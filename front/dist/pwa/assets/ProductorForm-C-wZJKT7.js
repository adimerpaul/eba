import{j as h,L as x,g as y,O as U,k as _,l as m,m as f,_ as O,c as b,o as v,w as u,$ as C,b as s,Z as g,t as I,a as n,as as r,f as V}from"./index-B477s0tw.js";import{Q as d}from"./QSelect-DVrLSWUT.js";import{Q as w,a as S}from"./format-BxWfQaud.js";import{Q as T}from"./QForm-C5kMoPlg.js";const q=h({name:"QBanner",props:{...x,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(i,{slots:o}){const{proxy:{$q:t}}=y(),c=U(i,t),e=_(()=>"q-banner row items-center"+(i.dense===!0?" q-banner--dense":"")+(c.value===!0?" q-banner--dark q-dark":"")+(i.rounded===!0?" rounded-borders":"")),a=_(()=>`q-banner__actions row items-center justify-end col-${i.inlineActions===!0?"auto":"all"}`);return()=>{const l=[m("div",{class:"q-banner__avatar col-auto row items-center self-start"},f(o.avatar)),m("div",{class:"q-banner__content col text-body2"},f(o.default))],p=f(o.action);return p!==void 0&&l.push(m("div",{class:a.value},p)),m("div",{class:e.value+(i.inlineActions===!1&&p!==void 0?" q-banner--top-padding":""),role:"alert"},l)}}}),N={name:"ProductorForm",props:{productor:{type:Object,default:null},tree:{type:Array,default:()=>[]},autoLoadTree:{type:Boolean,default:!0},bannerMsg:{type:String,default:""}},emits:["saved","cancel","error"],data(){return{localTree:[],saving:!1,banner:this.bannerMsg,orgOptions:[],orgLoading:!1,form:this.emptyForm(),sexoOptions:[{label:"Masculino",value:1},{label:"Femenino",value:2}]}},computed:{treeToUse(){return this.tree&&this.tree.length?this.tree:this.localTree},depOptions(){return(this.treeToUse||[]).map(i=>({label:i.nombre_departamento,value:i.id}))},provOptions(){const i=this.form.departamento_id;return i?((this.treeToUse||[]).find(t=>t.id===i)?.provincias||[]).map(t=>({label:t.nombre_provincia,value:t.id})):[]},munOptions(){const i=this.form.departamento_id,o=this.form.provincia_id;return!i||!o?[]:(((this.treeToUse||[]).find(e=>e.id===i)?.provincias||[]).find(e=>e.id===o)?.municipios||[]).map(e=>({label:e.nombre_municipio,value:e.id}))}},watch:{productor:{handler(){this.initFromProp()},immediate:!0}},mounted(){!this.tree?.length&&this.autoLoadTree&&this.loadTree()},methods:{emptyForm(){return{id:null,municipio_id:null,runsa:"0",sub_codigo:"",nombre:"",apellidos:"",numcarnet:"",expedido:"",fec_nacimiento:null,sexo:null,direccion:"",comunidad:"",proveedor:"",cip_acopio:"",num_celular:"",ocupacion:"",otros:"",seleccion:0,organizacion_id:null,fecha_registro:new Date().toISOString().slice(0,10),fecha_expiracion:null,estado:"VIGENTE",departamento_id:null,provincia_id:null}},async loadTree(){try{const{data:i}=await this.$axios.get("geo/tree");this.localTree=i}catch(i){this.$alert?.error?.(i.response?.data?.message||"No se pudo cargar el árbol geográfico")}},initFromProp(){const i=this.productor;if(!i){this.form=this.emptyForm();return}this.form={id:i.id??null,municipio_id:i.municipio?.id||i.municipio_id||null,runsa:i.runsa??"0",sub_codigo:i.sub_codigo??"",nombre:i.nombre??"",apellidos:i.apellidos??"",numcarnet:i.numcarnet??"",expedido:i.expedido??"",fec_nacimiento:i.fec_nacimiento??null,sexo:i.sexo??null,direccion:i.direccion??"",comunidad:i.comunidad??"",proveedor:i.proveedor??"",cip_acopio:i.cip_acopio??"",num_celular:i.num_celular??"",ocupacion:i.ocupacion??"",otros:i.otros??"",seleccion:i.seleccion??0,organizacion_id:i.organizacion?.id||i.organizacion_id||null,fecha_registro:i.fecha_registro??new Date().toISOString().slice(0,10),fecha_expiracion:i.fecha_expiracion??null,estado:i.estado??"VIGENTE",departamento_id:i.municipio?.departamento_id||null,provincia_id:i.municipio?.provincia_id||null}},onDepChange(){this.form.provincia_id=null,this.form.municipio_id=null},onProvChange(){this.form.municipio_id=null},async filterOrganizaciones(i,o){o(async()=>{this.orgLoading=!0;try{const{data:t}=await this.$axios.get("organizaciones",{params:{search:i||void 0,paginate:!1}});this.orgOptions=Array.isArray(t)?t:t?.data||[]}catch{this.orgOptions=[]}finally{this.orgLoading=!1}})},async submit(){this.saving=!0;try{const i={municipio_id:this.form.municipio_id,runsa:this.form.runsa,sub_codigo:this.form.sub_codigo,nombre:this.form.nombre,apellidos:this.form.apellidos,numcarnet:this.form.numcarnet,expedido:this.form.expedido,fec_nacimiento:this.form.fec_nacimiento,sexo:this.form.sexo,direccion:this.form.direccion,comunidad:this.form.comunidad,proveedor:this.form.proveedor,cip_acopio:this.form.cip_acopio,num_celular:this.form.num_celular,ocupacion:this.form.ocupacion,otros:this.form.otros,seleccion:this.form.seleccion,organizacion_id:this.form.organizacion_id,fecha_registro:this.form.fecha_registro,fecha_expiracion:this.form.fecha_expiracion,estado:this.form.estado};let o;this.form.id?o=await this.$axios.put(`productores/${this.form.id}`,i):o=await this.$axios.post("productores",i);const t=o.data;this.$alert?.success?.(this.form.id?"Productor actualizado":"Productor creado")}catch(i){const o=i.response?.data?.message||"No se pudo guardar";this.$alert?.error?.(o),this.$emit("error",i)}finally{this.saving=!1}}}},z={class:"row q-col-gutter-sm"},P={class:"col-6 col-sm-2"},F={class:"col-6 col-sm-2"},A={class:"col-12 col-sm-4"},B={class:"col-12 col-sm-4"},D={class:"col-6 col-sm-3"},E={class:"col-6 col-sm-2"},Q={class:"col-12 col-sm-3"},k={class:"col-12 col-sm-4"},L={class:"col-12"},R={class:"col-12 col-sm-4"},M={class:"col-12 col-sm-4"},G={class:"col-12 col-sm-4"},j={class:"col-12 col-sm-4"},Z={class:"col-12 col-sm-4"},H={class:"col-12 col-sm-4"},J={class:"col-12 col-sm-6"},K={class:"col-12 col-sm-4"},W={class:"col-12 col-sm-4"},X={class:"col-12 col-sm-4"},Y={class:"col-12 col-sm-4"},$={class:"col-12 col-sm-4"},oo={class:"col-12 col-sm-4"},eo={class:"col-12"},lo={class:"text-right q-gutter-sm"};function io(i,o,t,c,e,a){return v(),b(T,{onSubmit:a.submit,class:"q-gutter-md"},{default:u(()=>[e.banner?(v(),b(q,{key:0,class:"bg-yellow-1 text-yellow-10"},{default:u(()=>[g(I(e.banner),1)]),_:1})):C("",!0),s("div",z,[s("div",P,[n(r,{modelValue:e.form.runsa,"onUpdate:modelValue":o[0]||(o[0]=l=>e.form.runsa=l),label:"RUNSA",dense:"",outlined:""},null,8,["modelValue"])]),s("div",F,[n(r,{modelValue:e.form.sub_codigo,"onUpdate:modelValue":o[1]||(o[1]=l=>e.form.sub_codigo=l),label:"Sub Código",dense:"",outlined:""},null,8,["modelValue"])]),s("div",A,[n(r,{modelValue:e.form.nombre,"onUpdate:modelValue":o[2]||(o[2]=l=>e.form.nombre=l),label:"Nombre",dense:"",outlined:"",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"])]),s("div",B,[n(r,{modelValue:e.form.apellidos,"onUpdate:modelValue":o[3]||(o[3]=l=>e.form.apellidos=l),label:"Apellidos",dense:"",outlined:"",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"])]),s("div",D,[n(r,{modelValue:e.form.numcarnet,"onUpdate:modelValue":o[4]||(o[4]=l=>e.form.numcarnet=l),label:"N° Carnet",dense:"",outlined:"",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"])]),s("div",E,[n(r,{modelValue:e.form.expedido,"onUpdate:modelValue":o[5]||(o[5]=l=>e.form.expedido=l),label:"Expedido",dense:"",outlined:"",hint:"LP, CB, SC..."},null,8,["modelValue"])]),s("div",Q,[n(r,{modelValue:e.form.fec_nacimiento,"onUpdate:modelValue":o[6]||(o[6]=l=>e.form.fec_nacimiento=l),type:"date",label:"Nacimiento",dense:"",outlined:""},null,8,["modelValue"])]),s("div",k,[n(d,{modelValue:e.form.sexo,"onUpdate:modelValue":o[7]||(o[7]=l=>e.form.sexo=l),options:e.sexoOptions,label:"Sexo",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),s("div",L,[n(r,{modelValue:e.form.direccion,"onUpdate:modelValue":o[8]||(o[8]=l=>e.form.direccion=l),type:"textarea",label:"Dirección",dense:"",outlined:"",autogrow:""},null,8,["modelValue"])]),s("div",R,[n(r,{modelValue:e.form.comunidad,"onUpdate:modelValue":o[9]||(o[9]=l=>e.form.comunidad=l),label:"Comunidad",dense:"",outlined:""},null,8,["modelValue"])]),s("div",M,[n(r,{modelValue:e.form.proveedor,"onUpdate:modelValue":o[10]||(o[10]=l=>e.form.proveedor=l),label:"Proveedor",dense:"",outlined:""},null,8,["modelValue"])]),s("div",G,[n(r,{modelValue:e.form.cip_acopio,"onUpdate:modelValue":o[11]||(o[11]=l=>e.form.cip_acopio=l),label:"CIP Acopio",dense:"",outlined:""},null,8,["modelValue"])]),s("div",j,[n(r,{modelValue:e.form.num_celular,"onUpdate:modelValue":o[12]||(o[12]=l=>e.form.num_celular=l),label:"Celular",dense:"",outlined:""},null,8,["modelValue"])]),s("div",Z,[n(r,{modelValue:e.form.ocupacion,"onUpdate:modelValue":o[13]||(o[13]=l=>e.form.ocupacion=l),label:"Ocupación",dense:"",outlined:""},null,8,["modelValue"])]),s("div",H,[n(r,{modelValue:e.form.seleccion,"onUpdate:modelValue":o[14]||(o[14]=l=>e.form.seleccion=l),modelModifiers:{number:!0},type:"number",label:"Selección",dense:"",outlined:""},null,8,["modelValue"])]),s("div",J,[n(d,{modelValue:e.form.organizacion_id,"onUpdate:modelValue":o[15]||(o[15]=l=>e.form.organizacion_id=l),label:"Organización",dense:"",outlined:"","use-input":"","fill-input":"","input-debounce":"300",options:e.orgOptions,"option-label":"nombre_organiza","option-value":"id","emit-value":"","map-options":"",clearable:"",onFilter:a.filterOrganizaciones,loading:e.orgLoading,hint:"Escribe para buscar"},{"no-option":u(()=>[n(w,null,{default:u(()=>[n(S,{class:"text-grey"},{default:u(()=>o[24]||(o[24]=[g("Sin resultados")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","loading"])]),s("div",K,[n(d,{modelValue:e.form.departamento_id,"onUpdate:modelValue":[o[16]||(o[16]=l=>e.form.departamento_id=l),a.onDepChange],options:a.depOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",dense:"",outlined:"",label:"Departamento"},null,8,["modelValue","options","onUpdate:modelValue"])]),s("div",W,[n(d,{modelValue:e.form.provincia_id,"onUpdate:modelValue":[o[17]||(o[17]=l=>e.form.provincia_id=l),a.onProvChange],options:a.provOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",dense:"",outlined:"",label:"Provincia",disable:!e.form.departamento_id},null,8,["modelValue","options","disable","onUpdate:modelValue"])]),s("div",X,[n(d,{modelValue:e.form.municipio_id,"onUpdate:modelValue":o[18]||(o[18]=l=>e.form.municipio_id=l),options:a.munOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",dense:"",outlined:"",label:"Municipio",rules:[l=>!!l||"Requerido"],disable:!e.form.provincia_id},null,8,["modelValue","options","rules","disable"])]),s("div",Y,[n(r,{modelValue:e.form.fecha_registro,"onUpdate:modelValue":o[19]||(o[19]=l=>e.form.fecha_registro=l),type:"date",label:"Fecha Registro",dense:"",outlined:""},null,8,["modelValue"])]),s("div",$,[n(r,{modelValue:e.form.fecha_expiracion,"onUpdate:modelValue":o[20]||(o[20]=l=>e.form.fecha_expiracion=l),type:"date",label:"Fecha Expiración",dense:"",outlined:""},null,8,["modelValue"])]),s("div",oo,[n(d,{modelValue:e.form.estado,"onUpdate:modelValue":o[21]||(o[21]=l=>e.form.estado=l),options:["VIGENTE","VENCIDO","ACTIVO","INACTIVO"],label:"Estado",dense:"",outlined:""},null,8,["modelValue"])]),s("div",eo,[n(r,{modelValue:e.form.otros,"onUpdate:modelValue":o[22]||(o[22]=l=>e.form.otros=l),type:"textarea",label:"Otros",dense:"",outlined:"",autogrow:""},null,8,["modelValue"])])]),s("div",lo,[n(V,{flat:"",color:"negative",label:"Cancelar",disable:e.saving,onClick:o[23]||(o[23]=l=>i.$emit("cancel"))},null,8,["disable"]),n(V,{color:"primary",label:e.form.id?"Guardar cambios":"Crear productor",type:"submit",loading:e.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])}const ao=O(N,[["render",io],["__scopeId","data-v-7be71ec7"]]);export{ao as P};
