import{_ as S,c as m,o as n,w as a,b as s,a as e,f as u,a7 as v,a6 as I,a8 as A,a9 as D,t as i,J as p,d as E,a5 as x,aa as k,h as R,Q as q,e as f,I as w,ad as c,a4 as h}from"./index-HepSidP8.js";import{Q as P}from"./QSpace-Dn5WQffa.js";import{Q as L,a as g,b as H,c as _}from"./QTabPanels-C2uugagc.js";import{Q as J}from"./QPage-9wWivC71.js";import{P as K}from"./ProductorForm-Bg3H4JeE.js";import{P as W,a as X,b as Z}from"./ProductorMapa-0VSekzuB.js";import{Q as U,b,d as O}from"./format-CYYykBEP.js";import{Q as T}from"./QList-DlnRyfKv.js";import{Q as G}from"./QBtnDropdown-DxzJEjk7.js";import{Q as z}from"./QMarkupTable-CPy6o30-.js";import{Q as B}from"./QSelect-80M13KBl.js";import{Q as M}from"./QForm-v_lbYAMD.js";import{C as y}from"./ClosePopup-B47MtnAu.js";import{h as oo}from"./moment-C5S46NFB.js";import"./QResizeObserver-CxP2-EAc.js";import"./use-panel-DDp916IJ.js";import"./touch-BjYP5sR0.js";import"./selection-DCX2aG26.js";import"./QBanner-OkaNWTzL.js";import"./marker-shadow-DiDHNFYN.js";import"./QBadge-ComLELyn.js";const eo={name:"ProductorRunsas",props:{productor:{type:Object,required:!0}},emits:["updated"],data(){return{loading:!1,saving:!1,list:[],dlg:{open:!1},form:this.emptyForm()}},mounted(){this.hydrateFromProductor()},watch:{productor(){this.hydrateFromProductor()}},methods:{hydrateFromProductor(){this.productor?.runsas?this.list=this.productor.runsas:this.fetchRunsas()},async fetchRunsas(){console.log(this.productor),this.loading=!0;try{const{data:o}=await this.$axios.get("runsas",{params:{productor_id:this.productor.id,paginate:!1}});console.log(o),this.list=Array.isArray(o)?o:o?.data||[]}catch(o){console.log(o),this.list=[],this.$alert?.error?.(o.response?.data?.message||"No se pudo cargar runsas")}finally{this.loading=!1}},emptyForm(){return{id:null,productor_id:this.productor?.id||null,codigo:null,subcodigo:"",fecha_registro:null,fecha_vencimiento:null,estado:"VIGENTE"}},chip(o){return o==="VIGENTE"?"green":o==="VENCIDO"?"red":o==="SUSPENDIDO"?"orange":"grey"},startCreate(){this.form=this.emptyForm(),this.form.productor_id=this.productor?.id||null,this.dlg.open=!0},startEdit(o){this.form={id:o.id,productor_id:this.productor?.id||o.productor_id,codigo:o.codigo||null,subcodigo:o.subcodigo||"",fecha_registro:o.fecha_registro||null,fecha_vencimiento:o.fecha_vencimiento||null,estado:o.estado||"VIGENTE"},this.dlg.open=!0},async submit(){if(this.productor?.id){this.saving=!0;try{const o={...this.form,productor_id:this.productor.id};o.id?await this.$axios.put(`runsas/${o.id}`,o):await this.$axios.post("runsas",o),this.$alert?.success?.(o.id?"Runsa actualizada":"Runsa creada"),this.dlg.open=!1,this.$emit("updated")}catch(o){this.$alert?.error?.(o.response?.data?.message||"No se pudo guardar")}finally{this.saving=!1}}},remove(o){this.$alert?.dialog?.("¿Eliminar runsa?")?.onOk(async()=>{try{await this.$axios.delete(`runsas/${o.id}`),this.$alert?.success?.("Eliminado"),this.$emit("updated")}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo eliminar")}})}}},to={class:"row items-center q-gutter-sm q-mb-sm"},so={key:0},ro={class:"text-h6"},lo={class:"col-12 col-sm-4"},ao={class:"col-12 col-sm-8"},io={class:"col-6 col-sm-3"},no={class:"col-6 col-sm-3"},uo={class:"col-12 col-sm-3"},co={class:"col-12 text-right q-gutter-sm q-mt-sm"};function mo(o,t,N,F,r,d){return n(),m(f,null,{default:a(()=>[s("div",to,[t[6]||(t[6]=s("div",{class:"text-subtitle1"},"Certificaciones Runsa",-1)),e(P),e(u,{dense:"",color:"primary",icon:"add_circle",label:"Nueva",onClick:d.startCreate,disable:r.saving,"no-caps":""},null,8,["onClick","disable"])]),e(z,{dense:""},{default:a(()=>[t[10]||(t[10]=s("thead",null,[s("tr",{class:"bg-grey-3"},[s("th",{class:"text-left"},"#"),s("th",{class:"text-left",style:{width:"120px"}},"Opciones"),s("th",{class:"text-left"},"Codigo"),s("th",{class:"text-left"},"Subcodigo"),s("th",{class:"text-left"},"Registro"),s("th",{class:"text-left"},"Vencimiento"),s("th",{class:"text-left"},"Estado")])],-1)),s("tbody",null,[(n(!0),v(A,null,D(r.list||[],(l,C)=>(n(),v("tr",{key:l.id||C},[s("td",null,i(C+1),1),s("td",null,[e(G,{dense:"",label:"Opciones",color:"primary","no-caps":"",size:"10px"},{default:a(()=>[e(T,null,{default:a(()=>[p((n(),m(U,{clickable:"",onClick:Q=>d.startEdit(l)},{default:a(()=>[e(b,{avatar:""},{default:a(()=>[e(E,{name:"edit"})]),_:1}),e(b,null,{default:a(()=>t[7]||(t[7]=[x("Editar")])),_:1})]),_:2},1032,["onClick"])),[[k],[y]]),p((n(),m(U,{clickable:"",onClick:Q=>d.remove(l)},{default:a(()=>[e(b,{avatar:""},{default:a(()=>[e(E,{name:"delete",class:"text-negative"})]),_:1}),e(b,{class:"text-negative"},{default:a(()=>t[8]||(t[8]=[x("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[k],[y]])]),_:2},1024)]),_:2},1024)]),s("td",null,i(l.codigo||"-"),1),s("td",null,i(l.subcodigo||"-"),1),s("td",null,i(l.fecha_registro||"-"),1),s("td",null,i(l.fecha_vencimiento||"-"),1),s("td",null,[e(O,{color:d.chip(l.estado),"text-color":"white",size:"xs",class:"text-bold"},{default:a(()=>[x(i(l.estado),1)]),_:2},1032,["color"])])]))),128)),!r.loading&&(N.productor?.runsas?.length||0)===0?(n(),v("tr",so,t[9]||(t[9]=[s("td",{colspan:"8",class:"text-center text-grey"},"Sin registros",-1)]))):I("",!0)])]),_:1}),e(R,{modelValue:r.dlg.open,"onUpdate:modelValue":t[5]||(t[5]=l=>r.dlg.open=l),persistent:""},{default:a(()=>[e(q,{style:{"min-width":"720px","max-width":"95vw"}},{default:a(()=>[e(f,{class:"row items-center q-gutter-sm"},{default:a(()=>[s("div",ro,i(r.form.id?"Editar runsa":"Nueva runsa"),1),e(P),p(e(u,{flat:"",round:"",dense:"",icon:"close"},null,512),[[y]])]),_:1}),e(w),e(f,null,{default:a(()=>[e(M,{onSubmit:d.submit,class:"row q-col-gutter-sm"},{default:a(()=>[s("div",lo,[e(c,{modelValue:r.form.codigo,"onUpdate:modelValue":t[0]||(t[0]=l=>r.form.codigo=l),dense:"",outlined:"",label:"Codigo",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"])]),s("div",ao,[e(c,{modelValue:r.form.subcodigo,"onUpdate:modelValue":t[1]||(t[1]=l=>r.form.subcodigo=l),dense:"",outlined:"",label:"Subcodigo"},null,8,["modelValue"])]),s("div",io,[e(c,{modelValue:r.form.fecha_registro,"onUpdate:modelValue":t[2]||(t[2]=l=>r.form.fecha_registro=l),type:"date",dense:"",outlined:"",label:"Fec Registro"},null,8,["modelValue"])]),s("div",no,[e(c,{modelValue:r.form.fecha_vencimiento,"onUpdate:modelValue":t[3]||(t[3]=l=>r.form.fecha_vencimiento=l),type:"date",dense:"",outlined:"",label:"Fec Vencimiento"},null,8,["modelValue"])]),s("div",uo,[e(B,{modelValue:r.form.estado,"onUpdate:modelValue":t[4]||(t[4]=l=>r.form.estado=l),options:["VIGENTE","VENCIDO","SUSPENDIDO"],dense:"",outlined:"",label:"Estado"},null,8,["modelValue"])]),s("div",co,[p(e(u,{flat:"",color:"grey",label:"Cancelar",disable:r.saving},null,8,["disable"]),[[y]]),e(u,{color:"primary",label:r.form.id?"Guardar cambios":"Crear",type:"submit",loading:r.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const po=S(eo,[["render",mo]]),fo={name:"ProductorAcopios",props:{productor:{type:Object,required:!0}},emits:["updated"],data(){return{loading:!1,saving:!1,list:[],dlg:{open:!1},form:this.emptyForm(),acopioCosechas:[]}},mounted(){this.hydrateFromProductor()},watch:{productor(){this.hydrateFromProductor()}},methods:{async fetchAcopio(){this.loading=!0,console.log(this.productor),await this.$axios.get("/acopio/cosechas",{params:{fecha_inicio:"0001-01-01",fecha_fin:oo().format("YYYY-MM-DD"),productor_id:this.productor.id}}).then(o=>{console.log(o.data),this.acopioCosechas=o.data}).catch(o=>{console.log(o),this.$alert?.error?.(o.response?.data?.message||"No se pudo cargar las cosechas")}).finally(()=>{this.loading=!1})},hydrateFromProductor(){this.productor?.acopios?this.acopioCosechas=this.productor.acopios:this.fetchAcopio()},async fetchRunsas(){console.log(this.productor),this.loading=!0;try{const{data:o}=await this.$axios.get("runsas",{params:{productor_id:this.productor.id,paginate:!1}});console.log(o),this.list=Array.isArray(o)?o:o?.data||[]}catch(o){console.log(o),this.list=[],this.$alert?.error?.(o.response?.data?.message||"No se pudo cargar runsas")}finally{this.loading=!1}},emptyForm(){return{id:null,productor_id:this.productor?.id||null,codigo:null,subcodigo:"",fecha_registro:null,fecha_vencimiento:null,estado:"VIGENTE"}},chip(o){return o==="VIGENTE"?"green":o==="VENCIDO"?"red":o==="SUSPENDIDO"?"orange":"grey"},startCreate(){this.form=this.emptyForm(),this.form.productor_id=this.productor?.id||null,this.dlg.open=!0},startEdit(o){this.form={id:o.id,productor_id:this.productor?.id||o.productor_id,codigo:o.codigo||null,subcodigo:o.subcodigo||"",fecha_registro:o.fecha_registro||null,fecha_vencimiento:o.fecha_vencimiento||null,estado:o.estado||"VIGENTE"},this.dlg.open=!0},async submit(){if(this.productor?.id){this.saving=!0;try{const o={...this.form,productor_id:this.productor.id};o.id?await this.$axios.put(`runsas/${o.id}`,o):await this.$axios.post("runsas",o),this.$alert?.success?.(o.id?"Runsa actualizada":"Runsa creada"),this.dlg.open=!1,this.$emit("updated")}catch(o){this.$alert?.error?.(o.response?.data?.message||"No se pudo guardar")}finally{this.saving=!1}}},remove(o){this.$alert?.dialog?.("¿Eliminar runsa?")?.onOk(async()=>{try{await this.$axios.delete(`runsas/${o.id}`),this.$alert?.success?.("Eliminado"),this.$emit("updated")}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo eliminar")}})}}},ho={class:"row items-center q-gutter-sm q-mb-sm"},go={key:1,class:"text-center q-pa-md"},_o={class:"text-h6"},bo={class:"col-12 col-sm-4"},yo={class:"col-12 col-sm-8"},vo={class:"col-6 col-sm-3"},Vo={class:"col-6 col-sm-3"},xo={class:"col-12 col-sm-3"},Po={class:"col-12 text-right q-gutter-sm q-mt-sm"};function Co(o,t,N,F,r,d){return n(),m(f,null,{default:a(()=>[s("div",ho,[t[6]||(t[6]=s("div",{class:"text-subtitle1"},"Acopios Proveedor",-1)),e(P)]),r.acopioCosechas.length>0?(n(),m(z,{key:0,dense:"","wrap-cells":"",flat:"",bordered:""},{default:a(()=>[t[8]||(t[8]=s("thead",null,[s("tr",{class:"bg-primary text-white"},[s("th",null,"Opciones"),s("th",null,"Fecha Cosecha"),s("th",null,"Productor"),s("th",null,"Cantidad (kg)"),s("th",null,"Humedad (%)"),s("th",null,"Temperatura Almacenaje (°C)"),s("th",null,"Número Acta"),s("th",null,"Condiciones Almacenaje"),s("th",null,"Estado")])],-1)),s("tbody",null,[(n(!0),v(A,null,D(r.acopioCosechas,l=>(n(),v("tr",{key:l.id},[s("td",null,[e(G,{dense:"",label:"Opciones",color:"primary","no-caps":"",size:"10px"},{default:a(()=>[e(T,null,{default:a(()=>[p((n(),m(U,{clickable:"",to:`/acopio/cosechas/${l.id}`},{default:a(()=>[e(b,{avatar:""},{default:a(()=>[e(E,{name:"visibility"})]),_:1}),e(b,null,{default:a(()=>t[7]||(t[7]=[x("Ver Detalles")])),_:1})]),_:2},1032,["to"])),[[k]])]),_:2},1024)]),_:2},1024)]),s("td",null,i(l.fecha_cosecha),1),s("td",null,i(l.apiario?.productor.nombre)+" "+i(l.apiario?.productor.apellidos),1),s("td",null,i(l.cantidad_kg),1),s("td",null,i(l.humedad),1),s("td",null,i(l.temperatura_almacenaje),1),s("td",null,i(l.num_acta),1),s("td",null,i(l.condiciones_almacenaje),1),s("td",null,[e(O,{color:l.estado==="BUENO"?"green":"red","text-color":"white",dense:"",size:"10px"},{default:a(()=>[x(i(l.estado.replace("_"," ")),1)]),_:2},1032,["color"])])]))),128))])]),_:1})):(n(),v("div",go,[e(E,{name:"info",size:"48px",color:"grey-5"}),t[9]||(t[9]=s("div",{class:"text-subtitle2 text-grey-5"},"No se encontraron cosechas.",-1))])),e(R,{modelValue:r.dlg.open,"onUpdate:modelValue":t[5]||(t[5]=l=>r.dlg.open=l),persistent:""},{default:a(()=>[e(q,{style:{"min-width":"720px","max-width":"95vw"}},{default:a(()=>[e(f,{class:"row items-center q-gutter-sm"},{default:a(()=>[s("div",_o,i(r.form.id?"Editar runsa":"Nueva runsa"),1),e(P),p(e(u,{flat:"",round:"",dense:"",icon:"close"},null,512),[[y]])]),_:1}),e(w),e(f,null,{default:a(()=>[e(M,{onSubmit:d.submit,class:"row q-col-gutter-sm"},{default:a(()=>[s("div",bo,[e(c,{modelValue:r.form.codigo,"onUpdate:modelValue":t[0]||(t[0]=l=>r.form.codigo=l),dense:"",outlined:"",label:"Codigo",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"])]),s("div",yo,[e(c,{modelValue:r.form.subcodigo,"onUpdate:modelValue":t[1]||(t[1]=l=>r.form.subcodigo=l),dense:"",outlined:"",label:"Subcodigo"},null,8,["modelValue"])]),s("div",vo,[e(c,{modelValue:r.form.fecha_registro,"onUpdate:modelValue":t[2]||(t[2]=l=>r.form.fecha_registro=l),type:"date",dense:"",outlined:"",label:"Fec Registro"},null,8,["modelValue"])]),s("div",Vo,[e(c,{modelValue:r.form.fecha_vencimiento,"onUpdate:modelValue":t[3]||(t[3]=l=>r.form.fecha_vencimiento=l),type:"date",dense:"",outlined:"",label:"Fec Vencimiento"},null,8,["modelValue"])]),s("div",xo,[e(B,{modelValue:r.form.estado,"onUpdate:modelValue":t[4]||(t[4]=l=>r.form.estado=l),options:["VIGENTE","VENCIDO","SUSPENDIDO"],dense:"",outlined:"",label:"Estado"},null,8,["modelValue"])]),s("div",Po,[p(e(u,{flat:"",color:"grey",label:"Cancelar",disable:r.saving},null,8,["disable"]),[[y]]),e(u,{color:"primary",label:r.form.id?"Guardar cambios":"Crear",type:"submit",loading:r.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Eo=S(fo,[["render",Co]]),No={name:"ProductorShow",components:{ProductorMapa:Z,ProductorApiarios:X,ProductorCertificaciones:W,ProductorForm:K,ProductorRunsa:po,ProductorAcopios:Eo},data(){return{tab:"general",loading:!1,productor:null}},mounted(){this.fetchProductor()},methods:{async fetchProductor(){this.loading=!0;try{const o=this.$route.params.id,{data:t}=await this.$axios.get(`productores/${o}`);this.productor=t}catch(o){this.productor=null,this.$alert?.error?.(o.response?.data?.message||"No se pudo cargar el productor")}finally{this.loading=!1}},onSaved(o){this.productor=o,this.$alert?.success?.("Cambios guardados")}}},Qo={class:"row items-center q-gutter-sm q-mb-md"};function ko(o,t,N,F,r,d){const l=h("ProductorForm"),C=h("ProductorCertificaciones"),Q=h("ProductorRunsa"),j=h("ProductorApiarios"),Y=h("ProductorMapa"),$=h("ProductorAcopios");return n(),m(J,{class:"q-pa-md"},{default:a(()=>[s("div",Qo,[e(u,{flat:"",round:"",icon:"arrow_back",onClick:t[0]||(t[0]=V=>o.$router.push("/productores"))}),t[4]||(t[4]=s("div",{class:"text-h6"},"Editar Productor",-1)),e(P),e(u,{flat:"",round:"",icon:"refresh",loading:r.loading,onClick:d.fetchProductor},null,8,["loading","onClick"])]),e(q,{flat:"",bordered:""},{default:a(()=>[e(L,{modelValue:r.tab,"onUpdate:modelValue":t[1]||(t[1]=V=>r.tab=V),class:"text-primary",align:"left",dense:""},{default:a(()=>[e(g,{name:"general",icon:"badge",label:"1) Información general","no-caps":""}),e(g,{name:"runsa",icon:"assured_workload",label:"2) Runsa","no-caps":""}),e(g,{name:"certs",icon:"verified",label:"3) Certificaciones","no-caps":""}),e(g,{name:"apiarios",icon:"hive",label:"4) Apiarios","no-caps":""}),e(g,{name:"mapa",icon:"map",label:"5) Mapa","no-caps":""}),e(g,{name:"acopio",icon:"send",label:"6) Acopio","no-caps":""})]),_:1},8,["modelValue"]),e(w),e(H,{modelValue:r.tab,"onUpdate:modelValue":t[3]||(t[3]=V=>r.tab=V),animated:""},{default:a(()=>[e(_,{name:"general",class:"q-pa-none"},{default:a(()=>[!r.loading&&r.productor?(n(),m(f,{key:0},{default:a(()=>[e(l,{productor:r.productor,"banner-msg":"Actualiza los datos y guarda los cambios",onSaved:d.onSaved,onCancel:t[2]||(t[2]=V=>o.$router.back())},null,8,["productor","onSaved"])]),_:1})):I("",!0)]),_:1}),e(_,{name:"certs",class:"q-pa-none"},{default:a(()=>[e(C,{productor:r.productor,onUpdated:d.fetchProductor},null,8,["productor","onUpdated"])]),_:1}),e(_,{name:"runsa",class:"q-pa-none"},{default:a(()=>[e(Q,{productor:r.productor,onUpdated:d.fetchProductor},null,8,["productor","onUpdated"])]),_:1}),e(_,{name:"apiarios",class:"q-pa-none"},{default:a(()=>[e(j,{productor:r.productor,onUpdated:d.fetchProductor},null,8,["productor","onUpdated"])]),_:1}),e(_,{name:"mapa",class:"q-pa-none"},{default:a(()=>[e(Y,{productor:r.productor,onUpdated:d.fetchProductor},null,8,["productor","onUpdated"])]),_:1}),e(_,{name:"acopio",class:"q-pa-none"},{default:a(()=>[e($,{productor:r.productor,onUpdated:d.fetchProductor},null,8,["productor","onUpdated"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const Ko=S(No,[["render",ko]]);export{Ko as default};
