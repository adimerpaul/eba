import{_ as E,c as b,o as u,w as n,b as i,a as o,f as h,a0 as g,$ as O,a1 as S,a2 as q,t as d,W as v,d as w,Z as p,a4 as F,h as D,Q,e as k,a3 as z,as as c,Y as y}from"./index--cRk6gQu.js";import{Q as N}from"./QSpace-DeWfYgbd.js";import{Q as oe,a as M,b as te,c as P}from"./QTabPanels-B9G_LLTE.js";import{Q as le}from"./QPage-D4ZSi_d2.js";import{P as ie}from"./ProductorForm-Dg6Fk5CN.js";import{Q as U,a as f,d as R}from"./format-BzETV7Yi.js";import{Q as G,a as j,C as x}from"./ClosePopup-Dnr3QA3a.js";import{Q as B}from"./QMarkupTable-DCwPCXvL.js";import{Q as I}from"./QSelect-OpRcc1Xw.js";import{Q as Z}from"./QForm-S5_dUhpu.js";import{R as H,y as J,u as W,v as Y,i as K,L as T,m as X,a as $,b as ee}from"./marker-shadow-BDP4RPpA.js";import{Q as ae}from"./QBadge-CQjEBIFf.js";import"./touch-CP3fpweO.js";import"./use-panel-BgVYN2z6.js";import"./selection-Dsf8oOwm.js";const ne={name:"ProductorCertificaciones",props:{productor:{type:Object,required:!0}},emits:["updated"],data(){return{loading:!1,saving:!1,dlg:{open:!1},form:this.emptyForm(),tipoOptions:["ORGANICO","COMERCIO_JUSTO","DENOMINACION_ORIGEN","BUENAS_PRACTICAS"]}},methods:{emptyForm(){return{id:null,productor_id:this.productor?.id||null,tipo_certificacion:null,organismo_certificador:"",fecha_emision:null,fecha_vencimiento:null,certificado_url:"",estado:"VIGENTE"}},chip(t){return t==="VIGENTE"?"green":t==="VENCIDO"?"red":t==="SUSPENDIDO"?"orange":"grey"},shortUrl(t){try{return t&&t.length>40?t.slice(0,40)+"…":t||"-"}catch{return t||"-"}},startCreate(){this.form=this.emptyForm(),this.form.productor_id=this.productor?.id||null,this.dlg.open=!0},startEdit(t){this.form={id:t.id,productor_id:this.productor?.id||t.productor_id,tipo_certificacion:t.tipo_certificacion||null,organismo_certificador:t.organismo_certificador||"",fecha_emision:t.fecha_emision||null,fecha_vencimiento:t.fecha_vencimiento||null,certificado_url:t.certificado_url||"",estado:t.estado||"VIGENTE"},this.dlg.open=!0},async submit(){if(this.productor?.id){this.saving=!0;try{const t={...this.form,productor_id:this.productor.id};t.id?await this.$axios.put(`certificaciones/${t.id}`,t):await this.$axios.post("certificaciones",t),this.$alert?.success?.(t.id?"Certificación actualizada":"Certificación creada"),this.dlg.open=!1,this.$emit("updated")}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo guardar")}finally{this.saving=!1}}},remove(t){this.$alert?.dialog?.("¿Eliminar certificación?")?.onOk(async()=>{try{await this.$axios.delete(`certificaciones/${t.id}`),this.$alert?.success?.("Eliminado"),this.$emit("updated")}catch(e){this.$alert?.error?.(e.response?.data?.message||"No se pudo eliminar")}})},async printPdf(t){this.$axios.get(`certificaciones/${t.id}/print`,{responseType:"blob"}).then(e=>{let m=`certificacion_${t.id}.pdf`;const V=e.headers["content-disposition"];if(V){const s=V.match(/filename="?([^"]+)"?/i);s&&s[1]&&(m=s[1])}const l=new Blob([e.data],{type:"application/pdf"}),r=document.createElement("a");r.href=URL.createObjectURL(l),r.download=m,document.body.appendChild(r),r.click(),URL.revokeObjectURL(r.href),document.body.removeChild(r)}).catch(e=>{this.$alert?.error?.(e.response?.data?.message||"No se pudo generar el PDF")})}}},re={class:"row items-center q-gutter-sm q-mb-sm"},se=["href"],de={key:1},ue={key:0},me={class:"text-h6"},ce={class:"col-12 col-sm-4"},pe={class:"col-12 col-sm-8"},fe={class:"col-6 col-sm-3"},he={class:"col-6 col-sm-3"},ge={class:"col-12 col-sm-3"},_e={class:"col-12"},be={class:"col-12 text-right q-gutter-sm q-mt-sm"};function ye(t,e,m,V,l,r){return u(),b(k,null,{default:n(()=>[i("div",re,[e[7]||(e[7]=i("div",{class:"text-subtitle1"},"Certificaciones",-1)),o(N),o(h,{dense:"",color:"primary",icon:"add_circle",label:"Nueva",onClick:r.startCreate,disable:l.saving,"no-caps":""},null,8,["onClick","disable"])]),o(B,{dense:""},{default:n(()=>[e[12]||(e[12]=i("thead",null,[i("tr",{class:"bg-grey-3"},[i("th",{class:"text-left"},"#"),i("th",{class:"text-left",style:{width:"120px"}},"Opciones"),i("th",{class:"text-left"},"Tipo"),i("th",{class:"text-left"},"Organismo"),i("th",{class:"text-left"},"Emisión"),i("th",{class:"text-left"},"Vencimiento"),i("th",{class:"text-left"},"Estado"),i("th",{class:"text-left"},"URL")])],-1)),i("tbody",null,[(u(!0),g(S,null,q(m.productor?.certificaciones||[],(s,a)=>(u(),g("tr",{key:s.id||a},[i("td",null,d(a+1),1),i("td",null,[o(G,{dense:"",label:"Opciones",color:"primary","no-caps":"",size:"10px"},{default:n(()=>[o(j,null,{default:n(()=>[v((u(),b(U,{clickable:"",onClick:C=>r.startEdit(s)},{default:n(()=>[o(f,{avatar:""},{default:n(()=>[o(w,{name:"edit"})]),_:1}),o(f,null,{default:n(()=>e[8]||(e[8]=[p("Editar")])),_:1})]),_:2},1032,["onClick"])),[[F],[x]]),v((u(),b(U,{clickable:"",onClick:C=>r.remove(s)},{default:n(()=>[o(f,{avatar:""},{default:n(()=>[o(w,{name:"delete",class:"text-negative"})]),_:1}),o(f,{class:"text-negative"},{default:n(()=>e[9]||(e[9]=[p("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[F],[x]]),v((u(),b(U,{clickable:"",onClick:C=>r.printPdf(s)},{default:n(()=>[o(f,{avatar:""},{default:n(()=>[o(w,{name:"picture_as_pdf"})]),_:1}),o(f,null,{default:n(()=>e[10]||(e[10]=[p("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[F],[x]])]),_:2},1024)]),_:2},1024)]),i("td",null,d(s.tipo_certificacion||"-"),1),i("td",null,d(s.organismo_certificador||"-"),1),i("td",null,d(s.fecha_emision||"-"),1),i("td",null,d(s.fecha_vencimiento||"-"),1),i("td",null,[o(R,{color:r.chip(s.estado),"text-color":"white",size:"xs",class:"text-bold"},{default:n(()=>[p(d(s.estado),1)]),_:2},1032,["color"])]),i("td",null,[s.certificado_url?(u(),g("a",{key:0,href:s.certificado_url,target:"_blank"},d(r.shortUrl(s.certificado_url)),9,se)):(u(),g("span",de,"-"))])]))),128)),!l.loading&&(m.productor?.certificaciones?.length||0)===0?(u(),g("tr",ue,e[11]||(e[11]=[i("td",{colspan:"8",class:"text-center text-grey"},"Sin registros",-1)]))):O("",!0)])]),_:1}),o(D,{modelValue:l.dlg.open,"onUpdate:modelValue":e[6]||(e[6]=s=>l.dlg.open=s),persistent:""},{default:n(()=>[o(Q,{style:{"min-width":"720px","max-width":"95vw"}},{default:n(()=>[o(k,{class:"row items-center q-gutter-sm"},{default:n(()=>[i("div",me,d(l.form.id?"Editar certificación":"Nueva certificación"),1),o(N),v(o(h,{flat:"",round:"",dense:"",icon:"close"},null,512),[[x]])]),_:1}),o(z),o(k,null,{default:n(()=>[o(Z,{onSubmit:r.submit,class:"row q-col-gutter-sm"},{default:n(()=>[i("div",ce,[o(I,{modelValue:l.form.tipo_certificacion,"onUpdate:modelValue":e[0]||(e[0]=s=>l.form.tipo_certificacion=s),options:l.tipoOptions,dense:"",outlined:"",label:"Tipo",rules:[s=>!!s||"Requerido"]},null,8,["modelValue","options","rules"])]),i("div",pe,[o(c,{modelValue:l.form.organismo_certificador,"onUpdate:modelValue":e[1]||(e[1]=s=>l.form.organismo_certificador=s),dense:"",outlined:"",label:"Organismo certificador"},null,8,["modelValue"])]),i("div",fe,[o(c,{modelValue:l.form.fecha_emision,"onUpdate:modelValue":e[2]||(e[2]=s=>l.form.fecha_emision=s),type:"date",dense:"",outlined:"",label:"Emisión"},null,8,["modelValue"])]),i("div",he,[o(c,{modelValue:l.form.fecha_vencimiento,"onUpdate:modelValue":e[3]||(e[3]=s=>l.form.fecha_vencimiento=s),type:"date",dense:"",outlined:"",label:"Vencimiento"},null,8,["modelValue"])]),i("div",ge,[o(I,{modelValue:l.form.estado,"onUpdate:modelValue":e[4]||(e[4]=s=>l.form.estado=s),options:["VIGENTE","VENCIDO","SUSPENDIDO"],dense:"",outlined:"",label:"Estado"},null,8,["modelValue"])]),i("div",_e,[o(c,{modelValue:l.form.certificado_url,"onUpdate:modelValue":e[5]||(e[5]=s=>l.form.certificado_url=s),dense:"",outlined:"",label:"URL certificado (opcional)"},null,8,["modelValue"])]),i("div",be,[v(o(h,{flat:"",color:"grey",label:"Cancelar",disable:l.saving},null,8,["disable"]),[[x]]),o(h,{color:"primary",label:l.form.id?"Guardar cambios":"Crear",type:"submit",loading:l.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Ce=E(ne,[["render",ye]]);delete T.Icon.Default.prototype._getIconUrl;T.Icon.Default.mergeOptions({iconRetinaUrl:ee,iconUrl:$,shadowUrl:X});const ve={name:"ApiarioMap",components:{LMap:K,LTileLayer:Y,LMarker:W,LPopup:J,LControlLayers:H},props:{modelValue:{type:Object,default:()=>({latitud:null,longitud:null})},center:{type:Array,default:()=>[-16.5,-68.15]},zoomInit:{type:Number,default:14}},emits:["update:modelValue"],data(){return{zoom:this.zoomInit,local:{...this.modelValue},mapOptions:{zoomControl:!0,attributionControl:!1,zoomAnimation:!1,fadeAnimation:!1,markerZoomAnimation:!1}}},computed:{hasLatLng(){const{latitud:t,longitud:e}=this.local;return t!=null&&e!=null&&isFinite(t)&&isFinite(e)},mapCenter(){return this.hasLatLng?[Number(this.local.latitud),Number(this.local.longitud)]:this.center},mapObj(){return this.$refs.map?.leafletObject||null}},watch:{modelValue:{deep:!0,handler(t){t&&(t.latitud!==this.local.latitud||t.longitud!==this.local.longitud)&&(this.local={...t},this.$nextTick(()=>this.refresh()))}},local:{deep:!0,handler(t){const e={...this.modelValue,latitud:t.latitud??null,longitud:t.longitud??null};this.$emit("update:modelValue",e)}}},mounted(){this.$nextTick(()=>this.refresh())},methods:{fix(t){const e=Number(t);return isFinite(e)?e.toFixed(6):"-"},refresh(){const t=this.mapObj;t&&setTimeout(()=>{t.invalidateSize(),this.hasLatLng&&t.setView([Number(this.local.latitud),Number(this.local.longitud)],Math.max(t.getZoom()||this.zoom,15),{animate:!1})},60)},onMapClick(t){const{lat:e,lng:m}=t.latlng||{};e==null||m==null||(this.local.latitud=Number(e.toFixed(7)),this.local.longitud=Number(m.toFixed(7)),this.flyToLatLng())},onDragEnd(t){const e=t?.target?.getLatLng?.();e&&(this.local.latitud=Number(e.lat.toFixed(7)),this.local.longitud=Number(e.lng.toFixed(7)),this.flyToLatLng())},flyToLatLng(){const t=this.mapObj;!t||!this.hasLatLng||t.setView([Number(this.local.latitud),Number(this.local.longitud)],Math.max(t.getZoom()||this.zoom,16),{animate:!1})},locateMe(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(t=>{this.local.latitud=Number(t.coords.latitude.toFixed(7)),this.local.longitud=Number(t.coords.longitude.toFixed(7)),this.$nextTick(()=>this.flyToLatLng())})}}},xe={class:"map-wrapper"},Ve={class:"row items-center q-col-gutter-sm q-mb-sm"},Ae={class:"col-6 col-sm-3"},ke={class:"col-6 col-sm-3"},Le={class:"col-6 col-sm-3"},we={class:"col-6 col-sm-3"};function Ue(t,e,m,V,l,r){const s=y("l-control-layers"),a=y("l-tile-layer"),C=y("l-popup"),A=y("l-marker"),L=y("l-map");return u(),g("div",xe,[i("div",Ve,[i("div",Ae,[o(c,{modelValue:l.local.latitud,"onUpdate:modelValue":e[0]||(e[0]=_=>l.local.latitud=_),modelModifiers:{number:!0},dense:"",outlined:"",label:"Latitud"},null,8,["modelValue"])]),i("div",ke,[o(c,{modelValue:l.local.longitud,"onUpdate:modelValue":e[1]||(e[1]=_=>l.local.longitud=_),modelModifiers:{number:!0},dense:"",outlined:"",label:"Longitud"},null,8,["modelValue"])]),i("div",Le,[o(h,{dense:"","no-caps":"",color:"primary",icon:"place",label:"Ir a lat/lng",onClick:r.flyToLatLng,style:{width:"100%"}},null,8,["onClick"])]),i("div",we,[o(h,{dense:"","no-caps":"",color:"secondary",icon:"my_location",label:"Mi ubicación",onClick:r.locateMe,style:{width:"100%"}},null,8,["onClick"])])]),o(L,{ref:"map",zoom:l.zoom,center:r.mapCenter,options:l.mapOptions,style:{height:"360px","border-radius":"8px",overflow:"hidden"},onClick:r.onMapClick},{default:n(()=>[o(s,{position:"topright"}),o(a,{"layer-type":"base",name:"OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","max-zoom":19,visible:!0}),o(a,{"layer-type":"base",name:"Google Calle",url:"https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),o(a,{"layer-type":"base",name:"Google Satélite",url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),o(a,{"layer-type":"base",name:"Google Híbrido",url:"https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),r.hasLatLng?(u(),b(A,{key:0,"lat-lng":[Number(l.local.latitud),Number(l.local.longitud)],draggable:!0,onDragend:r.onDragEnd},{default:n(()=>[o(C,null,{default:n(()=>[i("div",null,[p("Lat: "+d(r.fix(l.local.latitud)),1),e[2]||(e[2]=i("br",null,null,-1)),p("Lng: "+d(r.fix(l.local.longitud)),1)])]),_:1})]),_:1},8,["lat-lng","onDragend"])):O("",!0)]),_:1},8,["zoom","center","options","onClick"])])}const Ne=E(ve,[["render",Ue],["__scopeId","data-v-253e10b2"]]),Oe={name:"ProductorApiarios",components:{ApiarioMap:Ne},props:{productor:{type:Object,required:!0}},emits:["updated"],data(){return{loading:!1,saving:!1,list:[],dlgApiario:{open:!1},formApiario:this.emptyApiario(),dlgColmena:{open:!1},currentApiario:null,colmenas:[],colLoading:!1,formColmena:this.emptyColmena(),tipoMielOptions:[]}},mounted(){this.hydrateFromProductor()},watch:{productor(){this.hydrateFromProductor()}},methods:{hydrateFromProductor(){this.productor?.apiarios?this.list=this.productor.apiarios:this.fetchApiarios()},async fetchApiarios(){this.loading=!0;try{const{data:t}=await this.$axios.get("apiarios",{params:{productor_id:this.productor.id,paginate:!1}});this.list=Array.isArray(t)?t:t?.data||[]}catch(t){this.list=[],this.$alert?.error?.(t.response?.data?.message||"No se pudo cargar apiarios")}finally{this.loading=!1}},emptyApiario(){return{id:null,productor_id:this.productor?.id||null,municipio_id:null,nombre_cip:"",latitud:null,longitud:null,altitud:null,lugar_apiario:"",numero_colmenas_runsa:null,numero_colmenas_prod:0,seleccion:0,rend_programa_nal:0,organizacion_id:0,fecha_instalacion:null,estado:"ACTIVO",fase:"",coordenada:""}},startCreate(){this.formApiario=this.emptyApiario(),this.dlgApiario.open=!0},startEdit(t){this.formApiario={...this.emptyApiario(),...t,productor_id:this.productor?.id||t.productor_id},this.dlgApiario.open=!0},onApiarioDialogShow(){this.$nextTick(()=>this.$refs.apiarioMap?.refresh())},async saveApiario(){this.saving=!0;try{const t={...this.formApiario,productor_id:this.productor.id};t.id?await this.$axios.put(`apiarios/${t.id}`,t):await this.$axios.post("apiarios",t),this.$alert?.success?.(t.id?"Apiario actualizado":"Apiario creado"),this.dlgApiario.open=!1,this.$emit("updated"),await this.fetchApiarios()}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo guardar apiario")}finally{this.saving=!1}},emptyColmena(){return{id:null,apiario_id:null,tipo_miel_id:null,codigo_colmena:"",tipo_colmena:"",fecha_instalacion:null,reina_fecha_nacimiento:null,reina_procedencia:"",estado:"ACTIVA"}},async openColmenas(t){this.currentApiario=t,this.dlgColmena.open=!0,await this.fetchTipoMiel(),await this.fetchColmenas()},async fetchTipoMiel(){try{const{data:t}=await this.$axios.get("tipo-miel");this.tipoMielOptions=Array.isArray(t)?t:t?.data||[]}catch{this.tipoMielOptions=[]}},async fetchColmenas(){if(this.currentApiario?.id){this.colLoading=!0;try{const{data:t}=await this.$axios.get("colmenas",{params:{apiario_id:this.currentApiario.id,paginate:!1}});this.colmenas=Array.isArray(t)?t:t?.data||[]}catch(t){this.colmenas=[],this.$alert?.error?.(t.response?.data?.message||"No se pudieron cargar colmenas")}finally{this.colLoading=!1}}},startCreateColmena(){this.formColmena=this.emptyColmena(),this.formColmena.apiario_id=this.currentApiario?.id||null},startEditColmena(t){this.formColmena={...this.emptyColmena(),...t,apiario_id:this.currentApiario?.id||t.apiario_id}},resetColmena(){this.startCreateColmena()},async saveColmena(){this.saving=!0;try{const t={...this.formColmena,apiario_id:this.currentApiario.id};t.id?await this.$axios.put(`colmenas/${t.id}`,t):await this.$axios.post("colmenas",t),this.$alert?.success?.(t.id?"Colmena actualizada":"Colmena creada"),await this.fetchColmenas(),this.$emit("updated")}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo guardar colmena")}finally{this.saving=!1}},removeColmena(t){this.$alert?.dialog?.("¿Eliminar colmena?")?.onOk(async()=>{try{await this.$axios.delete(`colmenas/${t.id}`),this.$alert?.success?.("Eliminado"),await this.fetchColmenas(),this.$emit("updated")}catch(e){this.$alert?.error?.(e.response?.data?.message||"No se pudo eliminar")}})}}},ze={class:"row items-center q-gutter-sm q-mb-sm"},Ie={key:0},Ee={key:1},Te={key:0},Me={class:"text-h6"},Pe={class:"col-12 col-sm-4"},Se={class:"col-12 col-sm-8"},qe={class:"col-6 col-sm-2"},Qe={class:"col-6 col-sm-2"},Fe={class:"col-12 col-sm-2"},De={class:"col-12"},Re={class:"col-6 col-sm-3"},Ge={class:"col-6 col-sm-3"},je={class:"col-6 col-sm-3"},Be={class:"col-6 col-sm-3"},Ze={class:"col-12 text-right q-gutter-sm q-mt-sm"},He={class:"text-h6"},Je={key:0},We={class:"text-subtitle2 q-mb-sm"},Ye={class:"col-12 col-sm-3"},Ke={class:"col-12 col-sm-3"},Xe={class:"col-12 col-sm-3"},$e={class:"col-12 col-sm-3"},eo={class:"col-12 col-sm-4"},oo={class:"col-12 col-sm-4"},to={class:"col-12 col-sm-4"},lo={class:"col-12 text-right q-gutter-sm"};function io(t,e,m,V,l,r){const s=y("ApiarioMap");return u(),b(k,null,{default:n(()=>[i("div",ze,[e[19]||(e[19]=i("div",{class:"text-subtitle1"},"Apiarios",-1)),o(N),o(h,{dense:"",color:"primary",icon:"add_circle",label:"Nuevo","no-caps":"",onClick:r.startCreate,disable:l.saving},null,8,["onClick","disable"])]),o(B,{dense:""},{default:n(()=>[e[24]||(e[24]=i("thead",null,[i("tr",{class:"bg-grey-3"},[i("th",{class:"text-left"},"#"),i("th",{class:"text-left"},"Opciones"),i("th",{class:"text-left"},"Nombre/CIP"),i("th",{class:"text-left"},"Lugar"),i("th",{class:"text-left"},"Ubicación"),i("th",{class:"text-left"},"Colmenas"),i("th",{class:"text-left"},"Estado"),i("th",{class:"text-left"},"Instalación")])],-1)),i("tbody",null,[(u(!0),g(S,null,q(l.list,(a,C)=>(u(),g("tr",{key:a.id},[i("td",null,d(C+1),1),i("td",null,[o(G,{dense:"",label:"Opciones","no-caps":"",color:"primary",size:"10px"},{default:n(()=>[o(j,null,{default:n(()=>[v((u(),b(U,{clickable:"",onClick:A=>r.startEdit(a)},{default:n(()=>[o(f,{avatar:""},{default:n(()=>[o(w,{name:"edit"})]),_:1}),o(f,null,{default:n(()=>e[20]||(e[20]=[p("Editar")])),_:1})]),_:2},1032,["onClick"])),[[x]]),v((u(),b(U,{clickable:"",onClick:A=>r.openColmenas(a)},{default:n(()=>[o(f,{avatar:""},{default:n(()=>[o(w,{name:"hive"})]),_:1}),o(f,null,{default:n(()=>e[21]||(e[21]=[p("Colmenas")])),_:1})]),_:2},1032,["onClick"])),[[x]]),v((u(),b(U,{clickable:"",onClick:A=>t.removeApiario(a)},{default:n(()=>[o(f,{avatar:""},{default:n(()=>[o(w,{class:"text-negative",name:"delete"})]),_:1}),o(f,{class:"text-negative"},{default:n(()=>e[22]||(e[22]=[p("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[x]])]),_:2},1024)]),_:2},1024)]),i("td",null,d(a.nombre_cip||"-"),1),i("td",null,d(a.lugar_apiario||"-"),1),i("td",null,[a.latitud&&a.longitud?(u(),g("span",Ie,d(a.latitud.toFixed?a.latitud.toFixed(6):a.latitud)+", "+d(a.longitud.toFixed?a.longitud.toFixed(6):a.longitud),1)):(u(),g("span",Ee,"-"))]),i("td",null,d((a.colmenas?a.colmenas.length:a.colmenas_count)??0),1),i("td",null,[o(R,{color:a.estado==="ACTIVO"?"green":"grey","text-color":"white",size:"xs",class:"text-bold"},{default:n(()=>[p(d(a.estado),1)]),_:2},1032,["color"])]),i("td",null,d(a.fecha_instalacion||"-"),1)]))),128)),!l.loading&&l.list.length===0?(u(),g("tr",Te,e[23]||(e[23]=[i("td",{colspan:"8",class:"text-center text-grey"},"Sin registros",-1)]))):O("",!0)])]),_:1}),o(D,{modelValue:l.dlgApiario.open,"onUpdate:modelValue":e[10]||(e[10]=a=>l.dlgApiario.open=a),persistent:"","transition-show":"none","transition-hide":"none",onShow:r.onApiarioDialogShow},{default:n(()=>[o(Q,{style:{"min-width":"900px","max-width":"95vw"}},{default:n(()=>[o(k,{class:"row items-center q-gutter-sm"},{default:n(()=>[i("div",Me,d(l.formApiario.id?"Editar apiario":"Nuevo apiario"),1),o(N),v(o(h,{flat:"",round:"",dense:"",icon:"close"},null,512),[[x]])]),_:1}),o(z),o(k,null,{default:n(()=>[o(Z,{onSubmit:r.saveApiario,class:"row q-col-gutter-sm"},{default:n(()=>[i("div",Pe,[o(c,{modelValue:l.formApiario.nombre_cip,"onUpdate:modelValue":e[0]||(e[0]=a=>l.formApiario.nombre_cip=a),label:"Nombre / CIP",dense:"",outlined:""},null,8,["modelValue"])]),i("div",Se,[o(c,{modelValue:l.formApiario.lugar_apiario,"onUpdate:modelValue":e[1]||(e[1]=a=>l.formApiario.lugar_apiario=a),label:"Lugar del apiario",dense:"",outlined:""},null,8,["modelValue"])]),i("div",qe,[o(c,{modelValue:l.formApiario.altitud,"onUpdate:modelValue":e[2]||(e[2]=a=>l.formApiario.altitud=a),modelModifiers:{number:!0},label:"Altitud (msnm)",dense:"",outlined:""},null,8,["modelValue"])]),i("div",Qe,[o(c,{modelValue:l.formApiario.fecha_instalacion,"onUpdate:modelValue":e[3]||(e[3]=a=>l.formApiario.fecha_instalacion=a),type:"date",label:"Instalación",dense:"",outlined:""},null,8,["modelValue"])]),i("div",Fe,[o(I,{modelValue:l.formApiario.estado,"onUpdate:modelValue":e[4]||(e[4]=a=>l.formApiario.estado=a),options:["ACTIVO","INACTIVO"],label:"Estado",dense:"",outlined:""},null,8,["modelValue"])]),i("div",De,[o(s,{ref:"apiarioMap",modelValue:l.formApiario,"onUpdate:modelValue":e[5]||(e[5]=a=>l.formApiario=a),center:[-16.5,-68.15],"zoom-init":14},null,8,["modelValue"])]),i("div",Re,[o(c,{modelValue:l.formApiario.numero_colmenas_runsa,"onUpdate:modelValue":e[6]||(e[6]=a=>l.formApiario.numero_colmenas_runsa=a),modelModifiers:{number:!0},type:"number",label:"Colmenas RUNSA",dense:"",outlined:""},null,8,["modelValue"])]),i("div",Ge,[o(c,{modelValue:l.formApiario.numero_colmenas_prod,"onUpdate:modelValue":e[7]||(e[7]=a=>l.formApiario.numero_colmenas_prod=a),modelModifiers:{number:!0},type:"number",label:"Colmenas PROD.",dense:"",outlined:""},null,8,["modelValue"])]),i("div",je,[o(c,{modelValue:l.formApiario.rend_programa_nal,"onUpdate:modelValue":e[8]||(e[8]=a=>l.formApiario.rend_programa_nal=a),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Rend. prog. nal",dense:"",outlined:""},null,8,["modelValue"])]),i("div",Be,[o(c,{modelValue:l.formApiario.seleccion,"onUpdate:modelValue":e[9]||(e[9]=a=>l.formApiario.seleccion=a),modelModifiers:{number:!0},type:"number",label:"Selección",dense:"",outlined:""},null,8,["modelValue"])]),i("div",Ze,[v(o(h,{flat:"",color:"grey",label:"Cancelar",disable:l.saving},null,8,["disable"]),[[x]]),o(h,{color:"primary",label:l.formApiario.id?"Guardar cambios":"Crear",type:"submit",loading:l.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue","onShow"]),o(D,{modelValue:l.dlgColmena.open,"onUpdate:modelValue":e[18]||(e[18]=a=>l.dlgColmena.open=a),persistent:"","transition-show":"none","transition-hide":"none"},{default:n(()=>[o(Q,{style:{"min-width":"900px","max-width":"95vw"}},{default:n(()=>[o(k,{class:"row items-center q-gutter-sm"},{default:n(()=>[i("div",He,"Colmenas — "+d(l.currentApiario?.nombre_cip||"Apiario #"+l.currentApiario?.id),1),o(N),o(h,{dense:"",color:"primary",icon:"add_circle",label:"Nueva colmena","no-caps":"",onClick:r.startCreateColmena},null,8,["onClick"]),v(o(h,{flat:"",round:"",dense:"",icon:"close"},null,512),[[x]])]),_:1}),o(z),o(k,null,{default:n(()=>[o(B,{dense:""},{default:n(()=>[e[28]||(e[28]=i("thead",null,[i("tr",{class:"bg-grey-3"},[i("th",null,"#"),i("th",null,"Opc."),i("th",null,"Código"),i("th",null,"Tipo"),i("th",null,"Tipo miel"),i("th",null,"Instalación"),i("th",null,"Reina nacimiento"),i("th",null,"Estado")])],-1)),i("tbody",null,[(u(!0),g(S,null,q(l.colmenas,(a,C)=>(u(),g("tr",{key:a.id||C},[i("td",null,d(C+1),1),i("td",null,[o(G,{dense:"","no-caps":"",size:"10px",label:"Opciones",color:"primary"},{default:n(()=>[o(j,null,{default:n(()=>[v((u(),b(U,{clickable:"",onClick:A=>r.startEditColmena(a)},{default:n(()=>[o(f,{avatar:""},{default:n(()=>[o(w,{name:"edit"})]),_:1}),o(f,null,{default:n(()=>e[25]||(e[25]=[p("Editar")])),_:1})]),_:2},1032,["onClick"])),[[x]]),v((u(),b(U,{clickable:"",onClick:A=>r.removeColmena(a)},{default:n(()=>[o(f,{avatar:""},{default:n(()=>[o(w,{class:"text-negative",name:"delete"})]),_:1}),o(f,{class:"text-negative"},{default:n(()=>e[26]||(e[26]=[p("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[x]])]),_:2},1024)]),_:2},1024)]),i("td",null,d(a.codigo_colmena||"-"),1),i("td",null,d(a.tipo_colmena||"-"),1),i("td",null,d(a.tipo_miel?.tipo_miel||a.tipoMiel?.tipo_miel||"-"),1),i("td",null,d(a.fecha_instalacion||"-"),1),i("td",null,d(a.reina_fecha_nacimiento||"-"),1),i("td",null,[o(R,{color:a.estado==="ACTIVA"?"green":"grey","text-color":"white",size:"xs"},{default:n(()=>[p(d(a.estado),1)]),_:2},1032,["color"])])]))),128)),!l.colLoading&&l.colmenas.length===0?(u(),g("tr",Je,e[27]||(e[27]=[i("td",{colspan:"8",class:"text-center text-grey"},"Sin colmenas",-1)]))):O("",!0)])]),_:1}),o(z,{class:"q-my-md"}),i("div",We,d(l.formColmena.id?"Editar colmena":"Nueva colmena"),1),o(Z,{onSubmit:r.saveColmena,class:"row q-col-gutter-sm"},{default:n(()=>[i("div",Ye,[o(c,{modelValue:l.formColmena.codigo_colmena,"onUpdate:modelValue":e[11]||(e[11]=a=>l.formColmena.codigo_colmena=a),dense:"",outlined:"",label:"Código"},null,8,["modelValue"])]),i("div",Ke,[o(c,{modelValue:l.formColmena.tipo_colmena,"onUpdate:modelValue":e[12]||(e[12]=a=>l.formColmena.tipo_colmena=a),dense:"",outlined:"",label:"Tipo colmena"},null,8,["modelValue"])]),i("div",Xe,[o(I,{modelValue:l.formColmena.tipo_miel_id,"onUpdate:modelValue":e[13]||(e[13]=a=>l.formColmena.tipo_miel_id=a),options:l.tipoMielOptions,"option-value":"id","option-label":"tipo_miel","emit-value":"","map-options":"",dense:"",outlined:"",label:"Tipo de miel"},null,8,["modelValue","options"])]),i("div",$e,[o(c,{modelValue:l.formColmena.fecha_instalacion,"onUpdate:modelValue":e[14]||(e[14]=a=>l.formColmena.fecha_instalacion=a),type:"date",dense:"",outlined:"",label:"Instalación"},null,8,["modelValue"])]),i("div",eo,[o(c,{modelValue:l.formColmena.reina_fecha_nacimiento,"onUpdate:modelValue":e[15]||(e[15]=a=>l.formColmena.reina_fecha_nacimiento=a),type:"date",dense:"",outlined:"",label:"Reina: nacimiento"},null,8,["modelValue"])]),i("div",oo,[o(c,{modelValue:l.formColmena.reina_procedencia,"onUpdate:modelValue":e[16]||(e[16]=a=>l.formColmena.reina_procedencia=a),dense:"",outlined:"",label:"Reina: procedencia"},null,8,["modelValue"])]),i("div",to,[o(I,{modelValue:l.formColmena.estado,"onUpdate:modelValue":e[17]||(e[17]=a=>l.formColmena.estado=a),options:["ACTIVA","INACTIVA"],dense:"",outlined:"",label:"Estado"},null,8,["modelValue"])]),i("div",lo,[o(h,{flat:"",color:"grey",label:"Limpiar",onClick:r.resetColmena,disable:l.saving},null,8,["onClick","disable"]),o(h,{color:"primary",label:l.formColmena.id?"Guardar cambios":"Agregar colmena",type:"submit",loading:l.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ao=E(Oe,[["render",io],["__scopeId","data-v-e650b14b"]]);delete T.Icon.Default.prototype._getIconUrl;T.Icon.Default.mergeOptions({iconRetinaUrl:ee,iconUrl:$,shadowUrl:X});const no={name:"ProductorMapa",components:{LMap:K,LTileLayer:Y,LMarker:W,LPopup:J,LControlLayers:H},props:{productor:{type:Object,required:!0},defaultCenter:{type:Array,default:()=>[-16.29,-63.59]},defaultZoom:{type:Number,default:6}},data(){return{zoom:this.defaultZoom,initialCenter:this.defaultCenter,mapOptions:{zoomControl:!0,attributionControl:!1,zoomAnimation:!1,fadeAnimation:!1,markerZoomAnimation:!1}}},computed:{mapObj(){return this.$refs.map?.leafletObject||null},apiariosConLatLng(){return(Array.isArray(this.productor?.apiarios)?this.productor.apiarios:[]).map(e=>{const m=Number(e.latitud),V=Number(e.longitud);return isFinite(m)&&isFinite(V)?{...e,lat:m,lng:V}:null}).filter(Boolean)}},watch:{productor:{deep:!0,handler(){this.$nextTick(()=>this.fitToMarkers())}}},mounted(){this.$nextTick(()=>this.fitToMarkers())},methods:{refresh(){const t=this.mapObj;t&&setTimeout(()=>{t.invalidateSize(),this.fitToMarkers(!0)},60)},fitToMarkers(t=!1){const e=this.mapObj;if(!e)return;const m=this.apiariosConLatLng.map(l=>[l.lat,l.lng]);if(m.length===0){e.setView(this.defaultCenter,this.defaultZoom,{animate:!1});return}if(m.length===1){const l=t?e.getZoom()||this.defaultZoom:Math.max(e.getZoom()||this.defaultZoom,15);e.setView(m[0],l,{animate:!1});return}const V=T.latLngBounds(m);e.fitBounds(V.pad(.2),{animate:!1})}}},ro={style:{height:"580px","border-radius":"8px",overflow:"hidden"}},so={style:{"min-width":"180px"}},uo={class:"text-bold"},mo={class:"text-grey-7",style:{"font-size":"12px"}},co={key:0,class:"q-mt-xs"};function po(t,e,m,V,l,r){const s=y("l-control-layers"),a=y("l-tile-layer"),C=y("l-popup"),A=y("l-marker"),L=y("l-map");return u(),b(k,{class:"q-pa-none"},{default:n(()=>[i("div",ro,[o(L,{ref:"map",zoom:l.zoom,center:l.initialCenter,options:l.mapOptions,style:{height:"100%",width:"100%"}},{default:n(()=>[o(s,{position:"topright"}),o(a,{"layer-type":"base",name:"OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","max-zoom":19,visible:!1}),o(a,{"layer-type":"base",name:"Google Calle",url:"https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),o(a,{"layer-type":"base",name:"Google Satélite",url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),o(a,{"layer-type":"base",name:"Google Híbrido",url:"https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}","max-zoom":21,visible:!0}),(u(!0),g(S,null,q(r.apiariosConLatLng,_=>(u(),b(A,{key:_.id,"lat-lng":[_.lat,_.lng]},{default:n(()=>[o(C,null,{default:n(()=>[i("div",so,[i("div",uo,d(_.nombre_cip||"Apiario #"+_.id),1),i("div",null,d(_.lugar_apiario||"-"),1),i("div",mo,[p(" Lat: "+d(_.lat.toFixed(6)),1),e[0]||(e[0]=i("br",null,null,-1)),p(" Lng: "+d(_.lng.toFixed(6)),1)]),_.estado?(u(),g("div",co,[e[1]||(e[1]=p(" Estado: ")),o(ae,{color:_.estado==="ACTIVO"?"green":"grey","text-color":"white",rounded:""},{default:n(()=>[p(d(_.estado),1)]),_:2},1032,["color"])])):O("",!0)])]),_:2},1024)]),_:2},1032,["lat-lng"]))),128))]),_:1},8,["zoom","center","options"])])]),_:1})}const fo=E(no,[["render",po],["__scopeId","data-v-9985e018"]]),ho={name:"ProductorShow",components:{ProductorMapa:fo,ProductorApiarios:ao,ProductorCertificaciones:Ce,ProductorForm:ie},data(){return{tab:"general",loading:!1,productor:null}},mounted(){this.fetchProductor()},methods:{async fetchProductor(){this.loading=!0;try{const t=this.$route.params.id,{data:e}=await this.$axios.get(`productores/${t}`);this.productor=e}catch(t){this.productor=null,this.$alert?.error?.(t.response?.data?.message||"No se pudo cargar el productor")}finally{this.loading=!1}},onSaved(t){this.productor=t,this.$alert?.success?.("Cambios guardados")}}},go={class:"row items-center q-gutter-sm q-mb-md"};function _o(t,e,m,V,l,r){const s=y("ProductorForm"),a=y("ProductorCertificaciones"),C=y("ProductorApiarios"),A=y("ProductorMapa");return u(),b(le,{class:"q-pa-md"},{default:n(()=>[i("div",go,[o(h,{flat:"",round:"",icon:"arrow_back",onClick:e[0]||(e[0]=L=>t.$router.back())}),e[4]||(e[4]=i("div",{class:"text-h6"},"Editar Productor",-1)),o(N),o(h,{flat:"",round:"",icon:"refresh",loading:l.loading,onClick:r.fetchProductor},null,8,["loading","onClick"])]),o(Q,{flat:"",bordered:""},{default:n(()=>[o(oe,{modelValue:l.tab,"onUpdate:modelValue":e[1]||(e[1]=L=>l.tab=L),class:"text-primary",align:"left",dense:""},{default:n(()=>[o(M,{name:"general",icon:"badge",label:"1) Información general","no-caps":""}),o(M,{name:"certs",icon:"verified",label:"2) Certificaciones","no-caps":""}),o(M,{name:"apiarios",icon:"hive",label:"3) Apiarios","no-caps":""}),o(M,{name:"mapa",icon:"map",label:"4) Mapa","no-caps":""})]),_:1},8,["modelValue"]),o(z),o(te,{modelValue:l.tab,"onUpdate:modelValue":e[3]||(e[3]=L=>l.tab=L),animated:""},{default:n(()=>[o(P,{name:"general",class:"q-pa-none"},{default:n(()=>[!l.loading&&l.productor?(u(),b(k,{key:0},{default:n(()=>[o(s,{productor:l.productor,"banner-msg":"Actualiza los datos y guarda los cambios",onSaved:r.onSaved,onCancel:e[2]||(e[2]=L=>t.$router.back())},null,8,["productor","onSaved"])]),_:1})):O("",!0)]),_:1}),o(P,{name:"certs",class:"q-pa-none"},{default:n(()=>[o(a,{productor:l.productor,onUpdated:r.fetchProductor},null,8,["productor","onUpdated"])]),_:1}),o(P,{name:"apiarios",class:"q-pa-none"},{default:n(()=>[o(C,{productor:l.productor,onUpdated:r.fetchProductor},null,8,["productor","onUpdated"])]),_:1}),o(P,{name:"mapa",class:"q-pa-none"},{default:n(()=>[o(A,{productor:l.productor,onUpdated:r.fetchProductor},null,8,["productor","onUpdated"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const Eo=E(ho,[["render",_o]]);export{Eo as default};
