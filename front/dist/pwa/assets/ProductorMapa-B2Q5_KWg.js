import{Q as N}from"./QSpace-Bu3AWtyB.js";import{_ as M,c as C,o as m,w as n,b as l,a as o,f as g,a7 as h,a6 as z,a8 as E,a9 as T,t as d,J as y,d as L,a5 as p,aa as F,h as q,Q,e as A,I as U,as as c,a4 as V}from"./index-CgsOsC2M.js";import{Q as w,b as f,d as D}from"./format-3XDpBjW3.js";import{Q as P,a as R}from"./QList-DUGaZj2J.js";import{Q as G}from"./QMarkupTable-BbQVqshu.js";import{Q as O}from"./QSelect-NBg615gq.js";import{Q as j}from"./QForm-OBneluEl.js";import{C as b}from"./ClosePopup-C42Spooc.js";import{R as B,y as Z,u as H,v as J,i as K,L as I,m as W,a as X,b as Y}from"./marker-shadow-CC2XAsfC.js";import{Q as $}from"./QBadge-CwbSe4P8.js";const ee={name:"ProductorCertificaciones",props:{productor:{type:Object,required:!0}},emits:["updated"],data(){return{loading:!1,saving:!1,dlg:{open:!1},form:this.emptyForm(),tipoOptions:["ORGANICO","COMERCIO_JUSTO","DENOMINACION_ORIGEN","BUENAS_PRACTICAS"]}},methods:{emptyForm(){return{id:null,productor_id:this.productor?.id||null,tipo_certificacion:null,organismo_certificador:"",fecha_emision:null,fecha_vencimiento:null,certificado_url:"",estado:"VIGENTE"}},chip(t){return t==="VIGENTE"?"green":t==="VENCIDO"?"red":t==="SUSPENDIDO"?"orange":"grey"},shortUrl(t){try{return t&&t.length>40?t.slice(0,40)+"…":t||"-"}catch{return t||"-"}},startCreate(){this.form=this.emptyForm(),this.form.productor_id=this.productor?.id||null,this.dlg.open=!0},startEdit(t){this.form={id:t.id,productor_id:this.productor?.id||t.productor_id,tipo_certificacion:t.tipo_certificacion||null,organismo_certificador:t.organismo_certificador||"",fecha_emision:t.fecha_emision||null,fecha_vencimiento:t.fecha_vencimiento||null,certificado_url:t.certificado_url||"",estado:t.estado||"VIGENTE"},this.dlg.open=!0},async submit(){if(this.productor?.id){this.saving=!0;try{const t={...this.form,productor_id:this.productor.id};t.id?await this.$axios.put(`certificaciones/${t.id}`,t):await this.$axios.post("certificaciones",t),this.$alert?.success?.(t.id?"Certificación actualizada":"Certificación creada"),this.dlg.open=!1,this.$emit("updated")}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo guardar")}finally{this.saving=!1}}},remove(t){this.$alert?.dialog?.("¿Eliminar certificación?")?.onOk(async()=>{try{await this.$axios.delete(`certificaciones/${t.id}`),this.$alert?.success?.("Eliminado"),this.$emit("updated")}catch(e){this.$alert?.error?.(e.response?.data?.message||"No se pudo eliminar")}})},async printPdf(t){this.$axios.get(`certificaciones/${t.id}/print`,{responseType:"blob"}).then(e=>{let u=`certificacion_${t.id}.pdf`;const v=e.headers["content-disposition"];if(v){const s=v.match(/filename="?([^"]+)"?/i);s&&s[1]&&(u=s[1])}const i=new Blob([e.data],{type:"application/pdf"}),r=document.createElement("a");r.href=URL.createObjectURL(i),r.download=u,document.body.appendChild(r),r.click(),URL.revokeObjectURL(r.href),document.body.removeChild(r)}).catch(e=>{this.$alert?.error?.(e.response?.data?.message||"No se pudo generar el PDF")})}}},oe={class:"row items-center q-gutter-sm q-mb-sm"},te=["href"],le={key:1},ie={key:0},ae={class:"text-h6"},ne={class:"col-12 col-sm-4"},se={class:"col-12 col-sm-8"},re={class:"col-6 col-sm-3"},de={class:"col-6 col-sm-3"},me={class:"col-12 col-sm-3"},ue={class:"col-12"},ce={class:"col-12 text-right q-gutter-sm q-mt-sm"};function pe(t,e,u,v,i,r){return m(),C(A,null,{default:n(()=>[l("div",oe,[e[7]||(e[7]=l("div",{class:"text-subtitle1"},"Certificaciones",-1)),o(N),o(g,{dense:"",color:"primary",icon:"add_circle",label:"Nueva",onClick:r.startCreate,disable:i.saving,"no-caps":""},null,8,["onClick","disable"])]),o(G,{dense:""},{default:n(()=>[e[12]||(e[12]=l("thead",null,[l("tr",{class:"bg-grey-3"},[l("th",{class:"text-left"},"#"),l("th",{class:"text-left",style:{width:"120px"}},"Opciones"),l("th",{class:"text-left"},"Tipo"),l("th",{class:"text-left"},"Organismo"),l("th",{class:"text-left"},"Emisión"),l("th",{class:"text-left"},"Vencimiento"),l("th",{class:"text-left"},"Estado"),l("th",{class:"text-left"},"URL")])],-1)),l("tbody",null,[(m(!0),h(E,null,T(u.productor?.certificaciones||[],(s,a)=>(m(),h("tr",{key:s.id||a},[l("td",null,d(a+1),1),l("td",null,[o(P,{dense:"",label:"Opciones",color:"primary","no-caps":"",size:"10px"},{default:n(()=>[o(R,null,{default:n(()=>[y((m(),C(w,{clickable:"",onClick:x=>r.startEdit(s)},{default:n(()=>[o(f,{avatar:""},{default:n(()=>[o(L,{name:"edit"})]),_:1}),o(f,null,{default:n(()=>e[8]||(e[8]=[p("Editar")])),_:1})]),_:2},1032,["onClick"])),[[F],[b]]),y((m(),C(w,{clickable:"",onClick:x=>r.remove(s)},{default:n(()=>[o(f,{avatar:""},{default:n(()=>[o(L,{name:"delete",class:"text-negative"})]),_:1}),o(f,{class:"text-negative"},{default:n(()=>e[9]||(e[9]=[p("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[F],[b]]),y((m(),C(w,{clickable:"",onClick:x=>r.printPdf(s)},{default:n(()=>[o(f,{avatar:""},{default:n(()=>[o(L,{name:"picture_as_pdf"})]),_:1}),o(f,null,{default:n(()=>e[10]||(e[10]=[p("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[F],[b]])]),_:2},1024)]),_:2},1024)]),l("td",null,d(s.tipo_certificacion||"-"),1),l("td",null,d(s.organismo_certificador||"-"),1),l("td",null,d(s.fecha_emision||"-"),1),l("td",null,d(s.fecha_vencimiento||"-"),1),l("td",null,[o(D,{color:r.chip(s.estado),"text-color":"white",size:"xs",class:"text-bold"},{default:n(()=>[p(d(s.estado),1)]),_:2},1032,["color"])]),l("td",null,[s.certificado_url?(m(),h("a",{key:0,href:s.certificado_url,target:"_blank"},d(r.shortUrl(s.certificado_url)),9,te)):(m(),h("span",le,"-"))])]))),128)),!i.loading&&(u.productor?.certificaciones?.length||0)===0?(m(),h("tr",ie,e[11]||(e[11]=[l("td",{colspan:"8",class:"text-center text-grey"},"Sin registros",-1)]))):z("",!0)])]),_:1}),o(q,{modelValue:i.dlg.open,"onUpdate:modelValue":e[6]||(e[6]=s=>i.dlg.open=s),persistent:""},{default:n(()=>[o(Q,{style:{"min-width":"720px","max-width":"95vw"}},{default:n(()=>[o(A,{class:"row items-center q-gutter-sm"},{default:n(()=>[l("div",ae,d(i.form.id?"Editar certificación":"Nueva certificación"),1),o(N),y(o(g,{flat:"",round:"",dense:"",icon:"close"},null,512),[[b]])]),_:1}),o(U),o(A,null,{default:n(()=>[o(j,{onSubmit:r.submit,class:"row q-col-gutter-sm"},{default:n(()=>[l("div",ne,[o(O,{modelValue:i.form.tipo_certificacion,"onUpdate:modelValue":e[0]||(e[0]=s=>i.form.tipo_certificacion=s),options:i.tipoOptions,dense:"",outlined:"",label:"Tipo",rules:[s=>!!s||"Requerido"]},null,8,["modelValue","options","rules"])]),l("div",se,[o(c,{modelValue:i.form.organismo_certificador,"onUpdate:modelValue":e[1]||(e[1]=s=>i.form.organismo_certificador=s),dense:"",outlined:"",label:"Organismo certificador"},null,8,["modelValue"])]),l("div",re,[o(c,{modelValue:i.form.fecha_emision,"onUpdate:modelValue":e[2]||(e[2]=s=>i.form.fecha_emision=s),type:"date",dense:"",outlined:"",label:"Emisión"},null,8,["modelValue"])]),l("div",de,[o(c,{modelValue:i.form.fecha_vencimiento,"onUpdate:modelValue":e[3]||(e[3]=s=>i.form.fecha_vencimiento=s),type:"date",dense:"",outlined:"",label:"Vencimiento"},null,8,["modelValue"])]),l("div",me,[o(O,{modelValue:i.form.estado,"onUpdate:modelValue":e[4]||(e[4]=s=>i.form.estado=s),options:["VIGENTE","VENCIDO","SUSPENDIDO"],dense:"",outlined:"",label:"Estado"},null,8,["modelValue"])]),l("div",ue,[o(c,{modelValue:i.form.certificado_url,"onUpdate:modelValue":e[5]||(e[5]=s=>i.form.certificado_url=s),dense:"",outlined:"",label:"URL certificado (opcional)"},null,8,["modelValue"])]),l("div",ce,[y(o(g,{flat:"",color:"grey",label:"Cancelar",disable:i.saving},null,8,["disable"]),[[b]]),o(g,{color:"primary",label:i.form.id?"Guardar cambios":"Crear",type:"submit",loading:i.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const _o=M(ee,[["render",pe]]);delete I.Icon.Default.prototype._getIconUrl;I.Icon.Default.mergeOptions({iconRetinaUrl:Y,iconUrl:X,shadowUrl:W});const fe={name:"ApiarioMap",components:{LMap:K,LTileLayer:J,LMarker:H,LPopup:Z,LControlLayers:B},props:{modelValue:{type:Object,default:()=>({latitud:null,longitud:null})},center:{type:Array,default:()=>[-16.5,-68.15]},zoomInit:{type:Number,default:14}},emits:["update:modelValue"],data(){return{zoom:this.zoomInit,local:{...this.modelValue},mapOptions:{zoomControl:!0,attributionControl:!1,zoomAnimation:!1,fadeAnimation:!1,markerZoomAnimation:!1}}},computed:{hasLatLng(){const{latitud:t,longitud:e}=this.local;return t!=null&&e!=null&&isFinite(t)&&isFinite(e)},mapCenter(){return this.hasLatLng?[Number(this.local.latitud),Number(this.local.longitud)]:this.center},mapObj(){return this.$refs.map?.leafletObject||null}},watch:{modelValue:{deep:!0,handler(t){t&&(t.latitud!==this.local.latitud||t.longitud!==this.local.longitud)&&(this.local={...t},this.$nextTick(()=>this.refresh()))}},local:{deep:!0,handler(t){const e={...this.modelValue,latitud:t.latitud??null,longitud:t.longitud??null};this.$emit("update:modelValue",e)}}},mounted(){this.$nextTick(()=>this.refresh())},methods:{fix(t){const e=Number(t);return isFinite(e)?e.toFixed(6):"-"},refresh(){const t=this.mapObj;t&&setTimeout(()=>{t.invalidateSize(),this.hasLatLng&&t.setView([Number(this.local.latitud),Number(this.local.longitud)],Math.max(t.getZoom()||this.zoom,15),{animate:!1})},60)},onMapClick(t){const{lat:e,lng:u}=t.latlng||{};e==null||u==null||(this.local.latitud=Number(e.toFixed(7)),this.local.longitud=Number(u.toFixed(7)),this.flyToLatLng())},onDragEnd(t){const e=t?.target?.getLatLng?.();e&&(this.local.latitud=Number(e.lat.toFixed(7)),this.local.longitud=Number(e.lng.toFixed(7)),this.flyToLatLng())},flyToLatLng(){const t=this.mapObj;!t||!this.hasLatLng||t.setView([Number(this.local.latitud),Number(this.local.longitud)],Math.max(t.getZoom()||this.zoom,16),{animate:!1})},locateMe(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(t=>{this.local.latitud=Number(t.coords.latitude.toFixed(7)),this.local.longitud=Number(t.coords.longitude.toFixed(7)),this.$nextTick(()=>this.flyToLatLng())})}}},he={class:"map-wrapper"},_e={class:"row items-center q-col-gutter-sm q-mb-sm"},ge={class:"col-6 col-sm-3"},ye={class:"col-6 col-sm-3"},be={class:"col-6 col-sm-3"},Ce={class:"col-6 col-sm-3"};function ve(t,e,u,v,i,r){const s=V("l-control-layers"),a=V("l-tile-layer"),x=V("l-popup"),k=V("l-marker"),S=V("l-map");return m(),h("div",he,[l("div",_e,[l("div",ge,[o(c,{modelValue:i.local.latitud,"onUpdate:modelValue":e[0]||(e[0]=_=>i.local.latitud=_),modelModifiers:{number:!0},dense:"",outlined:"",label:"Latitud"},null,8,["modelValue"])]),l("div",ye,[o(c,{modelValue:i.local.longitud,"onUpdate:modelValue":e[1]||(e[1]=_=>i.local.longitud=_),modelModifiers:{number:!0},dense:"",outlined:"",label:"Longitud"},null,8,["modelValue"])]),l("div",be,[o(g,{dense:"","no-caps":"",color:"primary",icon:"place",label:"Ir a lat/lng",onClick:r.flyToLatLng,style:{width:"100%"}},null,8,["onClick"])]),l("div",Ce,[o(g,{dense:"","no-caps":"",color:"secondary",icon:"my_location",label:"Mi ubicación",onClick:r.locateMe,style:{width:"100%"}},null,8,["onClick"])])]),o(S,{ref:"map",zoom:i.zoom,center:r.mapCenter,options:i.mapOptions,style:{height:"360px","border-radius":"8px",overflow:"hidden"},onClick:r.onMapClick},{default:n(()=>[o(s,{position:"topright"}),o(a,{"layer-type":"base",name:"OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","max-zoom":19,visible:!0}),o(a,{"layer-type":"base",name:"Google Calle",url:"https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),o(a,{"layer-type":"base",name:"Google Satélite",url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),o(a,{"layer-type":"base",name:"Google Híbrido",url:"https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),r.hasLatLng?(m(),C(k,{key:0,"lat-lng":[Number(i.local.latitud),Number(i.local.longitud)],draggable:!0,onDragend:r.onDragEnd},{default:n(()=>[o(x,null,{default:n(()=>[l("div",null,[p("Lat: "+d(r.fix(i.local.latitud)),1),e[2]||(e[2]=l("br",null,null,-1)),p("Lng: "+d(r.fix(i.local.longitud)),1)])]),_:1})]),_:1},8,["lat-lng","onDragend"])):z("",!0)]),_:1},8,["zoom","center","options","onClick"])])}const xe=M(fe,[["render",ve],["__scopeId","data-v-253e10b2"]]),Ve={name:"ProductorApiarios",components:{ApiarioMap:xe},props:{productor:{type:Object,required:!0}},emits:["updated"],data(){return{loading:!1,saving:!1,list:[],dlgApiario:{open:!1},formApiario:this.emptyApiario(),dlgColmena:{open:!1},currentApiario:null,colmenas:[],colLoading:!1,formColmena:this.emptyColmena(),tipoMielOptions:[]}},mounted(){this.hydrateFromProductor()},watch:{productor(){this.hydrateFromProductor()}},methods:{hydrateFromProductor(){this.productor?.apiarios?this.list=this.productor.apiarios:this.fetchApiarios()},async fetchApiarios(){this.loading=!0;try{const{data:t}=await this.$axios.get("apiarios",{params:{productor_id:this.productor.id,paginate:!1}});this.list=Array.isArray(t)?t:t?.data||[]}catch(t){this.list=[],this.$alert?.error?.(t.response?.data?.message||"No se pudo cargar apiarios")}finally{this.loading=!1}},emptyApiario(){return{id:null,productor_id:this.productor?.id||null,municipio_id:null,nombre_cip:"",latitud:null,longitud:null,altitud:null,lugar_apiario:"",numero_colmenas_runsa:null,numero_colmenas_prod:0,seleccion:0,rend_programa_nal:0,organizacion_id:0,fecha_instalacion:null,estado:"ACTIVO",fase:"",coordenada:""}},startCreate(){this.formApiario=this.emptyApiario(),this.dlgApiario.open=!0},startEdit(t){this.formApiario={...this.emptyApiario(),...t,productor_id:this.productor?.id||t.productor_id},this.dlgApiario.open=!0},onApiarioDialogShow(){this.$nextTick(()=>this.$refs.apiarioMap?.refresh())},async saveApiario(){this.saving=!0;try{const t={...this.formApiario,productor_id:this.productor.id};t.id?await this.$axios.put(`apiarios/${t.id}`,t):await this.$axios.post("apiarios",t),this.$alert?.success?.(t.id?"Apiario actualizado":"Apiario creado"),this.dlgApiario.open=!1,this.$emit("updated"),await this.fetchApiarios()}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo guardar apiario")}finally{this.saving=!1}},emptyColmena(){return{id:null,apiario_id:null,tipo_miel_id:null,codigo_colmena:"",tipo_colmena:"",fecha_instalacion:null,reina_fecha_nacimiento:null,reina_procedencia:"",estado:"ACTIVA"}},async openColmenas(t){this.currentApiario=t,this.dlgColmena.open=!0,await this.fetchTipoMiel(),await this.fetchColmenas()},async fetchTipoMiel(){try{const{data:t}=await this.$axios.get("tipo-miel");this.tipoMielOptions=Array.isArray(t)?t:t?.data||[]}catch{this.tipoMielOptions=[]}},async fetchColmenas(){if(this.currentApiario?.id){this.colLoading=!0;try{const{data:t}=await this.$axios.get("colmenas",{params:{apiario_id:this.currentApiario.id,paginate:!1}});this.colmenas=Array.isArray(t)?t:t?.data||[]}catch(t){this.colmenas=[],this.$alert?.error?.(t.response?.data?.message||"No se pudieron cargar colmenas")}finally{this.colLoading=!1}}},startCreateColmena(){this.formColmena=this.emptyColmena(),this.formColmena.apiario_id=this.currentApiario?.id||null},startEditColmena(t){this.formColmena={...this.emptyColmena(),...t,apiario_id:this.currentApiario?.id||t.apiario_id}},resetColmena(){this.startCreateColmena()},async saveColmena(){this.saving=!0;try{const t={...this.formColmena,apiario_id:this.currentApiario.id};t.id?await this.$axios.put(`colmenas/${t.id}`,t):await this.$axios.post("colmenas",t),this.$alert?.success?.(t.id?"Colmena actualizada":"Colmena creada"),await this.fetchColmenas(),this.$emit("updated")}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo guardar colmena")}finally{this.saving=!1}},removeColmena(t){this.$alert?.dialog?.("¿Eliminar colmena?")?.onOk(async()=>{try{await this.$axios.delete(`colmenas/${t.id}`),this.$alert?.success?.("Eliminado"),await this.fetchColmenas(),this.$emit("updated")}catch(e){this.$alert?.error?.(e.response?.data?.message||"No se pudo eliminar")}})}}},Ae={class:"row items-center q-gutter-sm q-mb-sm"},ke={key:0},Le={key:1},we={key:0},Ne={class:"text-h6"},Oe={class:"col-12 col-sm-4"},ze={class:"col-12 col-sm-8"},Ie={class:"col-6 col-sm-2"},Ue={class:"col-6 col-sm-2"},Ee={class:"col-12 col-sm-2"},Te={class:"col-12"},Me={class:"col-6 col-sm-3"},Se={class:"col-6 col-sm-3"},Fe={class:"col-6 col-sm-3"},qe={class:"col-6 col-sm-3"},Qe={class:"col-12 text-right q-gutter-sm q-mt-sm"},De={class:"text-h6"},Pe={key:0},Re={class:"text-subtitle2 q-mb-sm"},Ge={class:"col-12 col-sm-3"},je={class:"col-12 col-sm-3"},Be={class:"col-12 col-sm-3"},Ze={class:"col-12 col-sm-3"},He={class:"col-12 col-sm-4"},Je={class:"col-12 col-sm-4"},Ke={class:"col-12 col-sm-4"},We={class:"col-12 text-right q-gutter-sm"};function Xe(t,e,u,v,i,r){const s=V("ApiarioMap");return m(),C(A,null,{default:n(()=>[l("div",Ae,[e[19]||(e[19]=l("div",{class:"text-subtitle1"},"Apiarios",-1)),o(N),o(g,{dense:"",color:"primary",icon:"add_circle",label:"Nuevo","no-caps":"",onClick:r.startCreate,disable:i.saving},null,8,["onClick","disable"])]),o(G,{dense:""},{default:n(()=>[e[24]||(e[24]=l("thead",null,[l("tr",{class:"bg-grey-3"},[l("th",{class:"text-left"},"#"),l("th",{class:"text-left"},"Opciones"),l("th",{class:"text-left"},"Nombre/CIP"),l("th",{class:"text-left"},"Lugar"),l("th",{class:"text-left"},"Ubicación"),l("th",{class:"text-left"},"Colmenas"),l("th",{class:"text-left"},"Estado"),l("th",{class:"text-left"},"Instalación")])],-1)),l("tbody",null,[(m(!0),h(E,null,T(i.list,(a,x)=>(m(),h("tr",{key:a.id},[l("td",null,d(x+1),1),l("td",null,[o(P,{dense:"",label:"Opciones","no-caps":"",color:"primary",size:"10px"},{default:n(()=>[o(R,null,{default:n(()=>[y((m(),C(w,{clickable:"",onClick:k=>r.startEdit(a)},{default:n(()=>[o(f,{avatar:""},{default:n(()=>[o(L,{name:"edit"})]),_:1}),o(f,null,{default:n(()=>e[20]||(e[20]=[p("Editar")])),_:1})]),_:2},1032,["onClick"])),[[b]]),y((m(),C(w,{clickable:"",onClick:k=>r.openColmenas(a)},{default:n(()=>[o(f,{avatar:""},{default:n(()=>[o(L,{name:"hive"})]),_:1}),o(f,null,{default:n(()=>e[21]||(e[21]=[p("Colmenas")])),_:1})]),_:2},1032,["onClick"])),[[b]]),y((m(),C(w,{clickable:"",onClick:k=>t.removeApiario(a)},{default:n(()=>[o(f,{avatar:""},{default:n(()=>[o(L,{class:"text-negative",name:"delete"})]),_:1}),o(f,{class:"text-negative"},{default:n(()=>e[22]||(e[22]=[p("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[b]])]),_:2},1024)]),_:2},1024)]),l("td",null,d(a.nombre_cip||"-"),1),l("td",null,d(a.lugar_apiario||"-"),1),l("td",null,[a.latitud&&a.longitud?(m(),h("span",ke,d(a.latitud.toFixed?a.latitud.toFixed(6):a.latitud)+", "+d(a.longitud.toFixed?a.longitud.toFixed(6):a.longitud),1)):(m(),h("span",Le,"-"))]),l("td",null,d((a.colmenas?a.colmenas.length:a.colmenas_count)??0),1),l("td",null,[o(D,{color:a.estado==="ACTIVO"?"green":"grey","text-color":"white",size:"xs",class:"text-bold"},{default:n(()=>[p(d(a.estado),1)]),_:2},1032,["color"])]),l("td",null,d(a.fecha_instalacion||"-"),1)]))),128)),!i.loading&&i.list.length===0?(m(),h("tr",we,e[23]||(e[23]=[l("td",{colspan:"8",class:"text-center text-grey"},"Sin registros",-1)]))):z("",!0)])]),_:1}),o(q,{modelValue:i.dlgApiario.open,"onUpdate:modelValue":e[10]||(e[10]=a=>i.dlgApiario.open=a),persistent:"","transition-show":"none","transition-hide":"none",onShow:r.onApiarioDialogShow},{default:n(()=>[o(Q,{style:{"min-width":"900px","max-width":"95vw"}},{default:n(()=>[o(A,{class:"row items-center q-gutter-sm"},{default:n(()=>[l("div",Ne,d(i.formApiario.id?"Editar apiario":"Nuevo apiario"),1),o(N),y(o(g,{flat:"",round:"",dense:"",icon:"close"},null,512),[[b]])]),_:1}),o(U),o(A,null,{default:n(()=>[o(j,{onSubmit:r.saveApiario,class:"row q-col-gutter-sm"},{default:n(()=>[l("div",Oe,[o(c,{modelValue:i.formApiario.nombre_cip,"onUpdate:modelValue":e[0]||(e[0]=a=>i.formApiario.nombre_cip=a),label:"Nombre / CIP",dense:"",outlined:""},null,8,["modelValue"])]),l("div",ze,[o(c,{modelValue:i.formApiario.lugar_apiario,"onUpdate:modelValue":e[1]||(e[1]=a=>i.formApiario.lugar_apiario=a),label:"Lugar del apiario",dense:"",outlined:""},null,8,["modelValue"])]),l("div",Ie,[o(c,{modelValue:i.formApiario.altitud,"onUpdate:modelValue":e[2]||(e[2]=a=>i.formApiario.altitud=a),modelModifiers:{number:!0},label:"Altitud (msnm)",dense:"",outlined:""},null,8,["modelValue"])]),l("div",Ue,[o(c,{modelValue:i.formApiario.fecha_instalacion,"onUpdate:modelValue":e[3]||(e[3]=a=>i.formApiario.fecha_instalacion=a),type:"date",label:"Instalación",dense:"",outlined:""},null,8,["modelValue"])]),l("div",Ee,[o(O,{modelValue:i.formApiario.estado,"onUpdate:modelValue":e[4]||(e[4]=a=>i.formApiario.estado=a),options:["ACTIVO","INACTIVO"],label:"Estado",dense:"",outlined:""},null,8,["modelValue"])]),l("div",Te,[o(s,{ref:"apiarioMap",modelValue:i.formApiario,"onUpdate:modelValue":e[5]||(e[5]=a=>i.formApiario=a),center:[-16.5,-68.15],"zoom-init":14},null,8,["modelValue"])]),l("div",Me,[o(c,{modelValue:i.formApiario.numero_colmenas_runsa,"onUpdate:modelValue":e[6]||(e[6]=a=>i.formApiario.numero_colmenas_runsa=a),modelModifiers:{number:!0},type:"number",label:"Colmenas RUNSA",dense:"",outlined:""},null,8,["modelValue"])]),l("div",Se,[o(c,{modelValue:i.formApiario.numero_colmenas_prod,"onUpdate:modelValue":e[7]||(e[7]=a=>i.formApiario.numero_colmenas_prod=a),modelModifiers:{number:!0},type:"number",label:"Colmenas PROD.",dense:"",outlined:""},null,8,["modelValue"])]),l("div",Fe,[o(c,{modelValue:i.formApiario.rend_programa_nal,"onUpdate:modelValue":e[8]||(e[8]=a=>i.formApiario.rend_programa_nal=a),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Rend. prog. nal",dense:"",outlined:""},null,8,["modelValue"])]),l("div",qe,[o(c,{modelValue:i.formApiario.seleccion,"onUpdate:modelValue":e[9]||(e[9]=a=>i.formApiario.seleccion=a),modelModifiers:{number:!0},type:"number",label:"Selección",dense:"",outlined:""},null,8,["modelValue"])]),l("div",Qe,[y(o(g,{flat:"",color:"grey",label:"Cancelar",disable:i.saving},null,8,["disable"]),[[b]]),o(g,{color:"primary",label:i.formApiario.id?"Guardar cambios":"Crear",type:"submit",loading:i.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue","onShow"]),o(q,{modelValue:i.dlgColmena.open,"onUpdate:modelValue":e[18]||(e[18]=a=>i.dlgColmena.open=a),persistent:"","transition-show":"none","transition-hide":"none"},{default:n(()=>[o(Q,{style:{"min-width":"900px","max-width":"95vw"}},{default:n(()=>[o(A,{class:"row items-center q-gutter-sm"},{default:n(()=>[l("div",De,"Colmenas — "+d(i.currentApiario?.nombre_cip||"Apiario #"+i.currentApiario?.id),1),o(N),o(g,{dense:"",color:"primary",icon:"add_circle",label:"Nueva colmena","no-caps":"",onClick:r.startCreateColmena},null,8,["onClick"]),y(o(g,{flat:"",round:"",dense:"",icon:"close"},null,512),[[b]])]),_:1}),o(U),o(A,null,{default:n(()=>[o(G,{dense:""},{default:n(()=>[e[28]||(e[28]=l("thead",null,[l("tr",{class:"bg-grey-3"},[l("th",null,"#"),l("th",null,"Opc."),l("th",null,"Código"),l("th",null,"Tipo"),l("th",null,"Tipo miel"),l("th",null,"Instalación"),l("th",null,"Reina nacimiento"),l("th",null,"Estado")])],-1)),l("tbody",null,[(m(!0),h(E,null,T(i.colmenas,(a,x)=>(m(),h("tr",{key:a.id||x},[l("td",null,d(x+1),1),l("td",null,[o(P,{dense:"","no-caps":"",size:"10px",label:"Opciones",color:"primary"},{default:n(()=>[o(R,null,{default:n(()=>[y((m(),C(w,{clickable:"",onClick:k=>r.startEditColmena(a)},{default:n(()=>[o(f,{avatar:""},{default:n(()=>[o(L,{name:"edit"})]),_:1}),o(f,null,{default:n(()=>e[25]||(e[25]=[p("Editar")])),_:1})]),_:2},1032,["onClick"])),[[b]]),y((m(),C(w,{clickable:"",onClick:k=>r.removeColmena(a)},{default:n(()=>[o(f,{avatar:""},{default:n(()=>[o(L,{class:"text-negative",name:"delete"})]),_:1}),o(f,{class:"text-negative"},{default:n(()=>e[26]||(e[26]=[p("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[b]])]),_:2},1024)]),_:2},1024)]),l("td",null,d(a.codigo_colmena||"-"),1),l("td",null,d(a.tipo_colmena||"-"),1),l("td",null,d(a.tipo_miel?.tipo_miel||a.tipoMiel?.tipo_miel||"-"),1),l("td",null,d(a.fecha_instalacion||"-"),1),l("td",null,d(a.reina_fecha_nacimiento||"-"),1),l("td",null,[o(D,{color:a.estado==="ACTIVA"?"green":"grey","text-color":"white",size:"xs"},{default:n(()=>[p(d(a.estado),1)]),_:2},1032,["color"])])]))),128)),!i.colLoading&&i.colmenas.length===0?(m(),h("tr",Pe,e[27]||(e[27]=[l("td",{colspan:"8",class:"text-center text-grey"},"Sin colmenas",-1)]))):z("",!0)])]),_:1}),o(U,{class:"q-my-md"}),l("div",Re,d(i.formColmena.id?"Editar colmena":"Nueva colmena"),1),o(j,{onSubmit:r.saveColmena,class:"row q-col-gutter-sm"},{default:n(()=>[l("div",Ge,[o(c,{modelValue:i.formColmena.codigo_colmena,"onUpdate:modelValue":e[11]||(e[11]=a=>i.formColmena.codigo_colmena=a),dense:"",outlined:"",label:"Código"},null,8,["modelValue"])]),l("div",je,[o(c,{modelValue:i.formColmena.tipo_colmena,"onUpdate:modelValue":e[12]||(e[12]=a=>i.formColmena.tipo_colmena=a),dense:"",outlined:"",label:"Tipo colmena"},null,8,["modelValue"])]),l("div",Be,[o(O,{modelValue:i.formColmena.tipo_miel_id,"onUpdate:modelValue":e[13]||(e[13]=a=>i.formColmena.tipo_miel_id=a),options:i.tipoMielOptions,"option-value":"id","option-label":"tipo_miel","emit-value":"","map-options":"",dense:"",outlined:"",label:"Tipo de miel"},null,8,["modelValue","options"])]),l("div",Ze,[o(c,{modelValue:i.formColmena.fecha_instalacion,"onUpdate:modelValue":e[14]||(e[14]=a=>i.formColmena.fecha_instalacion=a),type:"date",dense:"",outlined:"",label:"Instalación"},null,8,["modelValue"])]),l("div",He,[o(c,{modelValue:i.formColmena.reina_fecha_nacimiento,"onUpdate:modelValue":e[15]||(e[15]=a=>i.formColmena.reina_fecha_nacimiento=a),type:"date",dense:"",outlined:"",label:"Reina: nacimiento"},null,8,["modelValue"])]),l("div",Je,[o(c,{modelValue:i.formColmena.reina_procedencia,"onUpdate:modelValue":e[16]||(e[16]=a=>i.formColmena.reina_procedencia=a),dense:"",outlined:"",label:"Reina: procedencia"},null,8,["modelValue"])]),l("div",Ke,[o(O,{modelValue:i.formColmena.estado,"onUpdate:modelValue":e[17]||(e[17]=a=>i.formColmena.estado=a),options:["ACTIVA","INACTIVA"],dense:"",outlined:"",label:"Estado"},null,8,["modelValue"])]),l("div",We,[o(g,{flat:"",color:"grey",label:"Limpiar",onClick:r.resetColmena,disable:i.saving},null,8,["onClick","disable"]),o(g,{color:"primary",label:i.formColmena.id?"Guardar cambios":"Agregar colmena",type:"submit",loading:i.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const go=M(Ve,[["render",Xe],["__scopeId","data-v-e650b14b"]]);delete I.Icon.Default.prototype._getIconUrl;I.Icon.Default.mergeOptions({iconRetinaUrl:Y,iconUrl:X,shadowUrl:W});const Ye={name:"ProductorMapa",components:{LMap:K,LTileLayer:J,LMarker:H,LPopup:Z,LControlLayers:B},props:{productor:{type:Object,required:!0},defaultCenter:{type:Array,default:()=>[-16.29,-63.59]},defaultZoom:{type:Number,default:6}},data(){return{zoom:this.defaultZoom,initialCenter:this.defaultCenter,mapOptions:{zoomControl:!0,attributionControl:!1,zoomAnimation:!1,fadeAnimation:!1,markerZoomAnimation:!1}}},computed:{mapObj(){return this.$refs.map?.leafletObject||null},apiariosConLatLng(){return(Array.isArray(this.productor?.apiarios)?this.productor.apiarios:[]).map(e=>{const u=Number(e.latitud),v=Number(e.longitud);return isFinite(u)&&isFinite(v)?{...e,lat:u,lng:v}:null}).filter(Boolean)}},watch:{productor:{deep:!0,handler(){this.$nextTick(()=>this.fitToMarkers())}}},mounted(){this.$nextTick(()=>this.fitToMarkers())},methods:{refresh(){const t=this.mapObj;t&&setTimeout(()=>{t.invalidateSize(),this.fitToMarkers(!0)},60)},fitToMarkers(t=!1){const e=this.mapObj;if(!e)return;const u=this.apiariosConLatLng.map(i=>[i.lat,i.lng]);if(u.length===0){e.setView(this.defaultCenter,this.defaultZoom,{animate:!1});return}if(u.length===1){const i=t?e.getZoom()||this.defaultZoom:Math.max(e.getZoom()||this.defaultZoom,15);e.setView(u[0],i,{animate:!1});return}const v=I.latLngBounds(u);e.fitBounds(v.pad(.2),{animate:!1})}}},$e={style:{height:"580px","border-radius":"8px",overflow:"hidden"}},eo={style:{"min-width":"180px"}},oo={class:"text-bold"},to={class:"text-grey-7",style:{"font-size":"12px"}},lo={key:0,class:"q-mt-xs"};function io(t,e,u,v,i,r){const s=V("l-control-layers"),a=V("l-tile-layer"),x=V("l-popup"),k=V("l-marker"),S=V("l-map");return m(),C(A,{class:"q-pa-none"},{default:n(()=>[l("div",$e,[o(S,{ref:"map",zoom:i.zoom,center:i.initialCenter,options:i.mapOptions,style:{height:"100%",width:"100%"}},{default:n(()=>[o(s,{position:"topright"}),o(a,{"layer-type":"base",name:"OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","max-zoom":19,visible:!1}),o(a,{"layer-type":"base",name:"Google Calle",url:"https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),o(a,{"layer-type":"base",name:"Google Satélite",url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),o(a,{"layer-type":"base",name:"Google Híbrido",url:"https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}","max-zoom":21,visible:!0}),(m(!0),h(E,null,T(r.apiariosConLatLng,_=>(m(),C(k,{key:_.id,"lat-lng":[_.lat,_.lng]},{default:n(()=>[o(x,null,{default:n(()=>[l("div",eo,[l("div",oo,d(_.nombre_cip||"Apiario #"+_.id),1),l("div",null,d(_.lugar_apiario||"-"),1),l("div",to,[p(" Lat: "+d(_.lat.toFixed(6)),1),e[0]||(e[0]=l("br",null,null,-1)),p(" Lng: "+d(_.lng.toFixed(6)),1)]),_.estado?(m(),h("div",lo,[e[1]||(e[1]=p(" Estado: ")),o($,{color:_.estado==="ACTIVO"?"green":"grey","text-color":"white",rounded:""},{default:n(()=>[p(d(_.estado),1)]),_:2},1032,["color"])])):z("",!0)])]),_:2},1024)]),_:2},1032,["lat-lng"]))),128))]),_:1},8,["zoom","center","options"])])]),_:1})}const yo=M(Ye,[["render",io],["__scopeId","data-v-9985e018"]]);export{_o as P,go as a,yo as b};
