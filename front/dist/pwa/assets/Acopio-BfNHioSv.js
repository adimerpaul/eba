import{_ as O,c as m,o as r,w as i,a as l,Q,e as v,b as t,O as E,aa as h,aF as N,af as p,a8 as f,f as y,ab as w,ac as A,P as U,d as C,ad as k,t as d}from"./index-BN7mrdDx.js";import{Q as u}from"./QSelect-BPlie7Fo.js";import{Q as V,b as g,d as P}from"./format-NUIwdYMO.js";import{Q as $}from"./QForm-CqYjiPd0.js";import{Q as D,a as F}from"./QList-DzNteVDs.js";import{Q as _}from"./QMarkupTable-BIA3691u.js";import{Q as B}from"./QPage-BdLvf_of.js";import{h as S}from"./moment-C5S46NFB.js";import"./selection-DyHD8BGF.js";const I={name:"AcopioPage",data:function(){return{search:"",numActa:null,acopioCosechas:[],loadingProductores:!1,productor:null,productorOptions:[],productos:[],producto:null,loading:!1,fechaInicio:S().startOf("month").format("YYYY-MM-DD"),fechaFin:S().endOf("month").format("YYYY-MM-DD"),estados:[{label:"BUENO",value:"BUENO"},{label:"EN PROCESO",value:"EN_PROCESO"},{label:"CANCELADO",value:"CANCELADO"}],estadoSeleccionado:null,departamentos:[],departamentoSeleccionado:null,provincias:[],provinciaSeleccionado:null,municipios:[],municipioSeleccionado:null}},mounted(){this.buscarCosechas(),this.productoGet()},methods:{getDepartamentos(){this.$axios.get("/departamentos").then(({data:e})=>{this.departamentos=e?.data||e||[]}).catch(()=>{this.$q.notify({type:"negative",message:"No se pudieron cargar los departamentos"})})},getMunicipios(){if(!this.departamentoSeleccionado){this.municipios=[];return}this.$axios.get("/municipios",{params:{departamento_id:this.departamentoSeleccionado.value}}).then(({data:e})=>{console.log(e),this.municipios=e?.data||e||[]}).catch(()=>{this.$q.notify({type:"negative",message:"No se pudieron cargar los municipios"})})},filterProductores(e,a,c){if(!e||e.length<2){a(()=>{this.productorOptions=[]});return}a(async()=>{this.loadingProductores=!0;try{const{data:n}=await this.$axios.get("/productores",{params:{search:e,per_page:20}}),b=(n?.data||n||[]).map(s=>({value:s.id,label:`${s.nombre??""} ${s.apellidos??""} — ${s.municipio?.nombre_municipio??""}`.trim(),raw:s}));this.productorOptions=b}catch{this.$q.notify({type:"negative",message:"No se pudo cargar productores"})}finally{this.loadingProductores=!1}})},async productoGet(){this.$axios.get("/productos/tipo/1").then(({data:e})=>{console.log(e),this.productos=e?.data||e||[],this.productos.unshift({id:null,nombre_producto:"Todos"}),this.producto=null}).catch(()=>{this.$q.notify({type:"negative",message:"No se pudieron cargar los productos"})})},async generarExcel(){this.loading=!0,await this.$axios.post("acopioExcel",{fecha_inicio:this.fechaInicio,fecha_fin:this.fechaFin,estado:this.estadoSeleccionado},{responseType:"blob"}).then(e=>{const a=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=window.URL.createObjectURL(a),n=document.createElement("a");n.href=c,n.setAttribute("download","acopio.xlsx"),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(c)}).catch(e=>{this.$alert?.error?.(e.response?.data?.message||"No se pudo generar el reporte.")}).finally(()=>{this.loading=!1})},buscarCosechas(){this.loading=!0,console.log(this.producto),this.$axios.get("/acopio/cosechas",{params:{fecha_inicio:this.fechaInicio,fecha_fin:this.fechaFin,estado:this.estadoSeleccionado,productor_id:this.productor,num_acta:this.numActa,producto_id:this.producto,departamento_id:this.departamentoSeleccionado,municipio_id:this.municipioSeleccionado,search:this.search}}).then(e=>{console.log(e.data),this.acopioCosechas=e.data}).finally(()=>{this.loading=!1})}}},L={class:"row q-gutter-sm"},M={class:"col-12 col-md-2"},R={class:"col-12 col-md-2"},Y={class:"col-12 col-md-3"},q={class:"col-12 col-md-3"},j={class:"col-6 col-md-3"},T={class:"col-12 col-md-3"},x={class:"col-12 col-md-3"},z={class:"col-12 col-md-3"},G={class:"col-12 col-md-3"},H={class:"col-12 col-md-2 flex flex-center"},X={class:"col-12 col-md-2 flex flex-center"},J={key:1,class:"text-center q-pa-md"};function K(e,a,c,n,b,s){return r(),m(B,{class:"q-pa-xs"},{default:i(()=>[l(Q,null,{default:i(()=>[l(v,null,{default:i(()=>a[11]||(a[11]=[t("div",{class:"text-h6"},"Acopio de Cosechas",-1)])),_:1}),l(E),l(v,null,{default:i(()=>[l($,{onSubmit:N(s.buscarCosechas,["prevent"])},{default:i(()=>[t("div",L,[t("div",M,[l(p,{modelValue:e.fechaInicio,"onUpdate:modelValue":a[0]||(a[0]=o=>e.fechaInicio=o),label:"Fecha Inicio",type:"date",dense:"",outlined:""},null,8,["modelValue"])]),t("div",R,[l(p,{modelValue:e.fechaFin,"onUpdate:modelValue":a[1]||(a[1]=o=>e.fechaFin=o),label:"Fecha Fin",type:"date",dense:"",outlined:""},null,8,["modelValue"])]),t("div",Y,[l(u,{modelValue:e.estadoSeleccionado,"onUpdate:modelValue":a[2]||(a[2]=o=>e.estadoSeleccionado=o),options:e.estados,label:"Estado de Cosecha",dense:"",outlined:"",clearable:""},null,8,["modelValue","options"])]),t("div",q,[l(u,{modelValue:e.productor,"onUpdate:modelValue":a[3]||(a[3]=o=>e.productor=o),options:e.productorOptions,"option-label":"label","emit-value":"","map-options":"","use-input":"","input-debounce":"400",onFilter:s.filterProductores,label:"Productor",dense:"",outlined:"",loading:e.loadingProductores,clearable:""},{"no-option":i(()=>[l(V,null,{default:i(()=>[l(g,{class:"text-grey"},{default:i(()=>a[12]||(a[12]=[f("Escriba al menos 2 caracteres…")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","loading"])]),t("div",j,[l(u,{modelValue:e.producto,"onUpdate:modelValue":a[4]||(a[4]=o=>e.producto=o),options:e.productos.map(o=>({label:o.nombre_producto,value:o.id})),label:"Producto",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),t("div",T,[l(p,{modelValue:e.numActa,"onUpdate:modelValue":a[5]||(a[5]=o=>e.numActa=o),label:"Número de Acta",type:"text",dense:"",outlined:""},null,8,["modelValue"])]),t("div",x,[l(u,{modelValue:e.departamentoSeleccionado,"onUpdate:modelValue":[a[6]||(a[6]=o=>e.departamentoSeleccionado=o),a[8]||(a[8]=o=>s.getMunicipios())],label:"Departamento",options:e.departamentos.map(o=>({label:o.nombre_departamento,value:o.id})),dense:"",outlined:"",onFocus:a[7]||(a[7]=o=>s.getDepartamentos()),clearable:""},null,8,["modelValue","options"])]),t("div",z,[l(u,{modelValue:e.municipioSeleccionado,"onUpdate:modelValue":a[9]||(a[9]=o=>e.municipioSeleccionado=o),label:"Municipio",options:e.municipios.map(o=>({label:o.nombre_municipio,value:o.id})),dense:"",outlined:"",clearable:""},null,8,["modelValue","options"])]),t("div",G,[l(p,{modelValue:e.search,"onUpdate:modelValue":a[10]||(a[10]=o=>e.search=o),label:"CI/NOMBRE/APELLIDO PRODUCTOR",dense:"",outlined:""},null,8,["modelValue"])]),t("div",H,[l(y,{loading:e.loading,label:"Buscar Cosechas",type:"submit",color:"primary","no-caps":"",icon:"search"},null,8,["loading"])]),t("div",X,[l(y,{loading:e.loading,label:"EXCEL",color:"green",onClick:s.generarExcel},null,8,["loading","onClick"])])])]),_:1},8,["onSubmit"]),e.acopioCosechas.length>0?(r(),m(_,{key:0,dense:"","wrap-cells":"",flat:"",bordered:""},{default:i(()=>[a[14]||(a[14]=t("thead",null,[t("tr",{class:"bg-primary text-white"},[t("th",null,"Opciones"),t("th",null,"Fecha Cosecha"),t("th",null,"Productor"),t("th",null,"Cantidad (kg)"),t("th",null,"Humedad (%)"),t("th",null,"Temperatura Almacenaje (°C)"),t("th",null,"Número Acta"),t("th",null,"Condiciones Almacenaje"),t("th",null,"Estado")])],-1)),t("tbody",null,[(r(!0),h(w,null,A(e.acopioCosechas,o=>(r(),h("tr",{key:o.id},[t("td",null,[l(D,{dense:"",label:"Opciones",color:"primary","no-caps":"",size:"10px"},{default:i(()=>[l(F,null,{default:i(()=>[U((r(),m(V,{clickable:"",to:`/acopio/cosechas/${o.id}`},{default:i(()=>[l(g,{avatar:""},{default:i(()=>[l(C,{name:"visibility"})]),_:1}),l(g,null,{default:i(()=>a[13]||(a[13]=[f("Ver Detalles")])),_:1})]),_:2},1032,["to"])),[[k]])]),_:2},1024)]),_:2},1024)]),t("td",null,d(o.fecha_cosecha),1),t("td",null,d(o.apiario?.productor.nombre)+" "+d(o.apiario?.productor.apellidos),1),t("td",null,d(o.cantidad_kg),1),t("td",null,d(o.humedad),1),t("td",null,d(o.temperatura_almacenaje),1),t("td",null,d(o.num_acta),1),t("td",null,d(o.condiciones_almacenaje),1),t("td",null,[l(P,{color:o.estado==="BUENO"?"green":"red","text-color":"white",dense:"",size:"10px"},{default:i(()=>[f(d(o.estado.replace("_"," ")),1)]),_:2},1032,["color"])])]))),128))])]),_:1})):(r(),h("div",J,[l(C,{name:"info",size:"48px",color:"grey-5"}),a[15]||(a[15]=t("div",{class:"text-subtitle2 text-grey-5"},"No se encontraron cosechas.",-1))]))]),_:1})]),_:1})]),_:1})}const ne=O(I,[["render",K]]);export{ne as default};
