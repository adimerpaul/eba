import{v as p,G as y,J as k,g as x,x as b,j as w,y as Q,_ as q,c as h,o as r,w as c,a as s,b as o,f as m,Q as _,e as C,aa as g,a9 as S,a8 as l,t as i,O as B}from"./index-B9VECNgC.js";import{Q as z}from"./QImg-JfAhaEV1.js";import{Q as D}from"./QBanner-Biq4ygVT.js";import{Q as N}from"./QPage-NLRrOEXF.js";import{Q as P,a as R}from"./QLayout-CIGJt2Rb.js";import"./QResizeObserver-B_rqYbVS.js";const I=["text","rect","circle","QBtn","QBadge","QChip","QToolbar","QCheckbox","QRadio","QToggle","QSlider","QRange","QInput","QAvatar"],F=["wave","pulse","pulse-x","pulse-y","fade","blink","none"],u=p({name:"QSkeleton",props:{...y,tag:{type:String,default:"div"},type:{type:String,validator:e=>I.includes(e),default:"rect"},animation:{type:String,validator:e=>F.includes(e),default:"wave"},animationSpeed:{type:[String,Number],default:1500},square:Boolean,bordered:Boolean,size:String,width:String,height:String},setup(e,{slots:t}){const d=x(),f=k(e,d.proxy.$q),a=b(()=>{const v=e.size!==void 0?[e.size,e.size]:[e.width,e.height];return{"--q-skeleton-speed":`${e.animationSpeed}ms`,width:v[0],height:v[1]}}),n=b(()=>`q-skeleton q-skeleton--${f.value===!0?"dark":"light"} q-skeleton--type-${e.type}`+(e.animation!=="none"?` q-skeleton--anim q-skeleton--anim-${e.animation}`:"")+(e.square===!0?" q-skeleton--square":"")+(e.bordered===!0?" q-skeleton--bordered":""));return()=>w(e.tag,{class:n.value,style:a.value},Q(t.default))}}),L={name:"QrFront",data(){return{code:this.$route.params.code,cosecha:null,loading:!0,error:null}},computed:{ready(){return!!this.cosecha&&!this.loading&&!this.error},qrUrl(){const t=`${window.location?.origin??""}/qr/${this.code}`;return`https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(t)}&size=200x200`}},methods:{async fetchData(){try{this.loading=!0,this.error=null,console.log(this.code),console.log(encodeURIComponent(this.code));const e=`/cosechas/qr/${encodeURIComponent(this.code)}`,{data:t}=await this.$axios.get(e);console.log(t),this.cosecha=t?.data??t}catch{this.error="No se encontró la cosecha o el código es inválido."}finally{this.loading=!1}},fmt(e){if(!e)return"—";try{return new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return e}},openMap(e,t){if(!e||!t)return;const d=`https://www.google.com/maps/search/?api=1&query=${e},${t}`;window.open(d,"_blank")},async shareLink(){const e=window.location.href;if(navigator.share)try{await navigator.share({title:"Cosecha",url:e})}catch{}else await navigator.clipboard.writeText(e),this.$q.notify({type:"positive",message:"Enlace copiado al portapapeles"})},printPage(){window.print()}},async created(){await this.fetchData()}},T={class:"row items-center q-mb-md"},E={class:"col-auto"},U={class:"row items-center q-col-gutter-md"},V={class:"col-12 col-md-4 flex flex-center"},A={class:"col-12 col-md-8"},O={key:0},M={key:1},j={key:2},G={class:"text-subtitle1 text-weight-bold q-mb-sm"},H={class:"text-body2"},J={class:"text-body2"};function K(e,t,d,f,a,n){return r(),h(R,{view:"lHh Lpr lFf"},{default:c(()=>[s(P,null,{default:c(()=>[s(N,{class:"q-pa-md bg-grey-2"},{default:c(()=>[o("div",T,[t[0]||(t[0]=o("div",{class:"col"},[o("div",{class:"text-h6 text-weight-bold"},"Trazabilidad de Cosecha"),o("div",{class:"text-caption text-grey-7"},"Consulta pública vía QR")],-1)),o("div",E,[s(m,{flat:"",round:"",icon:"refresh",onClick:n.fetchData,disable:a.loading},null,8,["onClick","disable"]),s(m,{flat:"",round:"",icon:"share",onClick:n.shareLink,disable:!n.ready},null,8,["onClick","disable"]),s(m,{flat:"",round:"",icon:"print",onClick:n.printPage,disable:!n.ready},null,8,["onClick","disable"])])]),s(_,{flat:"",bordered:""},{default:c(()=>[s(C,null,{default:c(()=>[o("div",U,[o("div",V,[a.loading?(r(),h(u,{key:0,type:"QAvatar",size:"200px"})):(r(),h(z,{key:1,src:n.qrUrl,style:{width:"200px",height:"200px"},alt:"QR cosecha"},null,8,["src"]))]),o("div",A,[a.loading?(r(),g("div",O,[s(u,{type:"text",width:"60%"}),s(u,{type:"text",width:"40%"}),s(u,{type:"text",width:"80%"})])):a.error?(r(),g("div",M,[s(D,{"inline-actions":"",class:"bg-red-1 text-red-9 q-mb-md"},{default:c(()=>[l(i(a.error),1)]),_:1})])):a.cosecha?(r(),g("div",j,[o("div",G,i(a.cosecha.nombre_producto||"Producto"),1),o("div",H,[o("div",null,[t[1]||(t[1]=o("b",null,"NOMBRE CIP: ",-1)),l(" "+i(a.cosecha.asociacion),1)]),o("div",null,[t[2]||(t[2]=o("b",null,"Lote: ",-1)),l(" "+i(a.cosecha.codigo_lote),1)]),o("div",null,[t[3]||(t[3]=o("b",null,"Fecha Cosecha: ",-1)),l(" "+i(n.fmt(a.cosecha.fecha_cosecha)),1)]),o("div",null,[t[4]||(t[4]=o("b",null,"Fecha Envasado: ",-1)),l(" "+i(n.fmt(a.cosecha.fecha_envasado)),1)]),o("div",null,[t[5]||(t[5]=o("b",null,"Fecha Vencimiento: ",-1)),l(" "+i(n.fmt(a.cosecha.fecha_caducidad)),1)])]),s(B,{class:"q-my-md"}),o("div",J,[t[8]||(t[8]=o("div",{class:"text-subtitle2 text-weight-bold q-mb-xs"},"Productor(a)",-1)),o("div",null,[t[6]||(t[6]=o("b",null,"Nombre:",-1)),l(" "+i(a.cosecha.productor),1)]),o("div",null,[t[7]||(t[7]=o("b",null,"Origen:",-1)),l(" "+i(a.cosecha.nombre_departamento)+" - "+i(a.cosecha.nombre_municipio),1)])])])):S("",!0)])])]),_:1})]),_:1}),t[9]||(t[9]=o("div",{class:"q-mt-md text-center text-caption text-grey-7"}," Esta es una vista pública de verificación de trazabilidad. ",-1))]),_:1})]),_:1})]),_:1})}const te=q(L,[["render",K]]);export{te as default};
