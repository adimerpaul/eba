import{_ as A,c as f,o as u,w as a,b as t,a as e,f as p,P,Q as c,e as l,ag as v,d as _,R as k,t as r,a7 as m,af as C,O as F,a9 as q,aa as D,ab as T,ad as V,a8 as x}from"./index-BYmx5CNZ.js";import{Q as S}from"./QBtnGroup-CGN2IjQ1.js";import{Q as Y}from"./QSlideTransition-CvybpBwX.js";import{Q as b}from"./QBadge-XCEdf9Kh.js";import{Q as y}from"./QLinearProgress--ydnym95.js";import{Q as z,b as h,a as w}from"./position-engine-WcV6P5pk.js";import{Q}from"./QChip-BFVaIQP4.js";import{Q as E}from"./QTooltip-BGE4xi2l.js";import{Q as N}from"./QList-BvaTzhwT.js";import{Q as B}from"./QPage-p00VibaV.js";import{h as g}from"./moment-C5S46NFB.js";import"./selection-BcgxACWv.js";const I={name:"DashboardTransportesPage",data(){return{loading:!1,mostrarFiltros:!1,filtros:{fecha_inicio:"",fecha_fin:""},estadisticas:{total_transportes:0,con_alerta_temperatura:0,con_alerta_tiempo:0,total_alertas:0,porcentaje_conforme:100,duracion_promedio_horas:0,temperatura_promedio_llegada:0,temperatura_maxima_registrada:0,distancia_total_km:0},ultimasAlertas:[]}},computed:{tiempoCumplimientoPercentage(){return this.estadisticas.total_transportes?(this.estadisticas.total_transportes-(this.estadisticas.con_alerta_tiempo||0))/this.estadisticas.total_transportes*100:100},temperaturaCumplimientoPercentage(){return this.estadisticas.total_transportes?(this.estadisticas.total_transportes-(this.estadisticas.con_alerta_temperatura||0))/this.estadisticas.total_transportes*100:100},distanciaPromedio(){return this.estadisticas.total_transportes?this.estadisticas.distancia_total_km/this.estadisticas.total_transportes:0},velocidadPromedio(){return!this.estadisticas.duracion_promedio_horas||!this.distanciaPromedio?0:this.distanciaPromedio/this.estadisticas.duracion_promedio_horas}},mounted(){const i=g(),s=g().subtract(30,"days");this.filtros.fecha_fin=i.format("YYYY-MM-DD"),this.filtros.fecha_inicio=s.format("YYYY-MM-DD"),this.cargarDatos()},methods:{async cargarDatos(){this.loading=!0;try{await Promise.all([this.cargarEstadisticas(),this.cargarAlertas()])}catch(i){console.error("Error al cargar datos:",i)}finally{this.loading=!1}},async cargarEstadisticas(){try{const i={};this.filtros.fecha_inicio&&(i.fecha_inicio=this.filtros.fecha_inicio),this.filtros.fecha_fin&&(i.fecha_fin=this.filtros.fecha_fin);const{data:s}=await this.$axios.get("/transporte-logs-estadisticas",{params:i});this.estadisticas={total_transportes:s.total_transportes||0,con_alerta_temperatura:s.con_alerta_temperatura||0,con_alerta_tiempo:s.con_alerta_tiempo||0,total_alertas:(s.con_alerta_temperatura||0)+(s.con_alerta_tiempo||0),porcentaje_conforme:s.porcentaje_conforme||100,duracion_promedio_horas:s.duracion_promedio_horas||0,temperatura_promedio_llegada:s.temperatura_promedio_llegada||0,temperatura_maxima_registrada:s.temperatura_maxima_registrada||0,distancia_total_km:s.distancia_total_km||0}}catch{this.$q.notify({type:"negative",message:"Error al cargar estadísticas"})}},async cargarAlertas(){try{const i={};this.filtros.fecha_inicio&&(i.fecha_inicio=this.filtros.fecha_inicio),this.filtros.fecha_fin&&(i.fecha_fin=this.filtros.fecha_fin);const{data:s}=await this.$axios.get("/transporte-logs-alertas",{params:i});this.ultimasAlertas=(Array.isArray(s)?s:s.data||[]).slice(0,5)}catch(i){console.error("Error al cargar alertas:",i)}},formatearFecha(i){return i?g(i).format("DD/MM/YYYY HH:mm"):"--"}}},M={class:"row q-mb-md items-center"},j={class:"col-12 col-md-4 text-right"},G={class:"row q-col-gutter-md items-center"},L={class:"col-12 col-md-4"},H={class:"col-12 col-md-4"},R={class:"col-12 col-md-4"},U={class:"row q-col-gutter-md q-mb-md"},O={class:"col-12 col-sm-6 col-md-3"},J={class:"row items-center"},K={class:"col"},W={class:"text-h4"},X={class:"col-auto"},Z={class:"col-12 col-sm-6 col-md-3"},$={class:"row items-center"},tt={class:"col"},et={class:"text-h4"},st={class:"col-auto"},at={class:"col-12 col-sm-6 col-md-3"},ot={class:"row items-center"},it={class:"col"},lt={class:"text-h4"},rt={class:"col-auto"},dt={class:"col-12 col-sm-6 col-md-3"},ct={class:"row items-center"},nt={class:"col"},_t={class:"text-h4"},mt={class:"col-auto"},ut={class:"row q-col-gutter-md q-mb-md"},ft={class:"col-12 col-md-6"},pt={class:"text-h6 q-mb-md"},ht={class:"row q-col-gutter-sm"},gt={class:"col-6"},vt={class:"text-h5"},xt={class:"col-6"},bt={class:"text-h5 text-orange"},yt={class:"col-12"},wt={class:"absolute-full flex flex-center"},Qt={class:"col-12 col-md-6"},At={class:"text-h6 q-mb-md"},Pt={class:"row q-col-gutter-sm"},kt={class:"col-6"},Ct={class:"col-6"},Ft={class:"text-h5 text-red"},qt={class:"col-12"},Dt={class:"absolute-full flex flex-center"},Tt={class:"row q-col-gutter-md q-mb-md"},Vt={class:"col-12"},St={class:"text-h6 q-mb-md"},Yt={class:"row q-col-gutter-sm"},zt={class:"col-12 col-md-4"},Et={class:"text-h4"},Nt={class:"col-12 col-md-4"},Bt={class:"text-h5"},It={class:"col-12 col-md-4"},Mt={class:"text-h5"},jt={class:"row q-col-gutter-md"},Gt={class:"col-12"},Lt={class:"text-h6"},Ht={class:"text-center text-grey-6"};function Rt(i,s,Ut,Ot,o,n){return u(),f(B,{class:"q-pa-md"},{default:a(()=>[t("div",M,[s[3]||(s[3]=t("div",{class:"col-12 col-md-8"},[t("div",{class:"text-h5 text-weight-bold"},"Dashboard de Transportes"),t("div",{class:"text-caption text-grey-7"},"Análisis y estadísticas de cumplimiento SENASAG")],-1)),t("div",j,[e(S,null,{default:a(()=>[e(p,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",loading:o.loading,onClick:n.cargarDatos},null,8,["loading","onClick"]),e(p,{color:"info",icon:"filter_list",label:"Filtrar","no-caps":"",onClick:s[0]||(s[0]=d=>o.mostrarFiltros=!o.mostrarFiltros)})]),_:1})])]),e(Y,null,{default:a(()=>[P(e(c,{flat:"",bordered:"",class:"q-mb-md"},{default:a(()=>[e(l,null,{default:a(()=>[t("div",G,[t("div",L,[e(v,{modelValue:o.filtros.fecha_inicio,"onUpdate:modelValue":s[1]||(s[1]=d=>o.filtros.fecha_inicio=d),dense:"",outlined:"",label:"Fecha Inicio",type:"date"},{prepend:a(()=>[e(_,{name:"event"})]),_:1},8,["modelValue"])]),t("div",H,[e(v,{modelValue:o.filtros.fecha_fin,"onUpdate:modelValue":s[2]||(s[2]=d=>o.filtros.fecha_fin=d),dense:"",outlined:"",label:"Fecha Fin",type:"date"},{prepend:a(()=>[e(_,{name:"event"})]),_:1},8,["modelValue"])]),t("div",R,[e(p,{unelevated:"",color:"primary",label:"Aplicar Filtros",icon:"search",onClick:n.cargarDatos,class:"full-width"},null,8,["onClick"])])])]),_:1})]),_:1},512),[[k,o.mostrarFiltros]])]),_:1}),t("div",U,[t("div",O,[e(c,{flat:"",bordered:""},{default:a(()=>[e(l,{class:"bg-primary text-white"},{default:a(()=>[t("div",J,[t("div",K,[t("div",W,r(o.estadisticas.total_transportes||0),1),s[4]||(s[4]=t("div",{class:"text-caption"},"Total Transportes",-1))]),t("div",X,[e(_,{name:"local_shipping",size:"48px"})])])]),_:1})]),_:1})]),t("div",Z,[e(c,{flat:"",bordered:""},{default:a(()=>[e(l,{class:"bg-positive text-white"},{default:a(()=>[t("div",$,[t("div",tt,[t("div",et,r(o.estadisticas.porcentaje_conforme?.toFixed(1)||0)+"%",1),s[5]||(s[5]=t("div",{class:"text-caption"},"Cumplimiento SENASAG",-1))]),t("div",st,[e(_,{name:"verified",size:"48px"})])])]),_:1})]),_:1})]),t("div",at,[e(c,{flat:"",bordered:""},{default:a(()=>[e(l,{class:"bg-orange text-white"},{default:a(()=>[t("div",ot,[t("div",it,[t("div",lt,r(o.estadisticas.total_alertas||0),1),s[6]||(s[6]=t("div",{class:"text-caption"},"Alertas Activas",-1))]),t("div",rt,[e(_,{name:"warning",size:"48px"})])])]),_:1})]),_:1})]),t("div",dt,[e(c,{flat:"",bordered:""},{default:a(()=>[e(l,{class:"bg-info text-white"},{default:a(()=>[t("div",ct,[t("div",nt,[t("div",_t,r(o.estadisticas.temperatura_promedio_llegada?.toFixed(1)||0)+"°C",1),s[7]||(s[7]=t("div",{class:"text-caption"},"Temperatura Promedio",-1))]),t("div",mt,[e(_,{name:"thermostat",size:"48px"})])])]),_:1})]),_:1})])]),t("div",ut,[t("div",ft,[e(c,{flat:"",bordered:""},{default:a(()=>[e(l,null,{default:a(()=>[t("div",pt,[e(_,{name:"schedule",color:"orange"}),s[8]||(s[8]=m(" Análisis de Tiempo de Transporte "))]),t("div",ht,[t("div",gt,[e(c,{flat:"",class:"bg-grey-2"},{default:a(()=>[e(l,null,{default:a(()=>[s[9]||(s[9]=t("div",{class:"text-caption text-grey-7"},"Duración Promedio",-1)),t("div",vt,r(o.estadisticas.duracion_promedio_horas?.toFixed(1)||0)+" hrs",1)]),_:1})]),_:1})]),t("div",xt,[e(c,{flat:"",class:"bg-grey-2"},{default:a(()=>[e(l,null,{default:a(()=>[s[10]||(s[10]=t("div",{class:"text-caption text-grey-7"},"Alertas de Tiempo",-1)),t("div",bt,r(o.estadisticas.con_alerta_tiempo||0),1)]),_:1})]),_:1})]),t("div",yt,[e(y,{value:n.tiempoCumplimientoPercentage,size:"25px",color:n.tiempoCumplimientoPercentage>90?"positive":n.tiempoCumplimientoPercentage>70?"orange":"negative",class:"q-mt-md"},{default:a(()=>[t("div",wt,[e(b,{color:"white","text-color":"black",label:`${n.tiempoCumplimientoPercentage.toFixed(0)}% sin alertas de tiempo`},null,8,["label"])])]),_:1},8,["value","color"])])])]),_:1})]),_:1})]),t("div",Qt,[e(c,{flat:"",bordered:""},{default:a(()=>[e(l,null,{default:a(()=>[t("div",At,[e(_,{name:"thermostat",color:"red"}),s[11]||(s[11]=m(" Análisis de Temperatura "))]),t("div",Pt,[t("div",kt,[e(c,{flat:"",class:"bg-grey-2"},{default:a(()=>[e(l,null,{default:a(()=>[s[12]||(s[12]=t("div",{class:"text-caption text-grey-7"},"Temperatura Máxima",-1)),t("div",{class:C(["text-h5",o.estadisticas.temperatura_maxima_registrada>35?"text-red":""])},r(o.estadisticas.temperatura_maxima_registrada?.toFixed(1)||0)+"°C ",3)]),_:1})]),_:1})]),t("div",Ct,[e(c,{flat:"",class:"bg-grey-2"},{default:a(()=>[e(l,null,{default:a(()=>[s[13]||(s[13]=t("div",{class:"text-caption text-grey-7"},"Alertas de Temperatura",-1)),t("div",Ft,r(o.estadisticas.con_alerta_temperatura||0),1)]),_:1})]),_:1})]),t("div",qt,[e(y,{value:n.temperaturaCumplimientoPercentage,size:"25px",color:n.temperaturaCumplimientoPercentage>90?"positive":n.temperaturaCumplimientoPercentage>70?"orange":"negative",class:"q-mt-md"},{default:a(()=>[t("div",Dt,[e(b,{color:"white","text-color":"black",label:`${n.temperaturaCumplimientoPercentage.toFixed(0)}% sin alertas de temperatura`},null,8,["label"])])]),_:1},8,["value","color"])])])]),_:1})]),_:1})])]),t("div",Tt,[t("div",Vt,[e(c,{flat:"",bordered:""},{default:a(()=>[e(l,null,{default:a(()=>[t("div",St,[e(_,{name:"place",color:"info"}),s[14]||(s[14]=m(" Análisis de Distancias "))]),t("div",Yt,[t("div",zt,[e(c,{flat:"",class:"bg-info text-white"},{default:a(()=>[e(l,null,{default:a(()=>[s[15]||(s[15]=t("div",{class:"text-caption"},"Distancia Total Recorrida",-1)),t("div",Et,r(o.estadisticas.distancia_total_km?.toFixed(2)||0)+" km",1)]),_:1})]),_:1})]),t("div",Nt,[e(c,{flat:"",class:"bg-grey-2"},{default:a(()=>[e(l,null,{default:a(()=>[s[16]||(s[16]=t("div",{class:"text-caption text-grey-7"},"Distancia Promedio por Viaje",-1)),t("div",Bt,r(n.distanciaPromedio.toFixed(2))+" km",1)]),_:1})]),_:1})]),t("div",It,[e(c,{flat:"",class:"bg-grey-2"},{default:a(()=>[e(l,null,{default:a(()=>[s[17]||(s[17]=t("div",{class:"text-caption text-grey-7"},"Velocidad Promedio",-1)),t("div",Mt,r(n.velocidadPromedio.toFixed(1))+" km/h",1)]),_:1})]),_:1})])])]),_:1})]),_:1})])]),t("div",jt,[t("div",Gt,[e(c,{flat:"",bordered:""},{default:a(()=>[e(l,{class:"bg-orange-2"},{default:a(()=>[t("div",Lt,[e(_,{name:"warning",color:"orange"}),s[18]||(s[18]=m(" Últimas Alertas SENASAG "))])]),_:1}),e(F),o.ultimasAlertas.length>0?(u(),f(l,{key:0},{default:a(()=>[e(N,{separator:""},{default:a(()=>[(u(!0),q(D,null,T(o.ultimasAlertas,d=>(u(),f(z,{key:d.id},{default:a(()=>[e(h,{avatar:""},{default:a(()=>[e(V,{color:d.alerta_temperatura?"red":"orange","text-color":"white",icon:d.alerta_temperatura?"thermostat":"schedule"},null,8,["color","icon"])]),_:2},1024),e(h,null,{default:a(()=>[e(w,null,{default:a(()=>[m(r(d.transporte?.empresa)+" - "+r(d.transporte?.placa),1)]),_:2},1024),e(w,{caption:""},{default:a(()=>[m(r(n.formatearFecha(d.fecha_hora_salida))+" | "+r(d.lugar_origen)+" → "+r(d.lugar_destino||"Planta"),1)]),_:2},1024)]),_:2},1024),e(h,{side:""},{default:a(()=>[t("div",null,[d.alerta_temperatura?(u(),f(Q,{key:0,dense:"",color:"red","text-color":"white",icon:"thermostat"},{default:a(()=>[m(r(d.temperatura_llegada)+"°C ",1)]),_:2},1024)):x("",!0),d.alerta_tiempo?(u(),f(Q,{key:1,dense:"",color:"orange","text-color":"white",icon:"schedule"},{default:a(()=>[m(r(d.tiempo_transporte_horas)+" hrs ",1)]),_:2},1024)):x("",!0)])]),_:2},1024),e(h,{side:""},{default:a(()=>[e(p,{flat:"",dense:"",color:"info",icon:"visibility",to:"/historial-transportes"},{default:a(()=>[e(E,null,{default:a(()=>s[19]||(s[19]=[m("Ver en historial")])),_:1})]),_:1})]),_:1})]),_:2},1024))),128))]),_:1})]),_:1})):(u(),f(l,{key:1},{default:a(()=>[t("div",Ht,[e(_,{name:"check_circle",size:"lg",color:"positive"}),s[20]||(s[20]=t("div",null,"No hay alertas recientes",-1))])]),_:1}))]),_:1})])])]),_:1})}const le=A(I,[["render",Rt],["__scopeId","data-v-cb0f59a8"]]);export{le as default};
