import{Q as C}from"./QSpace-CKS8Z-WO.js";import{_ as V,c as p,o as c,w as a,a as t,Q as w,e as g,b as r,ad as k,d as _,f as u,I as D,a5 as d,t as i,J as h,aa as v,h as q,a7 as y,a8 as B,a9 as T,af as I}from"./index-B6d1zyjm.js";import{Q,b as f}from"./format-3uuXq-uR.js";import{Q as S,a as A}from"./QList-wBNT-pA_.js";import{Q as F,a as m}from"./QTable-DnhgDbms.js";import{Q as L}from"./QMarkupTable-c9DV683y.js";import{Q as N}from"./QPage-B_Jhyc8F.js";import{C as b}from"./ClosePopup-BnJ7FjjW.js";import"./selection-BkLv2Wda.js";import"./QSelect-DDXdziGV.js";import"./use-fullscreen-DcE-yTZB.js";const P={name:"VentasList",data(){return{loading:!1,rows:[],filter:"",columns:[{name:"actions",label:"Acciones",align:"right"},{name:"id",label:"#",align:"left",field:"id"},{name:"fecha_venta",label:"Fecha",align:"left",field:"fecha_venta"},{name:"cliente",label:"Cliente",align:"left",field:"cliente"},{name:"num_factura",label:"Factura",align:"left",field:"num_factura"},{name:"guia_remision",label:"Guía",align:"left",field:"guia_remision"},{name:"precio_total",label:"Total (Bs)",align:"right",field:"precio_total"}],dlg:{open:!1,row:null,detalles:[]}}},mounted(){this.fetch()},methods:{fmt(o){return Number(o||0).toFixed(2)},fmtDate(o){return o?new Date(o).toLocaleString():"-"},async fetch(){this.loading=!0;try{const o={};this.filter&&(o.q=this.filter);const{data:e}=await this.$axios.get("/ventas",{params:o});this.rows=Array.isArray(e)?e:e.data||[]}catch(o){this.$q.notify({type:"negative",message:o.response?.data?.message||"Error al listar ventas"})}finally{this.loading=!1}},fetchDebounced:(()=>{let o;return function(){clearTimeout(o),o=setTimeout(()=>this.fetch(),350)}})(),async openDetalle(o){try{const{data:e}=await this.$axios.get(`/ventas/${o.id}`);this.dlg={open:!0,row:e,detalles:e.detalles||[]}}catch{this.$q.notify({type:"negative",message:"No se pudo cargar el detalle"})}},printVenta(o){const e=`${this.$url}/ventas/${o.id}/nota`;window.open(e,"_blank")}}},U={class:"q-mb-sm"},z={class:"q-mb-sm"},E={class:"text-right"},G={class:"text-right"},J={class:"text-right"},K={class:"text-right text-bold"};function M(o,e,O,R,n,s){return c(),p(N,{class:"q-pa-md"},{default:a(()=>[t(w,{flat:"",bordered:""},{default:a(()=>[t(g,{class:"row items-center q-gutter-sm"},{default:a(()=>[e[4]||(e[4]=r("div",{class:"text-h6"},"Gestionar Ventas",-1)),t(C),t(k,{modelValue:n.filter,"onUpdate:modelValue":[e[0]||(e[0]=l=>n.filter=l),s.fetchDebounced],dense:"",outlined:"",placeholder:"Buscar cliente / factura / guía"},{append:a(()=>[t(_,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"]),t(u,{color:"positive",icon:"add_circle_outline",label:"Crear venta","no-caps":"",onClick:e[1]||(e[1]=l=>o.$router.push("/ventas/crear"))}),t(u,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",loading:n.loading,onClick:s.fetch},null,8,["loading","onClick"])]),_:1}),t(D),t(F,{flat:"",bordered:"",dense:"","wrap-cells":"",rows:n.rows,columns:n.columns,"row-key":"id",loading:n.loading,"rows-per-page-options":[0]},{"body-cell-actions":a(l=>[t(m,{props:l,class:"text-right"},{default:a(()=>[t(S,{dense:"",label:"Opciones",color:"primary","no-caps":"",size:"10px"},{default:a(()=>[t(A,null,{default:a(()=>[h((c(),p(Q,{clickable:"",onClick:x=>s.openDetalle(l.row)},{default:a(()=>[t(f,{avatar:""},{default:a(()=>[t(_,{name:"visibility"})]),_:1}),t(f,null,{default:a(()=>e[5]||(e[5]=[d("Ver detalle")])),_:1})]),_:2},1032,["onClick"])),[[v],[b]]),h((c(),p(Q,{clickable:"",onClick:x=>s.printVenta(l.row)},{default:a(()=>[t(f,{avatar:""},{default:a(()=>[t(_,{name:"print",color:"primary"})]),_:1}),t(f,null,{default:a(()=>e[6]||(e[6]=[d("Imprimir nota")])),_:1})]),_:2},1032,["onClick"])),[[v],[b]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-cliente":a(l=>[t(m,{props:l},{default:a(()=>[d(i(l.row.cliente?.nombre_cliente||"-"),1)]),_:2},1032,["props"])]),"body-cell-fecha_venta":a(l=>[t(m,{props:l},{default:a(()=>[d(i(s.fmtDate(l.row.fecha_venta)),1)]),_:2},1032,["props"])]),"body-cell-precio_total":a(l=>[t(m,{props:l,class:"text-right"},{default:a(()=>[d(i(s.fmt(l.row.precio_total)),1)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])]),_:1}),t(q,{modelValue:n.dlg.open,"onUpdate:modelValue":e[3]||(e[3]=l=>n.dlg.open=l)},{default:a(()=>[t(w,{style:{"min-width":"640px"}},{default:a(()=>[t(g,{class:"text-h6"},{default:a(()=>[d("Detalle de Venta #"+i(n.dlg.row?.id),1)]),_:1}),t(g,{class:"q-pt-none"},{default:a(()=>[r("div",U,[e[7]||(e[7]=r("b",null,"Cliente:",-1)),d(" "+i(n.dlg.row?.cliente?.nombre_cliente),1)]),r("div",z,[e[8]||(e[8]=r("b",null,"Fecha:",-1)),d(" "+i(s.fmtDate(n.dlg.row?.fecha_venta)),1)]),t(L,{dense:"",flat:"",bordered:""},{default:a(()=>[e[10]||(e[10]=r("thead",null,[r("tr",null,[r("th",null,"Lote"),r("th",null,"Producto"),r("th",{class:"text-right"},"Kg"),r("th",{class:"text-right"},"Precio"),r("th",{class:"text-right"},"Subtotal")])],-1)),r("tbody",null,[(c(!0),y(B,null,T(n.dlg.detalles,l=>(c(),y("tr",{key:l.id},[r("td",null,i(l.lote?.codigo_lote),1),r("td",null,i(l.producto?.nombre_producto),1),r("td",E,i(s.fmt(l.cantidad_salida)),1),r("td",G,i(s.fmt(l.precio_venta)),1),r("td",J,i(s.fmt(l.cantidad_salida*l.precio_venta)),1)]))),128)),r("tr",null,[e[9]||(e[9]=r("td",{colspan:"4",class:"text-right text-bold"},"Total",-1)),r("td",K,i(s.fmt(n.dlg.row?.precio_total)),1)])])]),_:1})]),_:1}),t(I,{align:"right"},{default:a(()=>[h(t(u,{flat:"",label:"Cerrar"},null,512),[[b]]),t(u,{color:"primary",icon:"print",label:"Imprimir",onClick:e[2]||(e[2]=l=>s.printVenta(n.dlg.row))})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const re=V(P,[["render",M]]);export{re as default};
