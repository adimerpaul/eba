import{Q as h}from"./QSelect-Dhln2zmq.js";import{_ as k,c,o as p,w as t,a as e,J as u,d as f,a5 as g,aa as y,b as s,t as v,ad as r,f as d,h as S,Q as N,e as V,I as w,ax as q,af as I}from"./index-WxekZxHz.js";import{Q}from"./QTd-Dixn-xcp.js";import{Q as C,b as m}from"./format-DK3kqVx7.js";import{Q as D}from"./QList-D6sPVp6E.js";import{Q as U}from"./QBtnDropdown-DM8UyfDv.js";import{Q as E}from"./QTable-C_lro3ZF.js";import{Q as M}from"./QForm-qHIV7X_g.js";import{Q as P}from"./QPage-Cum-xbc5.js";import{C as b}from"./ClosePopup-b2CG6IHp.js";import"./selection-D4dCPtkF.js";import"./QMarkupTable-DsMeMjJA.js";import"./use-fullscreen-143Ym3sx.js";const O={name:"PlantasPage",data(){return{loading:!1,rows:[],columns:[{name:"actions",label:"Acciones",align:"right"},{name:"codigo_planta",label:"Código",align:"left",field:"codigo_planta"},{name:"nombre_planta",label:"Nombre",align:"left",field:"nombre_planta"},{name:"registro_sanitario",label:"Reg. sanitario",align:"left",field:"registro_sanitario"},{name:"municipio",label:"Municipio",align:"left",field:i=>i.municipio?.nombre||""},{name:"direccion",label:"Dirección",align:"left",field:"direccion"}],filter:"",municipioId:null,municipioOptions:[],dlg:{open:!1,mode:"create",row:null},form:{codigo_planta:"",nombre_planta:"",registro_sanitario:"",direccion:"",municipio_id:null},saving:!1}},computed:{canSubmit(){const i=this.form;return!!(i.codigo_planta&&i.nombre_planta)}},mounted(){this.fetchMunicipios(),this.fetch()},methods:{findMunicipioNombre(i){const o=this.municipioOptions.find(_=>_.id===i);return o?o.nombre:i},async fetch(){this.loading=!0;try{const i={};this.filter&&(i.q=this.filter),this.municipioId&&(i.municipio_id=this.municipioId);const{data:o}=await this.$axios.get("/plantas",{params:i});this.rows=Array.isArray(o)?o:o.data||[]}catch(i){this.$q.notify({type:"negative",message:i.response?.data?.message||"Error al listar plantas"})}finally{this.loading=!1}},fetchDebounced:(()=>{let i;return function(){clearTimeout(i),i=setTimeout(()=>this.fetch(),350)}})(),async fetchMunicipios(){try{const{data:i}=await this.$axios.get("/municipios");this.municipioOptions=i}catch{this.$q.notify({type:"warning",message:"No se pudieron cargar municipios"})}},openCreate(){this.dlg={open:!0,mode:"create",row:null},this.form={codigo_planta:"",nombre_planta:"",registro_sanitario:"",direccion:"",municipio_id:null}},openEdit(i){this.dlg={open:!0,mode:"edit",row:i},this.form={codigo_planta:i.codigo_planta||"",nombre_planta:i.nombre_planta||"",registro_sanitario:i.registro_sanitario||"",direccion:i.direccion||"",municipio_id:i.municipio_id||i.municipio?.id||null}},async onSubmit(){if(this.canSubmit){this.saving=!0;try{this.dlg.mode==="create"?await this.$axios.post("/plantas",this.form):await this.$axios.put(`/plantas/${this.dlg.row.id}`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.dlg.open=!1,await this.fetch()}catch(i){this.$q.notify({type:"negative",message:i.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}}},async onDelete(i){this.$q.dialog({title:"Eliminar",message:`¿Eliminar la planta ${i.nombre_planta}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{await this.$axios.delete(`/plantas/${i.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),await this.fetch()}catch(o){this.$q.notify({type:"negative",message:o.response?.data?.message||"No se pudo eliminar"})}})}}},B={class:"row items-center q-gutter-sm"},A={class:"row q-col-gutter-md"},T={class:"col-12 col-md-4"},R={class:"col-12 col-md-8"},z={class:"col-12 col-md-6"},G={class:"col-12 col-md-6"},F={class:"col-12"};function J(i,o,_,L,l,n){return p(),c(P,{class:"q-pa-md"},{default:t(()=>[e(E,{rows:l.rows,columns:l.columns,"row-key":"id",flat:"",bordered:"",dense:"","wrap-cells":"","rows-per-page-options":[0],title:"Plantas",loading:l.loading,filter:l.filter},{"top-right":t(()=>[s("div",B,[e(h,{modelValue:l.municipioId,"onUpdate:modelValue":[o[0]||(o[0]=a=>l.municipioId=a),n.fetch],options:l.municipioOptions,"option-value":"id","option-label":"nombre","emit-value":"","map-options":"",dense:"",filled:"",clearable:"",label:"Municipio",style:{"min-width":"220px"}},null,8,["modelValue","options","onUpdate:modelValue"]),e(r,{modelValue:l.filter,"onUpdate:modelValue":[o[1]||(o[1]=a=>l.filter=a),n.fetchDebounced],dense:"",outlined:"",placeholder:"Buscar por código, nombre, registro o dirección"},{append:t(()=>[e(f,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"]),e(d,{color:"positive",icon:"add_circle_outline",label:"Nuevo","no-caps":"",loading:l.loading,onClick:n.openCreate},null,8,["loading","onClick"]),e(d,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",loading:l.loading,onClick:n.fetch},null,8,["loading","onClick"])])]),"body-cell-municipio":t(a=>[e(Q,{props:a},{default:t(()=>[g(v(a.row.municipio?.nombre||n.findMunicipioNombre(a.row.municipio_id)),1)]),_:2},1032,["props"])]),"body-cell-actions":t(a=>[e(Q,{props:a,class:"text-right"},{default:t(()=>[e(U,{label:"Opciones",dense:"",color:"primary","no-caps":"",size:"10px"},{default:t(()=>[e(D,null,{default:t(()=>[u((p(),c(C,{clickable:"",onClick:x=>n.openEdit(a.row)},{default:t(()=>[e(m,{avatar:""},{default:t(()=>[e(f,{name:"edit"})]),_:1}),e(m,null,{default:t(()=>o[8]||(o[8]=[g("Editar")])),_:1})]),_:2},1032,["onClick"])),[[y],[b]]),u((p(),c(C,{clickable:"",onClick:x=>n.onDelete(a.row)},{default:t(()=>[e(m,{avatar:""},{default:t(()=>[e(f,{name:"delete",color:"negative"})]),_:1}),e(m,null,{default:t(()=>o[9]||(o[9]=[s("span",{class:"text-negative"},"Eliminar",-1)])),_:1})]),_:2},1032,["onClick"])),[[y],[b]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading","filter"]),e(S,{modelValue:l.dlg.open,"onUpdate:modelValue":o[7]||(o[7]=a=>l.dlg.open=a),persistent:""},{default:t(()=>[e(N,{style:{"min-width":"560px","max-width":"820px"}},{default:t(()=>[e(V,{class:"text-h6"},{default:t(()=>[g(v(l.dlg.mode==="create"?"Nueva Planta":"Editar Planta"),1)]),_:1}),e(w),e(V,null,{default:t(()=>[e(M,{onSubmit:q(n.onSubmit,["prevent"]),ref:"formRef"},{default:t(()=>[s("div",A,[s("div",T,[e(r,{modelValue:l.form.codigo_planta,"onUpdate:modelValue":o[2]||(o[2]=a=>l.form.codigo_planta=a),dense:"",filled:"",label:"Código planta"},null,8,["modelValue"])]),s("div",R,[e(r,{modelValue:l.form.nombre_planta,"onUpdate:modelValue":o[3]||(o[3]=a=>l.form.nombre_planta=a),dense:"",filled:"",label:"Nombre planta"},null,8,["modelValue"])]),s("div",z,[e(r,{modelValue:l.form.registro_sanitario,"onUpdate:modelValue":o[4]||(o[4]=a=>l.form.registro_sanitario=a),dense:"",filled:"",label:"Registro sanitario"},null,8,["modelValue"])]),s("div",G,[e(h,{modelValue:l.form.municipio_id,"onUpdate:modelValue":o[5]||(o[5]=a=>l.form.municipio_id=a),options:l.municipioOptions,"option-value":"id","option-label":"nombre_municipio","emit-value":"","map-options":"",dense:"",filled:"",label:"Municipio"},null,8,["modelValue","options"])]),s("div",F,[e(r,{modelValue:l.form.direccion,"onUpdate:modelValue":o[6]||(o[6]=a=>l.form.direccion=a),type:"textarea",autogrow:"",dense:"",filled:"",label:"Dirección"},null,8,["modelValue"])])])]),_:1},8,["onSubmit"])]),_:1}),e(w),e(I,{align:"right"},{default:t(()=>[u(e(d,{flat:"",label:"Cancelar"},null,512),[[b]]),e(d,{color:"primary",loading:l.saving,disable:!n.canSubmit,label:"Guardar",onClick:n.onSubmit},null,8,["loading","disable","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ti=k(O,[["render",J],["__scopeId","data-v-7d1b171b"]]);export{ti as default};
