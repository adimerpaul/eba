import{_ as U,c as g,o as d,w as a,b as s,a as o,f as u,a7 as x,a6 as w,a8 as T,a9 as O,t as n,J as b,d as k,a5 as C,aa as S,h as A,Q as q,e as P,I,ad as _,a4 as m}from"./index-DCaMETEr.js";import{Q}from"./QSpace-BYw6yLnx.js";import{Q as B,a as p,b as G,c as f}from"./QTabPanels-BvHHotWZ.js";import{Q as M}from"./QPage-DJgHo5cb.js";import{P as z}from"./ProductorForm-Cqj3Ywsz.js";import{P as L,a as j,b as J}from"./ProductorMapa-DN7CSikI.js";import{Q as N,b as v,d as H}from"./format-5WkvPw9V.js";import{Q as K}from"./QList-C2vJRbVF.js";import{Q as W}from"./QBtnDropdown-HmOdFKZB.js";import{Q as X}from"./QMarkupTable-CpvLf6n9.js";import{Q as Y}from"./QSelect-B5pGbEEC.js";import{Q as Z}from"./QForm-D6jrHZOA.js";import{C as y}from"./ClosePopup-ficPZ1qx.js";import"./QResizeObserver-BJJeC5U6.js";import"./use-panel-sKdtuy3T.js";import"./touch-BjYP5sR0.js";import"./selection-BYRbqVwb.js";import"./QBanner-7FXNrSUv.js";import"./marker-shadow-Bjv-FlVx.js";import"./QBadge-DLnouPFd.js";const $={name:"ProductorRunsas",props:{productor:{type:Object,required:!0}},emits:["updated"],data(){return{loading:!1,saving:!1,list:[],dlg:{open:!1},form:this.emptyForm()}},mounted(){this.hydrateFromProductor()},watch:{productor(){this.hydrateFromProductor()}},methods:{hydrateFromProductor(){this.productor?.runsas?this.list=this.productor.runsas:this.fetchRunsas()},async fetchRunsas(){console.log(this.productor),this.loading=!0;try{const{data:e}=await this.$axios.get("runsas",{params:{productor_id:this.productor.id,paginate:!1}});console.log(e),this.list=Array.isArray(e)?e:e?.data||[]}catch(e){console.log(e),this.list=[],this.$alert?.error?.(e.response?.data?.message||"No se pudo cargar runsas")}finally{this.loading=!1}},emptyForm(){return{id:null,productor_id:this.productor?.id||null,codigo:null,subcodigo:"",fecha_registro:null,fecha_vencimiento:null,estado:"VIGENTE"}},chip(e){return e==="VIGENTE"?"green":e==="VENCIDO"?"red":e==="SUSPENDIDO"?"orange":"grey"},startCreate(){this.form=this.emptyForm(),this.form.productor_id=this.productor?.id||null,this.dlg.open=!0},startEdit(e){this.form={id:e.id,productor_id:this.productor?.id||e.productor_id,codigo:e.codigo||null,subcodigo:e.subcodigo||"",fecha_registro:e.fecha_registro||null,fecha_vencimiento:e.fecha_vencimiento||null,estado:e.estado||"VIGENTE"},this.dlg.open=!0},async submit(){if(this.productor?.id){this.saving=!0;try{const e={...this.form,productor_id:this.productor.id};e.id?await this.$axios.put(`runsas/${e.id}`,e):await this.$axios.post("runsas",e),this.$alert?.success?.(e.id?"Runsa actualizada":"Runsa creada"),this.dlg.open=!1,this.$emit("updated")}catch(e){this.$alert?.error?.(e.response?.data?.message||"No se pudo guardar")}finally{this.saving=!1}}},remove(e){this.$alert?.dialog?.("¿Eliminar runsa?")?.onOk(async()=>{try{await this.$axios.delete(`runsas/${e.id}`),this.$alert?.success?.("Eliminado"),this.$emit("updated")}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo eliminar")}})}}},oo={class:"row items-center q-gutter-sm q-mb-sm"},eo={key:0},to={class:"text-h6"},ro={class:"col-12 col-sm-4"},so={class:"col-12 col-sm-8"},ao={class:"col-6 col-sm-3"},lo={class:"col-6 col-sm-3"},io={class:"col-12 col-sm-3"},no={class:"col-12 text-right q-gutter-sm q-mt-sm"};function uo(e,t,E,R,r,i){return d(),g(P,null,{default:a(()=>[s("div",oo,[t[6]||(t[6]=s("div",{class:"text-subtitle1"},"Certificaciones Runsa",-1)),o(Q),o(u,{dense:"",color:"primary",icon:"add_circle",label:"Nueva",onClick:i.startCreate,disable:r.saving,"no-caps":""},null,8,["onClick","disable"])]),o(X,{dense:""},{default:a(()=>[t[10]||(t[10]=s("thead",null,[s("tr",{class:"bg-grey-3"},[s("th",{class:"text-left"},"#"),s("th",{class:"text-left",style:{width:"120px"}},"Opciones"),s("th",{class:"text-left"},"Codigo"),s("th",{class:"text-left"},"Subcodigo"),s("th",{class:"text-left"},"Registro"),s("th",{class:"text-left"},"Vencimiento"),s("th",{class:"text-left"},"Estado")])],-1)),s("tbody",null,[(d(!0),x(T,null,O(r.list||[],(l,h)=>(d(),x("tr",{key:l.id||h},[s("td",null,n(h+1),1),s("td",null,[o(W,{dense:"",label:"Opciones",color:"primary","no-caps":"",size:"10px"},{default:a(()=>[o(K,null,{default:a(()=>[b((d(),g(N,{clickable:"",onClick:V=>i.startEdit(l)},{default:a(()=>[o(v,{avatar:""},{default:a(()=>[o(k,{name:"edit"})]),_:1}),o(v,null,{default:a(()=>t[7]||(t[7]=[C("Editar")])),_:1})]),_:2},1032,["onClick"])),[[S],[y]]),b((d(),g(N,{clickable:"",onClick:V=>i.remove(l)},{default:a(()=>[o(v,{avatar:""},{default:a(()=>[o(k,{name:"delete",class:"text-negative"})]),_:1}),o(v,{class:"text-negative"},{default:a(()=>t[8]||(t[8]=[C("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[S],[y]])]),_:2},1024)]),_:2},1024)]),s("td",null,n(l.codigo||"-"),1),s("td",null,n(l.subcodigo||"-"),1),s("td",null,n(l.fecha_registro||"-"),1),s("td",null,n(l.fecha_vencimiento||"-"),1),s("td",null,[o(H,{color:i.chip(l.estado),"text-color":"white",size:"xs",class:"text-bold"},{default:a(()=>[C(n(l.estado),1)]),_:2},1032,["color"])])]))),128)),!r.loading&&(E.productor?.runsas?.length||0)===0?(d(),x("tr",eo,t[9]||(t[9]=[s("td",{colspan:"8",class:"text-center text-grey"},"Sin registros",-1)]))):w("",!0)])]),_:1}),o(A,{modelValue:r.dlg.open,"onUpdate:modelValue":t[5]||(t[5]=l=>r.dlg.open=l),persistent:""},{default:a(()=>[o(q,{style:{"min-width":"720px","max-width":"95vw"}},{default:a(()=>[o(P,{class:"row items-center q-gutter-sm"},{default:a(()=>[s("div",to,n(r.form.id?"Editar runsa":"Nueva runsa"),1),o(Q),b(o(u,{flat:"",round:"",dense:"",icon:"close"},null,512),[[y]])]),_:1}),o(I),o(P,null,{default:a(()=>[o(Z,{onSubmit:i.submit,class:"row q-col-gutter-sm"},{default:a(()=>[s("div",ro,[o(_,{modelValue:r.form.codigo,"onUpdate:modelValue":t[0]||(t[0]=l=>r.form.codigo=l),dense:"",outlined:"",label:"Codigo",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"])]),s("div",so,[o(_,{modelValue:r.form.subcodigo,"onUpdate:modelValue":t[1]||(t[1]=l=>r.form.subcodigo=l),dense:"",outlined:"",label:"Subcodigo"},null,8,["modelValue"])]),s("div",ao,[o(_,{modelValue:r.form.fecha_registro,"onUpdate:modelValue":t[2]||(t[2]=l=>r.form.fecha_registro=l),type:"date",dense:"",outlined:"",label:"Fec Registro"},null,8,["modelValue"])]),s("div",lo,[o(_,{modelValue:r.form.fecha_vencimiento,"onUpdate:modelValue":t[3]||(t[3]=l=>r.form.fecha_vencimiento=l),type:"date",dense:"",outlined:"",label:"Fec Vencimiento"},null,8,["modelValue"])]),s("div",io,[o(Y,{modelValue:r.form.estado,"onUpdate:modelValue":t[4]||(t[4]=l=>r.form.estado=l),options:["VIGENTE","VENCIDO","SUSPENDIDO"],dense:"",outlined:"",label:"Estado"},null,8,["modelValue"])]),s("div",no,[b(o(u,{flat:"",color:"grey",label:"Cancelar",disable:r.saving},null,8,["disable"]),[[y]]),o(u,{color:"primary",label:r.form.id?"Guardar cambios":"Crear",type:"submit",loading:r.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const co=U($,[["render",uo]]),mo={name:"ProductorShow",components:{ProductorMapa:J,ProductorApiarios:j,ProductorCertificaciones:L,ProductorForm:z,ProductorRunsa:co},data(){return{tab:"general",loading:!1,productor:null}},mounted(){this.fetchProductor()},methods:{async fetchProductor(){this.loading=!0;try{const e=this.$route.params.id,{data:t}=await this.$axios.get(`productores/${e}`);this.productor=t}catch(e){this.productor=null,this.$alert?.error?.(e.response?.data?.message||"No se pudo cargar el productor")}finally{this.loading=!1}},onSaved(e){this.productor=e,this.$alert?.success?.("Cambios guardados")}}},po={class:"row items-center q-gutter-sm q-mb-md"};function fo(e,t,E,R,r,i){const l=m("ProductorForm"),h=m("ProductorCertificaciones"),V=m("ProductorRunsa"),F=m("ProductorApiarios"),D=m("ProductorMapa");return d(),g(M,{class:"q-pa-md"},{default:a(()=>[s("div",po,[o(u,{flat:"",round:"",icon:"arrow_back",onClick:t[0]||(t[0]=c=>e.$router.push("/productores"))}),t[4]||(t[4]=s("div",{class:"text-h6"},"Editar Productor",-1)),o(Q),o(u,{flat:"",round:"",icon:"refresh",loading:r.loading,onClick:i.fetchProductor},null,8,["loading","onClick"])]),o(q,{flat:"",bordered:""},{default:a(()=>[o(B,{modelValue:r.tab,"onUpdate:modelValue":t[1]||(t[1]=c=>r.tab=c),class:"text-primary",align:"left",dense:""},{default:a(()=>[o(p,{name:"general",icon:"badge",label:"1) Información general","no-caps":""}),o(p,{name:"runsa",icon:"assured_workload",label:"2) Runsa","no-caps":""}),o(p,{name:"certs",icon:"verified",label:"3) Certificaciones","no-caps":""}),o(p,{name:"apiarios",icon:"hive",label:"4) Apiarios","no-caps":""}),o(p,{name:"mapa",icon:"map",label:"5) Mapa","no-caps":""})]),_:1},8,["modelValue"]),o(I),o(G,{modelValue:r.tab,"onUpdate:modelValue":t[3]||(t[3]=c=>r.tab=c),animated:""},{default:a(()=>[o(f,{name:"general",class:"q-pa-none"},{default:a(()=>[!r.loading&&r.productor?(d(),g(P,{key:0},{default:a(()=>[o(l,{productor:r.productor,"banner-msg":"Actualiza los datos y guarda los cambios",onSaved:i.onSaved,onCancel:t[2]||(t[2]=c=>e.$router.back())},null,8,["productor","onSaved"])]),_:1})):w("",!0)]),_:1}),o(f,{name:"certs",class:"q-pa-none"},{default:a(()=>[o(h,{productor:r.productor,onUpdated:i.fetchProductor},null,8,["productor","onUpdated"])]),_:1}),o(f,{name:"runsa",class:"q-pa-none"},{default:a(()=>[o(V,{productor:r.productor,onUpdated:i.fetchProductor},null,8,["productor","onUpdated"])]),_:1}),o(f,{name:"apiarios",class:"q-pa-none"},{default:a(()=>[o(F,{productor:r.productor,onUpdated:i.fetchProductor},null,8,["productor","onUpdated"])]),_:1}),o(f,{name:"mapa",class:"q-pa-none"},{default:a(()=>[o(D,{productor:r.productor,onUpdated:i.fetchProductor},null,8,["productor","onUpdated"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const Fo=U(mo,[["render",fo]]);export{Fo as default};
