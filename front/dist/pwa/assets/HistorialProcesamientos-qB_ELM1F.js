import{_ as T,c as C,o as d,w as o,b as s,a as e,f as b,Q as u,e as h,a7 as n,d as _,ag as q,t as r,a9 as p,a8 as f,h as N,P as D,aa as P,ab as A,ai as V}from"./index-BlKDBvQ5.js";import{Q as z}from"./QSelect-CrufDZ1L.js";import{Q as g}from"./QTd-CZruX_-d.js";import{Q as v}from"./QChip-CsUcH7aQ.js";import{Q as H}from"./QTooltip-CQgyPbEx.js";import{Q as M}from"./QTable-Cev_6FcY.js";import{Q as L}from"./QSpace-CWkkK__K.js";import{Q as x,b as y,a as m}from"./position-engine-C6RYylQK.js";import{Q as I}from"./QList-CtW7EQxk.js";import{Q as U}from"./QPage-9F4PkkBC.js";import{C as F}from"./ClosePopup-jQ9viJ4_.js";import{h as Q}from"./moment-C5S46NFB.js";import"./format-Zk9it-h-.js";import"./selection-D8rj6CQm.js";import"./QMarkupTable-Dr0zNr-8.js";import"./QLinearProgress-Bu1X8STu.js";import"./use-fullscreen-D3o4GhfS.js";const B={name:"HistorialProcesamientos",data(){return{loading:!1,historial:[],filtros:{tipo_procesamiento:null,fecha_desde:null,fecha_hasta:null},tiposProcesamiento:[{label:"Automático",value:"AUTOMATICO"},{label:"Manual",value:"MANUAL"},{label:"Selección",value:"SELECCION"}],pagination:{sortBy:"fecha_ejecucion",descending:!0,page:1,rowsPerPage:15,rowsNumber:0},columns:[{name:"fecha_ejecucion",label:"Fecha",field:"fecha_ejecucion",align:"left",sortable:!0},{name:"tipo_procesamiento",label:"Tipo",field:"tipo_procesamiento",align:"center",sortable:!0},{name:"usuario",label:"Usuario",field:i=>i.usuario?.name,align:"left",sortable:!0},{name:"acopios_procesados",label:"Procesados",field:"acopios_procesados",align:"center",sortable:!0},{name:"total_kg_procesado",label:"Kg Total",field:"total_kg_procesado",align:"right",sortable:!0},{name:"total_costo",label:"Costo (Bs)",field:"total_costo",align:"right",sortable:!0},{name:"duracion_segundos",label:"Duración",field:"duracion_segundos",align:"center",sortable:!0},{name:"acciones",label:"Acciones",align:"center",style:"width: 80px"}],dialogDetalle:!1,registroSeleccionado:null}},mounted(){this.cargarHistorial()},methods:{async cargarHistorial(){this.loading=!0;try{const i={...this.filtros,page:this.pagination.page,per_page:this.pagination.rowsPerPage,sort_by:this.pagination.sortBy,sort_dir:this.pagination.descending?"desc":"asc"},{data:t}=await this.$axios.get("/procesamiento-masivo/historial",{params:i});this.historial=t.data,this.pagination.rowsNumber=t.total,this.pagination.page=t.current_page}catch(i){this.$q.notify({type:"negative",message:"Error al cargar historial",caption:i.response?.data?.message||i.message})}finally{this.loading=!1}},onRequest(i){const{page:t,rowsPerPage:w,sortBy:k,descending:l}=i.pagination;this.pagination.page=t,this.pagination.rowsPerPage=w,this.pagination.sortBy=k,this.pagination.descending=l,this.cargarHistorial()},aplicarFiltros(){this.pagination.page=1,this.cargarHistorial()},limpiarFiltros(){this.filtros={tipo_procesamiento:null,fecha_desde:null,fecha_hasta:null},this.aplicarFiltros()},verDetalle(i){this.registroSeleccionado=i,this.dialogDetalle=!0},getTipoColor(i){return{AUTOMATICO:"positive",MANUAL:"primary",SELECCION:"purple"}[i]||"grey"},getTipoLabel(i){return{AUTOMATICO:"Automático",MANUAL:"Manual",SELECCION:"Selección"}[i]||i},getDuracionColor(i){return i<5?"positive":i<15?"orange":"negative"},formatNumber(i){const t=parseFloat(i);return isNaN(t)?"0.00":t.toFixed(2)},formatFecha(i){return Q(i).format("DD/MM/YYYY")},formatHora(i){return Q(i).format("HH:mm:ss")},formatFechaCompleta(i){return Q(i).format("DD/MM/YYYY HH:mm:ss")},formatDuracion(i){if(i<60)return`${i}s`;const t=Math.floor(i/60),w=i%60;return`${t}m ${w}s`},formatFiltroKey(i){return{organizacion_id:"Organización",productor_id:"Productor",producto_id:"Producto",fecha_desde:"Fecha Desde",fecha_hasta:"Fecha Hasta",cantidad_min:"Cantidad Mín",cantidad_max:"Cantidad Máx"}[i]||i}}},O={class:"row items-center q-mb-md"},E={class:"col-auto"},j={class:"text-subtitle2 q-mb-md"},Y={class:"row q-col-gutter-md"},R={class:"col-12 col-sm-3"},K={class:"col-12 col-sm-3"},G={class:"col-12 col-sm-3"},J={class:"col-12 col-sm-3 text-right"},W={class:"text-caption text-grey-7"},X={class:"text-caption text-grey-7"},Z={class:"text-weight-bold text-positive"},$={key:0,class:"text-caption text-grey-7"},ee={key:1,class:"text-caption text-grey-7"},oe={class:"text-negative"},te={class:"text-weight-bold"},ae={class:"text-h6"},se={class:"row q-col-gutter-md"},le={class:"col-12 col-md-6"},ie={class:"text-subtitle1 text-primary q-mb-md"},re={class:"col-12 col-md-6"},ne={class:"text-subtitle1 text-primary q-mb-md"},ce={class:"row q-col-gutter-sm"},de={class:"col-6"},ue={class:"text-h5"},me={class:"col-6"},_e={class:"text-h5"},pe={class:"col-6"},fe={class:"text-h5"},ge={key:0,class:"col-6"},he={class:"text-h5"},be={key:1,class:"col-6"},ve={class:"text-h5"},xe={key:0,class:"col-12"},ye={class:"text-subtitle1 text-primary q-mb-md"},we={class:"row q-col-gutter-sm"},Ce={class:"col-12"},Se={class:"text-subtitle1 text-primary q-mb-md"},Qe={class:"row q-col-gutter-xs"};function ke(i,t,w,k,l,c){return d(),C(U,{class:"q-pa-md"},{default:o(()=>[s("div",O,[t[4]||(t[4]=s("div",{class:"col"},[s("div",{class:"text-h5 text-primary"},"Historial de Procesamientos Masivos"),s("div",{class:"text-caption text-grey-7"},"Registro completo de operaciones de procesamiento")],-1)),s("div",E,[e(b,{color:"primary",icon:"refresh",label:"Actualizar",onClick:c.cargarHistorial,loading:l.loading,dense:"","no-caps":""},null,8,["onClick","loading"])])]),e(u,{flat:"",bordered:"",class:"q-mb-md"},{default:o(()=>[e(h,null,{default:o(()=>[s("div",j,[e(_,{name:"filter_list",class:"q-mr-xs"}),t[5]||(t[5]=n(" Filtros "))]),s("div",Y,[s("div",R,[e(z,{modelValue:l.filtros.tipo_procesamiento,"onUpdate:modelValue":t[0]||(t[0]=a=>l.filtros.tipo_procesamiento=a),options:l.tiposProcesamiento,label:"Tipo de Procesamiento",dense:"",outlined:"",clearable:"","emit-value":"","map-options":""},{prepend:o(()=>[e(_,{name:"category"})]),_:1},8,["modelValue","options"])]),s("div",K,[e(q,{modelValue:l.filtros.fecha_desde,"onUpdate:modelValue":t[1]||(t[1]=a=>l.filtros.fecha_desde=a),type:"date",label:"Desde",dense:"",outlined:"",clearable:""},{prepend:o(()=>[e(_,{name:"event"})]),_:1},8,["modelValue"])]),s("div",G,[e(q,{modelValue:l.filtros.fecha_hasta,"onUpdate:modelValue":t[2]||(t[2]=a=>l.filtros.fecha_hasta=a),type:"date",label:"Hasta",dense:"",outlined:"",clearable:""},{prepend:o(()=>[e(_,{name:"event"})]),_:1},8,["modelValue"])]),s("div",J,[e(b,{color:"grey-7",label:"Limpiar",icon:"clear",onClick:c.limpiarFiltros,flat:"",dense:"","no-caps":"",class:"q-mr-sm"},null,8,["onClick"]),e(b,{color:"primary",label:"Aplicar",icon:"search",onClick:c.aplicarFiltros,loading:l.loading,dense:"","no-caps":""},null,8,["onClick","loading"])])])]),_:1})]),_:1}),e(u,{flat:"",bordered:""},{default:o(()=>[e(M,{rows:l.historial,columns:l.columns,"row-key":"id",loading:l.loading,pagination:l.pagination,onRequest:c.onRequest,"binary-state-sort":"",flat:""},{"body-cell-fecha_ejecucion":o(a=>[e(g,{props:a},{default:o(()=>[s("div",null,r(c.formatFecha(a.row.fecha_ejecucion)),1),s("div",W,r(c.formatHora(a.row.fecha_ejecucion)),1)]),_:2},1032,["props"])]),"body-cell-tipo_procesamiento":o(a=>[e(g,{props:a},{default:o(()=>[e(v,{color:c.getTipoColor(a.row.tipo_procesamiento),"text-color":"white",size:"sm",dense:""},{default:o(()=>[n(r(c.getTipoLabel(a.row.tipo_procesamiento)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-usuario":o(a=>[e(g,{props:a},{default:o(()=>[s("div",null,r(a.row.usuario?.name),1),s("div",X,r(a.row.usuario?.email),1)]),_:2},1032,["props"])]),"body-cell-acopios_procesados":o(a=>[e(g,{props:a,class:"text-center"},{default:o(()=>[s("div",Z,r(a.row.acopios_procesados),1),a.row.acopios_rechazados>0?(d(),p("div",$,r(a.row.acopios_rechazados)+" rechazados ",1)):f("",!0),a.row.acopios_fallidos>0?(d(),p("div",ee,[s("span",oe,r(a.row.acopios_fallidos)+" fallidos",1)])):f("",!0)]),_:2},1032,["props"])]),"body-cell-total_kg_procesado":o(a=>[e(g,{props:a,class:"text-right"},{default:o(()=>[s("span",te,r(c.formatNumber(a.row.total_kg_procesado)),1)]),_:2},1032,["props"])]),"body-cell-total_costo":o(a=>[e(g,{props:a,class:"text-right"},{default:o(()=>[n(r(c.formatNumber(a.row.total_costo)),1)]),_:2},1032,["props"])]),"body-cell-duracion_segundos":o(a=>[e(g,{props:a,class:"text-center"},{default:o(()=>[e(v,{size:"sm",color:c.getDuracionColor(a.row.duracion_segundos),"text-color":"white",dense:""},{default:o(()=>[n(r(c.formatDuracion(a.row.duracion_segundos)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-acciones":o(a=>[e(g,{props:a},{default:o(()=>[e(b,{icon:"visibility",color:"primary",flat:"",dense:"",round:"",onClick:S=>c.verDetalle(a.row)},{default:o(()=>[e(H,null,{default:o(()=>t[6]||(t[6]=[n("Ver Detalle")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading","pagination","onRequest"])]),_:1}),e(N,{modelValue:l.dialogDetalle,"onUpdate:modelValue":t[3]||(t[3]=a=>l.dialogDetalle=a),maximized:""},{default:o(()=>[l.registroSeleccionado?(d(),C(u,{key:0},{default:o(()=>[e(h,{class:"row items-center bg-primary text-white"},{default:o(()=>[e(_,{name:"article",size:"md",class:"q-mr-sm"}),s("span",ae,"Detalle del Procesamiento #"+r(l.registroSeleccionado.id),1),e(L),D(e(b,{icon:"close",flat:"",round:"",dense:""},null,512),[[F]])]),_:1}),e(h,null,{default:o(()=>[s("div",se,[s("div",le,[e(u,{flat:"",bordered:""},{default:o(()=>[e(h,null,{default:o(()=>[s("div",ie,[e(_,{name:"info"}),t[7]||(t[7]=n(" Información General "))]),e(I,{dense:""},{default:o(()=>[e(x,null,{default:o(()=>[e(y,null,{default:o(()=>[e(m,{caption:""},{default:o(()=>t[8]||(t[8]=[n("Tipo de Procesamiento")])),_:1}),e(m,null,{default:o(()=>[e(v,{color:c.getTipoColor(l.registroSeleccionado.tipo_procesamiento),"text-color":"white",size:"sm"},{default:o(()=>[n(r(c.getTipoLabel(l.registroSeleccionado.tipo_procesamiento)),1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1}),e(x,null,{default:o(()=>[e(y,null,{default:o(()=>[e(m,{caption:""},{default:o(()=>t[9]||(t[9]=[n("Fecha de Ejecución")])),_:1}),e(m,null,{default:o(()=>[n(r(c.formatFechaCompleta(l.registroSeleccionado.fecha_ejecucion)),1)]),_:1})]),_:1})]),_:1}),e(x,null,{default:o(()=>[e(y,null,{default:o(()=>[e(m,{caption:""},{default:o(()=>t[10]||(t[10]=[n("Usuario Responsable")])),_:1}),e(m,null,{default:o(()=>[n(r(l.registroSeleccionado.usuario?.name),1)]),_:1}),e(m,{caption:""},{default:o(()=>[n(r(l.registroSeleccionado.usuario?.email),1)]),_:1})]),_:1})]),_:1}),e(x,null,{default:o(()=>[e(y,null,{default:o(()=>[e(m,{caption:""},{default:o(()=>t[11]||(t[11]=[n("Duración")])),_:1}),e(m,null,{default:o(()=>[n(r(c.formatDuracion(l.registroSeleccionado.duracion_segundos)),1)]),_:1})]),_:1})]),_:1}),l.registroSeleccionado.observaciones?(d(),C(x,{key:0},{default:o(()=>[e(y,null,{default:o(()=>[e(m,{caption:""},{default:o(()=>t[12]||(t[12]=[n("Observaciones")])),_:1}),e(m,null,{default:o(()=>[n(r(l.registroSeleccionado.observaciones),1)]),_:1})]),_:1})]),_:1})):f("",!0)]),_:1})]),_:1})]),_:1})]),s("div",re,[e(u,{flat:"",bordered:""},{default:o(()=>[e(h,null,{default:o(()=>[s("div",ne,[e(_,{name:"assessment"}),t[13]||(t[13]=n(" Estadísticas "))]),s("div",ce,[s("div",de,[e(u,{flat:"",class:"bg-positive text-white text-center q-pa-md"},{default:o(()=>[s("div",ue,r(l.registroSeleccionado.acopios_procesados),1),t[14]||(t[14]=s("div",{class:"text-caption"},"Acopios Procesados",-1))]),_:1})]),s("div",me,[e(u,{flat:"",class:"bg-green text-white text-center q-pa-md"},{default:o(()=>[s("div",_e,r(c.formatNumber(l.registroSeleccionado.total_kg_procesado)),1),t[15]||(t[15]=s("div",{class:"text-caption"},"Kilogramos",-1))]),_:1})]),s("div",pe,[e(u,{flat:"",class:"bg-orange text-white text-center q-pa-md"},{default:o(()=>[s("div",fe,r(c.formatNumber(l.registroSeleccionado.total_costo)),1),t[16]||(t[16]=s("div",{class:"text-caption"},"Costo Total (Bs)",-1))]),_:1})]),l.registroSeleccionado.acopios_rechazados>0?(d(),p("div",ge,[e(u,{flat:"",class:"bg-warning text-white text-center q-pa-md"},{default:o(()=>[s("div",he,r(l.registroSeleccionado.acopios_rechazados),1),t[17]||(t[17]=s("div",{class:"text-caption"},"Rechazados",-1))]),_:1})])):f("",!0),l.registroSeleccionado.acopios_fallidos>0?(d(),p("div",be,[e(u,{flat:"",class:"bg-negative text-white text-center q-pa-md"},{default:o(()=>[s("div",ve,r(l.registroSeleccionado.acopios_fallidos),1),t[18]||(t[18]=s("div",{class:"text-caption"},"Fallidos",-1))]),_:1})])):f("",!0)])]),_:1})]),_:1})]),l.registroSeleccionado.filtros_aplicados?(d(),p("div",xe,[e(u,{flat:"",bordered:""},{default:o(()=>[e(h,null,{default:o(()=>[s("div",ye,[e(_,{name:"tune"}),t[19]||(t[19]=n(" Filtros Aplicados "))]),s("div",we,[(d(!0),p(P,null,A(l.registroSeleccionado.filtros_aplicados,(a,S)=>(d(),p("div",{key:S,class:"col-12 col-sm-6 col-md-4"},[a?(d(),C(v,{key:0,outline:"",color:"primary",size:"md"},{default:o(()=>[s("strong",null,r(c.formatFiltroKey(S))+":",1),n(" "+r(a),1)]),_:2},1024)):f("",!0)]))),128))])]),_:1})]),_:1})])):f("",!0),s("div",Ce,[e(u,{flat:"",bordered:""},{default:o(()=>[e(h,null,{default:o(()=>[s("div",Se,[e(_,{name:"list"}),n(" Acopios Procesados ("+r(l.registroSeleccionado.acopio_ids?.length||0)+") ",1)]),s("div",Qe,[(d(!0),p(P,null,A(l.registroSeleccionado.acopio_ids,a=>(d(),p("div",{key:a,class:"col-auto"},[e(v,{size:"sm",color:"blue-grey-2"},{default:o(()=>[n(" Acopio #"+r(a),1)]),_:2},1024)]))),128))])]),_:1})]),_:1})])])]),_:1}),e(V,{align:"right"},{default:o(()=>[D(e(b,{label:"Cerrar",color:"primary",flat:""},null,512),[[F]])]),_:1})]),_:1})):f("",!0)]),_:1},8,["modelValue"])]),_:1})}const je=T(B,[["render",ke],["__scopeId","data-v-559dde38"]]);export{je as default};
