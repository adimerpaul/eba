import{aq as ie,j as W,g as H,ar as ne,k as r,l as v,as as oe,at as se,A as re,E as de,r as ue,s as ce,au as j,av as me,aw as ge,ad as D,f as q,_ as fe,c as ve,o as N,w as x,b as i,a as d,ab as he,Q as R,e as pe,ag as be,d as ye,a7 as E,a6 as K,a8 as _e,a9 as xe,t as f,a5 as G}from"./index-6IHxgry6.js";import{Q as Ce}from"./QSpace-DY67wFKK.js";import{Q as k}from"./QSelect-DwJSveFE.js";import{c as X,d as ke}from"./format-WnA0rjyC.js";import{Q as Ve}from"./QMarkupTable-DlCQZ6S4.js";import{Q as Se}from"./QPage-BpggVHej.js";import"./moment-C5S46NFB.js";import"./selection-CljkKmo-.js";const Pe={...ie,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:e=>e>=0&&e<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},A=50,J=2*A,Y=J*Math.PI,we=Math.round(Y*1e3)/1e3,Be=W({name:"QCircularProgress",props:{...Pe,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(e,{slots:a}){const{proxy:{$q:m}}=H(),u=ne(e),l=r(()=>{const c=(m.lang.rtl===!0?-1:1)*e.angle;return{transform:e.reverse!==(m.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-c}deg)`:`rotate3d(0, 0, 1, ${c-90}deg)`}}),s=r(()=>e.instantFeedback!==!0&&e.indeterminate!==!0?{transition:`stroke-dashoffset ${e.animationSpeed}ms ease 0s, stroke ${e.animationSpeed}ms ease`}:""),t=r(()=>J/(1-e.thickness/2)),V=r(()=>`${t.value/2} ${t.value/2} ${t.value} ${t.value}`),y=r(()=>X(e.value,e.min,e.max)),F=r(()=>e.max-e.min),h=r(()=>e.thickness/2*t.value),U=r(()=>{const c=(e.max-y.value)/F.value,g=e.rounded===!0&&y.value<e.max&&c<.25?h.value/2*(1-c/.25):0;return Y*c+g});function C({thickness:c,offset:g,color:I,cls:S,rounded:Q}){return v("circle",{class:"q-circular-progress__"+S+(I!==void 0?` text-${I}`:""),style:s.value,fill:"transparent",stroke:"currentColor","stroke-width":c,"stroke-dasharray":we,"stroke-dashoffset":g,"stroke-linecap":Q,cx:t.value,cy:t.value,r:A})}return()=>{const c=[];e.centerColor!==void 0&&e.centerColor!=="transparent"&&c.push(v("circle",{class:`q-circular-progress__center text-${e.centerColor}`,fill:"currentColor",r:A-h.value/2,cx:t.value,cy:t.value})),e.trackColor!==void 0&&e.trackColor!=="transparent"&&c.push(C({cls:"track",thickness:h.value,offset:0,color:e.trackColor})),c.push(C({cls:"circle",thickness:h.value,offset:U.value,color:e.color,rounded:e.rounded===!0?"round":void 0}));const g=[v("svg",{class:"q-circular-progress__svg",style:l.value,viewBox:V.value,"aria-hidden":"true"},c)];return e.showValue===!0&&g.push(v("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:e.fontSize}},a.default!==void 0?a.default():[v("div",y.value)])),v("div",{class:`q-circular-progress q-circular-progress--${e.indeterminate===!0?"in":""}determinate`,style:u.value,role:"progressbar","aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.indeterminate===!0?void 0:y.value},oe(a.internal,g))}}});function O(e,a){return[!0,!1].includes(e)?e:a}const Ne=W({name:"QPagination",props:{...re,modelValue:{type:Number,required:!0},min:{type:[Number,String],default:1},max:{type:[Number,String],required:!0},maxPages:{type:[Number,String],default:0,validator:e=>(typeof e=="string"?parseInt(e,10):e)>=0},inputStyle:[Array,String,Object],inputClass:[Array,String,Object],size:String,disable:Boolean,input:Boolean,iconPrev:String,iconNext:String,iconFirst:String,iconLast:String,toFn:Function,boundaryLinks:{type:Boolean,default:null},boundaryNumbers:{type:Boolean,default:null},directionLinks:{type:Boolean,default:null},ellipses:{type:Boolean,default:null},ripple:{type:[Boolean,Object],default:null},round:Boolean,rounded:Boolean,flat:Boolean,outline:Boolean,unelevated:Boolean,push:Boolean,glossy:Boolean,color:{type:String,default:"primary"},textColor:String,activeDesign:{type:String,default:"",values:e=>e===""||se.includes(e)},activeColor:String,activeTextColor:String,gutter:String,padding:{type:String,default:"3px 2px"}},emits:["update:modelValue"],setup(e,{emit:a}){const{proxy:m}=H(),{$q:u}=m,l=de(e,u),s=r(()=>parseInt(e.min,10)),t=r(()=>parseInt(e.max,10)),V=r(()=>parseInt(e.maxPages,10)),y=r(()=>g.value+" / "+t.value),F=r(()=>O(e.boundaryLinks,e.input)),h=r(()=>O(e.boundaryNumbers,!e.input)),U=r(()=>O(e.directionLinks,e.input)),C=r(()=>O(e.ellipses,!e.input)),c=ue(null),g=r({get:()=>e.modelValue,set:n=>{if(n=parseInt(n,10),e.disable||isNaN(n))return;const o=X(n,s.value,t.value);e.modelValue!==o&&a("update:modelValue",o)}});ce(()=>`${s.value}|${t.value}`,()=>{g.value=e.modelValue});const I=r(()=>"q-pagination row no-wrap items-center"+(e.disable===!0?" disabled":"")),S=r(()=>e.gutter in j?`${j[e.gutter]}px`:e.gutter||null),Q=r(()=>S.value!==null?`--q-pagination-gutter-parent:-${S.value};--q-pagination-gutter-child:${S.value}`:null),T=r(()=>{const n=[e.iconFirst||u.iconSet.pagination.first,e.iconPrev||u.iconSet.pagination.prev,e.iconNext||u.iconSet.pagination.next,e.iconLast||u.iconSet.pagination.last];return u.lang.rtl===!0?n.reverse():n}),Z=r(()=>({"aria-disabled":e.disable===!0?"true":"false",role:"navigation"})),M=r(()=>me(e,"flat")),$=r(()=>({[M.value]:!0,round:e.round,rounded:e.rounded,padding:e.padding,color:e.color,textColor:e.textColor,size:e.size,ripple:e.ripple!==null?e.ripple:!0})),ee=r(()=>{const n={[M.value]:!1};return e.activeDesign!==""&&(n[e.activeDesign]=!0),n}),te=r(()=>({...ee.value,color:e.activeColor||e.color,textColor:e.activeTextColor||e.textColor})),P=r(()=>{let n=Math.max(V.value,1+(C.value?2:0)+(h.value?2:0));const o={pgFrom:s.value,pgTo:t.value,ellipsesStart:!1,ellipsesEnd:!1,boundaryStart:!1,boundaryEnd:!1,marginalStyle:{minWidth:`${Math.max(2,String(t.value).length)}em`}};return V.value&&n<t.value-s.value+1&&(n=1+Math.floor(n/2)*2,o.pgFrom=Math.max(s.value,Math.min(t.value-n+1,e.modelValue-Math.floor(n/2))),o.pgTo=Math.min(t.value,o.pgFrom+n-1),h.value&&(o.boundaryStart=!0,o.pgFrom++),C.value&&o.pgFrom>s.value+(h.value?1:0)&&(o.ellipsesStart=!0,o.pgFrom++),h.value&&(o.boundaryEnd=!0,o.pgTo--),C.value&&o.pgTo<t.value-(h.value?1:0)&&(o.ellipsesEnd=!0,o.pgTo--)),o});function L(n){g.value=n}function ae(n){g.value=g.value+n}const le=r(()=>{function n(){g.value=c.value,c.value=null}return{"onUpdate:modelValue":o=>{c.value=o},onKeyup:o=>{ge(o,13)===!0&&n()},onBlur:n}});function b(n,o,w){const _={"aria-label":o,"aria-current":"false",...$.value,...n};return w===!0&&Object.assign(_,{"aria-current":"true",...te.value}),o!==void 0&&(e.toFn!==void 0?_.to=e.toFn(o):_.onClick=()=>{L(o)}),v(q,_)}return Object.assign(m,{set:L,setByOffset:ae}),()=>{const n=[],o=[];let w;if(F.value===!0&&(n.push(b({key:"bls",disable:e.disable||e.modelValue<=s.value,icon:T.value[0],"aria-label":u.lang.pagination.first},s.value)),o.unshift(b({key:"ble",disable:e.disable||e.modelValue>=t.value,icon:T.value[3],"aria-label":u.lang.pagination.last},t.value))),U.value===!0&&(n.push(b({key:"bdp",disable:e.disable||e.modelValue<=s.value,icon:T.value[1],"aria-label":u.lang.pagination.prev},e.modelValue-1)),o.unshift(b({key:"bdn",disable:e.disable||e.modelValue>=t.value,icon:T.value[2],"aria-label":u.lang.pagination.next},e.modelValue+1))),e.input!==!0){w=[];const{pgFrom:_,pgTo:z,marginalStyle:B}=P.value;if(P.value.boundaryStart===!0){const p=s.value===e.modelValue;n.push(b({key:"bns",style:B,disable:e.disable,label:s.value},s.value,p))}if(P.value.boundaryEnd===!0){const p=t.value===e.modelValue;o.unshift(b({key:"bne",style:B,disable:e.disable,label:t.value},t.value,p))}P.value.ellipsesStart===!0&&n.push(b({key:"bes",style:B,disable:e.disable,label:"…",ripple:!1},_-1)),P.value.ellipsesEnd===!0&&o.unshift(b({key:"bee",style:B,disable:e.disable,label:"…",ripple:!1},z+1));for(let p=_;p<=z;p++)w.push(b({key:`bpg${p}`,style:B,disable:e.disable,label:p},p,p===e.modelValue))}return v("div",{class:I.value,...Z.value},[v("div",{class:"q-pagination__content row no-wrap items-center",style:Q.value},[...n,e.input===!0?v(D,{class:"inline",style:{width:`${y.value.length/1.5}em`},type:"number",dense:!0,value:c.value,disable:e.disable,dark:l.value,borderless:!0,inputClass:e.inputClass,inputStyle:e.inputStyle,placeholder:y.value,min:s.value,max:t.value,...le.value}):v("div",{class:"q-pagination__middle row justify-center"},w),...o])])}}}),qe={name:"ProductoresPage",data(){return{rows:[],loading:!1,producto:{},serverCount:0,pagination:{page:1,perPage:10},loadingTree:!1,tree:[],filters:{search:"",estado:null,sexo:null,fecha_desde:null,fecha_hasta:null,departamento_id:null,provincia_id:null,municipio_id:null},sexoOptions:[{label:"Masculino",value:1},{label:"Femenino",value:2}]}},computed:{pageCount(){return Math.max(1,Math.ceil(this.serverCount/this.pagination.perPage))},depOptions(){return Array.isArray(this.tree)?this.tree.map(e=>({label:e.nombre_departamento,value:e.id})):[]},provOptions(){const e=this.filters.departamento_id;return e?((this.tree||[]).find(m=>m.id===e)?.provincias||[]).map(m=>({label:m.nombre_provincia,value:m.id})):[]},munOptions(){const e=this.filters.departamento_id,a=this.filters.provincia_id;return!e||!a?[]:(((this.tree||[]).find(l=>l.id===e)?.provincias||[]).find(l=>l.id===a)?.municipios||[]).map(l=>({label:l.nombre_municipio,value:l.id}))}},mounted(){this.loadTree(),this.fetchPage()},methods:{async genrarExcel(){this.loading=!0,await this.$axios.post("productorExcel",{page:this.pagination.page,per_page:this.pagination.perPage,sort_by:"id",sort_dir:"desc",search:this.filters.search||void 0,estado:this.filters.estado||void 0,sexo:this.filters.sexo||void 0,fecha_desde:this.filters.fecha_desde||void 0,fecha_hasta:this.filters.fecha_hasta||void 0,departamento_id:this.filters.departamento_id||void 0,provincia_id:this.filters.provincia_id||void 0,municipio_id:this.filters.municipio_id||void 0},{responseType:"blob"}).then(e=>{const a=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),m=window.URL.createObjectURL(a),u=document.createElement("a");u.href=m,u.setAttribute("download","proveedores.xlsx"),document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(m)}).catch(e=>{this.$alert?.error?.(e.response?.data?.message||"No se pudo generar el reporte.")}).finally(()=>{this.loading=!1})},chipColor(e){return e==="VIGENTE"||e==="ACTIVO"?"green":e==="VENCIDO"||e==="INACTIVO"?"red":"grey"},async loadTree(){this.loadingTree=!0;try{const{data:e}=await this.$axios.get("geo/tree");this.tree=e}catch(e){this.$alert?.error?.(e.response?.data?.message||"No se pudo cargar el árbol geográfico")}finally{this.loadingTree=!1}},async fetchPage(){this.loading=!0,this.rows=[];try{const{data:e}=await this.$axios.get("productores",{params:{page:this.pagination.page,per_page:this.pagination.perPage,sort_by:"id",sort_dir:"desc",search:this.filters.search||void 0,estado:this.filters.estado||void 0,sexo:this.filters.sexo||void 0,fecha_desde:this.filters.fecha_desde||void 0,fecha_hasta:this.filters.fecha_hasta||void 0,departamento_id:this.filters.departamento_id||void 0,provincia_id:this.filters.provincia_id||void 0,municipio_id:this.filters.municipio_id||void 0}});console.log(e),this.rows=e.data,this.serverCount=e.total,this.pagination.page>this.pageCount&&(this.pagination.page=this.pageCount)}catch(e){this.$alert?.error?.(e.response?.data?.message||"No se pudo cargar productores")}finally{this.loading=!1}},changePage(){this.fetchPage()},changePerPage(){this.pagination.page=1,this.fetchPage()},applyFilters(){this.pagination.page=1,this.fetchPage()},onDepChange(){this.filters.provincia_id=null,this.filters.municipio_id=null,this.applyFilters()},onProvChange(){this.filters.municipio_id=null,this.applyFilters()},openDetails(e){this.$router.push("/productores/editar/"+e.id)}}},Ie={class:"row items-center q-gutter-sm q-mb-sm"},Te={class:"col-12 col-md-3"},Ee={class:"col-12 col-md-2"},Oe={class:"col-12 col-md-2"},De={class:"col-12 col-md-2"},Fe={class:"col-12 col-md-2"},Ue={class:"col-12 col-md-3"},Qe={class:"col-12 col-md-3"},Ae={class:"col-12 col-md-3"},Me={class:"col-12 col-md-auto q-gutter-sm"},Le=["onClick"],ze={class:"text-left"},je={class:"text-left"},Re={class:"text-left"},Ke={class:"text-left"},Ge={class:"text-weight-medium"},We={class:"text-caption text-grey-7"},He={class:"text-left"},Xe={class:"text-left"},Je={class:"text-left"},Ye={class:"text-left"},Ze={class:"text-left"},$e={key:0},et={key:0,class:"absolute-full flex flex-center bg-transparent"},tt={class:"q-pa-sm row items-center justify-between"},at={class:"text-caption"},lt={class:"row items-center q-gutter-sm"};function it(e,a,m,u,l,s){return N(),ve(Se,{class:"q-pa-md"},{default:x(()=>[i("div",Ie,[d(he,{icon:"person_search",color:"primary","text-color":"white"}),a[11]||(a[11]=i("div",{class:"text-h6 text-weight-bold"},"Productores",-1)),d(Ce),d(q,{color:"primary",icon:"forest",label:"Actualizar árbol geo",onClick:s.loadTree,loading:l.loadingTree,"no-caps":""},null,8,["onClick","loading"])]),d(R,{flat:"",bordered:"",class:"q-mb-md"},{default:x(()=>[d(pe,{class:"row q-col-gutter-sm"},{default:x(()=>[i("div",Te,[d(D,{modelValue:l.filters.search,"onUpdate:modelValue":a[0]||(a[0]=t=>l.filters.search=t),dense:"",outlined:"",placeholder:"Buscar (RUNSA, nombre, carnet, celular...)",onKeyup:be(s.applyFilters,["enter"])},{append:x(()=>[d(ye,{name:"search"})]),_:1},8,["modelValue","onKeyup"])]),i("div",Ee,[d(k,{modelValue:l.filters.estado,"onUpdate:modelValue":a[1]||(a[1]=t=>l.filters.estado=t),options:["VIGENTE","VENCIDO","ACTIVO","INACTIVO"],dense:"",outlined:"",label:"Estado",clearable:""},null,8,["modelValue"])]),i("div",Oe,[d(k,{modelValue:l.filters.sexo,"onUpdate:modelValue":a[2]||(a[2]=t=>l.filters.sexo=t),options:l.sexoOptions,dense:"",outlined:"",label:"Sexo",clearable:""},null,8,["modelValue","options"])]),i("div",De,[d(D,{modelValue:l.filters.fecha_desde,"onUpdate:modelValue":a[3]||(a[3]=t=>l.filters.fecha_desde=t),type:"date",dense:"",outlined:"",label:"Desde"},null,8,["modelValue"])]),i("div",Fe,[d(D,{modelValue:l.filters.fecha_hasta,"onUpdate:modelValue":a[4]||(a[4]=t=>l.filters.fecha_hasta=t),type:"date",dense:"",outlined:"",label:"Hasta"},null,8,["modelValue"])]),i("div",Ue,[d(k,{modelValue:l.filters.departamento_id,"onUpdate:modelValue":[a[5]||(a[5]=t=>l.filters.departamento_id=t),s.onDepChange],options:s.depOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",dense:"",outlined:"",label:"Departamento"},null,8,["modelValue","options","onUpdate:modelValue"])]),i("div",Qe,[d(k,{modelValue:l.filters.provincia_id,"onUpdate:modelValue":[a[6]||(a[6]=t=>l.filters.provincia_id=t),s.onProvChange],options:s.provOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",dense:"",outlined:"",label:"Provincia",disable:!l.filters.departamento_id},null,8,["modelValue","options","disable","onUpdate:modelValue"])]),i("div",Ae,[d(k,{modelValue:l.filters.municipio_id,"onUpdate:modelValue":a[7]||(a[7]=t=>l.filters.municipio_id=t),options:s.munOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",dense:"",outlined:"",label:"Municipio",disable:!l.filters.provincia_id},null,8,["modelValue","options","disable"])]),i("div",Me,[d(q,{color:"secondary",icon:"refresh",label:"Aplicar",loading:l.loading,onClick:s.applyFilters,"no-caps":""},null,8,["loading","onClick"]),d(q,{color:"primary",icon:"person_add",label:"Nuevo Productor",loading:l.loading,onClick:a[8]||(a[8]=t=>e.$router.push("/productores/crear")),"no-caps":""},null,8,["loading"]),d(q,{color:"green",label:"EXCEL",onClick:s.genrarExcel,loading:l.loading},null,8,["onClick","loading"])])]),_:1})]),_:1}),d(R,{flat:"",bordered:"",class:"relative-position"},{default:x(()=>[d(Ve,{dense:"","wrap-cells":""},{default:x(()=>[a[13]||(a[13]=i("thead",null,[i("tr",{class:"bg-primary text-white"},[i("th",{class:"text-left"},"ID"),i("th",{class:"text-left"},"RUNSA"),i("th",{class:"text-left"},"Sub Cód."),i("th",{class:"text-left"},"Nombre completo"),i("th",{class:"text-left"},"CI"),i("th",{class:"text-left"},"Celular"),i("th",{class:"text-left"},"Comunidad"),i("th",{class:"text-left"},"Estado"),i("th",{class:"text-left"},"Registro")])],-1)),i("tbody",null,[(N(!0),E(_e,null,xe(l.rows,t=>(N(),E("tr",{key:t.id,class:"row-click",onClick:V=>s.openDetails(t)},[i("td",ze,f(t.id),1),i("td",je,f(t.runsa||"-"),1),i("td",Re,f(t.sub_codigo||"-"),1),i("td",Ke,[i("div",Ge,f(t.nombre_completo),1),i("div",We,f(t.municipio?.nombre_municipio||"-"),1)]),i("td",He,f(t.numcarnet),1),i("td",Xe,f(t.num_celular||"-"),1),i("td",Je,f(t.comunidad||"-"),1),i("td",Ye,[d(ke,{color:s.chipColor(t.estado),"text-color":"white",size:"xs",class:"text-bold"},{default:x(()=>[G(f(t.estado),1)]),_:2},1032,["color"])]),i("td",Ze,f(t.fecha_registro),1)],8,Le))),128)),!l.loading&&l.rows?.length===0?(N(),E("tr",$e,a[12]||(a[12]=[i("td",{colspan:"9",class:"text-center text-grey q-pa-md"},"No hay resultados",-1)]))):K("",!0)])]),_:1}),l.loading?(N(),E("div",et,[d(Be,{indeterminate:"",size:"40px"})])):K("",!0),i("div",tt,[i("div",at,[a[14]||(a[14]=G("Total: ")),i("b",null,f(l.serverCount?.toLocaleString()),1)]),i("div",lt,[d(k,{modelValue:l.pagination.perPage,"onUpdate:modelValue":[a[9]||(a[9]=t=>l.pagination.perPage=t),s.changePerPage],options:[10,25,50,100,150,200],dense:"",outlined:"",style:{width:"120px"},label:"Por página"},null,8,["modelValue","onUpdate:modelValue"]),d(Ne,{modelValue:l.pagination.page,"onUpdate:modelValue":[a[10]||(a[10]=t=>l.pagination.page=t),s.changePage],max:s.pageCount,"max-pages":"8","direction-links":"","boundary-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])])]),_:1})]),_:1})}const gt=fe(qe,[["render",it],["__scopeId","data-v-1ddae877"]]);export{gt as default};
