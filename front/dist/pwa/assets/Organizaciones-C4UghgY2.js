import{_ as I,c as g,o as p,w as t,b as n,a,a5 as k,f as c,Q as b,e as h,as as u,av as T,d as V,a0 as O,a1 as A,a2 as P,W as f,Z as C,t as r,h as q,a3 as N}from"./index-C8cOtXD5.js";import{Q as z}from"./QSpace-G125MlL4.js";import{Q as m}from"./QSelect-Btz7-Uhq.js";import{Q as x,a as _,d as R}from"./format-9hC2cPcq.js";import{Q as D,a as S}from"./QList-DC0hlBnR.js";import{Q as E}from"./QMarkupTable-PSZmN6DJ.js";import{Q as M}from"./QForm-z2o1sA1w.js";import{Q as j}from"./QPage-4pZAHheK.js";import{C as v}from"./ClosePopup-aRKoZuby.js";import"./selection-DN40pDtB.js";const B={name:"OrganizacionesPage",data(){return{rows:[],loading:!1,saving:!1,dialog:!1,loadingTree:!1,tree:[],filters:{search:"",departamento_id:null,provincia_id:null,municipio_id:null,estado:null},form:{id:null,nombre_organiza:"",asociacion:"",programa:"",nombre_presidente:"",descripcion:"",celular:"",num_apicultor:0,num_colmena:0,pj_actual:0,convenio:0,estado:"ACTIVO",fecha_registro:null,departamento_id:null,provincia_id:null,municipio_id:null}}},computed:{depOptions(){return(this.tree||[]).map(l=>({label:l.nombre_departamento,value:l.id}))},provOptions(){const l=this.filters.departamento_id;return l?((this.tree||[]).find(d=>d.id===l)?.provincias||[]).map(d=>({label:d.nombre_provincia,value:d.id})):[]},munOptions(){const l=this.filters.departamento_id,i=this.filters.provincia_id;return!l||!i?[]:(((this.tree||[]).find(o=>o.id===l)?.provincias||[]).find(o=>o.id===i)?.municipios||[]).map(o=>({label:o.nombre_municipio,value:o.id}))},formProvOptions(){const l=this.form.departamento_id;return l?((this.tree||[]).find(d=>d.id===l)?.provincias||[]).map(d=>({label:d.nombre_provincia,value:d.id})):[]},formMunOptions(){const l=this.form.departamento_id,i=this.form.provincia_id;return!l||!i?[]:(((this.tree||[]).find(o=>o.id===l)?.provincias||[]).find(o=>o.id===i)?.municipios||[]).map(o=>({label:o.nombre_municipio,value:o.id}))}},mounted(){this.loadTree(),this.fetchRows()},methods:{async loadTree(){this.loadingTree=!0;try{const{data:l}=await this.$axios.get("geo/tree");this.tree=l}catch(l){this.$alert?.error?.(l.response?.data?.message||"No se pudo cargar el árbol geográfico")}finally{this.loadingTree=!1}},async fetchRows(){this.loading=!0;try{const{data:l}=await this.$axios.get("organizaciones",{params:{search:this.filters.search||void 0,departamento_id:this.filters.departamento_id||void 0,provincia_id:this.filters.provincia_id||void 0,municipio_id:this.filters.municipio_id||void 0,estado:this.filters.estado||void 0}});this.rows=l}catch(l){this.$alert?.error?.(l.response?.data?.message||"No se pudo cargar organizaciones")}finally{this.loading=!1}},onDepChange(){this.filters.provincia_id=null,this.filters.municipio_id=null,this.fetchRows()},onProvChange(){this.filters.municipio_id=null,this.fetchRows()},openNew(){this.form={id:null,nombre_organiza:"",asociacion:"",programa:"",nombre_presidente:"",descripcion:"",celular:"",num_apicultor:0,num_colmena:0,pj_actual:0,convenio:0,estado:"ACTIVO",fecha_registro:new Date().toISOString().slice(0,10),departamento_id:this.filters.departamento_id||null,provincia_id:this.filters.provincia_id||null,municipio_id:this.filters.municipio_id||null},this.dialog=!0},openEdit(l){this.form={id:l.id,nombre_organiza:l.nombre_organiza,asociacion:l.asociacion,programa:l.programa,nombre_presidente:l.nombre_presidente,descripcion:l.descripcion,celular:l.celular,num_apicultor:l.num_apicultor??0,num_colmena:l.num_colmena??0,pj_actual:l.pj_actual??0,convenio:l.convenio??0,estado:l.estado||"ACTIVO",fecha_registro:l.fecha_registro||new Date().toISOString().slice(0,10),departamento_id:l.departamento?.id||l.municipio?.departamento_id||null,provincia_id:l.provincia?.id||l.municipio?.provincia_id||null,municipio_id:l.municipio?.id||l.municipio_id||null},this.dialog=!0},async submit(){this.saving=!0;try{const l={...this.form},i={municipio_id:l.municipio_id,nombre_organiza:l.nombre_organiza,asociacion:l.asociacion,programa:l.programa,nombre_presidente:l.nombre_presidente,descripcion:l.descripcion,celular:l.celular,num_apicultor:l.num_apicultor,num_colmena:l.num_colmena,pj_actual:l.pj_actual,convenio:l.convenio,estado:l.estado,fecha_registro:l.fecha_registro};l.id?(await this.$axios.put(`organizaciones/${l.id}`,i),this.$alert?.success?.("Actualizado")):(await this.$axios.post("organizaciones",i),this.$alert?.success?.("Creado")),this.dialog=!1,this.fetchRows()}catch(l){this.$alert?.error?.(l.response?.data?.message||"No se pudo guardar")}finally{this.saving=!1}},remove(l){this.$alert?.dialog?.(`¿Eliminar la organización "${l.nombre_organiza}"?`)?.onOk(async()=>{this.loading=!0;try{await this.$axios.delete(`organizaciones/${l.id}`),this.$alert?.success?.("Eliminado"),this.fetchRows()}catch(i){this.$alert?.error?.(i.response?.data?.message||"No se pudo eliminar")}finally{this.loading=!1}})}}},w={class:"row items-center q-gutter-sm q-mb-sm"},F={class:"col-12 col-md-3"},K={class:"col-12 col-md-3"},J={class:"col-12 col-md-3"},L={class:"col-12 col-md-3"},G={class:"col-12 col-md-2"},W={class:"col-12 col-md-3 q-gutter-sm"},Z={class:"text-weight-medium"},H={class:"text-right"},X={class:"text-right"},Y={class:"text-h6"},$={class:"row q-col-gutter-sm"},ee={class:"col-12"},oe={class:"col-12 col-sm-6"},le={class:"col-12 col-sm-6"},ie={class:"col-12 col-sm-6"},ne={class:"col-12 col-sm-6"},ae={class:"col-12"},te={class:"col-6 col-sm-3"},se={class:"col-6 col-sm-3"},re={class:"col-6 col-sm-3"},de={class:"col-6 col-sm-3"},ue={class:"col-12 col-sm-4"},me={class:"col-12 col-sm-4"},ce={class:"col-12 col-sm-4"},pe={class:"col-12 col-sm-6"},fe={class:"col-12 col-sm-6"},_e={class:"text-right q-mt-md"};function ve(l,i,d,y,o,s){return p(),g(j,{class:"q-pa-md"},{default:t(()=>[n("div",w,[a(k,{icon:"groups",color:"primary","text-color":"white"}),i[21]||(i[21]=n("div",{class:"text-h6 text-weight-bold"},"Organizaciones",-1)),a(z),a(c,{color:"primary",icon:"refresh",label:"Actualizar árbol",onClick:s.loadTree,loading:o.loadingTree,"no-caps":""},null,8,["onClick","loading"])]),a(b,{flat:"",bordered:"",class:"q-mb-md"},{default:t(()=>[a(h,{class:"row items-center q-col-gutter-sm"},{default:t(()=>[n("div",F,[a(u,{modelValue:o.filters.search,"onUpdate:modelValue":i[0]||(i[0]=e=>o.filters.search=e),dense:"",outlined:"",placeholder:"Buscar (nombre, asociación, presidente...)",onKeyup:T(s.fetchRows,["enter"])},{append:t(()=>[a(V,{name:"search"})]),_:1},8,["modelValue","onKeyup"])]),n("div",K,[a(m,{modelValue:o.filters.departamento_id,"onUpdate:modelValue":[i[1]||(i[1]=e=>o.filters.departamento_id=e),s.onDepChange],options:s.depOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",dense:"",outlined:"",label:"Departamento",clearable:""},null,8,["modelValue","options","onUpdate:modelValue"])]),n("div",J,[a(m,{modelValue:o.filters.provincia_id,"onUpdate:modelValue":[i[2]||(i[2]=e=>o.filters.provincia_id=e),s.onProvChange],options:s.provOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",dense:"",outlined:"",label:"Provincia",clearable:"",disable:!o.filters.departamento_id},null,8,["modelValue","options","onUpdate:modelValue","disable"])]),n("div",L,[a(m,{modelValue:o.filters.municipio_id,"onUpdate:modelValue":i[3]||(i[3]=e=>o.filters.municipio_id=e),options:s.munOptions,"option-label":"label","option-value":"value",clearable:"","emit-value":"","map-options":"",dense:"",outlined:"",label:"Municipio",disable:!o.filters.provincia_id},null,8,["modelValue","options","disable"])]),n("div",G,[a(m,{modelValue:o.filters.estado,"onUpdate:modelValue":i[4]||(i[4]=e=>o.filters.estado=e),options:["ACTIVO","INACTIVO"],dense:"",outlined:"",label:"Estado",clearable:""},null,8,["modelValue"])]),n("div",W,[a(c,{color:"secondary",icon:"refresh",label:"Actualizar",loading:o.loading,onClick:s.fetchRows,"no-caps":""},null,8,["loading","onClick"]),a(c,{color:"positive",icon:"add_circle",label:"Nueva",loading:o.saving,onClick:s.openNew,"no-caps":""},null,8,["loading","onClick"])])]),_:1})]),_:1}),a(b,{flat:"",bordered:""},{default:t(()=>[a(E,{dense:"","wrap-cells":""},{default:t(()=>[i[24]||(i[24]=n("thead",null,[n("tr",{class:"bg-primary text-white"},[n("th",{style:{width:"140px"}},"Opciones"),n("th",null,"Organización"),n("th",null,"Asociación"),n("th",null,"Presidente"),n("th",null,"Departamento"),n("th",null,"Provincia"),n("th",null,"Municipio"),n("th",{class:"text-right"},"# Apicultores"),n("th",{class:"text-right"},"# Colmenas"),n("th",null,"PJ"),n("th",null,"Convenio"),n("th",null,"Estado"),n("th",null,"Registro")])],-1)),n("tbody",null,[(p(!0),O(A,null,P(o.rows,(e,Q)=>(p(),O("tr",{key:e.id},[n("td",null,[a(D,{dense:"",color:"primary",label:`Opciones (${Q+1})`,"no-caps":"",size:"10px"},{default:t(()=>[a(S,null,{default:t(()=>[f((p(),g(x,{clickable:"",onClick:U=>s.openEdit(e)},{default:t(()=>[a(_,{avatar:""},{default:t(()=>[a(V,{name:"edit"})]),_:1}),a(_,null,{default:t(()=>i[22]||(i[22]=[C("Editar")])),_:1})]),_:2},1032,["onClick"])),[[v]]),f((p(),g(x,{clickable:"",onClick:U=>s.remove(e)},{default:t(()=>[a(_,{avatar:""},{default:t(()=>[a(V,{name:"delete",color:"negative"})]),_:1}),a(_,null,{default:t(()=>i[23]||(i[23]=[C("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[v]])]),_:2},1024)]),_:2},1032,["label"])]),n("td",Z,r(e.nombre_organiza),1),n("td",null,r(e.asociacion),1),n("td",null,r(e.nombre_presidente||"-"),1),n("td",null,r(e.departamento?.nombre_departamento||"-"),1),n("td",null,r(e.provincia?.nombre_provincia||"-"),1),n("td",null,r(e.municipio?.nombre_municipio||"-"),1),n("td",H,r(e.num_apicultor??0),1),n("td",X,r(e.num_colmena??0),1),n("td",null,r(e.pj_actual??0),1),n("td",null,r(e.convenio??0),1),n("td",null,[a(R,{color:e.estado==="ACTIVO"?"green":"red","text-color":"white",size:"xs",class:"text-bold"},{default:t(()=>[C(r(e.estado),1)]),_:2},1032,["color"])]),n("td",null,r(e.fecha_registro),1)]))),128))])]),_:1})]),_:1}),a(q,{modelValue:o.dialog,"onUpdate:modelValue":i[20]||(i[20]=e=>o.dialog=e),persistent:""},{default:t(()=>[a(b,{style:{"min-width":"520px","max-width":"95vw"}},{default:t(()=>[a(h,{class:"row items-center q-gutter-sm"},{default:t(()=>[n("div",Y,r(o.form.id?"Editar Organización":"Nueva Organización"),1),a(z),f(a(c,{flat:"",round:"",dense:"",icon:"close"},null,512),[[v]])]),_:1}),a(N),a(h,null,{default:t(()=>[a(M,{onSubmit:s.submit},{default:t(()=>[n("div",$,[n("div",ee,[a(u,{modelValue:o.form.nombre_organiza,"onUpdate:modelValue":i[5]||(i[5]=e=>o.form.nombre_organiza=e),label:"Nombre de la organización",dense:"",outlined:"",rules:[e=>!!e||"Requerido"]},null,8,["modelValue","rules"])]),n("div",oe,[a(u,{modelValue:o.form.asociacion,"onUpdate:modelValue":i[6]||(i[6]=e=>o.form.asociacion=e),label:"Asociación",dense:"",outlined:"",rules:[e=>!!e||"Requerido"]},null,8,["modelValue","rules"])]),n("div",le,[a(u,{modelValue:o.form.programa,"onUpdate:modelValue":i[7]||(i[7]=e=>o.form.programa=e),label:"Programa",dense:"",outlined:""},null,8,["modelValue"])]),n("div",ie,[a(u,{modelValue:o.form.nombre_presidente,"onUpdate:modelValue":i[8]||(i[8]=e=>o.form.nombre_presidente=e),label:"Nombre Presidente",dense:"",outlined:""},null,8,["modelValue"])]),n("div",ne,[a(u,{modelValue:o.form.celular,"onUpdate:modelValue":i[9]||(i[9]=e=>o.form.celular=e),label:"Celular",dense:"",outlined:""},null,8,["modelValue"])]),n("div",ae,[a(u,{type:"textarea",modelValue:o.form.descripcion,"onUpdate:modelValue":i[10]||(i[10]=e=>o.form.descripcion=e),label:"Descripción",dense:"",outlined:"",autogrow:""},null,8,["modelValue"])]),n("div",te,[a(u,{modelValue:o.form.num_apicultor,"onUpdate:modelValue":i[11]||(i[11]=e=>o.form.num_apicultor=e),modelModifiers:{number:!0},type:"number",label:"# Apicultores",dense:"",outlined:""},null,8,["modelValue"])]),n("div",se,[a(u,{modelValue:o.form.num_colmena,"onUpdate:modelValue":i[12]||(i[12]=e=>o.form.num_colmena=e),modelModifiers:{number:!0},type:"number",label:"# Colmenas",dense:"",outlined:""},null,8,["modelValue"])]),n("div",re,[a(u,{modelValue:o.form.pj_actual,"onUpdate:modelValue":i[13]||(i[13]=e=>o.form.pj_actual=e),modelModifiers:{number:!0},type:"number",label:"PJ actual",dense:"",outlined:""},null,8,["modelValue"])]),n("div",de,[a(u,{modelValue:o.form.convenio,"onUpdate:modelValue":i[14]||(i[14]=e=>o.form.convenio=e),modelModifiers:{number:!0},type:"number",label:"Convenio",dense:"",outlined:""},null,8,["modelValue"])]),n("div",ue,[a(m,{modelValue:o.form.departamento_id,"onUpdate:modelValue":[i[15]||(i[15]=e=>o.form.departamento_id=e),l.onFormDepChange],options:s.depOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",dense:"",outlined:"",label:"Departamento",rules:[e=>!!e||"Requerido"]},null,8,["modelValue","options","rules","onUpdate:modelValue"])]),n("div",me,[a(m,{modelValue:o.form.provincia_id,"onUpdate:modelValue":[i[16]||(i[16]=e=>o.form.provincia_id=e),l.onFormProvChange],options:s.formProvOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",dense:"",outlined:"",label:"Provincia",rules:[e=>!!e||"Requerido"],disable:!o.form.departamento_id},null,8,["modelValue","options","rules","onUpdate:modelValue","disable"])]),n("div",ce,[a(m,{modelValue:o.form.municipio_id,"onUpdate:modelValue":i[17]||(i[17]=e=>o.form.municipio_id=e),options:s.formMunOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",dense:"",outlined:"",label:"Municipio",rules:[e=>!!e||"Requerido"],disable:!o.form.provincia_id},null,8,["modelValue","options","rules","disable"])]),n("div",pe,[a(m,{modelValue:o.form.estado,"onUpdate:modelValue":i[18]||(i[18]=e=>o.form.estado=e),options:["ACTIVO","INACTIVO"],label:"Estado",dense:"",outlined:""},null,8,["modelValue"])]),n("div",fe,[a(u,{modelValue:o.form.fecha_registro,"onUpdate:modelValue":i[19]||(i[19]=e=>o.form.fecha_registro=e),type:"date",label:"Fecha registro",dense:"",outlined:""},null,8,["modelValue"])])]),n("div",_e,[f(a(c,{flat:"",label:"Cancelar",color:"negative",loading:o.saving},null,8,["loading"]),[[v]]),a(c,{label:"Guardar",color:"primary",type:"submit",loading:o.saving,class:"q-ml-sm"},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Ue=I(B,[["render",ve]]);export{Ue as default};
