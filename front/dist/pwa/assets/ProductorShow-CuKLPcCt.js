import{_ as U,c as m,o as n,w as a,b as r,a as e,f as u,a7 as y,a6 as I,a8 as A,a9 as R,t as i,J as _,d as Q,a5 as C,aa as w,h as D,Q as k,e as p,I as S,ad as c,a4 as f}from"./index-Bgl9rRLH.js";import{Q as V}from"./QSpace-CFzHtxxp.js";import{Q as $,a as h,b as L,c as g}from"./QTabPanels-BOUsthVz.js";import{Q as H}from"./QPage-CsQZftZw.js";import{P as J}from"./ProductorForm-BAWhqZFb.js";import{P as K,a as W,b as X}from"./ProductorMapa-GLUs1_T1.js";import{Q as F,b as P,d as O}from"./format-B5GA3g1M.js";import{Q as Y}from"./QList-D3YhuSO6.js";import{Q as Z}from"./QBtnDropdown-BgEj-v7h.js";import{Q as T}from"./QMarkupTable-DFMRGiSY.js";import{Q as G}from"./QSelect-BbHtm0Q4.js";import{Q as z}from"./QForm-DMImXLrz.js";import{C as b}from"./ClosePopup-CEV2ZCU4.js";import"./moment-C5S46NFB.js";import"./QResizeObserver-BnO6uMcE.js";import"./use-panel-CILXlG6U.js";import"./touch-BjYP5sR0.js";import"./selection-Bc9EnJoi.js";import"./QBanner-Uom9nUHz.js";import"./marker-shadow-ym2pMarA.js";import"./QBadge-DgODta8y.js";const oo={name:"ProductorRunsas",props:{productor:{type:Object,required:!0}},emits:["updated"],data(){return{loading:!1,saving:!1,list:[],dlg:{open:!1},form:this.emptyForm()}},mounted(){this.hydrateFromProductor()},watch:{productor(){this.hydrateFromProductor()}},methods:{hydrateFromProductor(){this.productor?.runsas?this.list=this.productor.runsas:this.fetchRunsas()},async fetchRunsas(){console.log(this.productor),this.loading=!0;try{const{data:o}=await this.$axios.get("runsas",{params:{productor_id:this.productor.id,paginate:!1}});console.log(o),this.list=Array.isArray(o)?o:o?.data||[]}catch(o){console.log(o),this.list=[],this.$alert?.error?.(o.response?.data?.message||"No se pudo cargar runsas")}finally{this.loading=!1}},emptyForm(){return{id:null,productor_id:this.productor?.id||null,codigo:null,subcodigo:"",fecha_registro:null,fecha_vencimiento:null,estado:"VIGENTE"}},chip(o){return o==="VIGENTE"?"green":o==="VENCIDO"?"red":o==="SUSPENDIDO"?"orange":"grey"},startCreate(){this.form=this.emptyForm(),this.form.productor_id=this.productor?.id||null,this.dlg.open=!0},startEdit(o){this.form={id:o.id,productor_id:this.productor?.id||o.productor_id,codigo:o.codigo||null,subcodigo:o.subcodigo||"",fecha_registro:o.fecha_registro||null,fecha_vencimiento:o.fecha_vencimiento||null,estado:o.estado||"VIGENTE"},this.dlg.open=!0},async submit(){if(this.productor?.id){this.saving=!0;try{const o={...this.form,productor_id:this.productor.id};o.id?await this.$axios.put(`runsas/${o.id}`,o):await this.$axios.post("runsas",o),this.$alert?.success?.(o.id?"Runsa actualizada":"Runsa creada"),this.dlg.open=!1,this.$emit("updated")}catch(o){this.$alert?.error?.(o.response?.data?.message||"No se pudo guardar")}finally{this.saving=!1}}},remove(o){this.$alert?.dialog?.("¿Eliminar runsa?")?.onOk(async()=>{try{await this.$axios.delete(`runsas/${o.id}`),this.$alert?.success?.("Eliminado"),this.$emit("updated")}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo eliminar")}})}}},eo={class:"row items-center q-gutter-sm q-mb-sm"},to={key:0},ro={class:"text-h6"},so={class:"col-12 col-sm-4"},lo={class:"col-12 col-sm-8"},ao={class:"col-6 col-sm-3"},io={class:"col-6 col-sm-3"},no={class:"col-12 col-sm-3"},uo={class:"col-12 text-right q-gutter-sm q-mt-sm"};function co(o,t,E,q,s,d){return n(),m(p,null,{default:a(()=>[r("div",eo,[t[6]||(t[6]=r("div",{class:"text-subtitle1"},"Certificaciones Runsa",-1)),e(V),e(u,{dense:"",color:"primary",icon:"add_circle",label:"Nueva",onClick:d.startCreate,disable:s.saving,"no-caps":""},null,8,["onClick","disable"])]),e(T,{dense:""},{default:a(()=>[t[10]||(t[10]=r("thead",null,[r("tr",{class:"bg-grey-3"},[r("th",{class:"text-left"},"#"),r("th",{class:"text-left",style:{width:"120px"}},"Opciones"),r("th",{class:"text-left"},"Codigo"),r("th",{class:"text-left"},"Subcodigo"),r("th",{class:"text-left"},"Registro"),r("th",{class:"text-left"},"Vencimiento"),r("th",{class:"text-left"},"Estado")])],-1)),r("tbody",null,[(n(!0),y(A,null,R(s.list||[],(l,x)=>(n(),y("tr",{key:l.id||x},[r("td",null,i(x+1),1),r("td",null,[e(Z,{dense:"",label:"Opciones",color:"primary","no-caps":"",size:"10px"},{default:a(()=>[e(Y,null,{default:a(()=>[_((n(),m(F,{clickable:"",onClick:N=>d.startEdit(l)},{default:a(()=>[e(P,{avatar:""},{default:a(()=>[e(Q,{name:"edit"})]),_:1}),e(P,null,{default:a(()=>t[7]||(t[7]=[C("Editar")])),_:1})]),_:2},1032,["onClick"])),[[w],[b]]),_((n(),m(F,{clickable:"",onClick:N=>d.remove(l)},{default:a(()=>[e(P,{avatar:""},{default:a(()=>[e(Q,{name:"delete",class:"text-negative"})]),_:1}),e(P,{class:"text-negative"},{default:a(()=>t[8]||(t[8]=[C("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[w],[b]])]),_:2},1024)]),_:2},1024)]),r("td",null,i(l.codigo||"-"),1),r("td",null,i(l.subcodigo||"-"),1),r("td",null,i(l.fecha_registro||"-"),1),r("td",null,i(l.fecha_vencimiento||"-"),1),r("td",null,[e(O,{color:d.chip(l.estado),"text-color":"white",size:"xs",class:"text-bold"},{default:a(()=>[C(i(l.estado),1)]),_:2},1032,["color"])])]))),128)),!s.loading&&(E.productor?.runsas?.length||0)===0?(n(),y("tr",to,t[9]||(t[9]=[r("td",{colspan:"8",class:"text-center text-grey"},"Sin registros",-1)]))):I("",!0)])]),_:1}),e(D,{modelValue:s.dlg.open,"onUpdate:modelValue":t[5]||(t[5]=l=>s.dlg.open=l),persistent:""},{default:a(()=>[e(k,{style:{"min-width":"720px","max-width":"95vw"}},{default:a(()=>[e(p,{class:"row items-center q-gutter-sm"},{default:a(()=>[r("div",ro,i(s.form.id?"Editar runsa":"Nueva runsa"),1),e(V),_(e(u,{flat:"",round:"",dense:"",icon:"close"},null,512),[[b]])]),_:1}),e(S),e(p,null,{default:a(()=>[e(z,{onSubmit:d.submit,class:"row q-col-gutter-sm"},{default:a(()=>[r("div",so,[e(c,{modelValue:s.form.codigo,"onUpdate:modelValue":t[0]||(t[0]=l=>s.form.codigo=l),dense:"",outlined:"",label:"Codigo",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"])]),r("div",lo,[e(c,{modelValue:s.form.subcodigo,"onUpdate:modelValue":t[1]||(t[1]=l=>s.form.subcodigo=l),dense:"",outlined:"",label:"Subcodigo"},null,8,["modelValue"])]),r("div",ao,[e(c,{modelValue:s.form.fecha_registro,"onUpdate:modelValue":t[2]||(t[2]=l=>s.form.fecha_registro=l),type:"date",dense:"",outlined:"",label:"Fec Registro"},null,8,["modelValue"])]),r("div",io,[e(c,{modelValue:s.form.fecha_vencimiento,"onUpdate:modelValue":t[3]||(t[3]=l=>s.form.fecha_vencimiento=l),type:"date",dense:"",outlined:"",label:"Fec Vencimiento"},null,8,["modelValue"])]),r("div",no,[e(G,{modelValue:s.form.estado,"onUpdate:modelValue":t[4]||(t[4]=l=>s.form.estado=l),options:["VIGENTE","VENCIDO","SUSPENDIDO"],dense:"",outlined:"",label:"Estado"},null,8,["modelValue"])]),r("div",uo,[_(e(u,{flat:"",color:"grey",label:"Cancelar",disable:s.saving},null,8,["disable"]),[[b]]),e(u,{color:"primary",label:s.form.id?"Guardar cambios":"Crear",type:"submit",loading:s.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const mo=U(oo,[["render",co]]),po={name:"ProductorAcopios",props:{productor:{type:Object,required:!0}},emits:["updated"],data(){return{loading:!1,saving:!1,list:[],dlg:{open:!1},form:this.emptyForm(),acopioCosechas:[]}},mounted(){this.hydrateFromProductor()},watch:{productor(){this.hydrateFromProductor()}},methods:{async fetchAcopio(){this.loading=!0,console.log(this.productor),await this.$axios.post("/productorAcopios",{productor_id:this.productor.id}).then(o=>{console.log(o),this.acopioCosechas=o.data}).catch(o=>{console.log(o),this.$alert?.error?.(o.response?.data?.message||"No se pudo cargar las cosechas")}).finally(()=>{this.loading=!1})},hydrateFromProductor(){this.fetchAcopio()},async fetchRunsas(){console.log(this.productor),this.loading=!0;try{const{data:o}=await this.$axios.get("runsas",{params:{productor_id:this.productor.id,paginate:!1}});console.log(o),this.list=Array.isArray(o)?o:o?.data||[]}catch(o){console.log(o),this.list=[],this.$alert?.error?.(o.response?.data?.message||"No se pudo cargar runsas")}finally{this.loading=!1}},emptyForm(){return{id:null,productor_id:this.productor?.id||null,codigo:null,subcodigo:"",fecha_registro:null,fecha_vencimiento:null,estado:"VIGENTE"}},chip(o){return o==="VIGENTE"?"green":o==="VENCIDO"?"red":o==="SUSPENDIDO"?"orange":"grey"},startCreate(){this.form=this.emptyForm(),this.form.productor_id=this.productor?.id||null,this.dlg.open=!0},startEdit(o){this.form={id:o.id,productor_id:this.productor?.id||o.productor_id,codigo:o.codigo||null,subcodigo:o.subcodigo||"",fecha_registro:o.fecha_registro||null,fecha_vencimiento:o.fecha_vencimiento||null,estado:o.estado||"VIGENTE"},this.dlg.open=!0},async submit(){if(this.productor?.id){this.saving=!0;try{const o={...this.form,productor_id:this.productor.id};o.id?await this.$axios.put(`runsas/${o.id}`,o):await this.$axios.post("runsas",o),this.$alert?.success?.(o.id?"Runsa actualizada":"Runsa creada"),this.dlg.open=!1,this.$emit("updated")}catch(o){this.$alert?.error?.(o.response?.data?.message||"No se pudo guardar")}finally{this.saving=!1}}},remove(o){this.$alert?.dialog?.("¿Eliminar runsa?")?.onOk(async()=>{try{await this.$axios.delete(`runsas/${o.id}`),this.$alert?.success?.("Eliminado"),this.$emit("updated")}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo eliminar")}})}}},fo={class:"row items-center q-gutter-sm q-mb-sm"},ho={key:1,class:"text-center q-pa-md"},go={class:"text-h6"},_o={class:"col-12 col-sm-4"},bo={class:"col-12 col-sm-8"},yo={class:"col-6 col-sm-3"},vo={class:"col-6 col-sm-3"},Vo={class:"col-12 col-sm-3"},xo={class:"col-12 text-right q-gutter-sm q-mt-sm"};function Po(o,t,E,q,s,d){return n(),m(p,null,{default:a(()=>[r("div",fo,[t[6]||(t[6]=r("div",{class:"text-subtitle1"},"Acopios Proveedor",-1)),e(V)]),s.acopioCosechas.length>0?(n(),m(T,{key:0,dense:"","wrap-cells":"",flat:"",bordered:""},{default:a(()=>[t[7]||(t[7]=r("thead",null,[r("tr",{class:"bg-primary text-white"},[r("th",null,"Fecha Cosecha"),r("th",null,"Productor"),r("th",null,"Cantidad (kg)"),r("th",null,"Humedad (%)"),r("th",null,"Temperatura Almacenaje (°C)"),r("th",null,"Número Acta"),r("th",null,"Condiciones Almacenaje"),r("th",null,"Estado")])],-1)),r("tbody",null,[(n(!0),y(A,null,R(s.acopioCosechas,l=>(n(),y("tr",{key:l.id},[r("td",null,i(l.fecha_cosecha),1),r("td",null,i(l.apiario?.productor.nombre)+" "+i(l.apiario?.productor.apellidos),1),r("td",null,i(l.cantidad_kg),1),r("td",null,i(l.humedad),1),r("td",null,i(l.temperatura_almacenaje),1),r("td",null,i(l.num_acta),1),r("td",null,i(l.condiciones_almacenaje),1),r("td",null,[e(O,{color:l.estado==="BUENO"?"green":"red","text-color":"white",dense:"",size:"10px"},{default:a(()=>[C(i(l.estado.replace("_"," ")),1)]),_:2},1032,["color"])])]))),128))])]),_:1})):(n(),y("div",ho,[e(Q,{name:"info",size:"48px",color:"grey-5"}),t[8]||(t[8]=r("div",{class:"text-subtitle2 text-grey-5"},"No se encontraron cosechas.",-1))])),e(D,{modelValue:s.dlg.open,"onUpdate:modelValue":t[5]||(t[5]=l=>s.dlg.open=l),persistent:""},{default:a(()=>[e(k,{style:{"min-width":"720px","max-width":"95vw"}},{default:a(()=>[e(p,{class:"row items-center q-gutter-sm"},{default:a(()=>[r("div",go,i(s.form.id?"Editar runsa":"Nueva runsa"),1),e(V),_(e(u,{flat:"",round:"",dense:"",icon:"close"},null,512),[[b]])]),_:1}),e(S),e(p,null,{default:a(()=>[e(z,{onSubmit:d.submit,class:"row q-col-gutter-sm"},{default:a(()=>[r("div",_o,[e(c,{modelValue:s.form.codigo,"onUpdate:modelValue":t[0]||(t[0]=l=>s.form.codigo=l),dense:"",outlined:"",label:"Codigo",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"])]),r("div",bo,[e(c,{modelValue:s.form.subcodigo,"onUpdate:modelValue":t[1]||(t[1]=l=>s.form.subcodigo=l),dense:"",outlined:"",label:"Subcodigo"},null,8,["modelValue"])]),r("div",yo,[e(c,{modelValue:s.form.fecha_registro,"onUpdate:modelValue":t[2]||(t[2]=l=>s.form.fecha_registro=l),type:"date",dense:"",outlined:"",label:"Fec Registro"},null,8,["modelValue"])]),r("div",vo,[e(c,{modelValue:s.form.fecha_vencimiento,"onUpdate:modelValue":t[3]||(t[3]=l=>s.form.fecha_vencimiento=l),type:"date",dense:"",outlined:"",label:"Fec Vencimiento"},null,8,["modelValue"])]),r("div",Vo,[e(G,{modelValue:s.form.estado,"onUpdate:modelValue":t[4]||(t[4]=l=>s.form.estado=l),options:["VIGENTE","VENCIDO","SUSPENDIDO"],dense:"",outlined:"",label:"Estado"},null,8,["modelValue"])]),r("div",xo,[_(e(u,{flat:"",color:"grey",label:"Cancelar",disable:s.saving},null,8,["disable"]),[[b]]),e(u,{color:"primary",label:s.form.id?"Guardar cambios":"Crear",type:"submit",loading:s.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Co=U(po,[["render",Po]]),Eo={name:"ProductorShow",components:{ProductorMapa:X,ProductorApiarios:W,ProductorCertificaciones:K,ProductorForm:J,ProductorRunsa:mo,ProductorAcopios:Co},data(){return{tab:"general",loading:!1,productor:null}},mounted(){this.fetchProductor()},methods:{async fetchProductor(){this.loading=!0;try{const o=this.$route.params.id,{data:t}=await this.$axios.get(`productores/${o}`);this.productor=t}catch(o){this.productor=null,this.$alert?.error?.(o.response?.data?.message||"No se pudo cargar el productor")}finally{this.loading=!1}},onSaved(o){this.productor=o,this.$alert?.success?.("Cambios guardados")}}},No={class:"row items-center q-gutter-sm q-mb-md"};function Qo(o,t,E,q,s,d){const l=f("ProductorForm"),x=f("ProductorCertificaciones"),N=f("ProductorRunsa"),B=f("ProductorApiarios"),j=f("ProductorMapa"),M=f("ProductorAcopios");return n(),m(H,{class:"q-pa-md"},{default:a(()=>[r("div",No,[e(u,{flat:"",round:"",icon:"arrow_back",onClick:t[0]||(t[0]=v=>o.$router.push("/productores"))}),t[4]||(t[4]=r("div",{class:"text-h6"},"Editar Productor",-1)),e(V),e(u,{flat:"",round:"",icon:"refresh",loading:s.loading,onClick:d.fetchProductor},null,8,["loading","onClick"])]),e(k,{flat:"",bordered:""},{default:a(()=>[e($,{modelValue:s.tab,"onUpdate:modelValue":t[1]||(t[1]=v=>s.tab=v),class:"text-primary",align:"left",dense:""},{default:a(()=>[e(h,{name:"general",icon:"badge",label:"1) Información general","no-caps":""}),e(h,{name:"runsa",icon:"assured_workload",label:"2) Runsa","no-caps":""}),e(h,{name:"certs",icon:"verified",label:"3) Certificaciones","no-caps":""}),e(h,{name:"apiarios",icon:"hive",label:"4) Apiarios","no-caps":""}),e(h,{name:"mapa",icon:"map",label:"5) Mapa","no-caps":""}),e(h,{name:"acopio",icon:"send",label:"6) Acopio","no-caps":""})]),_:1},8,["modelValue"]),e(S),e(L,{modelValue:s.tab,"onUpdate:modelValue":t[3]||(t[3]=v=>s.tab=v),animated:""},{default:a(()=>[e(g,{name:"general",class:"q-pa-none"},{default:a(()=>[!s.loading&&s.productor?(n(),m(p,{key:0},{default:a(()=>[e(l,{productor:s.productor,"banner-msg":"Actualiza los datos y guarda los cambios",onSaved:d.onSaved,onCancel:t[2]||(t[2]=v=>o.$router.back())},null,8,["productor","onSaved"])]),_:1})):I("",!0)]),_:1}),e(g,{name:"certs",class:"q-pa-none"},{default:a(()=>[e(x,{productor:s.productor,onUpdated:d.fetchProductor},null,8,["productor","onUpdated"])]),_:1}),e(g,{name:"runsa",class:"q-pa-none"},{default:a(()=>[e(N,{productor:s.productor,onUpdated:d.fetchProductor},null,8,["productor","onUpdated"])]),_:1}),e(g,{name:"apiarios",class:"q-pa-none"},{default:a(()=>[e(B,{productor:s.productor,onUpdated:d.fetchProductor},null,8,["productor","onUpdated"])]),_:1}),e(g,{name:"mapa",class:"q-pa-none"},{default:a(()=>[e(j,{productor:s.productor,onUpdated:d.fetchProductor},null,8,["productor","onUpdated"])]),_:1}),e(g,{name:"acopio",class:"q-pa-none"},{default:a(()=>[e(M,{productor:s.productor,onUpdated:d.fetchProductor},null,8,["productor","onUpdated"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const Ko=U(Eo,[["render",Qo]]);export{Ko as default};
