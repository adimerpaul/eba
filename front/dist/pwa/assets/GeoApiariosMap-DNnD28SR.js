import{g as q,bC as S,x as h,r as p,l as U,p as A,c as z,o as x,w as c,b as s,a,f as C,t as l,ag as G,d as R,Q as V,e as B,u as i,a9 as F,aa as O,ab as $,O as D,q as P}from"./index-CAulUK1l.js";import{Q as E}from"./QSpace-D2oGt-bw.js";import{Q as T}from"./QPage-CV8wXvdH.js";import{u as j}from"./use-quasar-CFFg_A6P.js";import{L as H,m as J,a as K,b as W,i as X,R as Y,v as d,u as Z,y as ee}from"./marker-shadow-_xxBO8fP.js";const ae={class:"row items-center q-gutter-sm q-mb-sm"},te={class:"text-h6 text-weight-bold"},oe={class:"text-caption q-mb-xs"},se={style:{"min-width":"220px"}},re={class:"text-subtitle2"},le={class:"text-caption"},ie={class:"text-caption"},ne={class:"text-caption"},ue={class:"text-caption"},ce={class:"text-caption"},be={__name:"GeoApiariosMap",setup(pe){const{proxy:k}=q();H.Icon.Default.mergeOptions({iconRetinaUrl:W,iconUrl:K,shadowUrl:J});const m=S(),Q=j(),N=k.$axios,g=h(()=>Number(m.query?.departamento_id||0)),L=h(()=>m.query?.nombre||""),f=p(7),_=p(null),w=p([-16.290154,-63.588653]),v=p(!1),n=p([]),b=p({search:""}),I=h(()=>{const t=(b.value.search||"").trim().toLowerCase();return t?n.value.filter(o=>(o.productor||"").toLowerCase().includes(t)||(o.municipio||"").toLowerCase().includes(t)||(o.lugar||"").toLowerCase().includes(t)||(o.cip||"").toLowerCase().includes(t)):n.value});function M(t,o){const e=Number(t),u=Number(o);return Number.isFinite(e)&&Number.isFinite(u)&&e>=-90&&e<=90&&u>=-180&&u<=180}async function y(){if(g.value){v.value=!0;try{const{data:t}=await N.get(`geo/departamentos/${g.value}/apiarios`),e=(Array.isArray(t?.apiarios)?t.apiarios:[]).map(r=>({...r,lat:Number(r.lat),lng:Number(r.lng)})).filter(r=>M(r.lat,r.lng));n.value=e,await P();const u=_.value?.leafletObject;if(!u)return;if(n.value.length===0){u.setView(w.value,6);return}if(n.value.length===1){const r=n.value[0];u.setView([r.lat,r.lng],Math.max(f.value,12));return}}catch(t){Q.notify({type:"negative",message:t?.response?.data?.message||"No se pudieron cargar apiarios"})}finally{v.value=!1}}}return U(y),A(()=>m.fullPath,y),(t,o)=>(x(),z(T,{class:"q-pa-md"},{default:c(()=>[s("div",ae,[a(C,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:o[0]||(o[0]=e=>t.$router.back())}),s("div",te," Apiarios — "+l(L.value||"Departamento "+(g.value||"—")),1),a(E),a(G,{modelValue:b.value.search,"onUpdate:modelValue":o[1]||(o[1]=e=>b.value.search=e),dense:"",outlined:"",placeholder:"Buscar productor/municipio...",debounce:"300",style:{"min-width":"260px"}},{append:c(()=>[a(R,{name:"search"})]),_:1},8,["modelValue"]),a(C,{color:"primary",icon:"refresh",label:"Actualizar",loading:v.value,"no-caps":"",onClick:y},null,8,["loading"])]),a(V,{flat:"",bordered:""},{default:c(()=>[a(B,null,{default:c(()=>[s("div",oe,"Total apiarios: "+l(n.value.length),1),a(i(X),{style:{height:"70vh"},zoom:f.value,"onUpdate:zoom":o[2]||(o[2]=e=>f.value=e),center:w.value,"use-global-leaflet":!1,options:{attributionControl:!1},ref_key:"mapRef",ref:_},{default:c(()=>[a(i(Y),{position:"topright"}),a(i(d),{"layer-type":"base",name:"OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"© OpenStreetMap contributors",subdomains:["a","b","c"],"max-zoom":19,visible:!1}),a(i(d),{"layer-type":"base",name:"Google Calle",url:"https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}",attribution:"Map data © Google","max-zoom":21,visible:!0}),a(i(d),{"layer-type":"base",name:"Google Satélite",url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",attribution:"Map data © Google","max-zoom":21,visible:!1}),a(i(d),{"layer-type":"base",name:"Google Híbrido",url:"https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}",attribution:"Map data © Google","max-zoom":21,visible:!1}),(x(!0),F(O,null,$(I.value,e=>(x(),z(i(Z),{key:e.id,"lat-lng":[e.lat,e.lng]},{default:c(()=>[a(i(ee),null,{default:c(()=>[s("div",se,[s("div",re,l(e.productor||"—"),1),s("div",le,"Municipio: "+l(e.municipio||"—"),1),s("div",ie,"Lugar: "+l(e.lugar||"—"),1),s("div",ne,"CIP: "+l(e.cip||"—"),1),s("div",ue,"Estado: "+l(e.estado||"—"),1),a(D,{spaced:""}),s("div",ce,"Lat: "+l(e.lat.toFixed(6))+" | Lng: "+l(e.lng.toFixed(6)),1)])]),_:2},1024)]),_:2},1032,["lat-lng"]))),128))]),_:1},8,["zoom","center"])]),_:1})]),_:1})]),_:1}))}};export{be as default};
