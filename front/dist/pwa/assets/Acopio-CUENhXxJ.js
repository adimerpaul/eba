import{_ as O,c,o as r,w as s,a as l,Q as _,e as y,b as e,I as E,a7 as p,ax as w,ad as m,a5 as h,f as C,a8 as A,a9 as N,J as k,d as v,aa as S,t as d}from"./index-DwGd6QCz.js";import{Q as f}from"./QSelect-Dxcf0lkG.js";import{Q,b,d as F}from"./format-BMyIwhlL.js";import{Q as I}from"./QForm-Cdukscts.js";import{Q as P}from"./QList-AYjqzq07.js";import{Q as x}from"./QBtnDropdown-CZbwMzLF.js";import{Q as U}from"./QMarkupTable-CRpWpHYl.js";import{Q as $}from"./QPage-r_YHzd59.js";import{h as V}from"./moment-C5S46NFB.js";import"./selection-Cxz9NKQ0.js";const B={name:"AcopioPage",data:function(){return{numActa:null,acopioCosechas:[],loadingProductores:!1,productor:null,productorOptions:[],productos:[],producto:null,loading:!1,fechaInicio:V().startOf("month").format("YYYY-MM-DD"),fechaFin:V().endOf("month").format("YYYY-MM-DD"),estados:[{label:"BUENO",value:"BUENO"},{label:"EN PROCESO",value:"EN_PROCESO"},{label:"CANCELADO",value:"CANCELADO"}],estadoSeleccionado:null}},mounted(){this.buscarCosechas(),this.productoGet()},methods:{filterProductores(o,t,u){if(!o||o.length<2){t(()=>{this.productorOptions=[]});return}t(async()=>{this.loadingProductores=!0;try{const{data:n}=await this.$axios.get("/productores",{params:{search:o,per_page:20}}),g=(n?.data||n||[]).map(i=>({value:i.id,label:`${i.nombre??""} ${i.apellidos??""} — ${i.municipio?.nombre_municipio??""}`.trim(),raw:i}));this.productorOptions=g}catch{this.$q.notify({type:"negative",message:"No se pudo cargar productores"})}finally{this.loadingProductores=!1}})},async productoGet(){this.$axios.get("/productos/tipo/1").then(({data:o})=>{console.log(o),this.productos=o?.data||o||[],this.productos.unshift({id:null,nombre_producto:"Todos"}),this.producto=null}).catch(()=>{this.$q.notify({type:"negative",message:"No se pudieron cargar los productos"})})},async generarExcel(){this.loading=!0,await this.$axios.post("acopioExcel",{fecha_inicio:this.fechaInicio,fecha_fin:this.fechaFin,estado:this.estadoSeleccionado},{responseType:"blob"}).then(o=>{const t=new Blob([o.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),u=window.URL.createObjectURL(t),n=document.createElement("a");n.href=u,n.setAttribute("download","acopio.xlsx"),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(u)}).catch(o=>{this.$alert?.error?.(o.response?.data?.message||"No se pudo generar el reporte.")}).finally(()=>{this.loading=!1})},buscarCosechas(){this.loading=!0,console.log(this.producto),this.$axios.get("/acopio/cosechas",{params:{fecha_inicio:this.fechaInicio,fecha_fin:this.fechaFin,estado:this.estadoSeleccionado,productor_id:this.productor,num_acta:this.numActa,producto_id:this.producto}}).then(o=>{console.log(o.data),this.acopioCosechas=o.data}).finally(()=>{this.loading=!1})}}},D={class:"row q-gutter-sm"},L={class:"col-12 col-md-2"},R={class:"col-12 col-md-2"},Y={class:"col-12 col-md-3"},j={class:"col-12 col-md-3"},M={class:"col-6 col-md-3"},q={class:"col-12 col-md-3"},T={class:"col-12 col-md-2 flex flex-center"},z={class:"col-12 col-md-2 flex flex-center"},G={key:1,class:"text-center q-pa-md"};function H(o,t,u,n,g,i){return r(),c($,{class:"q-pa-xs"},{default:s(()=>[l(_,null,{default:s(()=>[l(y,null,{default:s(()=>t[6]||(t[6]=[e("div",{class:"text-h6"},"Acopio de Cosechas",-1)])),_:1}),l(E),l(y,null,{default:s(()=>[l(I,{onSubmit:w(i.buscarCosechas,["prevent"])},{default:s(()=>[e("div",D,[e("div",L,[l(m,{modelValue:o.fechaInicio,"onUpdate:modelValue":t[0]||(t[0]=a=>o.fechaInicio=a),label:"Fecha Inicio",type:"date",dense:"",outlined:""},null,8,["modelValue"])]),e("div",R,[l(m,{modelValue:o.fechaFin,"onUpdate:modelValue":t[1]||(t[1]=a=>o.fechaFin=a),label:"Fecha Fin",type:"date",dense:"",outlined:""},null,8,["modelValue"])]),e("div",Y,[l(f,{modelValue:o.estadoSeleccionado,"onUpdate:modelValue":t[2]||(t[2]=a=>o.estadoSeleccionado=a),options:o.estados,label:"Estado de Cosecha",dense:"",outlined:"",clearable:""},null,8,["modelValue","options"])]),e("div",j,[l(f,{modelValue:o.productor,"onUpdate:modelValue":t[3]||(t[3]=a=>o.productor=a),options:o.productorOptions,"option-label":"label","emit-value":"","map-options":"","use-input":"","input-debounce":"400",onFilter:i.filterProductores,label:"Productor",dense:"",outlined:"",loading:o.loadingProductores,clearable:""},{"no-option":s(()=>[l(Q,null,{default:s(()=>[l(b,{class:"text-grey"},{default:s(()=>t[7]||(t[7]=[h("Escriba al menos 2 caracteres…")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","loading"])]),e("div",M,[l(f,{modelValue:o.producto,"onUpdate:modelValue":t[4]||(t[4]=a=>o.producto=a),options:o.productos.map(a=>({label:a.nombre_producto,value:a.id})),label:"Producto",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),e("div",q,[l(m,{modelValue:o.numActa,"onUpdate:modelValue":t[5]||(t[5]=a=>o.numActa=a),label:"Número de Acta",type:"text",dense:"",outlined:""},null,8,["modelValue"])]),e("div",T,[l(C,{loading:o.loading,label:"Buscar Cosechas",type:"submit",color:"primary","no-caps":"",icon:"search"},null,8,["loading"])]),e("div",z,[l(C,{loading:o.loading,label:"EXCEL",color:"green",onClick:i.generarExcel},null,8,["loading","onClick"])])])]),_:1},8,["onSubmit"]),o.acopioCosechas.length>0?(r(),c(U,{key:0,dense:"","wrap-cells":"",flat:"",bordered:""},{default:s(()=>[t[9]||(t[9]=e("thead",null,[e("tr",{class:"bg-primary text-white"},[e("th",null,"Opciones"),e("th",null,"Fecha Cosecha"),e("th",null,"Productor"),e("th",null,"Cantidad (kg)"),e("th",null,"Humedad (%)"),e("th",null,"Temperatura Almacenaje (°C)"),e("th",null,"Número Acta"),e("th",null,"Condiciones Almacenaje"),e("th",null,"Estado")])],-1)),e("tbody",null,[(r(!0),p(A,null,N(o.acopioCosechas,a=>(r(),p("tr",{key:a.id},[e("td",null,[l(x,{dense:"",label:"Opciones",color:"primary","no-caps":"",size:"10px"},{default:s(()=>[l(P,null,{default:s(()=>[k((r(),c(Q,{clickable:"",to:`/acopio/cosechas/${a.id}`},{default:s(()=>[l(b,{avatar:""},{default:s(()=>[l(v,{name:"visibility"})]),_:1}),l(b,null,{default:s(()=>t[8]||(t[8]=[h("Ver Detalles")])),_:1})]),_:2},1032,["to"])),[[S]])]),_:2},1024)]),_:2},1024)]),e("td",null,d(a.fecha_cosecha),1),e("td",null,d(a.apiario?.productor.nombre)+" "+d(a.apiario?.productor.apellidos),1),e("td",null,d(a.cantidad_kg),1),e("td",null,d(a.humedad),1),e("td",null,d(a.temperatura_almacenaje),1),e("td",null,d(a.num_acta),1),e("td",null,d(a.condiciones_almacenaje),1),e("td",null,[l(F,{color:a.estado==="SIN OBSERVACION"?"green":"red","text-color":"white",dense:"",size:"10px"},{default:s(()=>[h(d(a.estado.replace("_"," ")),1)]),_:2},1032,["color"])])]))),128))])]),_:1})):(r(),p("div",G,[l(v,{name:"info",size:"48px",color:"grey-5"}),t[10]||(t[10]=e("div",{class:"text-subtitle2 text-grey-5"},"No se encontraron cosechas.",-1))]))]),_:1})]),_:1})]),_:1})}const so=O(B,[["render",H]]);export{so as default};
