import{Q as P}from"./QSpace-x_ge6OO3.js";import{_ as I,c as p,o as r,w as s,b as o,a as l,f,aa as _,a9 as E,ab as L,ac as q,t as u,P as g,d as x,a8 as b,ad as N,h as M,Q as U,e as v,O as A,af as m,a7 as z,ah as B}from"./index-CMVOR4SE.js";import{Q as k,b as h,d as G}from"./format-CqfXnzVw.js";import{Q as R}from"./QList-Tklm7_V7.js";import{Q as F}from"./QBtnDropdown-DqoD0HF_.js";import{Q as T}from"./QMarkupTable-zQ7J1Gxx.js";import{Q as S}from"./QSelect-sN1YFDea.js";import{Q as j}from"./QForm-DODPaqO2.js";import{C as y}from"./ClosePopup-CPDLJUsB.js";import{R as Z,y as $,u as H,v as J,i as K,L as D,m as W,a as X,b as Y}from"./marker-shadow-BdT-LY5B.js";import{Q as ee}from"./QBadge-DAGMZO28.js";const le={name:"ProductorCertificaciones",props:{productor:{type:Object,required:!0}},emits:["updated"],data(){return{loading:!1,saving:!1,dlg:{open:!1},form:this.emptyForm(),tipoOptions:["ORGANICO","COMERCIO_JUSTO","DENOMINACION_ORIGEN","BUENAS_PRACTICAS"]}},methods:{emptyForm(){return{id:null,productor_id:this.productor?.id||null,tipo_certificacion:null,organismo_certificador:"",fecha_emision:null,fecha_vencimiento:null,certificado_url:"",estado:"VIGENTE"}},chip(i){return i==="VIGENTE"?"green":i==="VENCIDO"?"red":i==="SUSPENDIDO"?"orange":"grey"},shortUrl(i){try{return i&&i.length>40?i.slice(0,40)+"…":i||"-"}catch{return i||"-"}},startCreate(){this.form=this.emptyForm(),this.form.productor_id=this.productor?.id||null,this.dlg.open=!0},startEdit(i){this.form={id:i.id,productor_id:this.productor?.id||i.productor_id,tipo_certificacion:i.tipo_certificacion||null,organismo_certificador:i.organismo_certificador||"",fecha_emision:i.fecha_emision||null,fecha_vencimiento:i.fecha_vencimiento||null,certificado_url:i.certificado_url||"",estado:i.estado||"VIGENTE"},this.dlg.open=!0},async submit(){if(this.productor?.id){this.saving=!0;try{const i={...this.form,productor_id:this.productor.id};i.id?await this.$axios.put(`certificaciones/${i.id}`,i):await this.$axios.post("certificaciones",i),this.$alert?.success?.(i.id?"Certificación actualizada":"Certificación creada"),this.dlg.open=!1,this.$emit("updated")}catch(i){this.$alert?.error?.(i.response?.data?.message||"No se pudo guardar")}finally{this.saving=!1}}},remove(i){this.$alert?.dialog?.("¿Eliminar certificación?")?.onOk(async()=>{try{await this.$axios.delete(`certificaciones/${i.id}`),this.$alert?.success?.("Eliminado"),this.$emit("updated")}catch(e){this.$alert?.error?.(e.response?.data?.message||"No se pudo eliminar")}})},async printPdf(i){this.$axios.get(`certificaciones/${i.id}/print`,{responseType:"blob"}).then(e=>{let c=`certificacion_${i.id}.pdf`;const V=e.headers["content-disposition"];if(V){const a=V.match(/filename="?([^"]+)"?/i);a&&a[1]&&(c=a[1])}const t=new Blob([e.data],{type:"application/pdf"}),d=document.createElement("a");d.href=URL.createObjectURL(t),d.download=c,document.body.appendChild(d),d.click(),URL.revokeObjectURL(d.href),document.body.removeChild(d)}).catch(e=>{this.$alert?.error?.(e.response?.data?.message||"No se pudo generar el PDF")})}}},oe={class:"row items-center q-gutter-sm q-mb-sm"},te=["href"],ie={key:1},ae={key:0},se={class:"text-h6"},ne={class:"col-12 col-sm-4"},re={class:"col-12 col-sm-8"},de={class:"col-6 col-sm-3"},ue={class:"col-6 col-sm-3"},me={class:"col-12 col-sm-3"},ce={class:"col-12"},pe={class:"col-12 text-right q-gutter-sm q-mt-sm"};function fe(i,e,c,V,t,d){return r(),p(v,null,{default:s(()=>[o("div",oe,[e[7]||(e[7]=o("div",{class:"text-subtitle1"},"Certificaciones",-1)),l(P),l(f,{dense:"",color:"primary",icon:"add_circle",label:"Nueva",onClick:d.startCreate,disable:t.saving,"no-caps":""},null,8,["onClick","disable"])]),l(T,{dense:""},{default:s(()=>[e[12]||(e[12]=o("thead",null,[o("tr",{class:"bg-grey-3"},[o("th",{class:"text-left"},"#"),o("th",{class:"text-left",style:{width:"120px"}},"Opciones"),o("th",{class:"text-left"},"Tipo"),o("th",{class:"text-left"},"Organismo"),o("th",{class:"text-left"},"Emisión"),o("th",{class:"text-left"},"Vencimiento"),o("th",{class:"text-left"},"Estado"),o("th",{class:"text-left"},"URL")])],-1)),o("tbody",null,[(r(!0),_(L,null,q(c.productor?.certificaciones||[],(a,n)=>(r(),_("tr",{key:a.id||n},[o("td",null,u(n+1),1),o("td",null,[l(F,{dense:"",label:"Opciones",color:"primary","no-caps":"",size:"10px"},{default:s(()=>[l(R,null,{default:s(()=>[g((r(),p(k,{clickable:"",onClick:w=>d.startEdit(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"edit"})]),_:1}),l(h,null,{default:s(()=>e[8]||(e[8]=[b("Editar")])),_:1})]),_:2},1032,["onClick"])),[[N],[y]]),g((r(),p(k,{clickable:"",onClick:w=>d.remove(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"delete",class:"text-negative"})]),_:1}),l(h,{class:"text-negative"},{default:s(()=>e[9]||(e[9]=[b("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[N],[y]]),g((r(),p(k,{clickable:"",onClick:w=>d.printPdf(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"picture_as_pdf"})]),_:1}),l(h,null,{default:s(()=>e[10]||(e[10]=[b("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[N],[y]])]),_:2},1024)]),_:2},1024)]),o("td",null,u(a.tipo_certificacion||"-"),1),o("td",null,u(a.organismo_certificador||"-"),1),o("td",null,u(a.fecha_emision||"-"),1),o("td",null,u(a.fecha_vencimiento||"-"),1),o("td",null,[l(G,{color:d.chip(a.estado),"text-color":"white",size:"xs",class:"text-bold"},{default:s(()=>[b(u(a.estado),1)]),_:2},1032,["color"])]),o("td",null,[a.certificado_url?(r(),_("a",{key:0,href:a.certificado_url,target:"_blank"},u(d.shortUrl(a.certificado_url)),9,te)):(r(),_("span",ie,"-"))])]))),128)),!t.loading&&(c.productor?.certificaciones?.length||0)===0?(r(),_("tr",ae,e[11]||(e[11]=[o("td",{colspan:"8",class:"text-center text-grey"},"Sin registros",-1)]))):E("",!0)])]),_:1}),l(M,{modelValue:t.dlg.open,"onUpdate:modelValue":e[6]||(e[6]=a=>t.dlg.open=a),persistent:""},{default:s(()=>[l(U,{style:{"min-width":"720px","max-width":"95vw"}},{default:s(()=>[l(v,{class:"row items-center q-gutter-sm"},{default:s(()=>[o("div",se,u(t.form.id?"Editar certificación":"Nueva certificación"),1),l(P),g(l(f,{flat:"",round:"",dense:"",icon:"close"},null,512),[[y]])]),_:1}),l(A),l(v,null,{default:s(()=>[l(j,{onSubmit:d.submit,class:"row q-col-gutter-sm"},{default:s(()=>[o("div",ne,[l(S,{modelValue:t.form.tipo_certificacion,"onUpdate:modelValue":e[0]||(e[0]=a=>t.form.tipo_certificacion=a),options:t.tipoOptions,dense:"",outlined:"",label:"Tipo",rules:[a=>!!a||"Requerido"]},null,8,["modelValue","options","rules"])]),o("div",re,[l(m,{modelValue:t.form.organismo_certificador,"onUpdate:modelValue":e[1]||(e[1]=a=>t.form.organismo_certificador=a),dense:"",outlined:"",label:"Organismo certificador"},null,8,["modelValue"])]),o("div",de,[l(m,{modelValue:t.form.fecha_emision,"onUpdate:modelValue":e[2]||(e[2]=a=>t.form.fecha_emision=a),type:"date",dense:"",outlined:"",label:"Emisión"},null,8,["modelValue"])]),o("div",ue,[l(m,{modelValue:t.form.fecha_vencimiento,"onUpdate:modelValue":e[3]||(e[3]=a=>t.form.fecha_vencimiento=a),type:"date",dense:"",outlined:"",label:"Vencimiento"},null,8,["modelValue"])]),o("div",me,[l(S,{modelValue:t.form.estado,"onUpdate:modelValue":e[4]||(e[4]=a=>t.form.estado=a),options:["VIGENTE","VENCIDO","SUSPENDIDO"],dense:"",outlined:"",label:"Estado"},null,8,["modelValue"])]),o("div",ce,[l(m,{modelValue:t.form.certificado_url,"onUpdate:modelValue":e[5]||(e[5]=a=>t.form.certificado_url=a),dense:"",outlined:"",label:"URL certificado (opcional)"},null,8,["modelValue"])]),o("div",pe,[g(l(f,{flat:"",color:"grey",label:"Cancelar",disable:t.saving},null,8,["disable"]),[[y]]),l(f,{color:"primary",label:t.form.id?"Guardar cambios":"Crear",type:"submit",loading:t.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ao=I(le,[["render",fe]]);delete D.Icon.Default.prototype._getIconUrl;D.Icon.Default.mergeOptions({iconRetinaUrl:Y,iconUrl:X,shadowUrl:W});const he={name:"ApiarioMap",components:{LMap:K,LTileLayer:J,LMarker:H,LPopup:$,LControlLayers:Z},props:{modelValue:{type:Object,default:()=>({latitud:null,longitud:null})},center:{type:Array,default:()=>[-16.5,-68.15]},zoomInit:{type:Number,default:14}},emits:["update:modelValue"],data(){return{zoom:this.zoomInit,local:{...this.modelValue},mapOptions:{zoomControl:!0,attributionControl:!1,zoomAnimation:!1,fadeAnimation:!1,markerZoomAnimation:!1}}},computed:{hasLatLng(){const{latitud:i,longitud:e}=this.local;return i!=null&&e!=null&&isFinite(i)&&isFinite(e)},mapCenter(){return this.hasLatLng?[Number(this.local.latitud),Number(this.local.longitud)]:this.center},mapObj(){return this.$refs.map?.leafletObject||null}},watch:{modelValue:{deep:!0,handler(i){i&&(i.latitud!==this.local.latitud||i.longitud!==this.local.longitud)&&(this.local={...i},this.$nextTick(()=>this.refresh()))}},local:{deep:!0,handler(i){const e={...this.modelValue,latitud:i.latitud??null,longitud:i.longitud??null};this.$emit("update:modelValue",e)}}},mounted(){this.$nextTick(()=>this.refresh())},methods:{fix(i){const e=Number(i);return isFinite(e)?e.toFixed(6):"-"},refresh(){const i=this.mapObj;i&&setTimeout(()=>{i.invalidateSize(),this.hasLatLng&&i.setView([Number(this.local.latitud),Number(this.local.longitud)],Math.max(i.getZoom()||this.zoom,15),{animate:!1})},60)},onMapClick(i){const{lat:e,lng:c}=i.latlng||{};e==null||c==null||(this.local.latitud=Number(e.toFixed(7)),this.local.longitud=Number(c.toFixed(7)),this.flyToLatLng())},onDragEnd(i){const e=i?.target?.getLatLng?.();e&&(this.local.latitud=Number(e.lat.toFixed(7)),this.local.longitud=Number(e.lng.toFixed(7)),this.flyToLatLng())},flyToLatLng(){const i=this.mapObj;!i||!this.hasLatLng||i.setView([Number(this.local.latitud),Number(this.local.longitud)],Math.max(i.getZoom()||this.zoom,16),{animate:!1})},locateMe(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(i=>{this.local.latitud=Number(i.coords.latitude.toFixed(7)),this.local.longitud=Number(i.coords.longitude.toFixed(7)),this.$nextTick(()=>this.flyToLatLng())})}}},_e={class:"map-wrapper"},ge={class:"row items-center q-col-gutter-sm q-mb-sm"},ye={class:"col-6 col-sm-3"},be={class:"col-6 col-sm-3"},ve={class:"col-6 col-sm-3"},Ce={class:"col-6 col-sm-3"};function Ve(i,e,c,V,t,d){const a=z("l-control-layers"),n=z("l-tile-layer"),w=z("l-popup"),O=z("l-marker"),Q=z("l-map");return r(),_("div",_e,[o("div",ge,[o("div",ye,[l(m,{modelValue:t.local.latitud,"onUpdate:modelValue":e[0]||(e[0]=C=>t.local.latitud=C),modelModifiers:{number:!0},dense:"",outlined:"",label:"Latitud"},null,8,["modelValue"])]),o("div",be,[l(m,{modelValue:t.local.longitud,"onUpdate:modelValue":e[1]||(e[1]=C=>t.local.longitud=C),modelModifiers:{number:!0},dense:"",outlined:"",label:"Longitud"},null,8,["modelValue"])]),o("div",ve,[l(f,{dense:"","no-caps":"",color:"primary",icon:"place",label:"Ir a lat/lng",onClick:d.flyToLatLng,style:{width:"100%"}},null,8,["onClick"])]),o("div",Ce,[l(f,{dense:"","no-caps":"",color:"secondary",icon:"my_location",label:"Mi ubicación",onClick:d.locateMe,style:{width:"100%"}},null,8,["onClick"])])]),l(Q,{ref:"map",zoom:t.zoom,center:d.mapCenter,options:t.mapOptions,style:{height:"360px","border-radius":"8px",overflow:"hidden"},onClick:d.onMapClick},{default:s(()=>[l(a,{position:"topright"}),l(n,{"layer-type":"base",name:"OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","max-zoom":19,visible:!0}),l(n,{"layer-type":"base",name:"Google Calle",url:"https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),l(n,{"layer-type":"base",name:"Google Satélite",url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),l(n,{"layer-type":"base",name:"Google Híbrido",url:"https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),d.hasLatLng?(r(),p(O,{key:0,"lat-lng":[Number(t.local.latitud),Number(t.local.longitud)],draggable:!0,onDragend:d.onDragEnd},{default:s(()=>[l(w,null,{default:s(()=>[o("div",null,[b("Lat: "+u(d.fix(t.local.latitud)),1),e[2]||(e[2]=o("br",null,null,-1)),b("Lng: "+u(d.fix(t.local.longitud)),1)])]),_:1})]),_:1},8,["lat-lng","onDragend"])):E("",!0)]),_:1},8,["zoom","center","options","onClick"])])}const xe=I(he,[["render",Ve],["__scopeId","data-v-ec3083c5"]]),ke={name:"ProductorApiarios",components:{ApiarioMap:xe},props:{productor:{type:Object,required:!0}},emits:["updated"],data(){return{loading:!1,saving:!1,list:[],dlgApiario:{open:!1},formApiario:this.emptyApiario(),dlgColmena:{open:!1},currentApiario:null,colmenas:[],colLoading:!1,formColmena:this.emptyColmena(),tipoMielOptions:[]}},mounted(){this.hydrateFromProductor()},watch:{productor(){this.hydrateFromProductor()}},methods:{hydrateFromProductor(){this.productor?.apiarios?this.list=this.productor.apiarios:this.fetchApiarios()},async fetchApiarios(){this.loading=!0;try{const{data:i}=await this.$axios.get("apiarios",{params:{productor_id:this.productor.id,paginate:!1}});this.list=Array.isArray(i)?i:i?.data||[]}catch(i){this.list=[],this.$alert?.error?.(i.response?.data?.message||"No se pudo cargar apiarios")}finally{this.loading=!1}},emptyApiario(){return{id:null,productor_id:this.productor?.id||null,municipio_id:null,nombre_cip:"",latitud:null,longitud:null,altitud:null,lugar_apiario:"",numero_colmenas_runsa:null,numero_colmenas_prod:0,seleccion:0,rend_programa_nal:0,organizacion_id:0,fecha_instalacion:null,estado:"ACTIVO",fase:"",coordenada:""}},startCreate(){this.formApiario=this.emptyApiario(),this.dlgApiario.open=!0},startEdit(i){this.formApiario={...this.emptyApiario(),...i,productor_id:this.productor?.id||i.productor_id},this.dlgApiario.open=!0},onApiarioDialogShow(){this.$nextTick(()=>this.$refs.apiarioMap?.refresh())},async saveApiario(){this.saving=!0;try{const i={...this.formApiario,productor_id:this.productor.id};i.id?await this.$axios.put(`apiarios/${i.id}`,i):await this.$axios.post("apiarios",i),this.$alert?.success?.(i.id?"Apiario actualizado":"Apiario creado"),this.dlgApiario.open=!1,this.$emit("updated"),await this.fetchApiarios()}catch(i){this.$alert?.error?.(i.response?.data?.message||"No se pudo guardar apiario")}finally{this.saving=!1}},emptyColmena(){return{id:null,apiario_id:null,tipo_miel_id:null,codigo_colmena:"",tipo_colmena:"",fecha_instalacion:null,reina_fecha_nacimiento:null,reina_procedencia:"",estado:"ACTIVA"}},async openColmenas(i){this.currentApiario=i,this.dlgColmena.open=!0,await this.fetchTipoMiel(),await this.fetchColmenas()},async removeApiario(i){this.$alert?.dialog?.("¿Eliminar apiario?")?.onOk(async()=>{try{await this.$axios.delete(`apiarios/${i.id}`),this.$alert?.success?.("Apiario eliminado"),await this.fetchApiarios()}catch(e){this.$alert?.error?.(e.response?.data?.message||"No se pudo eliminar apiario")}})},async fetchTipoMiel(){try{const{data:i}=await this.$axios.get("tipo-miel");this.tipoMielOptions=Array.isArray(i)?i:i?.data||[]}catch{this.tipoMielOptions=[]}},async fetchColmenas(){if(this.currentApiario?.id){this.colLoading=!0;try{const{data:i}=await this.$axios.get("colmenas",{params:{apiario_id:this.currentApiario.id,paginate:!1}});this.colmenas=Array.isArray(i)?i:i?.data||[]}catch(i){this.colmenas=[],this.$alert?.error?.(i.response?.data?.message||"No se pudieron cargar colmenas")}finally{this.colLoading=!1}}},startCreateColmena(){this.formColmena=this.emptyColmena(),this.formColmena.apiario_id=this.currentApiario?.id||null},startEditColmena(i){this.formColmena={...this.emptyColmena(),...i,apiario_id:this.currentApiario?.id||i.apiario_id}},resetColmena(){this.startCreateColmena()},async saveColmena(){this.saving=!0;try{const i={...this.formColmena,apiario_id:this.currentApiario.id};i.id?await this.$axios.put(`colmenas/${i.id}`,i):await this.$axios.post("colmenas",i),this.$alert?.success?.(i.id?"Colmena actualizada":"Colmena creada"),await this.fetchColmenas(),this.$emit("updated")}catch(i){this.$alert?.error?.(i.response?.data?.message||"No se pudo guardar colmena")}finally{this.saving=!1}},removeColmena(i){this.$alert?.dialog?.("¿Eliminar colmena?")?.onOk(async()=>{try{await this.$axios.delete(`colmenas/${i.id}`),this.$alert?.success?.("Eliminado"),await this.fetchColmenas(),this.$emit("updated")}catch(e){this.$alert?.error?.(e.response?.data?.message||"No se pudo eliminar")}})}}},Ae={class:"row items-center q-gutter-sm q-mb-sm"},we={key:0},ze={key:1},Ee={key:0},Ne={class:"text-h6"},Ue={class:"col-12 col-sm-4"},Oe={class:"col-12 col-sm-8"},Le={class:"col-6 col-sm-2"},qe={class:"col-6 col-sm-2"},Ie={class:"col-12 col-sm-2"},Me={class:"col-12"},Re={class:"col-6 col-sm-3"},Fe={class:"col-6 col-sm-3"},Te={class:"col-6 col-sm-3"},Pe={class:"col-6 col-sm-3"},Se={class:"col-12 text-right q-gutter-sm q-mt-sm"},De={class:"text-h6"},Qe={key:0},Ge={class:"text-subtitle2 q-mb-sm"},je={class:"col-12 col-sm-3"},Be={class:"col-12 col-sm-3"},Ze={class:"col-12 col-sm-3"},$e={class:"col-12 col-sm-3"},He={class:"col-12 col-sm-4"},Je={class:"col-12 col-sm-4"},Ke={class:"col-12 col-sm-4"},We={class:"col-12 text-right q-gutter-sm"};function Xe(i,e,c,V,t,d){const a=z("ApiarioMap");return r(),p(v,null,{default:s(()=>[o("div",Ae,[e[19]||(e[19]=o("div",{class:"text-subtitle1"},"Apiarios",-1)),l(P),l(f,{dense:"",color:"primary",icon:"add_circle",label:"Nuevo","no-caps":"",onClick:d.startCreate,disable:t.saving},null,8,["onClick","disable"])]),l(T,{dense:""},{default:s(()=>[e[24]||(e[24]=o("thead",null,[o("tr",{class:"bg-grey-3"},[o("th",{class:"text-left"},"#"),o("th",{class:"text-left"},"Opciones"),o("th",{class:"text-left"},"Nombre/CIP"),o("th",{class:"text-left"},"Lugar"),o("th",{class:"text-left"},"Ubicación"),o("th",{class:"text-left"},"Colmenas"),o("th",{class:"text-left"},"Estado"),o("th",{class:"text-left"},"Instalación")])],-1)),o("tbody",null,[(r(!0),_(L,null,q(t.list,(n,w)=>(r(),_("tr",{key:n.id},[o("td",null,u(w+1),1),o("td",null,[l(F,{dense:"",label:"Opciones","no-caps":"",color:"primary",size:"10px"},{default:s(()=>[l(R,null,{default:s(()=>[g((r(),p(k,{clickable:"",onClick:O=>d.startEdit(n)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"edit"})]),_:1}),l(h,null,{default:s(()=>e[20]||(e[20]=[b("Editar")])),_:1})]),_:2},1032,["onClick"])),[[y]]),g((r(),p(k,{clickable:"",onClick:O=>d.openColmenas(n)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"hive"})]),_:1}),l(h,null,{default:s(()=>e[21]||(e[21]=[b("Colmenas")])),_:1})]),_:2},1032,["onClick"])),[[y]]),g((r(),p(k,{clickable:"",onClick:O=>d.removeApiario(n)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{class:"text-negative",name:"delete"})]),_:1}),l(h,{class:"text-negative"},{default:s(()=>e[22]||(e[22]=[b("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[y]])]),_:2},1024)]),_:2},1024)]),o("td",null,u(n.nombre_cip||"-"),1),o("td",null,u(n.lugar_apiario||"-"),1),o("td",null,[n.latitud&&n.longitud?(r(),_("span",we,u(n.latitud.toFixed?n.latitud.toFixed(6):n.latitud)+", "+u(n.longitud.toFixed?n.longitud.toFixed(6):n.longitud),1)):(r(),_("span",ze,"-"))]),o("td",null,u((n.colmenas?n.colmenas.length:n.colmenas_count)??0),1),o("td",null,[l(G,{color:n.estado==="ACTIVO"?"green":"grey","text-color":"white",size:"xs",class:"text-bold"},{default:s(()=>[b(u(n.estado),1)]),_:2},1032,["color"])]),o("td",null,u(n.fecha_instalacion||"-"),1)]))),128)),!t.loading&&t.list.length===0?(r(),_("tr",Ee,e[23]||(e[23]=[o("td",{colspan:"8",class:"text-center text-grey"},"Sin registros",-1)]))):E("",!0)])]),_:1}),l(M,{modelValue:t.dlgApiario.open,"onUpdate:modelValue":e[10]||(e[10]=n=>t.dlgApiario.open=n),persistent:"","transition-show":"none","transition-hide":"none",onShow:d.onApiarioDialogShow},{default:s(()=>[l(U,{style:{"min-width":"900px","max-width":"95vw"}},{default:s(()=>[l(v,{class:"row items-center q-gutter-sm"},{default:s(()=>[o("div",Ne,u(t.formApiario.id?"Editar apiario":"Nuevo apiario"),1),l(P),g(l(f,{flat:"",round:"",dense:"",icon:"close"},null,512),[[y]])]),_:1}),l(A),l(v,null,{default:s(()=>[l(j,{onSubmit:d.saveApiario,class:"row q-col-gutter-sm"},{default:s(()=>[o("div",Ue,[l(m,{modelValue:t.formApiario.nombre_cip,"onUpdate:modelValue":e[0]||(e[0]=n=>t.formApiario.nombre_cip=n),label:"Nombre / CIP",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Oe,[l(m,{modelValue:t.formApiario.lugar_apiario,"onUpdate:modelValue":e[1]||(e[1]=n=>t.formApiario.lugar_apiario=n),label:"Lugar del apiario",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Le,[l(m,{modelValue:t.formApiario.altitud,"onUpdate:modelValue":e[2]||(e[2]=n=>t.formApiario.altitud=n),modelModifiers:{number:!0},label:"Altitud (msnm)",dense:"",outlined:""},null,8,["modelValue"])]),o("div",qe,[l(m,{modelValue:t.formApiario.fecha_instalacion,"onUpdate:modelValue":e[3]||(e[3]=n=>t.formApiario.fecha_instalacion=n),type:"date",label:"Instalación",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Ie,[l(S,{modelValue:t.formApiario.estado,"onUpdate:modelValue":e[4]||(e[4]=n=>t.formApiario.estado=n),options:["ACTIVO","INACTIVO"],label:"Estado",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Me,[l(a,{ref:"apiarioMap",modelValue:t.formApiario,"onUpdate:modelValue":e[5]||(e[5]=n=>t.formApiario=n),center:[-16.5,-68.15],"zoom-init":14},null,8,["modelValue"])]),o("div",Re,[l(m,{modelValue:t.formApiario.numero_colmenas_runsa,"onUpdate:modelValue":e[6]||(e[6]=n=>t.formApiario.numero_colmenas_runsa=n),modelModifiers:{number:!0},type:"number",label:"Colmenas RUNSA",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Fe,[l(m,{modelValue:t.formApiario.numero_colmenas_prod,"onUpdate:modelValue":e[7]||(e[7]=n=>t.formApiario.numero_colmenas_prod=n),modelModifiers:{number:!0},type:"number",label:"Colmenas PROD.",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Te,[l(m,{modelValue:t.formApiario.rend_programa_nal,"onUpdate:modelValue":e[8]||(e[8]=n=>t.formApiario.rend_programa_nal=n),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Rend. prog. nal",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Pe,[l(m,{modelValue:t.formApiario.seleccion,"onUpdate:modelValue":e[9]||(e[9]=n=>t.formApiario.seleccion=n),modelModifiers:{number:!0},type:"number",label:"Selección",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Se,[g(l(f,{flat:"",color:"grey",label:"Cancelar",disable:t.saving},null,8,["disable"]),[[y]]),l(f,{color:"primary",label:t.formApiario.id?"Guardar cambios":"Crear",type:"submit",loading:t.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue","onShow"]),l(M,{modelValue:t.dlgColmena.open,"onUpdate:modelValue":e[18]||(e[18]=n=>t.dlgColmena.open=n),persistent:"","transition-show":"none","transition-hide":"none"},{default:s(()=>[l(U,{style:{"min-width":"900px","max-width":"95vw"}},{default:s(()=>[l(v,{class:"row items-center q-gutter-sm"},{default:s(()=>[o("div",De,"Colmenas — "+u(t.currentApiario?.nombre_cip||"Apiario #"+t.currentApiario?.id),1),l(P),l(f,{dense:"",color:"primary",icon:"add_circle",label:"Nueva colmena","no-caps":"",onClick:d.startCreateColmena},null,8,["onClick"]),g(l(f,{flat:"",round:"",dense:"",icon:"close"},null,512),[[y]])]),_:1}),l(A),l(v,null,{default:s(()=>[l(T,{dense:""},{default:s(()=>[e[28]||(e[28]=o("thead",null,[o("tr",{class:"bg-grey-3"},[o("th",null,"#"),o("th",null,"Opc."),o("th",null,"Código"),o("th",null,"Tipo"),o("th",null,"Tipo miel"),o("th",null,"Instalación"),o("th",null,"Reina nacimiento"),o("th",null,"Estado")])],-1)),o("tbody",null,[(r(!0),_(L,null,q(t.colmenas,(n,w)=>(r(),_("tr",{key:n.id||w},[o("td",null,u(w+1),1),o("td",null,[l(F,{dense:"","no-caps":"",size:"10px",label:"Opciones",color:"primary"},{default:s(()=>[l(R,null,{default:s(()=>[g((r(),p(k,{clickable:"",onClick:O=>d.startEditColmena(n)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"edit"})]),_:1}),l(h,null,{default:s(()=>e[25]||(e[25]=[b("Editar")])),_:1})]),_:2},1032,["onClick"])),[[y]]),g((r(),p(k,{clickable:"",onClick:O=>d.removeColmena(n)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{class:"text-negative",name:"delete"})]),_:1}),l(h,{class:"text-negative"},{default:s(()=>e[26]||(e[26]=[b("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[y]])]),_:2},1024)]),_:2},1024)]),o("td",null,u(n.codigo_colmena||"-"),1),o("td",null,u(n.tipo_colmena||"-"),1),o("td",null,u(n.tipo_miel?.tipo_miel||n.tipoMiel?.tipo_miel||"-"),1),o("td",null,u(n.fecha_instalacion||"-"),1),o("td",null,u(n.reina_fecha_nacimiento||"-"),1),o("td",null,[l(G,{color:n.estado==="ACTIVA"?"green":"grey","text-color":"white",size:"xs"},{default:s(()=>[b(u(n.estado),1)]),_:2},1032,["color"])])]))),128)),!t.colLoading&&t.colmenas.length===0?(r(),_("tr",Qe,e[27]||(e[27]=[o("td",{colspan:"8",class:"text-center text-grey"},"Sin colmenas",-1)]))):E("",!0)])]),_:1}),l(A,{class:"q-my-md"}),o("div",Ge,u(t.formColmena.id?"Editar colmena":"Nueva colmena"),1),l(j,{onSubmit:d.saveColmena,class:"row q-col-gutter-sm"},{default:s(()=>[o("div",je,[l(m,{modelValue:t.formColmena.codigo_colmena,"onUpdate:modelValue":e[11]||(e[11]=n=>t.formColmena.codigo_colmena=n),dense:"",outlined:"",label:"Código"},null,8,["modelValue"])]),o("div",Be,[l(m,{modelValue:t.formColmena.tipo_colmena,"onUpdate:modelValue":e[12]||(e[12]=n=>t.formColmena.tipo_colmena=n),dense:"",outlined:"",label:"Tipo colmena"},null,8,["modelValue"])]),o("div",Ze,[l(S,{modelValue:t.formColmena.tipo_miel_id,"onUpdate:modelValue":e[13]||(e[13]=n=>t.formColmena.tipo_miel_id=n),options:t.tipoMielOptions,"option-value":"id","option-label":"tipo_miel","emit-value":"","map-options":"",dense:"",outlined:"",label:"Tipo de miel"},null,8,["modelValue","options"])]),o("div",$e,[l(m,{modelValue:t.formColmena.fecha_instalacion,"onUpdate:modelValue":e[14]||(e[14]=n=>t.formColmena.fecha_instalacion=n),type:"date",dense:"",outlined:"",label:"Instalación"},null,8,["modelValue"])]),o("div",He,[l(m,{modelValue:t.formColmena.reina_fecha_nacimiento,"onUpdate:modelValue":e[15]||(e[15]=n=>t.formColmena.reina_fecha_nacimiento=n),type:"date",dense:"",outlined:"",label:"Reina: nacimiento"},null,8,["modelValue"])]),o("div",Je,[l(m,{modelValue:t.formColmena.reina_procedencia,"onUpdate:modelValue":e[16]||(e[16]=n=>t.formColmena.reina_procedencia=n),dense:"",outlined:"",label:"Reina: procedencia"},null,8,["modelValue"])]),o("div",Ke,[l(S,{modelValue:t.formColmena.estado,"onUpdate:modelValue":e[17]||(e[17]=n=>t.formColmena.estado=n),options:["ACTIVA","INACTIVA"],dense:"",outlined:"",label:"Estado"},null,8,["modelValue"])]),o("div",We,[l(f,{flat:"",color:"grey",label:"Limpiar",onClick:d.resetColmena,disable:t.saving},null,8,["onClick","disable"]),l(f,{color:"primary",label:t.formColmena.id?"Guardar cambios":"Agregar colmena",type:"submit",loading:t.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const so=I(ke,[["render",Xe],["__scopeId","data-v-08f4bdb1"]]);delete D.Icon.Default.prototype._getIconUrl;D.Icon.Default.mergeOptions({iconRetinaUrl:Y,iconUrl:X,shadowUrl:W});const Ye={name:"ProductorMapa",components:{LMap:K,LTileLayer:J,LMarker:H,LPopup:$,LControlLayers:Z},props:{productor:{type:Object,required:!0},defaultCenter:{type:Array,default:()=>[-16.29,-63.59]},defaultZoom:{type:Number,default:6}},data(){return{zoom:this.defaultZoom,initialCenter:this.defaultCenter,mapOptions:{zoomControl:!0,attributionControl:!1,zoomAnimation:!1,fadeAnimation:!1,markerZoomAnimation:!1}}},computed:{mapObj(){return this.$refs.map?.leafletObject||null},apiariosConLatLng(){return(Array.isArray(this.productor?.apiarios)?this.productor.apiarios:[]).map(e=>{const c=Number(e.latitud),V=Number(e.longitud);return isFinite(c)&&isFinite(V)?{...e,lat:c,lng:V}:null}).filter(Boolean)}},watch:{productor:{deep:!0,handler(){this.$nextTick(()=>this.fitToMarkers())}}},mounted(){this.$nextTick(()=>this.fitToMarkers())},methods:{refresh(){const i=this.mapObj;i&&setTimeout(()=>{i.invalidateSize(),this.fitToMarkers(!0)},60)},fitToMarkers(i=!1){const e=this.mapObj;if(!e)return;const c=this.apiariosConLatLng.map(t=>[t.lat,t.lng]);if(c.length===0){e.setView(this.defaultCenter,this.defaultZoom,{animate:!1});return}if(c.length===1){const t=i?e.getZoom()||this.defaultZoom:Math.max(e.getZoom()||this.defaultZoom,15);e.setView(c[0],t,{animate:!1});return}const V=D.latLngBounds(c);e.fitBounds(V.pad(.2),{animate:!1})}}},el={style:{height:"580px","border-radius":"8px",overflow:"hidden"}},ll={style:{"min-width":"180px"}},ol={class:"text-bold"},tl={class:"text-grey-7",style:{"font-size":"12px"}},il={key:0,class:"q-mt-xs"};function al(i,e,c,V,t,d){const a=z("l-control-layers"),n=z("l-tile-layer"),w=z("l-popup"),O=z("l-marker"),Q=z("l-map");return r(),p(v,{class:"q-pa-none"},{default:s(()=>[o("div",el,[l(Q,{ref:"map",zoom:t.zoom,center:t.initialCenter,options:t.mapOptions,style:{height:"100%",width:"100%"}},{default:s(()=>[l(a,{position:"topright"}),l(n,{"layer-type":"base",name:"OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","max-zoom":19,visible:!1}),l(n,{"layer-type":"base",name:"Google Calle",url:"https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),l(n,{"layer-type":"base",name:"Google Satélite",url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),l(n,{"layer-type":"base",name:"Google Híbrido",url:"https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}","max-zoom":21,visible:!0}),(r(!0),_(L,null,q(d.apiariosConLatLng,C=>(r(),p(O,{key:C.id,"lat-lng":[C.lat,C.lng]},{default:s(()=>[l(w,null,{default:s(()=>[o("div",ll,[o("div",ol,u(C.nombre_cip||"Apiario #"+C.id),1),o("div",null,u(C.lugar_apiario||"-"),1),o("div",tl,[b(" Lat: "+u(C.lat.toFixed(6)),1),e[0]||(e[0]=o("br",null,null,-1)),b(" Lng: "+u(C.lng.toFixed(6)),1)]),C.estado?(r(),_("div",il,[e[1]||(e[1]=b(" Estado: ")),l(ee,{color:C.estado==="ACTIVO"?"green":"grey","text-color":"white",rounded:""},{default:s(()=>[b(u(C.estado),1)]),_:2},1032,["color"])])):E("",!0)])]),_:2},1024)]),_:2},1032,["lat-lng"]))),128))]),_:1},8,["zoom","center","options"])])]),_:1})}const no=I(Ye,[["render",al],["__scopeId","data-v-5da6a72a"]]),sl={name:"PlagasFormulario",props:{cosecha:{type:Object,required:!0},readOnly:{type:Boolean,default:!1}},data(){return{loading:!1,saving:!1,rows:[],dlg:{open:!1,modo:"crear",id:null},form:{acopio_cosecha_id:null,fecha:null,numero_colmenas_apiario:"",nombre_plaga:"",plaga_presente:"",daño_visible_apiario:"",medidas_control_celdilla:"",observaciones:""}}},mounted(){this.fetchRows()},methods:{resetForm(){this.form={acopio_cosecha_id:this.cosecha?.id||null,fecha:null,numero_colmenas_apiario:"",nombre_plaga:"",plaga_presente:"",daño_visible_apiario:"",medidas_control_celdilla:"",observaciones:""}},async fetchRows(){try{this.loading=!0;const{data:i}=await this.$axios.get("/plagas",{params:{cosecha_id:this.cosecha?.id}});this.rows=Array.isArray(i)?i:i?.data||[]}catch{this.$q.notify({type:"negative",message:"No se pudieron cargar los registros"})}finally{this.loading=!1}},onNuevo(){this.dlg.modo="crear",this.dlg.id=null,this.resetForm(),this.form.acopio_cosecha_id=this.cosecha?.id||null,this.dlg.open=!0},onEditar(i){this.dlg.modo="editar",this.dlg.id=i.id,this.form={...i,acopio_cosecha_id:this.cosecha?.id||i.acopio_cosecha_id},this.dlg.open=!0},async onGuardar(){try{this.saving=!0,this.dlg.modo==="crear"?(await this.$axios.post("/plagas",this.form),this.$q.notify({type:"positive",message:"Registro creado"})):(await this.$axios.put(`/plagas/${this.dlg.id}`,this.form),this.$q.notify({type:"positive",message:"Registro actualizado"})),this.dlg.open=!1,this.fetchRows()}catch{this.$q.notify({type:"negative",message:"Error al guardar"})}finally{this.saving=!1}},async onEliminar(i){this.$q.dialog({title:"Eliminar",message:"¿Desea eliminar este registro?",cancel:!0,persistent:!0}).onOk(async()=>{try{await this.$axios.delete(`/plagas/${i.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.fetchRows()}catch{this.$q.notify({type:"negative",message:"No se pudo eliminar"})}})},onImprimir(){if(!this.cosecha?.id)return;const i=this.$axios.defaults.baseURL+`/plagas/${this.cosecha.id}/imprimir`;window.open(i,"_blank")}}},nl={class:"q-gutter-sm"},rl={class:"text-right"},dl={key:1},ul={class:"text-subtitle1"},ml={class:"row q-col-gutter-md"},cl={class:"col-12 col-md-4"},pl={class:"col-12 col-md-4"},fl={class:"col-12 col-md-4"},hl={class:"col-12 col-md-6"},_l={class:"col-12 col-md-6"},gl={class:"col-12"},yl={class:"col-12"};function bl(i,e,c,V,t,d){return r(),p(U,{flat:"",bordered:""},{default:s(()=>[l(v,{class:"row items-center justify-between"},{default:s(()=>[e[8]||(e[8]=o("div",{class:"text-subtitle1"},"Control de Plagas",-1)),o("div",nl,[c.readOnly?E("",!0):(r(),p(f,{key:0,color:"primary",icon:"add",label:"Nuevo","no-caps":"",onClick:d.onNuevo},null,8,["onClick"])),c.readOnly?(r(),p(f,{key:1,color:"green",icon:"print",label:"Imprimir","no-caps":"",onClick:d.onImprimir},null,8,["onClick"])):E("",!0)])]),_:1}),l(A),l(v,null,{default:s(()=>[l(T,{dense:"","wrap-cells":"",bordered:"",flat:""},{default:s(()=>[e[11]||(e[11]=o("thead",null,[o("tr",{class:"bg-primary text-white"},[o("th",null,"Acciones"),o("th",null,"Fecha"),o("th",null,"N° Colmenas"),o("th",null,"Nombre Plaga"),o("th",null,"Plaga Presente"),o("th",null,"Daño Visible")])],-1)),o("tbody",null,[(r(!0),_(L,null,q(t.rows,a=>(r(),_("tr",{key:a.id},[o("td",rl,[c.readOnly?(r(),_("span",dl,"—")):(r(),p(F,{key:0,dense:"","no-caps":"",label:"Acciones",color:"primary",size:"10px"},{default:s(()=>[l(R,null,{default:s(()=>[g((r(),p(k,{clickable:"",onClick:n=>d.onEditar(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"edit"})]),_:1}),l(h,null,{default:s(()=>e[9]||(e[9]=[b("Editar")])),_:1})]),_:2},1032,["onClick"])),[[N],[y]]),g((r(),p(k,{clickable:"",onClick:n=>d.onEliminar(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"delete",color:"negative"})]),_:1}),l(h,null,{default:s(()=>e[10]||(e[10]=[b("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[N],[y]])]),_:2},1024)]),_:2},1024))]),o("td",null,u(a.fecha),1),o("td",null,u(a.numero_colmenas_apiario),1),o("td",null,u(a.nombre_plaga),1),o("td",null,u(a.plaga_presente),1),o("td",null,u(a.daño_visible_apiario),1)]))),128))])]),_:1})]),_:1}),l(M,{modelValue:t.dlg.open,"onUpdate:modelValue":e[7]||(e[7]=a=>t.dlg.open=a),persistent:""},{default:s(()=>[l(U,{style:{"max-width":"90vw"}},{default:s(()=>[l(v,{class:"row items-center justify-between"},{default:s(()=>[o("div",ul,u(t.dlg.modo==="crear"?"Nuevo registro":"Editar registro"),1),g(l(f,{flat:"",round:"",dense:"",icon:"close"},null,512),[[y]])]),_:1}),l(A),l(v,{class:""},{default:s(()=>[o("div",ml,[o("div",cl,[l(m,{modelValue:t.form.fecha,"onUpdate:modelValue":e[0]||(e[0]=a=>t.form.fecha=a),type:"date",label:"Fecha",dense:"",outlined:""},null,8,["modelValue"])]),o("div",pl,[l(m,{modelValue:t.form.numero_colmenas_apiario,"onUpdate:modelValue":e[1]||(e[1]=a=>t.form.numero_colmenas_apiario=a),label:"N° Colmenas en Apiario",dense:"",outlined:""},null,8,["modelValue"])]),o("div",fl,[l(m,{modelValue:t.form.nombre_plaga,"onUpdate:modelValue":e[2]||(e[2]=a=>t.form.nombre_plaga=a),label:"Nombre de la Plaga",dense:"",outlined:""},null,8,["modelValue"])]),o("div",hl,[l(m,{modelValue:t.form.plaga_presente,"onUpdate:modelValue":e[3]||(e[3]=a=>t.form.plaga_presente=a),label:"Plaga Presente en el Apiario",dense:"",outlined:""},null,8,["modelValue"])]),o("div",_l,[l(m,{modelValue:t.form.daño_visible_apiario,"onUpdate:modelValue":e[4]||(e[4]=a=>t.form.daño_visible_apiario=a),label:"Daño Visible en el Apiario",dense:"",outlined:""},null,8,["modelValue"])]),o("div",gl,[l(m,{modelValue:t.form.medidas_control_celdilla,"onUpdate:modelValue":e[5]||(e[5]=a=>t.form.medidas_control_celdilla=a),label:"Medidas de Control por Celdilla",dense:"",outlined:""},null,8,["modelValue"])]),o("div",yl,[l(m,{modelValue:t.form.observaciones,"onUpdate:modelValue":e[6]||(e[6]=a=>t.form.observaciones=a),type:"textarea",autogrow:"",label:"Observaciones",dense:"",outlined:""},null,8,["modelValue"])])])]),_:1}),l(A),l(B,{align:"right"},{default:s(()=>[g(l(f,{flat:"",label:"Cancelar"},null,512),[[y]]),l(f,{color:"primary",label:t.dlg.modo==="crear"?"Guardar":"Actualizar",onClick:d.onGuardar,loading:t.saving},null,8,["label","onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ro=I(sl,[["render",bl]]),vl={name:"LimpiezasFormulario",props:{cosecha:{type:Object,required:!0},readOnly:{type:Boolean,default:!1}},data(){return{loading:!1,saving:!1,rows:[],dlg:{open:!1,modo:"crear",id:null},form:{acopio_cosecha_id:null,equipo_herramienta_material:"",material_recubrimiento:"",metodo_limpieza_utilizado:"",producto_quimico_desinfeccion:"",fecha_aplicacion:null}}},mounted(){this.fetchRows()},methods:{resetForm(){this.form={acopio_cosecha_id:this.cosecha?.id||null,equipo_herramienta_material:"",material_recubrimiento:"",metodo_limpieza_utilizado:"",producto_quimico_desinfeccion:"",fecha_aplicacion:null}},async fetchRows(){try{this.loading=!0;const{data:i}=await this.$axios.get("/limpiezas",{params:{cosecha_id:this.cosecha?.id}});this.rows=Array.isArray(i)?i:i?.data||[]}catch{this.$q.notify({type:"negative",message:"No se pudieron cargar los registros"})}finally{this.loading=!1}},onNuevo(){this.dlg.modo="crear",this.dlg.id=null,this.resetForm(),this.form.acopio_cosecha_id=this.cosecha?.id||null,this.dlg.open=!0},onEditar(i){this.dlg.modo="editar",this.dlg.id=i.id,this.form={...i,acopio_cosecha_id:this.cosecha?.id||i.acopio_cosecha_id},this.dlg.open=!0},async onGuardar(){try{this.saving=!0,this.dlg.modo==="crear"?(await this.$axios.post("/limpiezas",this.form),this.$q.notify({type:"positive",message:"Registro creado"})):(await this.$axios.put(`/limpiezas/${this.dlg.id}`,this.form),this.$q.notify({type:"positive",message:"Registro actualizado"})),this.dlg.open=!1,this.fetchRows()}catch{this.$q.notify({type:"negative",message:"Error al guardar"})}finally{this.saving=!1}},async onEliminar(i){this.$q.dialog({title:"Eliminar",message:"¿Desea eliminar este registro?",cancel:!0,persistent:!0}).onOk(async()=>{try{await this.$axios.delete(`/limpiezas/${i.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.fetchRows()}catch{this.$q.notify({type:"negative",message:"No se pudo eliminar"})}})},onImprimir(){if(!this.cosecha?.id)return;const i=this.$axios.defaults.baseURL+`/limpiezas/${this.cosecha.id}/imprimir`;window.open(i,"_blank")}}},Cl={class:"q-gutter-sm"},Vl={class:"text-right"},xl={key:1},kl={class:"text-subtitle1"},Al={class:"row q-col-gutter-md"},wl={class:"col-12 col-md-6"},zl={class:"col-12 col-md-6"},El={class:"col-12 col-md-6"},Nl={class:"col-12 col-md-6"},Ul={class:"col-12 col-md-6"};function Ol(i,e,c,V,t,d){return r(),p(U,{flat:"",bordered:""},{default:s(()=>[l(v,{class:"row items-center justify-between"},{default:s(()=>[e[6]||(e[6]=o("div",{class:"text-subtitle1"},"Limpieza y Desinfección",-1)),o("div",Cl,[c.readOnly?E("",!0):(r(),p(f,{key:0,color:"primary",icon:"add",label:"Nuevo","no-caps":"",onClick:d.onNuevo},null,8,["onClick"])),c.readOnly?(r(),p(f,{key:1,color:"green",icon:"print",label:"Imprimir","no-caps":"",onClick:d.onImprimir},null,8,["onClick"])):E("",!0)])]),_:1}),l(A),l(v,null,{default:s(()=>[l(T,{dense:"","wrap-cells":"",bordered:"",flat:""},{default:s(()=>[e[9]||(e[9]=o("thead",null,[o("tr",{class:"bg-primary text-white"},[o("th",null,"Acciones"),o("th",null,"Equipo/Herramienta"),o("th",null,"Material Recubrimiento"),o("th",null,"Método Limpieza"),o("th",null,"Producto Químico"),o("th",null,"Fecha Aplicación")])],-1)),o("tbody",null,[(r(!0),_(L,null,q(t.rows,a=>(r(),_("tr",{key:a.id},[o("td",Vl,[c.readOnly?(r(),_("span",xl,"—")):(r(),p(F,{key:0,dense:"","no-caps":"",label:"Acciones",color:"primary",size:"10px"},{default:s(()=>[l(R,null,{default:s(()=>[g((r(),p(k,{clickable:"",onClick:n=>d.onEditar(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"edit"})]),_:1}),l(h,null,{default:s(()=>e[7]||(e[7]=[b("Editar")])),_:1})]),_:2},1032,["onClick"])),[[N],[y]]),g((r(),p(k,{clickable:"",onClick:n=>d.onEliminar(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"delete",color:"negative"})]),_:1}),l(h,null,{default:s(()=>e[8]||(e[8]=[b("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[N],[y]])]),_:2},1024)]),_:2},1024))]),o("td",null,u(a.equipo_herramienta_material),1),o("td",null,u(a.material_recubrimiento),1),o("td",null,u(a.metodo_limpieza_utilizado),1),o("td",null,u(a.producto_quimico_desinfeccion),1),o("td",null,u(a.fecha_aplicacion),1)]))),128))])]),_:1})]),_:1}),l(M,{modelValue:t.dlg.open,"onUpdate:modelValue":e[5]||(e[5]=a=>t.dlg.open=a),persistent:""},{default:s(()=>[l(U,{style:{"max-width":"90vw"}},{default:s(()=>[l(v,{class:"row items-center justify-between"},{default:s(()=>[o("div",kl,u(t.dlg.modo==="crear"?"Nuevo registro":"Editar registro"),1),g(l(f,{flat:"",round:"",dense:"",icon:"close"},null,512),[[y]])]),_:1}),l(A),l(v,{class:""},{default:s(()=>[o("div",Al,[o("div",wl,[l(m,{modelValue:t.form.equipo_herramienta_material,"onUpdate:modelValue":e[0]||(e[0]=a=>t.form.equipo_herramienta_material=a),label:"Equipo, Herramienta o Material Apícola",dense:"",outlined:""},null,8,["modelValue"])]),o("div",zl,[l(m,{modelValue:t.form.material_recubrimiento,"onUpdate:modelValue":e[1]||(e[1]=a=>t.form.material_recubrimiento=a),label:"Material de Recubrimiento",dense:"",outlined:""},null,8,["modelValue"])]),o("div",El,[l(m,{modelValue:t.form.metodo_limpieza_utilizado,"onUpdate:modelValue":e[2]||(e[2]=a=>t.form.metodo_limpieza_utilizado=a),label:"Método de Limpieza Utilizado",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Nl,[l(m,{modelValue:t.form.producto_quimico_desinfeccion,"onUpdate:modelValue":e[3]||(e[3]=a=>t.form.producto_quimico_desinfeccion=a),label:"Producto Químico o Desinfección",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Ul,[l(m,{modelValue:t.form.fecha_aplicacion,"onUpdate:modelValue":e[4]||(e[4]=a=>t.form.fecha_aplicacion=a),type:"date",label:"Fecha de Aplicación",dense:"",outlined:""},null,8,["modelValue"])])])]),_:1}),l(A),l(B,{align:"right"},{default:s(()=>[g(l(f,{flat:"",label:"Cancelar"},null,512),[[y]]),l(f,{color:"primary",label:t.dlg.modo==="crear"?"Guardar":"Actualizar",onClick:d.onGuardar,loading:t.saving},null,8,["label","onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const uo=I(vl,[["render",Ol]]),Ll={name:"MedicamentosFormulario",props:{cosecha:{type:Object,required:!0},readOnly:{type:Boolean,default:!1}},data(){return{loading:!1,saving:!1,rows:[],dlg:{open:!1,modo:"crear",id:null},form:{acopio_cosecha_id:null,fecha:null,nombre_producto:"",principio_activo:"",dosis_recomendada:"",dosis_aplicada:"",plagas_controladas:"",periodo_espera_cosecha:"",nombre_encargado:"",firma:""}}},mounted(){this.fetchRows()},methods:{resetForm(){this.form={acopio_cosecha_id:this.cosecha?.id||null,fecha:null,nombre_producto:"",principio_activo:"",dosis_recomendada:"",dosis_aplicada:"",plagas_controladas:"",periodo_espera_cosecha:"",nombre_encargado:"",firma:""}},async fetchRows(){try{this.loading=!0;const{data:i}=await this.$axios.get("/medicamentos",{params:{cosecha_id:this.cosecha?.id}});this.rows=Array.isArray(i)?i:i?.data||[]}catch{this.$q.notify({type:"negative",message:"No se pudieron cargar los registros"})}finally{this.loading=!1}},onNuevo(){this.dlg.modo="crear",this.dlg.id=null,this.resetForm(),this.form.acopio_cosecha_id=this.cosecha?.id||null,this.dlg.open=!0},onEditar(i){this.dlg.modo="editar",this.dlg.id=i.id,this.form={...i,acopio_cosecha_id:this.cosecha?.id||i.acopio_cosecha_id},this.dlg.open=!0},async onGuardar(){try{this.saving=!0,this.dlg.modo==="crear"?(await this.$axios.post("/medicamentos",this.form),this.$q.notify({type:"positive",message:"Registro creado"})):(await this.$axios.put(`/medicamentos/${this.dlg.id}`,this.form),this.$q.notify({type:"positive",message:"Registro actualizado"})),this.dlg.open=!1,this.fetchRows()}catch{this.$q.notify({type:"negative",message:"Error al guardar"})}finally{this.saving=!1}},async onEliminar(i){this.$q.dialog({title:"Eliminar",message:"¿Desea eliminar este registro?",cancel:!0,persistent:!0}).onOk(async()=>{try{await this.$axios.delete(`/medicamentos/${i.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),this.fetchRows()}catch{this.$q.notify({type:"negative",message:"No se pudo eliminar"})}})},onImprimir(){if(!this.cosecha?.id)return;const i=this.$axios.defaults.baseURL+`/medicamentos/${this.cosecha.id}/imprimir`;window.open(i,"_blank")}}},ql={class:"q-gutter-sm"},Il={class:"text-right"},Ml={key:1},Rl={class:"text-subtitle1"},Fl={class:"row q-col-gutter-md"},Tl={class:"col-12 col-md-3"},Pl={class:"col-12 col-md-9"},Sl={class:"col-12 col-md-6"},Dl={class:"col-12 col-md-3"},Ql={class:"col-12 col-md-3"},Gl={class:"col-12 col-md-6"},jl={class:"col-12 col-md-6"},Bl={class:"col-12 col-md-6"},Zl={class:"col-12 col-md-6"};function $l(i,e,c,V,t,d){return r(),p(U,{flat:"",bordered:""},{default:s(()=>[l(v,{class:"row items-center justify-between"},{default:s(()=>[e[10]||(e[10]=o("div",{class:"text-subtitle1"},"Aplicación de Medicamentos",-1)),o("div",ql,[c.readOnly?E("",!0):(r(),p(f,{key:0,color:"primary",icon:"add",label:"Nuevo","no-caps":"",onClick:d.onNuevo},null,8,["onClick"])),c.readOnly?(r(),p(f,{key:1,color:"green",icon:"print",label:"Imprimir","no-caps":"",onClick:d.onImprimir},null,8,["onClick"])):E("",!0)])]),_:1}),l(A),l(v,null,{default:s(()=>[l(T,{dense:"","wrap-cells":"",bordered:"",flat:""},{default:s(()=>[e[13]||(e[13]=o("thead",null,[o("tr",{class:"bg-primary text-white"},[o("th",null,"Acciones"),o("th",null,"Fecha"),o("th",null,"Nombre Producto"),o("th",null,"Principio Activo"),o("th",null,"Dosis Recomendada"),o("th",null,"Dosis Aplicada"),o("th",null,"Plagas Controladas")])],-1)),o("tbody",null,[(r(!0),_(L,null,q(t.rows,a=>(r(),_("tr",{key:a.id},[o("td",Il,[c.readOnly?(r(),_("span",Ml,"—")):(r(),p(F,{key:0,dense:"","no-caps":"",label:"Acciones",color:"primary",size:"10px"},{default:s(()=>[l(R,null,{default:s(()=>[g((r(),p(k,{clickable:"",onClick:n=>d.onEditar(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"edit"})]),_:1}),l(h,null,{default:s(()=>e[11]||(e[11]=[b("Editar")])),_:1})]),_:2},1032,["onClick"])),[[N],[y]]),g((r(),p(k,{clickable:"",onClick:n=>d.onEliminar(a)},{default:s(()=>[l(h,{avatar:""},{default:s(()=>[l(x,{name:"delete",color:"negative"})]),_:1}),l(h,null,{default:s(()=>e[12]||(e[12]=[b("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[N],[y]])]),_:2},1024)]),_:2},1024))]),o("td",null,u(a.fecha),1),o("td",null,u(a.nombre_producto),1),o("td",null,u(a.principio_activo),1),o("td",null,u(a.dosis_recomendada),1),o("td",null,u(a.dosis_aplicada),1),o("td",null,u(a.plagas_controladas),1)]))),128))])]),_:1})]),_:1}),l(M,{modelValue:t.dlg.open,"onUpdate:modelValue":e[9]||(e[9]=a=>t.dlg.open=a),persistent:""},{default:s(()=>[l(U,{style:{"max-width":"90vw"}},{default:s(()=>[l(v,{class:"row items-center justify-between"},{default:s(()=>[o("div",Rl,u(t.dlg.modo==="crear"?"Nuevo registro":"Editar registro"),1),g(l(f,{flat:"",round:"",dense:"",icon:"close"},null,512),[[y]])]),_:1}),l(A),l(v,{class:""},{default:s(()=>[o("div",Fl,[o("div",Tl,[l(m,{modelValue:t.form.fecha,"onUpdate:modelValue":e[0]||(e[0]=a=>t.form.fecha=a),type:"date",label:"Fecha",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Pl,[l(m,{modelValue:t.form.nombre_producto,"onUpdate:modelValue":e[1]||(e[1]=a=>t.form.nombre_producto=a),label:"Nombre del Producto",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Sl,[l(m,{modelValue:t.form.principio_activo,"onUpdate:modelValue":e[2]||(e[2]=a=>t.form.principio_activo=a),label:"Principio Activo",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Dl,[l(m,{modelValue:t.form.dosis_recomendada,"onUpdate:modelValue":e[3]||(e[3]=a=>t.form.dosis_recomendada=a),label:"Dosis Recomendada",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Ql,[l(m,{modelValue:t.form.dosis_aplicada,"onUpdate:modelValue":e[4]||(e[4]=a=>t.form.dosis_aplicada=a),label:"Dosis Aplicada",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Gl,[l(m,{modelValue:t.form.plagas_controladas,"onUpdate:modelValue":e[5]||(e[5]=a=>t.form.plagas_controladas=a),label:"Plagas Controladas",dense:"",outlined:""},null,8,["modelValue"])]),o("div",jl,[l(m,{modelValue:t.form.periodo_espera_cosecha,"onUpdate:modelValue":e[6]||(e[6]=a=>t.form.periodo_espera_cosecha=a),label:"Periodo de Espera para Cosecha",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Bl,[l(m,{modelValue:t.form.nombre_encargado,"onUpdate:modelValue":e[7]||(e[7]=a=>t.form.nombre_encargado=a),label:"Nombre del Encargado",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Zl,[l(m,{modelValue:t.form.firma,"onUpdate:modelValue":e[8]||(e[8]=a=>t.form.firma=a),label:"Firma",dense:"",outlined:"",hint:"Texto o ruta de imagen"},null,8,["modelValue"])])])]),_:1}),l(A),l(B,{align:"right"},{default:s(()=>[g(l(f,{flat:"",label:"Cancelar"},null,512),[[y]]),l(f,{color:"primary",label:t.dlg.modo==="crear"?"Guardar":"Actualizar",onClick:d.onGuardar,loading:t.saving},null,8,["label","onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const mo=I(Ll,[["render",$l]]);export{uo as L,mo as M,ro as P,ao as a,so as b,no as c};
