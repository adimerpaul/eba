import{_ as Q,c as p,o as r,w as i,a as l,Q as w,e as y,b as a,O as k,aa as m,ai as F,af as h,a8 as f,f as v,ab as O,ac as E,P as N,d as V,ad as $,t as d}from"./index-C57aArx_.js";import{Q as c}from"./QSelect-pyB2onRy.js";import{Q as C,b as g,d as A}from"./format-Doy9yArQ.js";import{Q as U}from"./QForm-BelSAkXf.js";import{Q as _}from"./QList-Dipks2eP.js";import{Q as P}from"./QBtnDropdown-9fSkuPgs.js";import{Q as B}from"./QMarkupTable-Bcow09FE.js";import{Q as D}from"./QPage-B7bQxfky.js";import{h as S}from"./moment-C5S46NFB.js";import"./selection-BLLKP77D.js";const I={name:"AcopioPage",data:function(){return{numActa:null,acopioCosechas:[],loadingProductores:!1,productor:null,productorOptions:[],productos:[],producto:null,loading:!1,fechaInicio:S().startOf("month").format("YYYY-MM-DD"),fechaFin:S().endOf("month").format("YYYY-MM-DD"),estados:["BUENO","EN OBSERVACION"],estadoSeleccionado:null,departamentos:[],departamentoSeleccionado:null,provincias:[],provinciaSeleccionado:null,municipios:[],municipioSeleccionado:null}},mounted(){this.buscarCosechas(),this.productoGet()},computed:{calculoCosecha(){let o=0;return this.acopioCosechas.forEach(e=>{o+=parseFloat(e.cantidad_kg)}),o.toFixed(2)}},methods:{getDepartamentos(){this.$axios.get("/departamentos").then(({data:o})=>{this.departamentos=o?.data||o||[]}).catch(()=>{this.$q.notify({type:"negative",message:"No se pudieron cargar los departamentos"})})},getMunicipios(){if(!this.departamentoSeleccionado){this.municipios=[];return}this.$axios.get("/municipios",{params:{departamento_id:this.departamentoSeleccionado.value}}).then(({data:o})=>{console.log(o),this.municipios=o?.data||o||[]}).catch(()=>{this.$q.notify({type:"negative",message:"No se pudieron cargar los municipios"})})},filterProductores(o,e,u){if(!o||o.length<2){e(()=>{this.productorOptions=[]});return}e(async()=>{this.loadingProductores=!0;try{const{data:s}=await this.$axios.get("/productores",{params:{search:o,per_page:20}}),b=(s?.data||s||[]).map(n=>({value:n.id,label:`${n.nombre??""} ${n.apellidos??""} — ${n.municipio?.nombre_municipio??""}`.trim(),raw:n}));this.productorOptions=b}catch{this.$q.notify({type:"negative",message:"No se pudo cargar productores"})}finally{this.loadingProductores=!1}})},async productoGet(){this.$axios.get("/productos/tipo/1").then(({data:o})=>{console.log(o),this.productos=o?.data||o||[],this.productos.unshift({id:null,nombre_producto:"Todos"}),this.producto=null}).catch(()=>{this.$q.notify({type:"negative",message:"No se pudieron cargar los productos"})})},async generarExcel(){this.loading=!0,await this.$axios.post("acopioExcel",{fecha_inicio:this.fechaInicio,fecha_fin:this.fechaFin,estado:this.estadoSeleccionado},{responseType:"blob"}).then(o=>{const e=new Blob([o.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),u=window.URL.createObjectURL(e),s=document.createElement("a");s.href=u,s.setAttribute("download","acopio.xlsx"),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(u)}).catch(o=>{this.$alert?.error?.(o.response?.data?.message||"No se pudo generar el reporte.")}).finally(()=>{this.loading=!1})},buscarCosechas(){this.loading=!0,console.log(this.producto),this.$axios.get("/acopio/cosechas",{params:{fecha_inicio:this.fechaInicio,fecha_fin:this.fechaFin,estado:this.estadoSeleccionado,productor_id:this.productor,num_acta:this.numActa,producto_id:this.producto,departamento_id:this.departamentoSeleccionado,municipio_id:this.municipioSeleccionado}}).then(o=>{console.log(o.data),this.acopioCosechas=o.data}).finally(()=>{this.loading=!1})}}},M={class:"row q-gutter-sm"},x={class:"col-12 col-md-2"},L={class:"col-12 col-md-2"},Y={class:"col-12 col-md-3"},q={class:"col-12 col-md-3"},T={class:"col-6 col-md-3"},j={class:"col-12 col-md-3"},R={class:"col-12 col-md-3"},z={class:"col-12 col-md-3"},G={class:"col-12 col-md-2 flex flex-center"},H={class:"col-12 col-md-2 flex flex-center"},X={key:1,class:"text-center q-pa-md"};function J(o,e,u,s,b,n){return r(),p(D,{class:"q-pa-xs"},{default:i(()=>[l(w,null,{default:i(()=>[l(y,null,{default:i(()=>e[10]||(e[10]=[a("div",{class:"text-h6"},"Acopio de Cosechas",-1)])),_:1}),l(k),l(y,null,{default:i(()=>[l(U,{onSubmit:F(n.buscarCosechas,["prevent"])},{default:i(()=>[a("div",M,[a("div",x,[l(h,{modelValue:o.fechaInicio,"onUpdate:modelValue":e[0]||(e[0]=t=>o.fechaInicio=t),label:"Fecha Inicio",type:"date",dense:"",outlined:""},null,8,["modelValue"])]),a("div",L,[l(h,{modelValue:o.fechaFin,"onUpdate:modelValue":e[1]||(e[1]=t=>o.fechaFin=t),label:"Fecha Fin",type:"date",dense:"",outlined:""},null,8,["modelValue"])]),a("div",Y,[l(c,{modelValue:o.estadoSeleccionado,"onUpdate:modelValue":e[2]||(e[2]=t=>o.estadoSeleccionado=t),options:o.estados,label:"Estado de Cosecha",dense:"",outlined:"",clearable:""},null,8,["modelValue","options"])]),a("div",q,[l(c,{modelValue:o.productor,"onUpdate:modelValue":e[3]||(e[3]=t=>o.productor=t),options:o.productorOptions,"option-label":"label","emit-value":"","map-options":"","use-input":"","input-debounce":"400",onFilter:n.filterProductores,label:"Productor",dense:"",outlined:"",loading:o.loadingProductores,clearable:""},{"no-option":i(()=>[l(C,null,{default:i(()=>[l(g,{class:"text-grey"},{default:i(()=>e[11]||(e[11]=[f("Escriba al menos 2 caracteres…")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","loading"])]),a("div",T,[l(c,{modelValue:o.producto,"onUpdate:modelValue":e[4]||(e[4]=t=>o.producto=t),options:o.productos.map(t=>({label:t.nombre_producto,value:t.id})),label:"Producto",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),a("div",j,[l(h,{modelValue:o.numActa,"onUpdate:modelValue":e[5]||(e[5]=t=>o.numActa=t),label:"Número de Acta",type:"text",dense:"",outlined:""},null,8,["modelValue"])]),a("div",R,[l(c,{modelValue:o.departamentoSeleccionado,"onUpdate:modelValue":[e[6]||(e[6]=t=>o.departamentoSeleccionado=t),e[8]||(e[8]=t=>n.getMunicipios())],label:"Departamento",options:o.departamentos.map(t=>({label:t.nombre_departamento,value:t.id})),dense:"",outlined:"",onFocus:e[7]||(e[7]=t=>n.getDepartamentos()),clearable:""},null,8,["modelValue","options"])]),a("div",z,[l(c,{modelValue:o.municipioSeleccionado,"onUpdate:modelValue":e[9]||(e[9]=t=>o.municipioSeleccionado=t),label:"Municipio",options:o.municipios.map(t=>({label:t.nombre_municipio,value:t.id})),dense:"",outlined:"",clearable:""},null,8,["modelValue","options"])]),a("div",G,[l(v,{loading:o.loading,label:"Buscar Cosechas",type:"submit",color:"primary","no-caps":"",icon:"search"},null,8,["loading"])]),a("div",H,[l(v,{loading:o.loading,label:"EXCEL",color:"green",onClick:n.generarExcel},null,8,["loading","onClick"])])])]),_:1},8,["onSubmit"]),o.acopioCosechas.length>0?(r(),p(B,{key:0,dense:"","wrap-cells":"",flat:"",bordered:""},{default:i(()=>[e[14]||(e[14]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",null,"Opciones"),a("th",null,"Fecha Cosecha"),a("th",null,"Productor"),a("th",null,"Cantidad (kg)"),a("th",null,"Humedad (%)"),a("th",null,"Temperatura Almacenaje (°C)"),a("th",null,"Número Acta"),a("th",null,"Condiciones Almacenaje"),a("th",null,"Estado")])],-1)),a("tbody",null,[(r(!0),m(O,null,E(o.acopioCosechas,t=>(r(),m("tr",{key:t.id},[a("td",null,[l(P,{dense:"",label:"Opciones",color:"primary","no-caps":"",size:"10px"},{default:i(()=>[l(_,null,{default:i(()=>[N((r(),p(C,{clickable:"",to:`/acopio/cosechas/${t.id}`},{default:i(()=>[l(g,{avatar:""},{default:i(()=>[l(V,{name:"visibility"})]),_:1}),l(g,null,{default:i(()=>e[12]||(e[12]=[f("Ver Detalles")])),_:1})]),_:2},1032,["to"])),[[$]])]),_:2},1024)]),_:2},1024)]),a("td",null,d(t.fecha_cosecha),1),a("td",null,d(t.apiario?.productor.nombre)+" "+d(t.apiario?.productor.apellidos),1),a("td",null,d(t.cantidad_kg),1),a("td",null,d(t.humedad),1),a("td",null,d(t.temperatura_almacenaje),1),a("td",null,d(t.num_acta),1),a("td",null,d(t.condiciones_almacenaje),1),a("td",null,[l(A,{color:t.estado==="BUENO"?"green":"red","text-color":"white",dense:"",size:"10px"},{default:i(()=>[f(d(t.estado.replace("_"," ")),1)]),_:2},1032,["color"])])]))),128)),a("tr",null,[e[13]||(e[13]=a("th",{colspan:"3"},"TOTAL",-1)),a("td",null,d(n.calculoCosecha),1)])])]),_:1})):(r(),m("div",X,[l(V,{name:"info",size:"48px",color:"grey-5"}),e[15]||(e[15]=a("div",{class:"text-subtitle2 text-grey-5"},"No se encontraron cosechas.",-1))]))]),_:1})]),_:1})]),_:1})}const so=Q(I,[["render",J]]);export{so as default};
