import{Q as b}from"./QBanner-cP-9__3l.js";import{_ as h,c as p,o as f,w as a,a9 as V,b as n,a8 as d,t as u,a as r,af as s,f as g}from"./index-CVF2lFVA.js";import{Q as m}from"./QSelect-DzU8X3-s.js";import{Q as v,b as x}from"./format-BGM6tIaB.js";import{Q as y}from"./QForm-BmHt26se.js";const U={name:"ProductorForm",props:{productor:{type:Object,default:null},tree:{type:Array,default:()=>[]},autoLoadTree:{type:Boolean,default:!0},bannerMsg:{type:String,default:""}},emits:["saved","cancel","error"],data(){return{tipos:["Pequeño Productor","Productor Individual","Organizacion de Productores","Asociacion"],dept:["LPZ","CBB","SCZ","ORU","POT","PND","BEN","TAR","SUC","OTRO"],localTree:[],saving:!1,banner:this.bannerMsg,orgOptions:[],orgLoading:!1,form:this.emptyForm(),sexoOptions:[{label:"Masculino",value:1},{label:"Femenino",value:2}]}},computed:{treeToUse(){return this.tree&&this.tree.length?this.tree:this.localTree},depOptions(){return(this.treeToUse||[]).map(i=>({label:i.nombre_departamento,value:i.id}))},provOptions(){const i=this.form.departamento_id;return i?((this.treeToUse||[]).find(t=>t.id===i)?.provincias||[]).map(t=>({label:t.nombre_provincia,value:t.id})):[]},munOptions(){const i=this.form.departamento_id,o=this.form.provincia_id;return!i||!o?[]:(((this.treeToUse||[]).find(e=>e.id===i)?.provincias||[]).find(e=>e.id===o)?.municipios||[]).map(e=>({label:e.nombre_municipio,value:e.id}))}},watch:{productor:{handler(){this.initFromProp()},immediate:!0}},mounted(){!this.tree?.length&&this.autoLoadTree&&this.loadTree()},methods:{emptyForm(){return{id:null,municipio_id:null,runsa:"0",sub_codigo:"",nombre:"",apellidos:"",numcarnet:"",expedido:"",fec_nacimiento:null,sexo:null,direccion:"",comunidad:"",proveedor:"",cip_acopio:"",num_celular:"",ocupacion:"",otros:"",seleccion:0,organizacion_id:null,fecha_registro:new Date().toISOString().slice(0,10),fecha_expiracion:null,estado:"VIGENTE",departamento_id:null,provincia_id:null}},async loadTree(){try{const{data:i}=await this.$axios.get("geo/tree");this.localTree=i}catch(i){this.$alert?.error?.(i.response?.data?.message||"No se pudo cargar el árbol geográfico")}},initFromProp(){const i=this.productor;if(console.log(i),!i){this.form=this.emptyForm();return}this.form={id:i.id??null,runsa:i.runsa??"0",sub_codigo:i.sub_codigo??"",nombre:i.nombre??"",apellidos:i.apellidos??"",numcarnet:i.numcarnet??"",expedido:i.expedido??"",fec_nacimiento:i.fec_nacimiento??null,sexo:i.sexo??null,direccion:i.direccion??"",comunidad:i.comunidad??"",proveedor:i.proveedor??"",cip_acopio:i.cip_acopio??"",num_celular:i.num_celular??"",ocupacion:i.ocupacion??"",otros:i.otros??"",seleccion:i.seleccion??0,organizacion_id:i.organizacion?.id||i.organizacion_id||null,organizacion:i.organizacion||null,fecha_registro:i.fecha_registro??new Date().toISOString().slice(0,10),fecha_expiracion:i.fecha_expiracion??null,estado:i.estado??"VIGENTE",provincia_id:i.municipio?.provincia_id||null}},onDepChange(){this.form.provincia_id=null,this.form.municipio_id=null},onProvChange(){this.form.municipio_id=null},async filterOrganizaciones(i,o){o(async()=>{this.orgLoading=!0;try{const{data:t}=await this.$axios.get("organizaciones",{params:{search:i||void 0,paginate:!1}});console.log(t),this.orgOptions=Array.isArray(t)?t:t?.data||[]}catch{this.orgOptions=[]}finally{this.orgLoading=!1}})},async submit(){this.saving=!0;try{const i={runsa:this.form.runsa,sub_codigo:this.form.sub_codigo,nombre:this.form.nombre,apellidos:this.form.apellidos,numcarnet:this.form.numcarnet,expedido:this.form.expedido,fec_nacimiento:this.form.fec_nacimiento,sexo:this.form.sexo,direccion:this.form.direccion,comunidad:this.form.comunidad,proveedor:this.form.proveedor,cip_acopio:this.form.cip_acopio,num_celular:this.form.num_celular,ocupacion:this.form.ocupacion,otros:this.form.otros,seleccion:this.form.seleccion,organizacion_id:this.form.organizacion.id,fecha_registro:this.form.fecha_registro,fecha_expiracion:this.form.fecha_expiracion,estado:this.form.estado};let o;this.form.id?o=await this.$axios.put(`productores/${this.form.id}`,i):o=await this.$axios.post("productores",i);const t=o.data;this.form.id||this.$router.push("/productores/editar/"+t.id),this.$alert?.success?.(this.form.id?"Productor actualizado":"Productor creado")}catch(i){const o=i.response?.data?.message||"No se pudo guardar";this.$alert?.error?.(o),this.$emit("error",i)}finally{this.saving=!1}}}},O={class:"row q-col-gutter-sm"},T={class:"col-6 col-sm-2"},z={class:"col-6 col-sm-2"},C={class:"col-12 col-sm-4"},I={class:"col-12 col-sm-4"},P={class:"col-6 col-sm-3"},N={class:"col-6 col-sm-2"},S={class:"col-12 col-sm-3"},w={class:"col-12 col-sm-4"},E={class:"col-12"},F={class:"col-12 col-sm-4"},Q={class:"col-12 col-sm-4"},A={class:"col-12 col-sm-4"},B={class:"col-12 col-sm-4"},D={class:"col-12 col-sm-4"},R={class:"col-12 col-sm-4"},q={class:"col-12 col-sm-4"},L={class:"col-12 col-sm-4"},M={class:"col-12 col-sm-4"},k={class:"col-12 col-sm-4"},G={class:"col-12 col-sm-4"},Z={class:"col-12"},j={class:"text-right q-gutter-sm"};function H(i,o,t,_,e,c){return f(),p(y,{onSubmit:c.submit,class:"q-gutter-md"},{default:a(()=>[e.banner?(f(),p(b,{key:0,class:"bg-yellow-1 text-yellow-10"},{default:a(()=>[d(u(e.banner),1)]),_:1})):V("",!0),n("div",O,[n("div",T,[r(s,{modelValue:e.form.runsa,"onUpdate:modelValue":o[0]||(o[0]=l=>e.form.runsa=l),label:"RUNSA",dense:"",outlined:""},null,8,["modelValue"])]),n("div",z,[r(s,{modelValue:e.form.sub_codigo,"onUpdate:modelValue":o[1]||(o[1]=l=>e.form.sub_codigo=l),label:"Sub Código",dense:"",outlined:""},null,8,["modelValue"])]),n("div",C,[r(s,{modelValue:e.form.nombre,"onUpdate:modelValue":o[2]||(o[2]=l=>e.form.nombre=l),label:"Nombre",dense:"",outlined:"",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"])]),n("div",I,[r(s,{modelValue:e.form.apellidos,"onUpdate:modelValue":o[3]||(o[3]=l=>e.form.apellidos=l),label:"Apellidos",dense:"",outlined:"",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"])]),n("div",P,[r(s,{modelValue:e.form.numcarnet,"onUpdate:modelValue":o[4]||(o[4]=l=>e.form.numcarnet=l),label:"N° Carnet",dense:"",outlined:"",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"])]),n("div",N,[r(m,{modelValue:e.form.expedido,"onUpdate:modelValue":o[5]||(o[5]=l=>e.form.expedido=l),label:"Expedido",dense:"",outlined:"",options:e.dept},null,8,["modelValue","options"])]),n("div",S,[r(s,{modelValue:e.form.fec_nacimiento,"onUpdate:modelValue":o[6]||(o[6]=l=>e.form.fec_nacimiento=l),type:"date",label:"Nacimiento",dense:"",outlined:""},null,8,["modelValue"])]),n("div",w,[r(m,{modelValue:e.form.sexo,"onUpdate:modelValue":o[7]||(o[7]=l=>e.form.sexo=l),options:e.sexoOptions,label:"Sexo",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),n("div",E,[r(s,{modelValue:e.form.direccion,"onUpdate:modelValue":o[8]||(o[8]=l=>e.form.direccion=l),type:"textarea",label:"Dirección",dense:"",outlined:"",autogrow:""},null,8,["modelValue"])]),n("div",F,[r(s,{modelValue:e.form.comunidad,"onUpdate:modelValue":o[9]||(o[9]=l=>e.form.comunidad=l),label:"Comunidad",dense:"",outlined:""},null,8,["modelValue"])]),n("div",Q,[r(s,{modelValue:e.form.cip_acopio,"onUpdate:modelValue":o[10]||(o[10]=l=>e.form.cip_acopio=l),label:"CIP Acopio",dense:"",outlined:""},null,8,["modelValue"])]),n("div",A,[r(s,{modelValue:e.form.num_celular,"onUpdate:modelValue":o[11]||(o[11]=l=>e.form.num_celular=l),label:"Celular",dense:"",outlined:""},null,8,["modelValue"])]),n("div",B,[r(s,{modelValue:e.form.seleccion,"onUpdate:modelValue":o[12]||(o[12]=l=>e.form.seleccion=l),modelModifiers:{number:!0},type:"number",label:"Selección",dense:"",outlined:""},null,8,["modelValue"])]),n("div",D,[r(m,{modelValue:e.form.organizacion,"onUpdate:modelValue":o[13]||(o[13]=l=>e.form.organizacion=l),label:"Organización",dense:"",outlined:"","use-input":"","fill-input":"","input-debounce":"300",options:e.orgOptions,"option-label":"nombre_organiza","emit-value":"","map-options":"",clearable:"",onFilter:c.filterOrganizaciones,loading:e.orgLoading,hint:"Escribe para buscar"},{"no-option":a(()=>[r(v,null,{default:a(()=>[r(x,{class:"text-grey"},{default:a(()=>o[19]||(o[19]=[d("Sin resultados")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","loading"])]),n("div",R,[o[20]||(o[20]=n("b",null,"DEPT:",-1)),d(" "+u(e.form.organizacion?.departamento.nombre_departamento),1)]),n("div",q,[o[21]||(o[21]=n("b",null,"Mun:",-1)),d(" "+u(e.form.organizacion?.municipio.nombre_municipio),1)]),n("div",L,[o[22]||(o[22]=n("b",null,"Prov:",-1)),d(" "+u(e.form.organizacion?.provincia.nombre_provincia),1)]),n("div",M,[r(s,{modelValue:e.form.fecha_registro,"onUpdate:modelValue":o[14]||(o[14]=l=>e.form.fecha_registro=l),type:"date",label:"Fecha Registro",dense:"",outlined:""},null,8,["modelValue"])]),n("div",k,[r(s,{modelValue:e.form.fecha_expiracion,"onUpdate:modelValue":o[15]||(o[15]=l=>e.form.fecha_expiracion=l),type:"date",label:"Fecha Expiración",dense:"",outlined:""},null,8,["modelValue"])]),n("div",G,[r(m,{modelValue:e.form.estado,"onUpdate:modelValue":o[16]||(o[16]=l=>e.form.estado=l),options:["VIGENTE","VENCIDO","ACTIVO","INACTIVO"],label:"Estado",dense:"",outlined:""},null,8,["modelValue"])]),n("div",Z,[r(s,{modelValue:e.form.otros,"onUpdate:modelValue":o[17]||(o[17]=l=>e.form.otros=l),type:"textarea",label:"Otros",dense:"",outlined:"",autogrow:""},null,8,["modelValue"])])]),n("div",j,[r(g,{flat:"",color:"negative",label:"Cancelar",disable:e.saving,onClick:o[18]||(o[18]=l=>i.$emit("cancel"))},null,8,["disable"]),r(g,{color:"primary",label:e.form.id?"Guardar cambios":"Crear productor",type:"submit",loading:e.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])}const $=h(U,[["render",H],["__scopeId","data-v-2df590a4"]]);export{$ as P};
