import{n as q,bb as S,g as U,bc as A,k as h,r as d,a2 as G,s as R,c as z,o as x,w as c,b as s,a,f as C,t as l,ad as V,d as B,Q as F,e as $,u as n,a7 as O,a8 as D,a9 as P,I as j,a1 as E}from"./index-DwGd6QCz.js";import{Q as T}from"./QSpace-DkicH05E.js";import{Q as H}from"./QPage-r_YHzd59.js";import{L as K,m as J,a as W,b as X,i as Y,R as Z,v as p,u as ee,y as ae}from"./marker-shadow-CXoG9aXL.js";function te(){return q(S)}const oe={class:"row items-center q-gutter-sm q-mb-sm"},se={class:"text-h6 text-weight-bold"},re={class:"text-caption q-mb-xs"},le={style:{"min-width":"220px"}},ne={class:"text-subtitle2"},ie={class:"text-caption"},ue={class:"text-caption"},ce={class:"text-caption"},de={class:"text-caption"},pe={class:"text-caption"},ye={__name:"GeoApiariosMap",setup(me){const{proxy:k}=U();K.Icon.Default.mergeOptions({iconRetinaUrl:X,iconUrl:W,shadowUrl:J});const m=A(),Q=te(),N=k.$axios,g=h(()=>Number(m.query?.departamento_id||0)),I=h(()=>m.query?.nombre||""),f=d(7),_=d(null),w=d([-16.290154,-63.588653]),v=d(!1),i=d([]),b=d({search:""}),L=h(()=>{const t=(b.value.search||"").trim().toLowerCase();return t?i.value.filter(o=>(o.productor||"").toLowerCase().includes(t)||(o.municipio||"").toLowerCase().includes(t)||(o.lugar||"").toLowerCase().includes(t)||(o.cip||"").toLowerCase().includes(t)):i.value});function M(t,o){const e=Number(t),u=Number(o);return Number.isFinite(e)&&Number.isFinite(u)&&e>=-90&&e<=90&&u>=-180&&u<=180}async function y(){if(g.value){v.value=!0;try{const{data:t}=await N.get(`geo/departamentos/${g.value}/apiarios`),e=(Array.isArray(t?.apiarios)?t.apiarios:[]).map(r=>({...r,lat:Number(r.lat),lng:Number(r.lng)})).filter(r=>M(r.lat,r.lng));i.value=e,await E();const u=_.value?.leafletObject;if(!u)return;if(i.value.length===0){u.setView(w.value,6);return}if(i.value.length===1){const r=i.value[0];u.setView([r.lat,r.lng],Math.max(f.value,12));return}}catch(t){Q.notify({type:"negative",message:t?.response?.data?.message||"No se pudieron cargar apiarios"})}finally{v.value=!1}}}return G(y),R(()=>m.fullPath,y),(t,o)=>(x(),z(H,{class:"q-pa-md"},{default:c(()=>[s("div",oe,[a(C,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:o[0]||(o[0]=e=>t.$router.back())}),s("div",se," Apiarios — "+l(I.value||"Departamento "+(g.value||"—")),1),a(T),a(V,{modelValue:b.value.search,"onUpdate:modelValue":o[1]||(o[1]=e=>b.value.search=e),dense:"",outlined:"",placeholder:"Buscar productor/municipio...",debounce:"300",style:{"min-width":"260px"}},{append:c(()=>[a(B,{name:"search"})]),_:1},8,["modelValue"]),a(C,{color:"primary",icon:"refresh",label:"Actualizar",loading:v.value,"no-caps":"",onClick:y},null,8,["loading"])]),a(F,{flat:"",bordered:""},{default:c(()=>[a($,null,{default:c(()=>[s("div",re,"Total apiarios: "+l(i.value.length),1),a(n(Y),{style:{height:"70vh"},zoom:f.value,"onUpdate:zoom":o[2]||(o[2]=e=>f.value=e),center:w.value,"use-global-leaflet":!1,options:{attributionControl:!1},ref_key:"mapRef",ref:_},{default:c(()=>[a(n(Z),{position:"topright"}),a(n(p),{"layer-type":"base",name:"OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"© OpenStreetMap contributors",subdomains:["a","b","c"],"max-zoom":19,visible:!1}),a(n(p),{"layer-type":"base",name:"Google Calle",url:"https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}",attribution:"Map data © Google","max-zoom":21,visible:!0}),a(n(p),{"layer-type":"base",name:"Google Satélite",url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",attribution:"Map data © Google","max-zoom":21,visible:!1}),a(n(p),{"layer-type":"base",name:"Google Híbrido",url:"https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}",attribution:"Map data © Google","max-zoom":21,visible:!1}),(x(!0),O(D,null,P(L.value,e=>(x(),z(n(ee),{key:e.id,"lat-lng":[e.lat,e.lng]},{default:c(()=>[a(n(ae),null,{default:c(()=>[s("div",le,[s("div",ne,l(e.productor||"—"),1),s("div",ie,"Municipio: "+l(e.municipio||"—"),1),s("div",ue,"Lugar: "+l(e.lugar||"—"),1),s("div",ce,"CIP: "+l(e.cip||"—"),1),s("div",de,"Estado: "+l(e.estado||"—"),1),a(j,{spaced:""}),s("div",pe,"Lat: "+l(e.lat.toFixed(6))+" | Lng: "+l(e.lng.toFixed(6)),1)])]),_:2},1024)]),_:2},1032,["lat-lng"]))),128))]),_:1},8,["zoom","center"])]),_:1})]),_:1})]),_:1}))}};export{ye as default};
