import{v as f,G as x,J as k,g as w,x as v,j as q,y as Q,_ as C,c as p,o as r,w as d,a as s,b as t,f as u,Q as _,e as S,aa as g,a9 as B,a8 as n,t as i,O as y}from"./index-7y1xTPo0.js";import{Q as N}from"./QImg-BTHiPSX0.js";import{Q as z}from"./QBanner-tFmWzhEI.js";import{Q as D}from"./QPage-BsPoimEa.js";import{Q as P,a as R}from"./QLayout-DZfNX53r.js";import"./QResizeObserver-BDZdvI0v.js";const T=["text","rect","circle","QBtn","QBadge","QChip","QToolbar","QCheckbox","QRadio","QToggle","QSlider","QRange","QInput","QAvatar"],I=["wave","pulse","pulse-x","pulse-y","fade","blink","none"],m=f({name:"QSkeleton",props:{...x,tag:{type:String,default:"div"},type:{type:String,validator:o=>T.includes(o),default:"rect"},animation:{type:String,validator:o=>I.includes(o),default:"wave"},animationSpeed:{type:[String,Number],default:1500},square:Boolean,bordered:Boolean,size:String,width:String,height:String},setup(o,{slots:e}){const c=w(),b=k(o,c.proxy.$q),a=v(()=>{const h=o.size!==void 0?[o.size,o.size]:[o.width,o.height];return{"--q-skeleton-speed":`${o.animationSpeed}ms`,width:h[0],height:h[1]}}),l=v(()=>`q-skeleton q-skeleton--${b.value===!0?"dark":"light"} q-skeleton--type-${o.type}`+(o.animation!=="none"?` q-skeleton--anim q-skeleton--anim-${o.animation}`:"")+(o.square===!0?" q-skeleton--square":"")+(o.bordered===!0?" q-skeleton--bordered":""));return()=>q(o.tag,{class:l.value,style:a.value},Q(e.default))}}),L={name:"QrFront",data(){return{code:this.$route.params.code,cosecha:null,loading:!0,error:null}},computed:{ready(){return!!this.cosecha&&!this.loading&&!this.error},qrUrl(){const e=`${window.location?.origin??""}/qr/${this.code}`;return`https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(e)}&size=200x200`}},methods:{async fetchData(){try{this.loading=!0,this.error=null;const o=`/cosechas/qr/${encodeURIComponent(this.code)}`,{data:e}=await this.$axios.get(o);this.cosecha=e?.data??e}catch{this.error="No se encontró la cosecha o el código es inválido."}finally{this.loading=!1}},fmt(o){if(!o)return"—";try{return new Date(o).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return o}},openMap(o,e){if(!o||!e)return;const c=`https://www.google.com/maps/search/?api=1&query=${o},${e}`;window.open(c,"_blank")},async shareLink(){const o=window.location.href;if(navigator.share)try{await navigator.share({title:"Cosecha",url:o})}catch{}else await navigator.clipboard.writeText(o),this.$q.notify({type:"positive",message:"Enlace copiado al portapapeles"})},printPage(){window.print()}},async created(){await this.fetchData()}},A={class:"row items-center q-mb-md"},U={class:"col-auto"},V={class:"row items-center q-col-gutter-md"},E={class:"col-12 col-md-4 flex flex-center"},F={class:"col-12 col-md-8"},M={key:0},j={key:1},H={key:2},G={class:"text-subtitle1 text-weight-bold q-mb-sm"},J={class:"text-body2"},K={class:"q-mt-sm"},O={class:"text-body2"},W={class:"q-mt-xs"},X={class:"text-body2"};function Y(o,e,c,b,a,l){return r(),p(R,{view:"lHh Lpr lFf"},{default:d(()=>[s(P,null,{default:d(()=>[s(D,{class:"q-pa-md bg-grey-2"},{default:d(()=>[t("div",A,[e[1]||(e[1]=t("div",{class:"col"},[t("div",{class:"text-h6 text-weight-bold"},"Trazabilidad de Cosecha"),t("div",{class:"text-caption text-grey-7"},"Consulta pública vía QR")],-1)),t("div",U,[s(u,{flat:"",round:"",icon:"refresh",onClick:l.fetchData,disable:a.loading},null,8,["onClick","disable"]),s(u,{flat:"",round:"",icon:"share",onClick:l.shareLink,disable:!l.ready},null,8,["onClick","disable"]),s(u,{flat:"",round:"",icon:"print",onClick:l.printPage,disable:!l.ready},null,8,["onClick","disable"])])]),s(_,{flat:"",bordered:""},{default:d(()=>[s(S,null,{default:d(()=>[t("div",V,[t("div",E,[a.loading?(r(),p(m,{key:0,type:"QAvatar",size:"200px"})):(r(),p(N,{key:1,src:l.qrUrl,style:{width:"200px",height:"200px"},alt:"QR cosecha"},null,8,["src"]))]),t("div",F,[a.loading?(r(),g("div",M,[s(m,{type:"text",width:"60%"}),s(m,{type:"text",width:"40%"}),s(m,{type:"text",width:"80%"})])):a.error?(r(),g("div",j,[s(z,{"inline-actions":"",class:"bg-red-1 text-red-9 q-mb-md"},{default:d(()=>[n(i(a.error),1)]),_:1})])):a.cosecha?(r(),g("div",H,[t("div",G,i(a.cosecha.producto?.nombre_producto||"Producto")+" — "+i(a.cosecha.cantidad_kg)+" "+i(a.cosecha.producto?.presentacion||"Kg"),1),t("div",J,[t("div",null,[e[2]||(e[2]=t("b",null,"Fecha cosecha:",-1)),n(" "+i(l.fmt(a.cosecha.fecha_cosecha)),1)]),t("div",null,[e[3]||(e[3]=t("b",null,"Estado:",-1)),n(" "+i(a.cosecha.estado),1)]),t("div",null,[e[4]||(e[4]=t("b",null,"Humedad (%):",-1)),n(" "+i(a.cosecha.humedad),1)]),t("div",null,[e[5]||(e[5]=t("b",null,"Temp. almac. (°C):",-1)),n(" "+i(a.cosecha.temperatura_almacenaje),1)]),t("div",K,[e[6]||(e[6]=t("b",null,"N° acta:",-1)),n(" "+i(a.cosecha.num_acta),1)])]),s(y,{class:"q-my-md"}),t("div",O,[e[10]||(e[10]=t("div",{class:"text-subtitle2 text-weight-bold q-mb-xs"},"Apiario",-1)),t("div",null,[e[7]||(e[7]=t("b",null,"Nombre CIP:",-1)),n(" "+i(a.cosecha.apiario?.nombre_cip),1)]),t("div",null,[e[8]||(e[8]=t("b",null,"Lugar:",-1)),n(" "+i(a.cosecha.apiario?.lugar_apiario),1)]),t("div",null,[e[9]||(e[9]=t("b",null,"Coordenadas:",-1)),n(" "+i(a.cosecha.apiario?.latitud)+", "+i(a.cosecha.apiario?.longitud),1)]),t("div",W,[s(u,{dense:"",outline:"",icon:"map",label:"Ver en mapa",onClick:e[0]||(e[0]=h=>l.openMap(a.cosecha.apiario?.latitud,a.cosecha.apiario?.longitud))})])]),s(y,{class:"q-my-md"}),t("div",X,[e[14]||(e[14]=t("div",{class:"text-subtitle2 text-weight-bold q-mb-xs"},"Productor(a)",-1)),t("div",null,[e[11]||(e[11]=t("b",null,"Nombre:",-1)),n(" "+i(a.cosecha.apiario?.productor?.nombre_completo),1)]),t("div",null,[e[12]||(e[12]=t("b",null,"RUNSA:",-1)),n(" "+i(a.cosecha.apiario?.productor?.runsa),1)]),t("div",null,[e[13]||(e[13]=t("b",null,"Municipio:",-1)),n(" "+i(a.cosecha.apiario?.municipio?.nombre_municipio),1)])])])):B("",!0)])])]),_:1})]),_:1}),e[15]||(e[15]=t("div",{class:"q-mt-md text-center text-caption text-grey-7"}," Esta es una vista pública de verificación de trazabilidad. ",-1))]),_:1})]),_:1})]),_:1})}const ie=C(L,[["render",Y]]);export{ie as default};
