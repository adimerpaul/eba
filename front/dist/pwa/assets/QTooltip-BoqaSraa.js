import{Q as z}from"./QSpace-BL4iU9Lh.js";import{_ as j,c as A,o as u,w as n,b as l,a as o,f as v,aa as _,a9 as M,ab as F,ac as R,t as d,P as x,d as T,a8 as h,ad as H,h as W,Q as J,e as O,O as D,ag as c,a7 as k,v as Re,aB as Z,F as je,aJ as Be,H as Ge,g as He,r as se,x as Q,aK as Ze,a3 as We,aC as Je,L as Ke,aL as Xe,p as re,m as de,V as ue,Z as me,aM as Ye,j as ce,T as $e,y as et,S as tt}from"./index-7y1xTPo0.js";import{Q as L,b as g,d as K,v as ot,e as pe,u as lt,p as fe,f as it,g as at,i as nt,r as he,s as st}from"./format-DML4119o.js";import{Q as X}from"./QList-De_fUt_D.js";import{Q as Y}from"./QBtnDropdown-DLL_ZlIs.js";import{Q as $}from"./QMarkupTable-DKld9FxK.js";import{Q as I}from"./QSelect-DyaU-PEd.js";import{Q as ee}from"./QForm-DbcSivmX.js";import{C as V}from"./ClosePopup-CznOxToL.js";import{R as _e,y as ye,u as be,v as ve,i as Ce,L as P,m as xe,a as Ve,b as Ae}from"./marker-shadow-DxHq-62P.js";import{Q as rt}from"./QBadge-BsdSWJUE.js";import{c as ge}from"./selection-DMQW0dhV.js";const dt={name:"ProductorCertificaciones",props:{productor:{type:Object,required:!0}},emits:["updated"],data(){return{loading:!1,saving:!1,dlg:{open:!1},form:this.emptyForm(),tipoOptions:["ORGANICO","COMERCIO_JUSTO","DENOMINACION_ORIGEN","BUENAS_PRACTICAS"]}},methods:{emptyForm(){return{id:null,productor_id:this.productor?.id||null,tipo_certificacion:null,organismo_certificador:"",fecha_emision:null,fecha_vencimiento:null,certificado_url:"",estado:"VIGENTE"}},chip(t){return t==="VIGENTE"?"green":t==="VENCIDO"?"red":t==="SUSPENDIDO"?"orange":"grey"},shortUrl(t){try{return t&&t.length>40?t.slice(0,40)+"…":t||"-"}catch{return t||"-"}},startCreate(){this.form=this.emptyForm(),this.form.productor_id=this.productor?.id||null,this.dlg.open=!0},startEdit(t){this.form={id:t.id,productor_id:this.productor?.id||t.productor_id,tipo_certificacion:t.tipo_certificacion||null,organismo_certificador:t.organismo_certificador||"",fecha_emision:t.fecha_emision||null,fecha_vencimiento:t.fecha_vencimiento||null,certificado_url:t.certificado_url||"",estado:t.estado||"VIGENTE"},this.dlg.open=!0},async submit(){if(this.productor?.id){this.saving=!0;try{const t={...this.form,productor_id:this.productor.id};t.id?await this.$axios.put(`certificaciones/${t.id}`,t):await this.$axios.post("certificaciones",t),this.$alert?.success?.(t.id?"Certificación actualizada":"Certificación creada"),this.dlg.open=!1,this.$emit("updated")}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo guardar")}finally{this.saving=!1}}},remove(t){this.$alert?.dialog?.("¿Eliminar certificación?")?.onOk(async()=>{try{await this.$axios.delete(`certificaciones/${t.id}`),this.$alert?.success?.("Eliminado"),this.$emit("updated")}catch(e){this.$alert?.error?.(e.response?.data?.message||"No se pudo eliminar")}})},async printPdf(t){this.$axios.get(`certificaciones/${t.id}/print`,{responseType:"blob"}).then(e=>{let m=`certificacion_${t.id}.pdf`;const y=e.headers["content-disposition"];if(y){const r=y.match(/filename="?([^"]+)"?/i);r&&r[1]&&(m=r[1])}const i=new Blob([e.data],{type:"application/pdf"}),s=document.createElement("a");s.href=URL.createObjectURL(i),s.download=m,document.body.appendChild(s),s.click(),URL.revokeObjectURL(s.href),document.body.removeChild(s)}).catch(e=>{this.$alert?.error?.(e.response?.data?.message||"No se pudo generar el PDF")})}}},ut={class:"row items-center q-gutter-sm q-mb-sm"},mt=["href"],ct={key:1},pt={key:0},ft={class:"text-h6"},ht={class:"col-12 col-sm-4"},gt={class:"col-12 col-sm-8"},_t={class:"col-6 col-sm-3"},yt={class:"col-6 col-sm-3"},bt={class:"col-12 col-sm-3"},vt={class:"col-12"},Ct={class:"col-12 text-right q-gutter-sm q-mt-sm"};function xt(t,e,m,y,i,s){return u(),A(O,null,{default:n(()=>[l("div",ut,[e[7]||(e[7]=l("div",{class:"text-subtitle1"},"Certificaciones",-1)),o(z),o(v,{dense:"",color:"primary",icon:"add_circle",label:"Nueva",onClick:s.startCreate,disable:i.saving,"no-caps":""},null,8,["onClick","disable"])]),o($,{dense:""},{default:n(()=>[e[12]||(e[12]=l("thead",null,[l("tr",{class:"bg-grey-3"},[l("th",{class:"text-left"},"#"),l("th",{class:"text-left",style:{width:"120px"}},"Opciones"),l("th",{class:"text-left"},"Tipo"),l("th",{class:"text-left"},"Organismo"),l("th",{class:"text-left"},"Emisión"),l("th",{class:"text-left"},"Vencimiento"),l("th",{class:"text-left"},"Estado"),l("th",{class:"text-left"},"URL")])],-1)),l("tbody",null,[(u(!0),_(F,null,R(m.productor?.certificaciones||[],(r,a)=>(u(),_("tr",{key:r.id||a},[l("td",null,d(a+1),1),l("td",null,[o(Y,{dense:"",label:"Opciones",color:"primary","no-caps":"",size:"10px"},{default:n(()=>[o(X,null,{default:n(()=>[x((u(),A(L,{clickable:"",onClick:p=>s.startEdit(r)},{default:n(()=>[o(g,{avatar:""},{default:n(()=>[o(T,{name:"edit"})]),_:1}),o(g,null,{default:n(()=>e[8]||(e[8]=[h("Editar")])),_:1})]),_:2},1032,["onClick"])),[[H],[V]]),x((u(),A(L,{clickable:"",onClick:p=>s.remove(r)},{default:n(()=>[o(g,{avatar:""},{default:n(()=>[o(T,{name:"delete",class:"text-negative"})]),_:1}),o(g,{class:"text-negative"},{default:n(()=>e[9]||(e[9]=[h("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[H],[V]]),x((u(),A(L,{clickable:"",onClick:p=>s.printPdf(r)},{default:n(()=>[o(g,{avatar:""},{default:n(()=>[o(T,{name:"picture_as_pdf"})]),_:1}),o(g,null,{default:n(()=>e[10]||(e[10]=[h("Imprimir")])),_:1})]),_:2},1032,["onClick"])),[[H],[V]])]),_:2},1024)]),_:2},1024)]),l("td",null,d(r.tipo_certificacion||"-"),1),l("td",null,d(r.organismo_certificador||"-"),1),l("td",null,d(r.fecha_emision||"-"),1),l("td",null,d(r.fecha_vencimiento||"-"),1),l("td",null,[o(K,{color:s.chip(r.estado),"text-color":"white",size:"xs",class:"text-bold"},{default:n(()=>[h(d(r.estado),1)]),_:2},1032,["color"])]),l("td",null,[r.certificado_url?(u(),_("a",{key:0,href:r.certificado_url,target:"_blank"},d(s.shortUrl(r.certificado_url)),9,mt)):(u(),_("span",ct,"-"))])]))),128)),!i.loading&&(m.productor?.certificaciones?.length||0)===0?(u(),_("tr",pt,e[11]||(e[11]=[l("td",{colspan:"8",class:"text-center text-grey"},"Sin registros",-1)]))):M("",!0)])]),_:1}),o(W,{modelValue:i.dlg.open,"onUpdate:modelValue":e[6]||(e[6]=r=>i.dlg.open=r),persistent:""},{default:n(()=>[o(J,{style:{"min-width":"720px","max-width":"95vw"}},{default:n(()=>[o(O,{class:"row items-center q-gutter-sm"},{default:n(()=>[l("div",ft,d(i.form.id?"Editar certificación":"Nueva certificación"),1),o(z),x(o(v,{flat:"",round:"",dense:"",icon:"close"},null,512),[[V]])]),_:1}),o(D),o(O,null,{default:n(()=>[o(ee,{onSubmit:s.submit,class:"row q-col-gutter-sm"},{default:n(()=>[l("div",ht,[o(I,{modelValue:i.form.tipo_certificacion,"onUpdate:modelValue":e[0]||(e[0]=r=>i.form.tipo_certificacion=r),options:i.tipoOptions,dense:"",outlined:"",label:"Tipo",rules:[r=>!!r||"Requerido"]},null,8,["modelValue","options","rules"])]),l("div",gt,[o(c,{modelValue:i.form.organismo_certificador,"onUpdate:modelValue":e[1]||(e[1]=r=>i.form.organismo_certificador=r),dense:"",outlined:"",label:"Organismo certificador"},null,8,["modelValue"])]),l("div",_t,[o(c,{modelValue:i.form.fecha_emision,"onUpdate:modelValue":e[2]||(e[2]=r=>i.form.fecha_emision=r),type:"date",dense:"",outlined:"",label:"Emisión"},null,8,["modelValue"])]),l("div",yt,[o(c,{modelValue:i.form.fecha_vencimiento,"onUpdate:modelValue":e[3]||(e[3]=r=>i.form.fecha_vencimiento=r),type:"date",dense:"",outlined:"",label:"Vencimiento"},null,8,["modelValue"])]),l("div",bt,[o(I,{modelValue:i.form.estado,"onUpdate:modelValue":e[4]||(e[4]=r=>i.form.estado=r),options:["VIGENTE","VENCIDO","SUSPENDIDO"],dense:"",outlined:"",label:"Estado"},null,8,["modelValue"])]),l("div",vt,[o(c,{modelValue:i.form.certificado_url,"onUpdate:modelValue":e[5]||(e[5]=r=>i.form.certificado_url=r),dense:"",outlined:"",label:"URL certificado (opcional)"},null,8,["modelValue"])]),l("div",Ct,[x(o(v,{flat:"",color:"grey",label:"Cancelar",disable:i.saving},null,8,["disable"]),[[V]]),o(v,{color:"primary",label:i.form.id?"Guardar cambios":"Crear",type:"submit",loading:i.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Oo=j(dt,[["render",xt]]);delete P.Icon.Default.prototype._getIconUrl;P.Icon.Default.mergeOptions({iconRetinaUrl:Ae,iconUrl:Ve,shadowUrl:xe});const Vt={name:"ApiarioMap",components:{LMap:Ce,LTileLayer:ve,LMarker:be,LPopup:ye,LControlLayers:_e},props:{modelValue:{type:Object,default:()=>({latitud:null,longitud:null})},center:{type:Array,default:()=>[-16.5,-68.15]},zoomInit:{type:Number,default:14}},emits:["update:modelValue"],data(){return{zoom:this.zoomInit,local:{...this.modelValue},mapOptions:{zoomControl:!0,attributionControl:!1,zoomAnimation:!1,fadeAnimation:!1,markerZoomAnimation:!1}}},computed:{hasLatLng(){const{latitud:t,longitud:e}=this.local;return t!=null&&e!=null&&isFinite(t)&&isFinite(e)},mapCenter(){return this.hasLatLng?[Number(this.local.latitud),Number(this.local.longitud)]:this.center},mapObj(){return this.$refs.map?.leafletObject||null}},watch:{modelValue:{deep:!0,handler(t){t&&(t.latitud!==this.local.latitud||t.longitud!==this.local.longitud)&&(this.local={...t},this.$nextTick(()=>this.refresh()))}},local:{deep:!0,handler(t){const e={...this.modelValue,latitud:t.latitud??null,longitud:t.longitud??null};this.$emit("update:modelValue",e)}}},mounted(){this.$nextTick(()=>this.refresh())},methods:{fix(t){const e=Number(t);return isFinite(e)?e.toFixed(6):"-"},refresh(){const t=this.mapObj;t&&setTimeout(()=>{t.invalidateSize(),this.hasLatLng&&t.setView([Number(this.local.latitud),Number(this.local.longitud)],Math.max(t.getZoom()||this.zoom,15),{animate:!1})},60)},onMapClick(t){const{lat:e,lng:m}=t.latlng||{};e==null||m==null||(this.local.latitud=Number(e.toFixed(7)),this.local.longitud=Number(m.toFixed(7)),this.flyToLatLng())},onDragEnd(t){const e=t?.target?.getLatLng?.();e&&(this.local.latitud=Number(e.lat.toFixed(7)),this.local.longitud=Number(e.lng.toFixed(7)),this.flyToLatLng())},flyToLatLng(){const t=this.mapObj;!t||!this.hasLatLng||t.setView([Number(this.local.latitud),Number(this.local.longitud)],Math.max(t.getZoom()||this.zoom,16),{animate:!1})},locateMe(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(t=>{this.local.latitud=Number(t.coords.latitude.toFixed(7)),this.local.longitud=Number(t.coords.longitude.toFixed(7)),this.$nextTick(()=>this.flyToLatLng())})}}},At={class:"map-wrapper"},kt={class:"row items-center q-col-gutter-sm q-mb-sm"},wt={class:"col-6 col-sm-3"},Ot={class:"col-6 col-sm-3"},Tt={class:"col-6 col-sm-3"},Lt={class:"col-6 col-sm-3"};function Et(t,e,m,y,i,s){const r=k("l-control-layers"),a=k("l-tile-layer"),p=k("l-popup"),C=k("l-marker"),N=k("l-map");return u(),_("div",At,[l("div",kt,[l("div",wt,[o(c,{modelValue:i.local.latitud,"onUpdate:modelValue":e[0]||(e[0]=f=>i.local.latitud=f),modelModifiers:{number:!0},dense:"",outlined:"",label:"Latitud"},null,8,["modelValue"])]),l("div",Ot,[o(c,{modelValue:i.local.longitud,"onUpdate:modelValue":e[1]||(e[1]=f=>i.local.longitud=f),modelModifiers:{number:!0},dense:"",outlined:"",label:"Longitud"},null,8,["modelValue"])]),l("div",Tt,[o(v,{dense:"","no-caps":"",color:"primary",icon:"place",label:"Ir a lat/lng",onClick:s.flyToLatLng,style:{width:"100%"}},null,8,["onClick"])]),l("div",Lt,[o(v,{dense:"","no-caps":"",color:"secondary",icon:"my_location",label:"Mi ubicación",onClick:s.locateMe,style:{width:"100%"}},null,8,["onClick"])])]),o(N,{ref:"map",zoom:i.zoom,center:s.mapCenter,options:i.mapOptions,style:{height:"360px","border-radius":"8px",overflow:"hidden"},onClick:s.onMapClick},{default:n(()=>[o(r,{position:"topright"}),o(a,{"layer-type":"base",name:"OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","max-zoom":19,visible:!0}),o(a,{"layer-type":"base",name:"Google Calle",url:"https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),o(a,{"layer-type":"base",name:"Google Satélite",url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),o(a,{"layer-type":"base",name:"Google Híbrido",url:"https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),s.hasLatLng?(u(),A(C,{key:0,"lat-lng":[Number(i.local.latitud),Number(i.local.longitud)],draggable:!0,onDragend:s.onDragEnd},{default:n(()=>[o(p,null,{default:n(()=>[l("div",null,[h("Lat: "+d(s.fix(i.local.latitud)),1),e[2]||(e[2]=l("br",null,null,-1)),h("Lng: "+d(s.fix(i.local.longitud)),1)])]),_:1})]),_:1},8,["lat-lng","onDragend"])):M("",!0)]),_:1},8,["zoom","center","options","onClick"])])}const Nt=j(Vt,[["render",Et],["__scopeId","data-v-253e10b2"]]),St={name:"ProductorApiarios",components:{ApiarioMap:Nt},props:{productor:{type:Object,required:!0}},emits:["updated"],data(){return{loading:!1,saving:!1,list:[],dlgApiario:{open:!1},formApiario:this.emptyApiario(),dlgColmena:{open:!1},currentApiario:null,colmenas:[],colLoading:!1,formColmena:this.emptyColmena(),tipoMielOptions:[]}},mounted(){this.hydrateFromProductor()},watch:{productor(){this.hydrateFromProductor()}},methods:{hydrateFromProductor(){this.productor?.apiarios?this.list=this.productor.apiarios:this.fetchApiarios()},async fetchApiarios(){this.loading=!0;try{const{data:t}=await this.$axios.get("apiarios",{params:{productor_id:this.productor.id,paginate:!1}});this.list=Array.isArray(t)?t:t?.data||[]}catch(t){this.list=[],this.$alert?.error?.(t.response?.data?.message||"No se pudo cargar apiarios")}finally{this.loading=!1}},emptyApiario(){return{id:null,productor_id:this.productor?.id||null,municipio_id:null,nombre_cip:"",latitud:null,longitud:null,altitud:null,lugar_apiario:"",numero_colmenas_runsa:null,numero_colmenas_prod:0,seleccion:0,rend_programa_nal:0,organizacion_id:0,fecha_instalacion:null,estado:"ACTIVO",fase:"",coordenada:""}},startCreate(){this.formApiario=this.emptyApiario(),this.dlgApiario.open=!0},startEdit(t){this.formApiario={...this.emptyApiario(),...t,productor_id:this.productor?.id||t.productor_id},this.dlgApiario.open=!0},onApiarioDialogShow(){this.$nextTick(()=>this.$refs.apiarioMap?.refresh())},async saveApiario(){this.saving=!0;try{const t={...this.formApiario,productor_id:this.productor.id};t.id?await this.$axios.put(`apiarios/${t.id}`,t):await this.$axios.post("apiarios",t),this.$alert?.success?.(t.id?"Apiario actualizado":"Apiario creado"),this.dlgApiario.open=!1,this.$emit("updated"),await this.fetchApiarios()}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo guardar apiario")}finally{this.saving=!1}},emptyColmena(){return{id:null,apiario_id:null,tipo_miel_id:null,codigo_colmena:"",tipo_colmena:"",fecha_instalacion:null,reina_fecha_nacimiento:null,reina_procedencia:"",estado:"ACTIVA"}},async openColmenas(t){this.currentApiario=t,this.dlgColmena.open=!0,await this.fetchTipoMiel(),await this.fetchColmenas()},async removeApiario(t){this.$alert?.dialog?.("¿Eliminar apiario?")?.onOk(async()=>{try{await this.$axios.delete(`apiarios/${t.id}`),this.$alert?.success?.("Apiario eliminado"),await this.fetchApiarios()}catch(e){this.$alert?.error?.(e.response?.data?.message||"No se pudo eliminar apiario")}})},async fetchTipoMiel(){try{const{data:t}=await this.$axios.get("tipo-miel");this.tipoMielOptions=Array.isArray(t)?t:t?.data||[]}catch{this.tipoMielOptions=[]}},async fetchColmenas(){if(this.currentApiario?.id){this.colLoading=!0;try{const{data:t}=await this.$axios.get("colmenas",{params:{apiario_id:this.currentApiario.id,paginate:!1}});this.colmenas=Array.isArray(t)?t:t?.data||[]}catch(t){this.colmenas=[],this.$alert?.error?.(t.response?.data?.message||"No se pudieron cargar colmenas")}finally{this.colLoading=!1}}},startCreateColmena(){this.formColmena=this.emptyColmena(),this.formColmena.apiario_id=this.currentApiario?.id||null},startEditColmena(t){this.formColmena={...this.emptyColmena(),...t,apiario_id:this.currentApiario?.id||t.apiario_id}},resetColmena(){this.startCreateColmena()},async saveColmena(){this.saving=!0;try{const t={...this.formColmena,apiario_id:this.currentApiario.id};t.id?await this.$axios.put(`colmenas/${t.id}`,t):await this.$axios.post("colmenas",t),this.$alert?.success?.(t.id?"Colmena actualizada":"Colmena creada"),await this.fetchColmenas(),this.$emit("updated")}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo guardar colmena")}finally{this.saving=!1}},removeColmena(t){this.$alert?.dialog?.("¿Eliminar colmena?")?.onOk(async()=>{try{await this.$axios.delete(`colmenas/${t.id}`),this.$alert?.success?.("Eliminado"),await this.fetchColmenas(),this.$emit("updated")}catch(e){this.$alert?.error?.(e.response?.data?.message||"No se pudo eliminar")}})}}},Ut={class:"row items-center q-gutter-sm q-mb-sm"},zt={key:0},It={key:1},Mt={key:0},Pt={class:"text-h6"},qt={class:"col-12 col-sm-4"},Qt={class:"col-12 col-sm-8"},Dt={class:"col-6 col-sm-2"},Ft={class:"col-6 col-sm-2"},Rt={class:"col-12 col-sm-2"},jt={class:"col-12"},Bt={class:"col-6 col-sm-3"},Gt={class:"col-6 col-sm-3"},Ht={class:"col-6 col-sm-3"},Zt={class:"col-6 col-sm-3"},Wt={class:"col-12 text-right q-gutter-sm q-mt-sm"},Jt={class:"text-h6"},Kt={key:0},Xt={class:"text-subtitle2 q-mb-sm"},Yt={class:"col-12 col-sm-3"},$t={class:"col-12 col-sm-3"},eo={class:"col-12 col-sm-3"},to={class:"col-12 col-sm-3"},oo={class:"col-12 col-sm-4"},lo={class:"col-12 col-sm-4"},io={class:"col-12 col-sm-4"},ao={class:"col-12 text-right q-gutter-sm"};function no(t,e,m,y,i,s){const r=k("ApiarioMap");return u(),A(O,null,{default:n(()=>[l("div",Ut,[e[19]||(e[19]=l("div",{class:"text-subtitle1"},"Apiarios",-1)),o(z),o(v,{dense:"",color:"primary",icon:"add_circle",label:"Nuevo","no-caps":"",onClick:s.startCreate,disable:i.saving},null,8,["onClick","disable"])]),o($,{dense:""},{default:n(()=>[e[24]||(e[24]=l("thead",null,[l("tr",{class:"bg-grey-3"},[l("th",{class:"text-left"},"#"),l("th",{class:"text-left"},"Opciones"),l("th",{class:"text-left"},"Nombre/CIP"),l("th",{class:"text-left"},"Lugar"),l("th",{class:"text-left"},"Ubicación"),l("th",{class:"text-left"},"Colmenas"),l("th",{class:"text-left"},"Estado"),l("th",{class:"text-left"},"Instalación")])],-1)),l("tbody",null,[(u(!0),_(F,null,R(i.list,(a,p)=>(u(),_("tr",{key:a.id},[l("td",null,d(p+1),1),l("td",null,[o(Y,{dense:"",label:"Opciones","no-caps":"",color:"primary",size:"10px"},{default:n(()=>[o(X,null,{default:n(()=>[x((u(),A(L,{clickable:"",onClick:C=>s.startEdit(a)},{default:n(()=>[o(g,{avatar:""},{default:n(()=>[o(T,{name:"edit"})]),_:1}),o(g,null,{default:n(()=>e[20]||(e[20]=[h("Editar")])),_:1})]),_:2},1032,["onClick"])),[[V]]),x((u(),A(L,{clickable:"",onClick:C=>s.openColmenas(a)},{default:n(()=>[o(g,{avatar:""},{default:n(()=>[o(T,{name:"hive"})]),_:1}),o(g,null,{default:n(()=>e[21]||(e[21]=[h("Colmenas")])),_:1})]),_:2},1032,["onClick"])),[[V]]),x((u(),A(L,{clickable:"",onClick:C=>s.removeApiario(a)},{default:n(()=>[o(g,{avatar:""},{default:n(()=>[o(T,{class:"text-negative",name:"delete"})]),_:1}),o(g,{class:"text-negative"},{default:n(()=>e[22]||(e[22]=[h("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[V]])]),_:2},1024)]),_:2},1024)]),l("td",null,d(a.nombre_cip||"-"),1),l("td",null,d(a.lugar_apiario||"-"),1),l("td",null,[a.latitud&&a.longitud?(u(),_("span",zt,d(a.latitud.toFixed?a.latitud.toFixed(6):a.latitud)+", "+d(a.longitud.toFixed?a.longitud.toFixed(6):a.longitud),1)):(u(),_("span",It,"-"))]),l("td",null,d((a.colmenas?a.colmenas.length:a.colmenas_count)??0),1),l("td",null,[o(K,{color:a.estado==="ACTIVO"?"green":"grey","text-color":"white",size:"xs",class:"text-bold"},{default:n(()=>[h(d(a.estado),1)]),_:2},1032,["color"])]),l("td",null,d(a.fecha_instalacion||"-"),1)]))),128)),!i.loading&&i.list.length===0?(u(),_("tr",Mt,e[23]||(e[23]=[l("td",{colspan:"8",class:"text-center text-grey"},"Sin registros",-1)]))):M("",!0)])]),_:1}),o(W,{modelValue:i.dlgApiario.open,"onUpdate:modelValue":e[10]||(e[10]=a=>i.dlgApiario.open=a),persistent:"","transition-show":"none","transition-hide":"none",onShow:s.onApiarioDialogShow},{default:n(()=>[o(J,{style:{"min-width":"900px","max-width":"95vw"}},{default:n(()=>[o(O,{class:"row items-center q-gutter-sm"},{default:n(()=>[l("div",Pt,d(i.formApiario.id?"Editar apiario":"Nuevo apiario"),1),o(z),x(o(v,{flat:"",round:"",dense:"",icon:"close"},null,512),[[V]])]),_:1}),o(D),o(O,null,{default:n(()=>[o(ee,{onSubmit:s.saveApiario,class:"row q-col-gutter-sm"},{default:n(()=>[l("div",qt,[o(c,{modelValue:i.formApiario.nombre_cip,"onUpdate:modelValue":e[0]||(e[0]=a=>i.formApiario.nombre_cip=a),label:"Nombre / CIP",dense:"",outlined:""},null,8,["modelValue"])]),l("div",Qt,[o(c,{modelValue:i.formApiario.lugar_apiario,"onUpdate:modelValue":e[1]||(e[1]=a=>i.formApiario.lugar_apiario=a),label:"Lugar del apiario",dense:"",outlined:""},null,8,["modelValue"])]),l("div",Dt,[o(c,{modelValue:i.formApiario.altitud,"onUpdate:modelValue":e[2]||(e[2]=a=>i.formApiario.altitud=a),modelModifiers:{number:!0},label:"Altitud (msnm)",dense:"",outlined:""},null,8,["modelValue"])]),l("div",Ft,[o(c,{modelValue:i.formApiario.fecha_instalacion,"onUpdate:modelValue":e[3]||(e[3]=a=>i.formApiario.fecha_instalacion=a),type:"date",label:"Instalación",dense:"",outlined:""},null,8,["modelValue"])]),l("div",Rt,[o(I,{modelValue:i.formApiario.estado,"onUpdate:modelValue":e[4]||(e[4]=a=>i.formApiario.estado=a),options:["ACTIVO","INACTIVO"],label:"Estado",dense:"",outlined:""},null,8,["modelValue"])]),l("div",jt,[o(r,{ref:"apiarioMap",modelValue:i.formApiario,"onUpdate:modelValue":e[5]||(e[5]=a=>i.formApiario=a),center:[-16.5,-68.15],"zoom-init":14},null,8,["modelValue"])]),l("div",Bt,[o(c,{modelValue:i.formApiario.numero_colmenas_runsa,"onUpdate:modelValue":e[6]||(e[6]=a=>i.formApiario.numero_colmenas_runsa=a),modelModifiers:{number:!0},type:"number",label:"Colmenas RUNSA",dense:"",outlined:""},null,8,["modelValue"])]),l("div",Gt,[o(c,{modelValue:i.formApiario.numero_colmenas_prod,"onUpdate:modelValue":e[7]||(e[7]=a=>i.formApiario.numero_colmenas_prod=a),modelModifiers:{number:!0},type:"number",label:"Colmenas PROD.",dense:"",outlined:""},null,8,["modelValue"])]),l("div",Ht,[o(c,{modelValue:i.formApiario.rend_programa_nal,"onUpdate:modelValue":e[8]||(e[8]=a=>i.formApiario.rend_programa_nal=a),modelModifiers:{number:!0},type:"number",step:"0.01",label:"Rend. prog. nal",dense:"",outlined:""},null,8,["modelValue"])]),l("div",Zt,[o(c,{modelValue:i.formApiario.seleccion,"onUpdate:modelValue":e[9]||(e[9]=a=>i.formApiario.seleccion=a),modelModifiers:{number:!0},type:"number",label:"Selección",dense:"",outlined:""},null,8,["modelValue"])]),l("div",Wt,[x(o(v,{flat:"",color:"grey",label:"Cancelar",disable:i.saving},null,8,["disable"]),[[V]]),o(v,{color:"primary",label:i.formApiario.id?"Guardar cambios":"Crear",type:"submit",loading:i.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue","onShow"]),o(W,{modelValue:i.dlgColmena.open,"onUpdate:modelValue":e[18]||(e[18]=a=>i.dlgColmena.open=a),persistent:"","transition-show":"none","transition-hide":"none"},{default:n(()=>[o(J,{style:{"min-width":"900px","max-width":"95vw"}},{default:n(()=>[o(O,{class:"row items-center q-gutter-sm"},{default:n(()=>[l("div",Jt,"Colmenas — "+d(i.currentApiario?.nombre_cip||"Apiario #"+i.currentApiario?.id),1),o(z),o(v,{dense:"",color:"primary",icon:"add_circle",label:"Nueva colmena","no-caps":"",onClick:s.startCreateColmena},null,8,["onClick"]),x(o(v,{flat:"",round:"",dense:"",icon:"close"},null,512),[[V]])]),_:1}),o(D),o(O,null,{default:n(()=>[o($,{dense:""},{default:n(()=>[e[28]||(e[28]=l("thead",null,[l("tr",{class:"bg-grey-3"},[l("th",null,"#"),l("th",null,"Opc."),l("th",null,"Código"),l("th",null,"Tipo"),l("th",null,"Tipo miel"),l("th",null,"Instalación"),l("th",null,"Reina nacimiento"),l("th",null,"Estado")])],-1)),l("tbody",null,[(u(!0),_(F,null,R(i.colmenas,(a,p)=>(u(),_("tr",{key:a.id||p},[l("td",null,d(p+1),1),l("td",null,[o(Y,{dense:"","no-caps":"",size:"10px",label:"Opciones",color:"primary"},{default:n(()=>[o(X,null,{default:n(()=>[x((u(),A(L,{clickable:"",onClick:C=>s.startEditColmena(a)},{default:n(()=>[o(g,{avatar:""},{default:n(()=>[o(T,{name:"edit"})]),_:1}),o(g,null,{default:n(()=>e[25]||(e[25]=[h("Editar")])),_:1})]),_:2},1032,["onClick"])),[[V]]),x((u(),A(L,{clickable:"",onClick:C=>s.removeColmena(a)},{default:n(()=>[o(g,{avatar:""},{default:n(()=>[o(T,{class:"text-negative",name:"delete"})]),_:1}),o(g,{class:"text-negative"},{default:n(()=>e[26]||(e[26]=[h("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[V]])]),_:2},1024)]),_:2},1024)]),l("td",null,d(a.codigo_colmena||"-"),1),l("td",null,d(a.tipo_colmena||"-"),1),l("td",null,d(a.tipo_miel?.tipo_miel||a.tipoMiel?.tipo_miel||"-"),1),l("td",null,d(a.fecha_instalacion||"-"),1),l("td",null,d(a.reina_fecha_nacimiento||"-"),1),l("td",null,[o(K,{color:a.estado==="ACTIVA"?"green":"grey","text-color":"white",size:"xs"},{default:n(()=>[h(d(a.estado),1)]),_:2},1032,["color"])])]))),128)),!i.colLoading&&i.colmenas.length===0?(u(),_("tr",Kt,e[27]||(e[27]=[l("td",{colspan:"8",class:"text-center text-grey"},"Sin colmenas",-1)]))):M("",!0)])]),_:1}),o(D,{class:"q-my-md"}),l("div",Xt,d(i.formColmena.id?"Editar colmena":"Nueva colmena"),1),o(ee,{onSubmit:s.saveColmena,class:"row q-col-gutter-sm"},{default:n(()=>[l("div",Yt,[o(c,{modelValue:i.formColmena.codigo_colmena,"onUpdate:modelValue":e[11]||(e[11]=a=>i.formColmena.codigo_colmena=a),dense:"",outlined:"",label:"Código"},null,8,["modelValue"])]),l("div",$t,[o(c,{modelValue:i.formColmena.tipo_colmena,"onUpdate:modelValue":e[12]||(e[12]=a=>i.formColmena.tipo_colmena=a),dense:"",outlined:"",label:"Tipo colmena"},null,8,["modelValue"])]),l("div",eo,[o(I,{modelValue:i.formColmena.tipo_miel_id,"onUpdate:modelValue":e[13]||(e[13]=a=>i.formColmena.tipo_miel_id=a),options:i.tipoMielOptions,"option-value":"id","option-label":"tipo_miel","emit-value":"","map-options":"",dense:"",outlined:"",label:"Tipo de miel"},null,8,["modelValue","options"])]),l("div",to,[o(c,{modelValue:i.formColmena.fecha_instalacion,"onUpdate:modelValue":e[14]||(e[14]=a=>i.formColmena.fecha_instalacion=a),type:"date",dense:"",outlined:"",label:"Instalación"},null,8,["modelValue"])]),l("div",oo,[o(c,{modelValue:i.formColmena.reina_fecha_nacimiento,"onUpdate:modelValue":e[15]||(e[15]=a=>i.formColmena.reina_fecha_nacimiento=a),type:"date",dense:"",outlined:"",label:"Reina: nacimiento"},null,8,["modelValue"])]),l("div",lo,[o(c,{modelValue:i.formColmena.reina_procedencia,"onUpdate:modelValue":e[16]||(e[16]=a=>i.formColmena.reina_procedencia=a),dense:"",outlined:"",label:"Reina: procedencia"},null,8,["modelValue"])]),l("div",io,[o(I,{modelValue:i.formColmena.estado,"onUpdate:modelValue":e[17]||(e[17]=a=>i.formColmena.estado=a),options:["ACTIVA","INACTIVA"],dense:"",outlined:"",label:"Estado"},null,8,["modelValue"])]),l("div",ao,[o(v,{flat:"",color:"grey",label:"Limpiar",onClick:s.resetColmena,disable:i.saving},null,8,["onClick","disable"]),o(v,{color:"primary",label:i.formColmena.id?"Guardar cambios":"Agregar colmena",type:"submit",loading:i.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const To=j(St,[["render",no],["__scopeId","data-v-08f4bdb1"]]);delete P.Icon.Default.prototype._getIconUrl;P.Icon.Default.mergeOptions({iconRetinaUrl:Ae,iconUrl:Ve,shadowUrl:xe});const so={name:"ProductorMapa",components:{LMap:Ce,LTileLayer:ve,LMarker:be,LPopup:ye,LControlLayers:_e},props:{productor:{type:Object,required:!0},defaultCenter:{type:Array,default:()=>[-16.29,-63.59]},defaultZoom:{type:Number,default:6}},data(){return{zoom:this.defaultZoom,initialCenter:this.defaultCenter,mapOptions:{zoomControl:!0,attributionControl:!1,zoomAnimation:!1,fadeAnimation:!1,markerZoomAnimation:!1}}},computed:{mapObj(){return this.$refs.map?.leafletObject||null},apiariosConLatLng(){return(Array.isArray(this.productor?.apiarios)?this.productor.apiarios:[]).map(e=>{const m=Number(e.latitud),y=Number(e.longitud);return isFinite(m)&&isFinite(y)?{...e,lat:m,lng:y}:null}).filter(Boolean)}},watch:{productor:{deep:!0,handler(){this.$nextTick(()=>this.fitToMarkers())}}},mounted(){this.$nextTick(()=>this.fitToMarkers())},methods:{refresh(){const t=this.mapObj;t&&setTimeout(()=>{t.invalidateSize(),this.fitToMarkers(!0)},60)},fitToMarkers(t=!1){const e=this.mapObj;if(!e)return;const m=this.apiariosConLatLng.map(i=>[i.lat,i.lng]);if(m.length===0){e.setView(this.defaultCenter,this.defaultZoom,{animate:!1});return}if(m.length===1){const i=t?e.getZoom()||this.defaultZoom:Math.max(e.getZoom()||this.defaultZoom,15);e.setView(m[0],i,{animate:!1});return}const y=P.latLngBounds(m);e.fitBounds(y.pad(.2),{animate:!1})}}},ro={style:{height:"580px","border-radius":"8px",overflow:"hidden"}},uo={style:{"min-width":"180px"}},mo={class:"text-bold"},co={class:"text-grey-7",style:{"font-size":"12px"}},po={key:0,class:"q-mt-xs"};function fo(t,e,m,y,i,s){const r=k("l-control-layers"),a=k("l-tile-layer"),p=k("l-popup"),C=k("l-marker"),N=k("l-map");return u(),A(O,{class:"q-pa-none"},{default:n(()=>[l("div",ro,[o(N,{ref:"map",zoom:i.zoom,center:i.initialCenter,options:i.mapOptions,style:{height:"100%",width:"100%"}},{default:n(()=>[o(r,{position:"topright"}),o(a,{"layer-type":"base",name:"OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","max-zoom":19,visible:!1}),o(a,{"layer-type":"base",name:"Google Calle",url:"https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),o(a,{"layer-type":"base",name:"Google Satélite",url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}","max-zoom":21,visible:!1}),o(a,{"layer-type":"base",name:"Google Híbrido",url:"https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}","max-zoom":21,visible:!0}),(u(!0),_(F,null,R(s.apiariosConLatLng,f=>(u(),A(C,{key:f.id,"lat-lng":[f.lat,f.lng]},{default:n(()=>[o(p,null,{default:n(()=>[l("div",uo,[l("div",mo,d(f.nombre_cip||"Apiario #"+f.id),1),l("div",null,d(f.lugar_apiario||"-"),1),l("div",co,[h(" Lat: "+d(f.lat.toFixed(6)),1),e[0]||(e[0]=l("br",null,null,-1)),h(" Lng: "+d(f.lng.toFixed(6)),1)]),f.estado?(u(),_("div",po,[e[1]||(e[1]=h(" Estado: ")),o(rt,{color:f.estado==="ACTIVO"?"green":"grey","text-color":"white",rounded:""},{default:n(()=>[h(d(f.estado),1)]),_:2},1032,["color"])])):M("",!0)])]),_:2},1024)]),_:2},1032,["lat-lng"]))),128))]),_:1},8,["zoom","center","options"])])]),_:1})}const Lo=j(so,[["render",fo],["__scopeId","data-v-9985e018"]]),Eo=Re({name:"QTooltip",inheritAttrs:!1,props:{...lt,...Ge,...Z,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{...Z.transitionShow,default:"jump-down"},transitionHide:{...Z.transitionHide,default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:pe},self:{type:String,default:"top middle",validator:pe},offset:{type:Array,default:()=>[14,14],validator:ot},scrollTarget:Be,delay:{type:Number,default:0},hideDelay:{type:Number,default:0},persistent:Boolean},emits:[...je],setup(t,{slots:e,emit:m,attrs:y}){let i,s;const r=He(),{proxy:{$q:a}}=r,p=se(null),C=se(!1),N=Q(()=>fe(t.anchor,a.lang.rtl)),f=Q(()=>fe(t.self,a.lang.rtl)),ke=Q(()=>t.persistent!==!0),{registerTick:we,removeTick:Oe}=Ze(),{registerTimeout:q}=We(),{transitionProps:Te,transitionStyle:Le}=Je(t),{localScrollTarget:te,changeScrollEvent:Ee,unconfigureScrollTarget:Ne}=it(t,ae),{anchorEl:w,canShow:Se,anchorEvents:S}=at({showing:C,configureAnchorEl:Qe}),{show:Ue,hide:B}=Ke({showing:C,canShow:Se,handleShow:Ie,handleHide:Me,hideOnRouteChange:ke,processOnMount:!0});Object.assign(S,{delayShow:Pe,delayHide:qe});const{showPortal:oe,hidePortal:le,renderPortal:ze}=Xe(r,p,Fe,"tooltip");if(a.platform.is.mobile===!0){const b={anchorEl:w,innerRef:p,onClickOutside(E){return B(E),E.target.classList.contains("q-dialog__backdrop")&&tt(E),!0}},G=Q(()=>t.modelValue===null&&t.persistent!==!0&&C.value===!0);re(G,E=>{(E===!0?nt:he)(b)}),de(()=>{he(b)})}function Ie(b){oe(),we(()=>{s=new MutationObserver(()=>U()),s.observe(p.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),U(),ae()}),i===void 0&&(i=re(()=>a.screen.width+"|"+a.screen.height+"|"+t.self+"|"+t.anchor+"|"+a.lang.rtl,U)),q(()=>{oe(!0),m("show",b)},t.transitionDuration)}function Me(b){Oe(),le(),ie(),q(()=>{le(!0),m("hide",b)},t.transitionDuration)}function ie(){s!==void 0&&(s.disconnect(),s=void 0),i!==void 0&&(i(),i=void 0),Ne(),ue(S,"tooltipTemp")}function U(){st({targetEl:p.value,offset:t.offset,anchorEl:w.value,anchorOrigin:N.value,selfOrigin:f.value,maxHeight:t.maxHeight,maxWidth:t.maxWidth})}function Pe(b){if(a.platform.is.mobile===!0){ge(),document.body.classList.add("non-selectable");const G=w.value,E=["touchmove","touchcancel","touchend","click"].map(ne=>[G,ne,"delayHide","passiveCapture"]);me(S,"tooltipTemp",E)}q(()=>{Ue(b)},t.delay)}function qe(b){a.platform.is.mobile===!0&&(ue(S,"tooltipTemp"),ge(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),q(()=>{B(b)},t.hideDelay)}function Qe(){if(t.noParentEvent===!0||w.value===null)return;const b=a.platform.is.mobile===!0?[[w.value,"touchstart","delayShow","passive"]]:[[w.value,"mouseenter","delayShow","passive"],[w.value,"mouseleave","delayHide","passive"]];me(S,"anchor",b)}function ae(){if(w.value!==null||t.scrollTarget!==void 0){te.value=Ye(w.value,t.scrollTarget);const b=t.noParentEvent===!0?U:B;Ee(te.value,b)}}function De(){return C.value===!0?ce("div",{...y,ref:p,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",y.class],style:[y.style,Le.value],role:"tooltip"},et(e.default)):null}function Fe(){return ce($e,Te.value,De)}return de(ie),Object.assign(r.proxy,{updatePosition:U}),ze}});export{Oo as P,Eo as Q,To as a,Lo as b};
