import{Q as b}from"./QBanner-qHsOemqf.js";import{_ as g,c as u,o as c,w as m,a6 as V,b as s,a5 as p,t as v,a as n,ad as r,f}from"./index-CE70hBEC.js";import{Q as a}from"./QSelect-DQsz9RK1.js";import{Q as h,b as x}from"./format-BnDNlhAd.js";import{Q as y}from"./QForm-BGKFr3Dr.js";const U={name:"ProductorForm",props:{productor:{type:Object,default:null},tree:{type:Array,default:()=>[]},autoLoadTree:{type:Boolean,default:!0},bannerMsg:{type:String,default:""}},emits:["saved","cancel","error"],data(){return{localTree:[],saving:!1,banner:this.bannerMsg,orgOptions:[],orgLoading:!1,form:this.emptyForm(),sexoOptions:[{label:"Masculino",value:1},{label:"Femenino",value:2}]}},computed:{treeToUse(){return this.tree&&this.tree.length?this.tree:this.localTree},depOptions(){return(this.treeToUse||[]).map(i=>({label:i.nombre_departamento,value:i.id}))},provOptions(){const i=this.form.departamento_id;return i?((this.treeToUse||[]).find(t=>t.id===i)?.provincias||[]).map(t=>({label:t.nombre_provincia,value:t.id})):[]},munOptions(){const i=this.form.departamento_id,e=this.form.provincia_id;return!i||!e?[]:(((this.treeToUse||[]).find(o=>o.id===i)?.provincias||[]).find(o=>o.id===e)?.municipios||[]).map(o=>({label:o.nombre_municipio,value:o.id}))}},watch:{productor:{handler(){this.initFromProp()},immediate:!0}},mounted(){!this.tree?.length&&this.autoLoadTree&&this.loadTree()},methods:{emptyForm(){return{id:null,municipio_id:null,runsa:"0",sub_codigo:"",nombre:"",apellidos:"",numcarnet:"",expedido:"",fec_nacimiento:null,sexo:null,direccion:"",comunidad:"",proveedor:"",cip_acopio:"",num_celular:"",ocupacion:"",otros:"",seleccion:0,organizacion_id:null,fecha_registro:new Date().toISOString().slice(0,10),fecha_expiracion:null,estado:"VIGENTE",departamento_id:null,provincia_id:null}},async loadTree(){try{const{data:i}=await this.$axios.get("geo/tree");this.localTree=i}catch(i){this.$alert?.error?.(i.response?.data?.message||"No se pudo cargar el árbol geográfico")}},initFromProp(){const i=this.productor;if(!i){this.form=this.emptyForm();return}this.form={id:i.id??null,municipio_id:i.municipio?.id||i.municipio_id||null,runsa:i.runsa??"0",sub_codigo:i.sub_codigo??"",nombre:i.nombre??"",apellidos:i.apellidos??"",numcarnet:i.numcarnet??"",expedido:i.expedido??"",fec_nacimiento:i.fec_nacimiento??null,sexo:i.sexo??null,direccion:i.direccion??"",comunidad:i.comunidad??"",proveedor:i.proveedor??"",cip_acopio:i.cip_acopio??"",num_celular:i.num_celular??"",ocupacion:i.ocupacion??"",otros:i.otros??"",seleccion:i.seleccion??0,organizacion_id:i.organizacion?.id||i.organizacion_id||null,fecha_registro:i.fecha_registro??new Date().toISOString().slice(0,10),fecha_expiracion:i.fecha_expiracion??null,estado:i.estado??"VIGENTE",departamento_id:i.municipio?.departamento_id||null,provincia_id:i.municipio?.provincia_id||null}},onDepChange(){this.form.provincia_id=null,this.form.municipio_id=null},onProvChange(){this.form.municipio_id=null},async filterOrganizaciones(i,e){e(async()=>{this.orgLoading=!0;try{const{data:t}=await this.$axios.get("organizaciones",{params:{search:i||void 0,paginate:!1}});this.orgOptions=Array.isArray(t)?t:t?.data||[]}catch{this.orgOptions=[]}finally{this.orgLoading=!1}})},async submit(){this.saving=!0;try{const i={municipio_id:this.form.municipio_id,runsa:this.form.runsa,sub_codigo:this.form.sub_codigo,nombre:this.form.nombre,apellidos:this.form.apellidos,numcarnet:this.form.numcarnet,expedido:this.form.expedido,fec_nacimiento:this.form.fec_nacimiento,sexo:this.form.sexo,direccion:this.form.direccion,comunidad:this.form.comunidad,proveedor:this.form.proveedor,cip_acopio:this.form.cip_acopio,num_celular:this.form.num_celular,ocupacion:this.form.ocupacion,otros:this.form.otros,seleccion:this.form.seleccion,organizacion_id:this.form.organizacion_id,fecha_registro:this.form.fecha_registro,fecha_expiracion:this.form.fecha_expiracion,estado:this.form.estado};let e;this.form.id?e=await this.$axios.put(`productores/${this.form.id}`,i):e=await this.$axios.post("productores",i);const t=e.data;this.$alert?.success?.(this.form.id?"Productor actualizado":"Productor creado")}catch(i){const e=i.response?.data?.message||"No se pudo guardar";this.$alert?.error?.(e),this.$emit("error",i)}finally{this.saving=!1}}}},O={class:"row q-col-gutter-sm"},C={class:"col-6 col-sm-2"},I={class:"col-6 col-sm-2"},T={class:"col-12 col-sm-4"},S={class:"col-12 col-sm-4"},N={class:"col-6 col-sm-3"},w={class:"col-6 col-sm-2"},z={class:"col-12 col-sm-3"},F={class:"col-12 col-sm-4"},P={class:"col-12"},E={class:"col-12 col-sm-4"},Q={class:"col-12 col-sm-4"},A={class:"col-12 col-sm-4"},D={class:"col-12 col-sm-4"},q={class:"col-12 col-sm-4"},B={class:"col-12 col-sm-4"},L={class:"col-12 col-sm-6"},R={class:"col-12 col-sm-4"},M={class:"col-12 col-sm-4"},k={class:"col-12 col-sm-4"},G={class:"col-12 col-sm-4"},j={class:"col-12 col-sm-4"},H={class:"col-12 col-sm-4"},J={class:"col-12"},K={class:"text-right q-gutter-sm"};function W(i,e,t,_,o,d){return c(),u(y,{onSubmit:d.submit,class:"q-gutter-md"},{default:m(()=>[o.banner?(c(),u(b,{key:0,class:"bg-yellow-1 text-yellow-10"},{default:m(()=>[p(v(o.banner),1)]),_:1})):V("",!0),s("div",O,[s("div",C,[n(r,{modelValue:o.form.runsa,"onUpdate:modelValue":e[0]||(e[0]=l=>o.form.runsa=l),label:"RUNSA",dense:"",outlined:""},null,8,["modelValue"])]),s("div",I,[n(r,{modelValue:o.form.sub_codigo,"onUpdate:modelValue":e[1]||(e[1]=l=>o.form.sub_codigo=l),label:"Sub Código",dense:"",outlined:""},null,8,["modelValue"])]),s("div",T,[n(r,{modelValue:o.form.nombre,"onUpdate:modelValue":e[2]||(e[2]=l=>o.form.nombre=l),label:"Nombre",dense:"",outlined:"",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"])]),s("div",S,[n(r,{modelValue:o.form.apellidos,"onUpdate:modelValue":e[3]||(e[3]=l=>o.form.apellidos=l),label:"Apellidos",dense:"",outlined:"",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"])]),s("div",N,[n(r,{modelValue:o.form.numcarnet,"onUpdate:modelValue":e[4]||(e[4]=l=>o.form.numcarnet=l),label:"N° Carnet",dense:"",outlined:"",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"])]),s("div",w,[n(r,{modelValue:o.form.expedido,"onUpdate:modelValue":e[5]||(e[5]=l=>o.form.expedido=l),label:"Expedido",dense:"",outlined:"",hint:"LP, CB, SC..."},null,8,["modelValue"])]),s("div",z,[n(r,{modelValue:o.form.fec_nacimiento,"onUpdate:modelValue":e[6]||(e[6]=l=>o.form.fec_nacimiento=l),type:"date",label:"Nacimiento",dense:"",outlined:""},null,8,["modelValue"])]),s("div",F,[n(a,{modelValue:o.form.sexo,"onUpdate:modelValue":e[7]||(e[7]=l=>o.form.sexo=l),options:o.sexoOptions,label:"Sexo",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),s("div",P,[n(r,{modelValue:o.form.direccion,"onUpdate:modelValue":e[8]||(e[8]=l=>o.form.direccion=l),type:"textarea",label:"Dirección",dense:"",outlined:"",autogrow:""},null,8,["modelValue"])]),s("div",E,[n(r,{modelValue:o.form.comunidad,"onUpdate:modelValue":e[9]||(e[9]=l=>o.form.comunidad=l),label:"Comunidad",dense:"",outlined:""},null,8,["modelValue"])]),s("div",Q,[n(r,{modelValue:o.form.proveedor,"onUpdate:modelValue":e[10]||(e[10]=l=>o.form.proveedor=l),label:"Proveedor",dense:"",outlined:""},null,8,["modelValue"])]),s("div",A,[n(r,{modelValue:o.form.cip_acopio,"onUpdate:modelValue":e[11]||(e[11]=l=>o.form.cip_acopio=l),label:"CIP Acopio",dense:"",outlined:""},null,8,["modelValue"])]),s("div",D,[n(r,{modelValue:o.form.num_celular,"onUpdate:modelValue":e[12]||(e[12]=l=>o.form.num_celular=l),label:"Celular",dense:"",outlined:""},null,8,["modelValue"])]),s("div",q,[n(r,{modelValue:o.form.ocupacion,"onUpdate:modelValue":e[13]||(e[13]=l=>o.form.ocupacion=l),label:"Ocupación",dense:"",outlined:""},null,8,["modelValue"])]),s("div",B,[n(r,{modelValue:o.form.seleccion,"onUpdate:modelValue":e[14]||(e[14]=l=>o.form.seleccion=l),modelModifiers:{number:!0},type:"number",label:"Selección",dense:"",outlined:""},null,8,["modelValue"])]),s("div",L,[n(a,{modelValue:o.form.organizacion_id,"onUpdate:modelValue":e[15]||(e[15]=l=>o.form.organizacion_id=l),label:"Organización",dense:"",outlined:"","use-input":"","fill-input":"","input-debounce":"300",options:o.orgOptions,"option-label":"nombre_organiza","option-value":"id","emit-value":"","map-options":"",clearable:"",onFilter:d.filterOrganizaciones,loading:o.orgLoading,hint:"Escribe para buscar"},{"no-option":m(()=>[n(h,null,{default:m(()=>[n(x,{class:"text-grey"},{default:m(()=>e[24]||(e[24]=[p("Sin resultados")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","loading"])]),s("div",R,[n(a,{modelValue:o.form.departamento_id,"onUpdate:modelValue":[e[16]||(e[16]=l=>o.form.departamento_id=l),d.onDepChange],options:d.depOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",dense:"",outlined:"",label:"Departamento"},null,8,["modelValue","options","onUpdate:modelValue"])]),s("div",M,[n(a,{modelValue:o.form.provincia_id,"onUpdate:modelValue":[e[17]||(e[17]=l=>o.form.provincia_id=l),d.onProvChange],options:d.provOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",dense:"",outlined:"",label:"Provincia",disable:!o.form.departamento_id},null,8,["modelValue","options","disable","onUpdate:modelValue"])]),s("div",k,[n(a,{modelValue:o.form.municipio_id,"onUpdate:modelValue":e[18]||(e[18]=l=>o.form.municipio_id=l),options:d.munOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",dense:"",outlined:"",label:"Municipio",rules:[l=>!!l||"Requerido"],disable:!o.form.provincia_id},null,8,["modelValue","options","rules","disable"])]),s("div",G,[n(r,{modelValue:o.form.fecha_registro,"onUpdate:modelValue":e[19]||(e[19]=l=>o.form.fecha_registro=l),type:"date",label:"Fecha Registro",dense:"",outlined:""},null,8,["modelValue"])]),s("div",j,[n(r,{modelValue:o.form.fecha_expiracion,"onUpdate:modelValue":e[20]||(e[20]=l=>o.form.fecha_expiracion=l),type:"date",label:"Fecha Expiración",dense:"",outlined:""},null,8,["modelValue"])]),s("div",H,[n(a,{modelValue:o.form.estado,"onUpdate:modelValue":e[21]||(e[21]=l=>o.form.estado=l),options:["VIGENTE","VENCIDO","ACTIVO","INACTIVO"],label:"Estado",dense:"",outlined:""},null,8,["modelValue"])]),s("div",J,[n(r,{modelValue:o.form.otros,"onUpdate:modelValue":e[22]||(e[22]=l=>o.form.otros=l),type:"textarea",label:"Otros",dense:"",outlined:"",autogrow:""},null,8,["modelValue"])])]),s("div",K,[n(f,{flat:"",color:"negative",label:"Cancelar",disable:o.saving,onClick:e[23]||(e[23]=l=>i.$emit("cancel"))},null,8,["disable"]),n(f,{color:"primary",label:o.form.id?"Guardar cambios":"Crear productor",type:"submit",loading:o.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])}const eo=g(U,[["render",W],["__scopeId","data-v-7be71ec7"]]);export{eo as P};
