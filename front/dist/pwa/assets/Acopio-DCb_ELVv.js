import{_ as Q,c as p,o as r,w as i,a as l,Q as O,e as v,b as a,O as E,aa as m,aF as w,af as h,a8 as f,f as y,ab as N,ac as k,P as A,d as C,ad as $,t as d}from"./index-DSKFdGBt.js";import{Q as u}from"./QSelect-CatHvqna.js";import{Q as V,b as g,d as F}from"./format-DMrCQU_3.js";import{Q as U}from"./QForm-DOfK8IId.js";import{Q as _}from"./QList-B6C20QEn.js";import{Q as P}from"./QBtnDropdown-CNX7oU2I.js";import{Q as D}from"./QMarkupTable-Ctp2MU3L.js";import{Q as B}from"./QPage-DVh0Cej_.js";import{h as S}from"./moment-C5S46NFB.js";import"./selection-B_eMA4-z.js";const I={name:"AcopioPage",data:function(){return{numActa:null,acopioCosechas:[],loadingProductores:!1,productor:null,productorOptions:[],productos:[],producto:null,loading:!1,fechaInicio:S().startOf("month").format("YYYY-MM-DD"),fechaFin:S().endOf("month").format("YYYY-MM-DD"),estados:[{label:"BUENO",value:"BUENO"},{label:"EN PROCESO",value:"EN_PROCESO"},{label:"CANCELADO",value:"CANCELADO"}],estadoSeleccionado:null,departamentos:[],departamentoSeleccionado:null,provincias:[],provinciaSeleccionado:null,municipios:[],municipioSeleccionado:null}},mounted(){this.buscarCosechas(),this.productoGet()},methods:{getDepartamentos(){this.$axios.get("/departamentos").then(({data:e})=>{this.departamentos=e?.data||e||[]}).catch(()=>{this.$q.notify({type:"negative",message:"No se pudieron cargar los departamentos"})})},getMunicipios(){if(!this.departamentoSeleccionado){this.municipios=[];return}this.$axios.get("/municipios",{params:{departamento_id:this.departamentoSeleccionado.value}}).then(({data:e})=>{console.log(e),this.municipios=e?.data||e||[]}).catch(()=>{this.$q.notify({type:"negative",message:"No se pudieron cargar los municipios"})})},filterProductores(e,t,c){if(!e||e.length<2){t(()=>{this.productorOptions=[]});return}t(async()=>{this.loadingProductores=!0;try{const{data:s}=await this.$axios.get("/productores",{params:{search:e,per_page:20}}),b=(s?.data||s||[]).map(n=>({value:n.id,label:`${n.nombre??""} ${n.apellidos??""} — ${n.municipio?.nombre_municipio??""}`.trim(),raw:n}));this.productorOptions=b}catch{this.$q.notify({type:"negative",message:"No se pudo cargar productores"})}finally{this.loadingProductores=!1}})},async productoGet(){this.$axios.get("/productos/tipo/1").then(({data:e})=>{console.log(e),this.productos=e?.data||e||[],this.productos.unshift({id:null,nombre_producto:"Todos"}),this.producto=null}).catch(()=>{this.$q.notify({type:"negative",message:"No se pudieron cargar los productos"})})},async generarExcel(){this.loading=!0,await this.$axios.post("acopioExcel",{fecha_inicio:this.fechaInicio,fecha_fin:this.fechaFin,estado:this.estadoSeleccionado},{responseType:"blob"}).then(e=>{const t=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=window.URL.createObjectURL(t),s=document.createElement("a");s.href=c,s.setAttribute("download","acopio.xlsx"),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(c)}).catch(e=>{this.$alert?.error?.(e.response?.data?.message||"No se pudo generar el reporte.")}).finally(()=>{this.loading=!1})},buscarCosechas(){this.loading=!0,console.log(this.producto),this.$axios.get("/acopio/cosechas",{params:{fecha_inicio:this.fechaInicio,fecha_fin:this.fechaFin,estado:this.estadoSeleccionado,productor_id:this.productor,num_acta:this.numActa,producto_id:this.producto,departamento_id:this.departamentoSeleccionado,municipio_id:this.municipioSeleccionado}}).then(e=>{console.log(e.data),this.acopioCosechas=e.data}).finally(()=>{this.loading=!1})}}},L={class:"row q-gutter-sm"},M={class:"col-12 col-md-2"},Y={class:"col-12 col-md-2"},q={class:"col-12 col-md-3"},x={class:"col-12 col-md-3"},R={class:"col-6 col-md-3"},j={class:"col-12 col-md-3"},T={class:"col-12 col-md-3"},z={class:"col-12 col-md-3"},G={class:"col-12 col-md-2 flex flex-center"},H={class:"col-12 col-md-2 flex flex-center"},X={key:1,class:"text-center q-pa-md"};function J(e,t,c,s,b,n){return r(),p(B,{class:"q-pa-xs"},{default:i(()=>[l(O,null,{default:i(()=>[l(v,null,{default:i(()=>t[10]||(t[10]=[a("div",{class:"text-h6"},"Acopio de Cosechas",-1)])),_:1}),l(E),l(v,null,{default:i(()=>[l(U,{onSubmit:w(n.buscarCosechas,["prevent"])},{default:i(()=>[a("div",L,[a("div",M,[l(h,{modelValue:e.fechaInicio,"onUpdate:modelValue":t[0]||(t[0]=o=>e.fechaInicio=o),label:"Fecha Inicio",type:"date",dense:"",outlined:""},null,8,["modelValue"])]),a("div",Y,[l(h,{modelValue:e.fechaFin,"onUpdate:modelValue":t[1]||(t[1]=o=>e.fechaFin=o),label:"Fecha Fin",type:"date",dense:"",outlined:""},null,8,["modelValue"])]),a("div",q,[l(u,{modelValue:e.estadoSeleccionado,"onUpdate:modelValue":t[2]||(t[2]=o=>e.estadoSeleccionado=o),options:e.estados,label:"Estado de Cosecha",dense:"",outlined:"",clearable:""},null,8,["modelValue","options"])]),a("div",x,[l(u,{modelValue:e.productor,"onUpdate:modelValue":t[3]||(t[3]=o=>e.productor=o),options:e.productorOptions,"option-label":"label","emit-value":"","map-options":"","use-input":"","input-debounce":"400",onFilter:n.filterProductores,label:"Productor",dense:"",outlined:"",loading:e.loadingProductores,clearable:""},{"no-option":i(()=>[l(V,null,{default:i(()=>[l(g,{class:"text-grey"},{default:i(()=>t[11]||(t[11]=[f("Escriba al menos 2 caracteres…")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","loading"])]),a("div",R,[l(u,{modelValue:e.producto,"onUpdate:modelValue":t[4]||(t[4]=o=>e.producto=o),options:e.productos.map(o=>({label:o.nombre_producto,value:o.id})),label:"Producto",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),a("div",j,[l(h,{modelValue:e.numActa,"onUpdate:modelValue":t[5]||(t[5]=o=>e.numActa=o),label:"Número de Acta",type:"text",dense:"",outlined:""},null,8,["modelValue"])]),a("div",T,[l(u,{modelValue:e.departamentoSeleccionado,"onUpdate:modelValue":[t[6]||(t[6]=o=>e.departamentoSeleccionado=o),t[8]||(t[8]=o=>n.getMunicipios())],label:"Departamento",options:e.departamentos.map(o=>({label:o.nombre_departamento,value:o.id})),dense:"",outlined:"",onFocus:t[7]||(t[7]=o=>n.getDepartamentos()),clearable:""},null,8,["modelValue","options"])]),a("div",z,[l(u,{modelValue:e.municipioSeleccionado,"onUpdate:modelValue":t[9]||(t[9]=o=>e.municipioSeleccionado=o),label:"Municipio",options:e.municipios.map(o=>({label:o.nombre_municipio,value:o.id})),dense:"",outlined:"",clearable:""},null,8,["modelValue","options"])]),a("div",G,[l(y,{loading:e.loading,label:"Buscar Cosechas",type:"submit",color:"primary","no-caps":"",icon:"search"},null,8,["loading"])]),a("div",H,[l(y,{loading:e.loading,label:"EXCEL",color:"green",onClick:n.generarExcel},null,8,["loading","onClick"])])])]),_:1},8,["onSubmit"]),e.acopioCosechas.length>0?(r(),p(D,{key:0,dense:"","wrap-cells":"",flat:"",bordered:""},{default:i(()=>[t[13]||(t[13]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",null,"Opciones"),a("th",null,"Fecha Cosecha"),a("th",null,"Productor"),a("th",null,"Cantidad (kg)"),a("th",null,"Humedad (%)"),a("th",null,"Temperatura Almacenaje (°C)"),a("th",null,"Número Acta"),a("th",null,"Condiciones Almacenaje"),a("th",null,"Estado")])],-1)),a("tbody",null,[(r(!0),m(N,null,k(e.acopioCosechas,o=>(r(),m("tr",{key:o.id},[a("td",null,[l(P,{dense:"",label:"Opciones",color:"primary","no-caps":"",size:"10px"},{default:i(()=>[l(_,null,{default:i(()=>[A((r(),p(V,{clickable:"",to:`/acopio/cosechas/${o.id}`},{default:i(()=>[l(g,{avatar:""},{default:i(()=>[l(C,{name:"visibility"})]),_:1}),l(g,null,{default:i(()=>t[12]||(t[12]=[f("Ver Detalles")])),_:1})]),_:2},1032,["to"])),[[$]])]),_:2},1024)]),_:2},1024)]),a("td",null,d(o.fecha_cosecha),1),a("td",null,d(o.apiario?.productor.nombre)+" "+d(o.apiario?.productor.apellidos),1),a("td",null,d(o.cantidad_kg),1),a("td",null,d(o.humedad),1),a("td",null,d(o.temperatura_almacenaje),1),a("td",null,d(o.num_acta),1),a("td",null,d(o.condiciones_almacenaje),1),a("td",null,[l(F,{color:o.estado==="BUENO"?"green":"red","text-color":"white",dense:"",size:"10px"},{default:i(()=>[f(d(o.estado.replace("_"," ")),1)]),_:2},1032,["color"])])]))),128))])]),_:1})):(r(),m("div",X,[l(C,{name:"info",size:"48px",color:"grey-5"}),t[14]||(t[14]=a("div",{class:"text-subtitle2 text-grey-5"},"No se encontraron cosechas.",-1))]))]),_:1})]),_:1})]),_:1})}const se=Q(I,[["render",J]]);export{se as default};
