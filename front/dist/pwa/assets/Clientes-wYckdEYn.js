import{_ as C,c,o as f,w as a,a as e,J as u,d as p,a5 as b,aa as h,b as n,ad as r,f as d,h as Q,Q as w,e as _,t as x,I as y,ax as k,af as N}from"./index-fnzLEXBD.js";import{Q as v,b as m}from"./format-DVPgbsZR.js";import{Q as S}from"./QList-Co1t5_13.js";import{Q as E}from"./QBtnDropdown-BSFaQLIe.js";import{Q as q}from"./QTd-D3zmj5Sj.js";import{Q as D}from"./QTable-DqFCgB10.js";import{Q as T}from"./QForm-D9uhvZyP.js";import{Q as I}from"./QPage-D1MqHEXM.js";import{C as g}from"./ClosePopup-CakbSU77.js";import"./selection-CsATEHkD.js";import"./QMarkupTable-CYonzi-7.js";import"./QSelect-B7rPa0lo.js";import"./use-fullscreen-Cr5-K54_.js";const U={name:"ClientesPage",data(){return{loading:!1,rows:[],columns:[{name:"actions",label:"Acciones",align:"right"},{name:"nombre_cliente",label:"Nombre",align:"left",field:"nombre_cliente"},{name:"nit",label:"NIT",align:"left",field:"nit"},{name:"telefono",label:"Teléfono",align:"left",field:"telefono"},{name:"email",label:"Email",align:"left",field:"email"},{name:"pais_destino",label:"País destino",align:"left",field:"pais_destino"},{name:"direccion",label:"Dirección",align:"left",field:"direccion"}],filter:"",dlg:{open:!1,mode:"create",row:null},form:{nit:"",nombre_cliente:"",direccion:"",telefono:"",email:"",pais_destino:""},saving:!1}},computed:{canSubmit(){return!!this.form.nombre_cliente}},mounted(){this.fetch()},methods:{async fetch(){this.loading=!0;try{const o={};this.filter&&(o.q=this.filter);const{data:l}=await this.$axios.get("/clientes",{params:o});this.rows=Array.isArray(l)?l:l.data||[]}catch(o){this.$q.notify({type:"negative",message:o.response?.data?.message||"Error al listar clientes"})}finally{this.loading=!1}},fetchDebounced:(()=>{let o;return function(){clearTimeout(o),o=setTimeout(()=>this.fetch(),350)}})(),openCreate(){this.dlg={open:!0,mode:"create",row:null},this.form={nit:"",nombre_cliente:"",direccion:"",telefono:"",email:"",pais_destino:""}},openEdit(o){this.dlg={open:!0,mode:"edit",row:o},this.form={nit:o.nit||"",nombre_cliente:o.nombre_cliente||"",direccion:o.direccion||"",telefono:o.telefono||"",email:o.email||"",pais_destino:o.pais_destino||""}},async onSubmit(){if(this.canSubmit){this.saving=!0;try{this.dlg.mode==="create"?await this.$axios.post("/clientes",this.form):await this.$axios.put(`/clientes/${this.dlg.row.id}`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.dlg.open=!1,await this.fetch()}catch(o){this.$q.notify({type:"negative",message:o.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}}},async onDelete(o){this.$q.dialog({title:"Eliminar",message:`¿Eliminar el cliente ${o.nombre_cliente}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{await this.$axios.delete(`/clientes/${o.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),await this.fetch()}catch(l){this.$q.notify({type:"negative",message:l.response?.data?.message||"No se pudo eliminar"})}})}}},B={class:"row items-center q-gutter-sm"},A={class:"row q-col-gutter-md"},P={class:"col-12 col-md-6"},z={class:"col-12 col-md-6"},G={class:"col-12"},O={class:"col-12 col-md-6"},R={class:"col-12 col-md-6"},F={class:"col-12 col-md-6"};function J(o,l,L,M,i,s){return f(),c(I,{class:"q-pa-md"},{default:a(()=>[e(D,{rows:i.rows,columns:i.columns,"row-key":"id",flat:"",bordered:"",dense:"","wrap-cells":"","rows-per-page-options":[0],title:"Clientes",loading:i.loading,filter:i.filter},{"top-right":a(()=>[n("div",B,[e(r,{modelValue:i.filter,"onUpdate:modelValue":[l[0]||(l[0]=t=>i.filter=t),s.fetchDebounced],dense:"",outlined:"",placeholder:"Buscar por nombre, NIT, email, país"},{append:a(()=>[e(p,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"]),e(d,{color:"positive",icon:"add_circle_outline",label:"Nuevo","no-caps":"",loading:i.loading,onClick:s.openCreate},null,8,["loading","onClick"]),e(d,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",loading:i.loading,onClick:s.fetch},null,8,["loading","onClick"])])]),"body-cell-actions":a(t=>[e(q,{props:t,class:"text-right"},{default:a(()=>[e(E,{label:"Opciones",dense:"",color:"primary","no-caps":"",size:"10px"},{default:a(()=>[e(S,null,{default:a(()=>[u((f(),c(v,{clickable:"",onClick:V=>s.openEdit(t.row)},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(p,{name:"edit"})]),_:1}),e(m,null,{default:a(()=>l[8]||(l[8]=[b("Editar")])),_:1})]),_:2},1032,["onClick"])),[[h],[g]]),u((f(),c(v,{clickable:"",onClick:V=>s.onDelete(t.row)},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(p,{name:"delete",color:"negative"})]),_:1}),e(m,null,{default:a(()=>l[9]||(l[9]=[n("span",{class:"text-negative"},"Eliminar",-1)])),_:1})]),_:2},1032,["onClick"])),[[h],[g]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading","filter"]),e(Q,{modelValue:i.dlg.open,"onUpdate:modelValue":l[7]||(l[7]=t=>i.dlg.open=t),persistent:""},{default:a(()=>[e(w,{style:{"min-width":"520px","max-width":"760px"}},{default:a(()=>[e(_,{class:"text-h6"},{default:a(()=>[b(x(i.dlg.mode==="create"?"Nuevo Cliente":"Editar Cliente"),1)]),_:1}),e(y),e(_,null,{default:a(()=>[e(T,{onSubmit:k(s.onSubmit,["prevent"]),ref:"formRef"},{default:a(()=>[n("div",A,[n("div",P,[e(r,{modelValue:i.form.nombre_cliente,"onUpdate:modelValue":l[1]||(l[1]=t=>i.form.nombre_cliente=t),dense:"",filled:"",label:"Nombre del cliente"},null,8,["modelValue"])]),n("div",z,[e(r,{modelValue:i.form.nit,"onUpdate:modelValue":l[2]||(l[2]=t=>i.form.nit=t),dense:"",filled:"",label:"NIT"},null,8,["modelValue"])]),n("div",G,[e(r,{modelValue:i.form.direccion,"onUpdate:modelValue":l[3]||(l[3]=t=>i.form.direccion=t),dense:"",filled:"",label:"Dirección",type:"textarea",autogrow:""},null,8,["modelValue"])]),n("div",O,[e(r,{modelValue:i.form.telefono,"onUpdate:modelValue":l[4]||(l[4]=t=>i.form.telefono=t),dense:"",filled:"",label:"Teléfono"},null,8,["modelValue"])]),n("div",R,[e(r,{modelValue:i.form.email,"onUpdate:modelValue":l[5]||(l[5]=t=>i.form.email=t),dense:"",filled:"",label:"Email",type:"email"},null,8,["modelValue"])]),n("div",F,[e(r,{modelValue:i.form.pais_destino,"onUpdate:modelValue":l[6]||(l[6]=t=>i.form.pais_destino=t),dense:"",filled:"",label:"País destino"},null,8,["modelValue"])])])]),_:1},8,["onSubmit"])]),_:1}),e(y),e(N,{align:"right"},{default:a(()=>[u(e(d,{flat:"",label:"Cancelar"},null,512),[[g]]),e(d,{color:"primary",loading:i.saving,disable:!s.canSubmit,label:"Guardar",onClick:s.onSubmit},null,8,["loading","disable","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ae=C(U,[["render",J],["__scopeId","data-v-b2a82b70"]]);export{ae as default};
