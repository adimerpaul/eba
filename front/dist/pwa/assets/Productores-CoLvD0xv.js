import{aq as ne,j as W,g as H,ar as ie,k as r,l as v,as as oe,at as se,A as re,E as ue,r as de,s as ce,au as j,av as me,aw as ge,ad as F,f as O,_ as fe,c as ve,o as w,w as x,b as n,a as u,ab as he,Q as K,e as pe,ag as be,d as ye,a7 as T,a6 as R,a8 as _e,a9 as xe,t as f,a5 as G}from"./index-B6d1zyjm.js";import{Q as Ce}from"./QSpace-CKS8Z-WO.js";import{Q as V}from"./QSelect-DDXdziGV.js";import{c as J,d as Ve}from"./format-3uuXq-uR.js";import{Q as Se}from"./QMarkupTable-c9DV683y.js";import{Q as ke}from"./QPage-B_Jhyc8F.js";import"./selection-BkLv2Wda.js";const Pe={...ne,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:e=>e>=0&&e<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},U=50,X=2*U,Y=X*Math.PI,Be=Math.round(Y*1e3)/1e3,Ne=W({name:"QCircularProgress",props:{...Pe,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(e,{slots:a}){const{proxy:{$q:g}}=H(),c=ie(e),l=r(()=>{const d=(g.lang.rtl===!0?-1:1)*e.angle;return{transform:e.reverse!==(g.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-d}deg)`:`rotate3d(0, 0, 1, ${d-90}deg)`}}),s=r(()=>e.instantFeedback!==!0&&e.indeterminate!==!0?{transition:`stroke-dashoffset ${e.animationSpeed}ms ease 0s, stroke ${e.animationSpeed}ms ease`}:""),t=r(()=>X/(1-e.thickness/2)),S=r(()=>`${t.value/2} ${t.value/2} ${t.value} ${t.value}`),y=r(()=>J(e.value,e.min,e.max)),Q=r(()=>e.max-e.min),h=r(()=>e.thickness/2*t.value),E=r(()=>{const d=(e.max-y.value)/Q.value,m=e.rounded===!0&&y.value<e.max&&d<.25?h.value/2*(1-d/.25):0;return Y*d+m});function C({thickness:d,offset:m,color:q,cls:k,rounded:M}){return v("circle",{class:"q-circular-progress__"+k+(q!==void 0?` text-${q}`:""),style:s.value,fill:"transparent",stroke:"currentColor","stroke-width":d,"stroke-dasharray":Be,"stroke-dashoffset":m,"stroke-linecap":M,cx:t.value,cy:t.value,r:U})}return()=>{const d=[];e.centerColor!==void 0&&e.centerColor!=="transparent"&&d.push(v("circle",{class:`q-circular-progress__center text-${e.centerColor}`,fill:"currentColor",r:U-h.value/2,cx:t.value,cy:t.value})),e.trackColor!==void 0&&e.trackColor!=="transparent"&&d.push(C({cls:"track",thickness:h.value,offset:0,color:e.trackColor})),d.push(C({cls:"circle",thickness:h.value,offset:E.value,color:e.color,rounded:e.rounded===!0?"round":void 0}));const m=[v("svg",{class:"q-circular-progress__svg",style:l.value,viewBox:S.value,"aria-hidden":"true"},d)];return e.showValue===!0&&m.push(v("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:e.fontSize}},a.default!==void 0?a.default():[v("div",y.value)])),v("div",{class:`q-circular-progress q-circular-progress--${e.indeterminate===!0?"in":""}determinate`,style:c.value,role:"progressbar","aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.indeterminate===!0?void 0:y.value},oe(a.internal,m))}}});function D(e,a){return[!0,!1].includes(e)?e:a}const we=W({name:"QPagination",props:{...re,modelValue:{type:Number,required:!0},min:{type:[Number,String],default:1},max:{type:[Number,String],required:!0},maxPages:{type:[Number,String],default:0,validator:e=>(typeof e=="string"?parseInt(e,10):e)>=0},inputStyle:[Array,String,Object],inputClass:[Array,String,Object],size:String,disable:Boolean,input:Boolean,iconPrev:String,iconNext:String,iconFirst:String,iconLast:String,toFn:Function,boundaryLinks:{type:Boolean,default:null},boundaryNumbers:{type:Boolean,default:null},directionLinks:{type:Boolean,default:null},ellipses:{type:Boolean,default:null},ripple:{type:[Boolean,Object],default:null},round:Boolean,rounded:Boolean,flat:Boolean,outline:Boolean,unelevated:Boolean,push:Boolean,glossy:Boolean,color:{type:String,default:"primary"},textColor:String,activeDesign:{type:String,default:"",values:e=>e===""||se.includes(e)},activeColor:String,activeTextColor:String,gutter:String,padding:{type:String,default:"3px 2px"}},emits:["update:modelValue"],setup(e,{emit:a}){const{proxy:g}=H(),{$q:c}=g,l=ue(e,c),s=r(()=>parseInt(e.min,10)),t=r(()=>parseInt(e.max,10)),S=r(()=>parseInt(e.maxPages,10)),y=r(()=>m.value+" / "+t.value),Q=r(()=>D(e.boundaryLinks,e.input)),h=r(()=>D(e.boundaryNumbers,!e.input)),E=r(()=>D(e.directionLinks,e.input)),C=r(()=>D(e.ellipses,!e.input)),d=de(null),m=r({get:()=>e.modelValue,set:i=>{if(i=parseInt(i,10),e.disable||isNaN(i))return;const o=J(i,s.value,t.value);e.modelValue!==o&&a("update:modelValue",o)}});ce(()=>`${s.value}|${t.value}`,()=>{m.value=e.modelValue});const q=r(()=>"q-pagination row no-wrap items-center"+(e.disable===!0?" disabled":"")),k=r(()=>e.gutter in j?`${j[e.gutter]}px`:e.gutter||null),M=r(()=>k.value!==null?`--q-pagination-gutter-parent:-${k.value};--q-pagination-gutter-child:${k.value}`:null),I=r(()=>{const i=[e.iconFirst||c.iconSet.pagination.first,e.iconPrev||c.iconSet.pagination.prev,e.iconNext||c.iconSet.pagination.next,e.iconLast||c.iconSet.pagination.last];return c.lang.rtl===!0?i.reverse():i}),Z=r(()=>({"aria-disabled":e.disable===!0?"true":"false",role:"navigation"})),A=r(()=>me(e,"flat")),$=r(()=>({[A.value]:!0,round:e.round,rounded:e.rounded,padding:e.padding,color:e.color,textColor:e.textColor,size:e.size,ripple:e.ripple!==null?e.ripple:!0})),ee=r(()=>{const i={[A.value]:!1};return e.activeDesign!==""&&(i[e.activeDesign]=!0),i}),te=r(()=>({...ee.value,color:e.activeColor||e.color,textColor:e.activeTextColor||e.textColor})),P=r(()=>{let i=Math.max(S.value,1+(C.value?2:0)+(h.value?2:0));const o={pgFrom:s.value,pgTo:t.value,ellipsesStart:!1,ellipsesEnd:!1,boundaryStart:!1,boundaryEnd:!1,marginalStyle:{minWidth:`${Math.max(2,String(t.value).length)}em`}};return S.value&&i<t.value-s.value+1&&(i=1+Math.floor(i/2)*2,o.pgFrom=Math.max(s.value,Math.min(t.value-i+1,e.modelValue-Math.floor(i/2))),o.pgTo=Math.min(t.value,o.pgFrom+i-1),h.value&&(o.boundaryStart=!0,o.pgFrom++),C.value&&o.pgFrom>s.value+(h.value?1:0)&&(o.ellipsesStart=!0,o.pgFrom++),h.value&&(o.boundaryEnd=!0,o.pgTo--),C.value&&o.pgTo<t.value-(h.value?1:0)&&(o.ellipsesEnd=!0,o.pgTo--)),o});function z(i){m.value=i}function ae(i){m.value=m.value+i}const le=r(()=>{function i(){m.value=d.value,d.value=null}return{"onUpdate:modelValue":o=>{d.value=o},onKeyup:o=>{ge(o,13)===!0&&i()},onBlur:i}});function b(i,o,B){const _={"aria-label":o,"aria-current":"false",...$.value,...i};return B===!0&&Object.assign(_,{"aria-current":"true",...te.value}),o!==void 0&&(e.toFn!==void 0?_.to=e.toFn(o):_.onClick=()=>{z(o)}),v(O,_)}return Object.assign(g,{set:z,setByOffset:ae}),()=>{const i=[],o=[];let B;if(Q.value===!0&&(i.push(b({key:"bls",disable:e.disable||e.modelValue<=s.value,icon:I.value[0],"aria-label":c.lang.pagination.first},s.value)),o.unshift(b({key:"ble",disable:e.disable||e.modelValue>=t.value,icon:I.value[3],"aria-label":c.lang.pagination.last},t.value))),E.value===!0&&(i.push(b({key:"bdp",disable:e.disable||e.modelValue<=s.value,icon:I.value[1],"aria-label":c.lang.pagination.prev},e.modelValue-1)),o.unshift(b({key:"bdn",disable:e.disable||e.modelValue>=t.value,icon:I.value[2],"aria-label":c.lang.pagination.next},e.modelValue+1))),e.input!==!0){B=[];const{pgFrom:_,pgTo:L,marginalStyle:N}=P.value;if(P.value.boundaryStart===!0){const p=s.value===e.modelValue;i.push(b({key:"bns",style:N,disable:e.disable,label:s.value},s.value,p))}if(P.value.boundaryEnd===!0){const p=t.value===e.modelValue;o.unshift(b({key:"bne",style:N,disable:e.disable,label:t.value},t.value,p))}P.value.ellipsesStart===!0&&i.push(b({key:"bes",style:N,disable:e.disable,label:"…",ripple:!1},_-1)),P.value.ellipsesEnd===!0&&o.unshift(b({key:"bee",style:N,disable:e.disable,label:"…",ripple:!1},L+1));for(let p=_;p<=L;p++)B.push(b({key:`bpg${p}`,style:N,disable:e.disable,label:p},p,p===e.modelValue))}return v("div",{class:q.value,...Z.value},[v("div",{class:"q-pagination__content row no-wrap items-center",style:M.value},[...i,e.input===!0?v(F,{class:"inline",style:{width:`${y.value.length/1.5}em`},type:"number",dense:!0,value:d.value,disable:e.disable,dark:l.value,borderless:!0,inputClass:e.inputClass,inputStyle:e.inputStyle,placeholder:y.value,min:s.value,max:t.value,...le.value}):v("div",{class:"q-pagination__middle row justify-center"},B),...o])])}}}),qe={name:"ProductoresPage",data(){return{rows:[],loading:!1,serverCount:0,pagination:{page:1,perPage:10},loadingTree:!1,tree:[],filters:{search:"",estado:null,sexo:null,fecha_desde:null,fecha_hasta:null,departamento_id:null,provincia_id:null,municipio_id:null},sexoOptions:[{label:"Masculino",value:1},{label:"Femenino",value:2}]}},computed:{pageCount(){return Math.max(1,Math.ceil(this.serverCount/this.pagination.perPage))},depOptions(){return(this.tree||[]).map(e=>({label:e.nombre_departamento,value:e.id}))},provOptions(){const e=this.filters.departamento_id;return e?((this.tree||[]).find(g=>g.id===e)?.provincias||[]).map(g=>({label:g.nombre_provincia,value:g.id})):[]},munOptions(){const e=this.filters.departamento_id,a=this.filters.provincia_id;return!e||!a?[]:(((this.tree||[]).find(l=>l.id===e)?.provincias||[]).find(l=>l.id===a)?.municipios||[]).map(l=>({label:l.nombre_municipio,value:l.id}))}},mounted(){this.loadTree(),this.fetchPage()},methods:{chipColor(e){return e==="VIGENTE"||e==="ACTIVO"?"green":e==="VENCIDO"||e==="INACTIVO"?"red":"grey"},async loadTree(){this.loadingTree=!0;try{const{data:e}=await this.$axios.get("geo/tree");this.tree=e}catch(e){this.$alert?.error?.(e.response?.data?.message||"No se pudo cargar el árbol geográfico")}finally{this.loadingTree=!1}},async fetchPage(){this.loading=!0;try{const{data:e}=await this.$axios.get("productores",{params:{page:this.pagination.page,per_page:this.pagination.perPage,sort_by:"id",sort_dir:"desc",search:this.filters.search||void 0,estado:this.filters.estado||void 0,sexo:this.filters.sexo||void 0,fecha_desde:this.filters.fecha_desde||void 0,fecha_hasta:this.filters.fecha_hasta||void 0,departamento_id:this.filters.departamento_id||void 0,provincia_id:this.filters.provincia_id||void 0,municipio_id:this.filters.municipio_id||void 0}});this.rows=e.data,this.serverCount=e.total,this.pagination.page>this.pageCount&&(this.pagination.page=this.pageCount)}catch(e){this.$alert?.error?.(e.response?.data?.message||"No se pudo cargar productores")}finally{this.loading=!1}},changePage(){this.fetchPage()},changePerPage(){this.pagination.page=1,this.fetchPage()},applyFilters(){this.pagination.page=1,this.fetchPage()},onDepChange(){this.filters.provincia_id=null,this.filters.municipio_id=null,this.applyFilters()},onProvChange(){this.filters.municipio_id=null,this.applyFilters()},openDetails(e){this.$router.push("/productores/editar/"+e.id)}}},Ie={class:"row items-center q-gutter-sm q-mb-sm"},Te={class:"col-12 col-md-3"},De={class:"col-12 col-md-2"},Fe={class:"col-12 col-md-2"},Oe={class:"col-12 col-md-2"},Qe={class:"col-12 col-md-2"},Ee={class:"col-12 col-md-3"},Me={class:"col-12 col-md-3"},Ue={class:"col-12 col-md-3"},Ae={class:"col-12 col-md-auto q-gutter-sm"},ze=["onClick"],Le={class:"text-left"},je={class:"text-left"},Ke={class:"text-left"},Re={class:"text-left"},Ge={class:"text-weight-medium"},We={class:"text-caption text-grey-7"},He={class:"text-left"},Je={class:"text-left"},Xe={class:"text-left"},Ye={class:"text-left"},Ze={class:"text-left"},$e={key:0},et={key:0,class:"absolute-full flex flex-center bg-transparent"},tt={class:"q-pa-sm row items-center justify-between"},at={class:"text-caption"},lt={class:"row items-center q-gutter-sm"};function nt(e,a,g,c,l,s){return w(),ve(ke,{class:"q-pa-md"},{default:x(()=>[n("div",Ie,[u(he,{icon:"person_search",color:"primary","text-color":"white"}),a[11]||(a[11]=n("div",{class:"text-h6 text-weight-bold"},"Productores",-1)),u(Ce),u(O,{color:"primary",icon:"forest",label:"Actualizar árbol geo",onClick:s.loadTree,loading:l.loadingTree,"no-caps":""},null,8,["onClick","loading"])]),u(K,{flat:"",bordered:"",class:"q-mb-md"},{default:x(()=>[u(pe,{class:"row q-col-gutter-sm"},{default:x(()=>[n("div",Te,[u(F,{modelValue:l.filters.search,"onUpdate:modelValue":a[0]||(a[0]=t=>l.filters.search=t),dense:"",outlined:"",placeholder:"Buscar (RUNSA, nombre, carnet, celular...)",onKeyup:be(s.applyFilters,["enter"])},{append:x(()=>[u(ye,{name:"search"})]),_:1},8,["modelValue","onKeyup"])]),n("div",De,[u(V,{modelValue:l.filters.estado,"onUpdate:modelValue":a[1]||(a[1]=t=>l.filters.estado=t),options:["VIGENTE","VENCIDO","ACTIVO","INACTIVO"],dense:"",outlined:"",label:"Estado",clearable:""},null,8,["modelValue"])]),n("div",Fe,[u(V,{modelValue:l.filters.sexo,"onUpdate:modelValue":a[2]||(a[2]=t=>l.filters.sexo=t),options:l.sexoOptions,dense:"",outlined:"",label:"Sexo",clearable:""},null,8,["modelValue","options"])]),n("div",Oe,[u(F,{modelValue:l.filters.fecha_desde,"onUpdate:modelValue":a[3]||(a[3]=t=>l.filters.fecha_desde=t),type:"date",dense:"",outlined:"",label:"Desde"},null,8,["modelValue"])]),n("div",Qe,[u(F,{modelValue:l.filters.fecha_hasta,"onUpdate:modelValue":a[4]||(a[4]=t=>l.filters.fecha_hasta=t),type:"date",dense:"",outlined:"",label:"Hasta"},null,8,["modelValue"])]),n("div",Ee,[u(V,{modelValue:l.filters.departamento_id,"onUpdate:modelValue":[a[5]||(a[5]=t=>l.filters.departamento_id=t),s.onDepChange],options:s.depOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",dense:"",outlined:"",label:"Departamento"},null,8,["modelValue","options","onUpdate:modelValue"])]),n("div",Me,[u(V,{modelValue:l.filters.provincia_id,"onUpdate:modelValue":[a[6]||(a[6]=t=>l.filters.provincia_id=t),s.onProvChange],options:s.provOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",dense:"",outlined:"",label:"Provincia",disable:!l.filters.departamento_id},null,8,["modelValue","options","disable","onUpdate:modelValue"])]),n("div",Ue,[u(V,{modelValue:l.filters.municipio_id,"onUpdate:modelValue":a[7]||(a[7]=t=>l.filters.municipio_id=t),options:s.munOptions,"option-label":"label","option-value":"value","emit-value":"","map-options":"",dense:"",outlined:"",label:"Municipio",disable:!l.filters.provincia_id},null,8,["modelValue","options","disable"])]),n("div",Ae,[u(O,{color:"secondary",icon:"refresh",label:"Aplicar",loading:l.loading,onClick:s.applyFilters,"no-caps":""},null,8,["loading","onClick"]),u(O,{color:"primary",icon:"person_add",label:"Nuevo Productor",loading:l.loading,onClick:a[8]||(a[8]=t=>e.$router.push("/productores/crear")),"no-caps":""},null,8,["loading"])])]),_:1})]),_:1}),u(K,{flat:"",bordered:"",class:"relative-position"},{default:x(()=>[u(Se,{dense:"","wrap-cells":""},{default:x(()=>[a[13]||(a[13]=n("thead",null,[n("tr",{class:"bg-primary text-white"},[n("th",{class:"text-left"},"ID"),n("th",{class:"text-left"},"RUNSA"),n("th",{class:"text-left"},"Sub Cód."),n("th",{class:"text-left"},"Nombre completo"),n("th",{class:"text-left"},"CI"),n("th",{class:"text-left"},"Celular"),n("th",{class:"text-left"},"Comunidad"),n("th",{class:"text-left"},"Estado"),n("th",{class:"text-left"},"Registro")])],-1)),n("tbody",null,[(w(!0),T(_e,null,xe(l.rows,t=>(w(),T("tr",{key:t.id,class:"row-click",onClick:S=>s.openDetails(t)},[n("td",Le,f(t.id),1),n("td",je,f(t.runsa||"-"),1),n("td",Ke,f(t.sub_codigo||"-"),1),n("td",Re,[n("div",Ge,f(t.nombre_completo),1),n("div",We,f(t.municipio?.nombre_municipio||"-"),1)]),n("td",He,f(t.numcarnet),1),n("td",Je,f(t.num_celular||"-"),1),n("td",Xe,f(t.comunidad||"-"),1),n("td",Ye,[u(Ve,{color:s.chipColor(t.estado),"text-color":"white",size:"xs",class:"text-bold"},{default:x(()=>[G(f(t.estado),1)]),_:2},1032,["color"])]),n("td",Ze,f(t.fecha_registro),1)],8,ze))),128)),!l.loading&&l.rows.length===0?(w(),T("tr",$e,a[12]||(a[12]=[n("td",{colspan:"9",class:"text-center text-grey q-pa-md"},"No hay resultados",-1)]))):R("",!0)])]),_:1}),l.loading?(w(),T("div",et,[u(Ne,{indeterminate:"",size:"40px"})])):R("",!0),n("div",tt,[n("div",at,[a[14]||(a[14]=G("Total: ")),n("b",null,f(l.serverCount.toLocaleString()),1)]),n("div",lt,[u(V,{modelValue:l.pagination.perPage,"onUpdate:modelValue":[a[9]||(a[9]=t=>l.pagination.perPage=t),s.changePerPage],options:[10,25,50,100,150,200],dense:"",outlined:"",style:{width:"120px"},label:"Por página"},null,8,["modelValue","onUpdate:modelValue"]),u(we,{modelValue:l.pagination.page,"onUpdate:modelValue":[a[10]||(a[10]=t=>l.pagination.page=t),s.changePage],max:s.pageCount,"max-pages":"8","direction-links":"","boundary-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])])]),_:1})]),_:1})}const mt=fe(qe,[["render",nt],["__scopeId","data-v-b008eadc"]]);export{mt as default};
