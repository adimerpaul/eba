import{_ as C,c,o as f,w as a,a as e,P as u,d as p,a8 as b,ad as h,b as n,af as r,f as d,h as w,Q,e as _,t as x,O as y,aF as k,ah as N}from"./index-CIw5_lD5.js";import{Q as v,b as m}from"./format-BhR3NQet.js";import{Q as S,a as E}from"./QList-Dm1zGf74.js";import{Q as q,a as D}from"./QTable-Ct0_TMtd.js";import{Q as T}from"./QForm-Cp6hDrPd.js";import{Q as U}from"./QPage-DW16IjuN.js";import{C as g}from"./ClosePopup-TWXUNgng.js";import"./selection-CkO9BJfo.js";import"./QMarkupTable-CMUHV2IW.js";import"./QSelect-ZX3ju-q3.js";import"./use-fullscreen-DmYSS0WB.js";const I={name:"ClientesPage",data(){return{loading:!1,rows:[],columns:[{name:"actions",label:"Acciones",align:"right"},{name:"nombre_cliente",label:"Nombre",align:"left",field:"nombre_cliente"},{name:"nit",label:"NIT",align:"left",field:"nit"},{name:"telefono",label:"Teléfono",align:"left",field:"telefono"},{name:"email",label:"Email",align:"left",field:"email"},{name:"pais_destino",label:"País destino",align:"left",field:"pais_destino"},{name:"direccion",label:"Dirección",align:"left",field:"direccion"}],filter:"",dlg:{open:!1,mode:"create",row:null},form:{nit:"",nombre_cliente:"",direccion:"",telefono:"",email:"",pais_destino:""},saving:!1}},computed:{canSubmit(){return!!this.form.nombre_cliente}},mounted(){this.fetch()},methods:{async fetch(){this.loading=!0;try{const t={};this.filter&&(t.q=this.filter);const{data:l}=await this.$axios.get("/clientes",{params:t});this.rows=Array.isArray(l)?l:l.data||[]}catch(t){this.$q.notify({type:"negative",message:t.response?.data?.message||"Error al listar clientes"})}finally{this.loading=!1}},fetchDebounced:(()=>{let t;return function(){clearTimeout(t),t=setTimeout(()=>this.fetch(),350)}})(),openCreate(){this.dlg={open:!0,mode:"create",row:null},this.form={nit:"",nombre_cliente:"",direccion:"",telefono:"",email:"",pais_destino:""}},openEdit(t){this.dlg={open:!0,mode:"edit",row:t},this.form={nit:t.nit||"",nombre_cliente:t.nombre_cliente||"",direccion:t.direccion||"",telefono:t.telefono||"",email:t.email||"",pais_destino:t.pais_destino||""}},async onSubmit(){if(this.canSubmit){this.saving=!0;try{this.dlg.mode==="create"?await this.$axios.post("/clientes",this.form):await this.$axios.put(`/clientes/${this.dlg.row.id}`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.dlg.open=!1,await this.fetch()}catch(t){this.$q.notify({type:"negative",message:t.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}}},async onDelete(t){this.$q.dialog({title:"Eliminar",message:`¿Eliminar el cliente ${t.nombre_cliente}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{await this.$axios.delete(`/clientes/${t.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),await this.fetch()}catch(l){this.$q.notify({type:"negative",message:l.response?.data?.message||"No se pudo eliminar"})}})}}},B={class:"row items-center q-gutter-sm"},P={class:"row q-col-gutter-md"},A={class:"col-12 col-md-6"},O={class:"col-12 col-md-6"},z={class:"col-12"},F={class:"col-12 col-md-6"},G={class:"col-12 col-md-6"},R={class:"col-12 col-md-6"};function L(t,l,M,j,i,s){return f(),c(U,{class:"q-pa-md"},{default:a(()=>[e(q,{rows:i.rows,columns:i.columns,"row-key":"id",flat:"",bordered:"",dense:"","wrap-cells":"","rows-per-page-options":[0],title:"Clientes",loading:i.loading,filter:i.filter},{"top-right":a(()=>[n("div",B,[e(r,{modelValue:i.filter,"onUpdate:modelValue":[l[0]||(l[0]=o=>i.filter=o),s.fetchDebounced],dense:"",outlined:"",placeholder:"Buscar por nombre, NIT, email, país"},{append:a(()=>[e(p,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"]),e(d,{color:"positive",icon:"add_circle_outline",label:"Nuevo","no-caps":"",loading:i.loading,onClick:s.openCreate},null,8,["loading","onClick"]),e(d,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",loading:i.loading,onClick:s.fetch},null,8,["loading","onClick"])])]),"body-cell-actions":a(o=>[e(D,{props:o,class:"text-right"},{default:a(()=>[e(S,{label:"Opciones",dense:"",color:"primary","no-caps":"",size:"10px"},{default:a(()=>[e(E,null,{default:a(()=>[u((f(),c(v,{clickable:"",onClick:V=>s.openEdit(o.row)},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(p,{name:"edit"})]),_:1}),e(m,null,{default:a(()=>l[8]||(l[8]=[b("Editar")])),_:1})]),_:2},1032,["onClick"])),[[h],[g]]),u((f(),c(v,{clickable:"",onClick:V=>s.onDelete(o.row)},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(p,{name:"delete",color:"negative"})]),_:1}),e(m,null,{default:a(()=>l[9]||(l[9]=[n("span",{class:"text-negative"},"Eliminar",-1)])),_:1})]),_:2},1032,["onClick"])),[[h],[g]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading","filter"]),e(w,{modelValue:i.dlg.open,"onUpdate:modelValue":l[7]||(l[7]=o=>i.dlg.open=o),persistent:""},{default:a(()=>[e(Q,{style:{"min-width":"520px","max-width":"760px"}},{default:a(()=>[e(_,{class:"text-h6"},{default:a(()=>[b(x(i.dlg.mode==="create"?"Nuevo Cliente":"Editar Cliente"),1)]),_:1}),e(y),e(_,null,{default:a(()=>[e(T,{onSubmit:k(s.onSubmit,["prevent"]),ref:"formRef"},{default:a(()=>[n("div",P,[n("div",A,[e(r,{modelValue:i.form.nombre_cliente,"onUpdate:modelValue":l[1]||(l[1]=o=>i.form.nombre_cliente=o),dense:"",filled:"",label:"Nombre del cliente"},null,8,["modelValue"])]),n("div",O,[e(r,{modelValue:i.form.nit,"onUpdate:modelValue":l[2]||(l[2]=o=>i.form.nit=o),dense:"",filled:"",label:"NIT"},null,8,["modelValue"])]),n("div",z,[e(r,{modelValue:i.form.direccion,"onUpdate:modelValue":l[3]||(l[3]=o=>i.form.direccion=o),dense:"",filled:"",label:"Dirección",type:"textarea",autogrow:""},null,8,["modelValue"])]),n("div",F,[e(r,{modelValue:i.form.telefono,"onUpdate:modelValue":l[4]||(l[4]=o=>i.form.telefono=o),dense:"",filled:"",label:"Teléfono"},null,8,["modelValue"])]),n("div",G,[e(r,{modelValue:i.form.email,"onUpdate:modelValue":l[5]||(l[5]=o=>i.form.email=o),dense:"",filled:"",label:"Email",type:"email"},null,8,["modelValue"])]),n("div",R,[e(r,{modelValue:i.form.pais_destino,"onUpdate:modelValue":l[6]||(l[6]=o=>i.form.pais_destino=o),dense:"",filled:"",label:"País destino"},null,8,["modelValue"])])])]),_:1},8,["onSubmit"])]),_:1}),e(y),e(N,{align:"right"},{default:a(()=>[u(e(d,{flat:"",label:"Cancelar"},null,512),[[g]]),e(d,{color:"primary",loading:i.saving,disable:!s.canSubmit,label:"Guardar",onClick:s.onSubmit},null,8,["loading","disable","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const te=C(I,[["render",L],["__scopeId","data-v-9527fa0b"]]);export{te as default};
