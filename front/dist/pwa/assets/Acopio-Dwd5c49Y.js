import{_,c,o as d,w as s,a as l,Q as y,e as p,b as e,I as E,a7 as u,ax as v,ad as f,f as h,a8 as x,a9 as O,J as k,d as b,a5 as g,aa as w,t as n}from"./index-4DSCWvoj.js";import{Q as S}from"./QSelect-DoSur-gS.js";import{Q as N}from"./QForm-D_4x_a9y.js";import{Q as V,b as C,d as A}from"./format-DOSyBnYL.js";import{Q as B}from"./QList-FqUTQEYo.js";import{Q as F}from"./QBtnDropdown-D3oBBd7h.js";import{Q as I}from"./QMarkupTable-C2lb6Iyg.js";import{Q as D}from"./QPage-pRGQFVuS.js";import{h as Q}from"./moment-C5S46NFB.js";import"./selection-CSt4UsTX.js";const U={name:"AcopioPage",data:function(){return{acopioCosechas:[],loading:!1,fechaInicio:Q().startOf("month").format("YYYY-MM-DD"),fechaFin:Q().endOf("month").format("YYYY-MM-DD"),estados:[{label:"BUENO",value:"BUENO"},{label:"EN PROCESO",value:"EN_PROCESO"},{label:"CANCELADO",value:"CANCELADO"}],estadoSeleccionado:null}},mounted(){this.buscarCosechas()},methods:{async generarExcel(){this.loading=!0,await this.$axios.post("acopioExcel",{fecha_inicio:this.fechaInicio,fecha_fin:this.fechaFin,estado:this.estadoSeleccionado},{responseType:"blob"}).then(o=>{const t=new Blob([o.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=window.URL.createObjectURL(t),i=document.createElement("a");i.href=r,i.setAttribute("download","acopio.xlsx"),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(r)}).catch(o=>{this.$alert?.error?.(o.response?.data?.message||"No se pudo generar el reporte.")}).finally(()=>{this.loading=!1})},buscarCosechas(){this.loading=!0,this.$axios.get("/acopio/cosechas",{params:{fecha_inicio:this.fechaInicio,fecha_fin:this.fechaFin,estado:this.estadoSeleccionado}}).then(o=>{this.acopioCosechas=o.data}).finally(()=>{this.loading=!1})}}},L={class:"row q-gutter-sm"},R={class:"col-12 col-md-2"},Y={class:"col-12 col-md-2"},j={class:"col-12 col-md-3"},M={class:"col-12 col-md-2 flex flex-center"},P={class:"col-12 col-md-2 flex flex-center"},$={key:1,class:"text-center q-pa-md"};function T(o,t,r,i,q,m){return d(),c(D,{class:"q-pa-xs"},{default:s(()=>[l(y,null,{default:s(()=>[l(p,null,{default:s(()=>t[3]||(t[3]=[e("div",{class:"text-h6"},"Acopio de Cosechas",-1)])),_:1}),l(E),l(p,null,{default:s(()=>[l(N,{onSubmit:v(m.buscarCosechas,["prevent"])},{default:s(()=>[e("div",L,[e("div",R,[l(f,{modelValue:o.fechaInicio,"onUpdate:modelValue":t[0]||(t[0]=a=>o.fechaInicio=a),label:"Fecha Inicio",type:"date",dense:"",outlined:""},null,8,["modelValue"])]),e("div",Y,[l(f,{modelValue:o.fechaFin,"onUpdate:modelValue":t[1]||(t[1]=a=>o.fechaFin=a),label:"Fecha Fin",type:"date",dense:"",outlined:""},null,8,["modelValue"])]),e("div",j,[l(S,{modelValue:o.estadoSeleccionado,"onUpdate:modelValue":t[2]||(t[2]=a=>o.estadoSeleccionado=a),options:o.estados,label:"Estado de Cosecha",dense:"",outlined:"",clearable:""},null,8,["modelValue","options"])]),e("div",M,[l(h,{loading:o.loading,label:"Buscar Cosechas",type:"submit",color:"primary","no-caps":"",icon:"search"},null,8,["loading"])]),e("div",P,[l(h,{loading:o.loading,label:"EXCEL",color:"green",onClick:m.generarExcel},null,8,["loading","onClick"])])])]),_:1},8,["onSubmit"]),o.acopioCosechas.length>0?(d(),c(I,{key:0,dense:"","wrap-cells":"",flat:"",bordered:""},{default:s(()=>[t[5]||(t[5]=e("thead",null,[e("tr",{class:"bg-primary text-white"},[e("th",null,"Opciones"),e("th",null,"Fecha Cosecha"),e("th",null,"Productor"),e("th",null,"Cantidad (kg)"),e("th",null,"Humedad (%)"),e("th",null,"Temperatura Almacenaje (°C)"),e("th",null,"Número Acta"),e("th",null,"Condiciones Almacenaje"),e("th",null,"Estado")])],-1)),e("tbody",null,[(d(!0),u(x,null,O(o.acopioCosechas,a=>(d(),u("tr",{key:a.id},[e("td",null,[l(F,{dense:"",label:"Opciones",color:"primary","no-caps":"",size:"10px"},{default:s(()=>[l(B,null,{default:s(()=>[k((d(),c(V,{clickable:"",to:`/acopio/cosechas/${a.id}`},{default:s(()=>[l(C,{avatar:""},{default:s(()=>[l(b,{name:"visibility"})]),_:1}),l(C,null,{default:s(()=>t[4]||(t[4]=[g("Ver Detalles")])),_:1})]),_:2},1032,["to"])),[[w]])]),_:2},1024)]),_:2},1024)]),e("td",null,n(a.fecha_cosecha),1),e("td",null,n(a.apiario?.productor.nombre)+" "+n(a.apiario?.productor.apellidos),1),e("td",null,n(a.cantidad_kg),1),e("td",null,n(a.humedad),1),e("td",null,n(a.temperatura_almacenaje),1),e("td",null,n(a.num_acta),1),e("td",null,n(a.condiciones_almacenaje),1),e("td",null,[l(A,{color:a.estado==="BUENO"?"green":a.estado==="EN_PROCESO"?"orange":"red","text-color":"white",dense:"",size:"10px"},{default:s(()=>[g(n(a.estado.replace("_"," ")),1)]),_:2},1032,["color"])])]))),128))])]),_:1})):(d(),u("div",$,[l(b,{name:"info",size:"48px",color:"grey-5"}),t[6]||(t[6]=e("div",{class:"text-subtitle2 text-grey-5"},"No se encontraron cosechas.",-1))]))]),_:1})]),_:1})]),_:1})}const oe=_(U,[["render",T]]);export{oe as default};
