import{_ as P,i as v,c as x,o as n,w as a,b as t,a as o,Q as u,e as l,a8 as i,O as b,af as k,f as M,t as r,aa as c,a9 as y,ab as C,ac as $}from"./index-FiRxq5PK.js";import{Q as w}from"./QBadge-DEBj-7sB.js";import{Q}from"./QMarkupTable-BZZhU-Bw.js";import{Q as A}from"./QPage-B80xAG9B.js";import{C as _}from"./auto-DHENdVy-.js";import{h as R}from"./moment-C5S46NFB.js";const F=v({name:"IndexPage",data(){return{gestion:R().format("YYYY"),loading:!1,resumenMes:{labels:[],data:[]},resumenProducto:{labels:[],data:[]},chartMes:null,chartProducto:null}},computed:{totalKgAno(){return this.resumenMes.data?this.resumenMes.data.reduce((s,d)=>s+(parseFloat(d)||0),0).toFixed(2):"0.00"},totalKgProductos(){return this.resumenProducto.data?this.resumenProducto.data.reduce((s,d)=>s+(parseFloat(d)||0),0).toFixed(2):"0.00"}},mounted(){this.fetchResumen()},beforeUnmount(){this.chartMes&&this.chartMes.destroy(),this.chartProducto&&this.chartProducto.destroy()},methods:{async fetchResumen(){this.loading=!0;try{await Promise.all([this.fetchResumenMensual(),this.fetchResumenPorProducto()])}finally{this.loading=!1}},async fetchResumenMensual(){try{const{data:e}=await this.$axios.get("acopiore2",{params:{year:this.gestion}});this.resumenMes={labels:e.labels||[],data:e.data||[]},this.renderChartMes()}catch(e){console.error(e),this.$alert?.error?.("Error al cargar resumen mensual de acopios")}},async fetchResumenPorProducto(){try{const{data:e}=await this.$axios.get("acopiore1",{params:{year:this.gestion}});this.resumenProducto={labels:e.labels||[],data:e.data||[]},this.renderChartProducto()}catch(e){console.error(e),this.$alert?.error?.("Error al cargar resumen por producto")}},renderChartMes(){if(!this.$refs.graficoMes){console.error("Canvas graficoMes no montado aún");return}this.chartMes&&this.chartMes.destroy(),this.chartMes=new _(this.$refs.graficoMes,{type:"bar",data:{labels:this.resumenMes.labels,datasets:[{label:"Kg acopiados",data:this.resumenMes.data,backgroundColor:"rgba(54, 162, 235, 0.7)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:e=>`${e.parsed.y} kg`}},title:{display:!1}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Kg"}}}}})},renderChartProducto(){if(!this.$refs.graficoProducto){console.error("Canvas graficoProducto no montado aún");return}this.chartProducto&&this.chartProducto.destroy(),this.chartProducto=new _(this.$refs.graficoProducto,{type:"doughnut",data:{labels:this.resumenProducto.labels,datasets:[{label:"Kg acopiados",data:this.resumenProducto.data,backgroundColor:["rgba(54, 162, 235, 0.7)","rgba(255, 99, 132, 0.7)","rgba(255, 206, 86, 0.7)","rgba(75, 192, 192, 0.7)","rgba(153, 102, 255, 0.7)","rgba(255, 159, 64, 0.7)"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right"},tooltip:{callbacks:{label:e=>{const s=e.parsed,d=this.resumenProducto.data.reduce((m,f)=>m+(parseFloat(f)||0),0),g=d>0?(s/d*100).toFixed(1):0;return`${e.label}: ${s.toFixed(2)} kg (${g}%)`}}},title:{display:!1}}}})}}}),K={class:"row q-col-gutter-md"},V={class:"col-12 col-md-3"},q={class:"text-subtitle2 q-mb-xs"},B={class:"text-h5 text-weight-bold"},T={class:"text-caption text-grey-7"},S={class:"col-12 col-md-9"},D={class:"row items-center"},I={class:"col-grow"},N={class:"text-subtitle1 text-weight-bold"},Y={class:"col-auto"},E={class:"chart-container"},G={ref:"graficoMes"},L={class:"col-12 col-md-6"},O={class:"text-caption text-grey-7"},U={key:0},W={class:"chart-container"},j={ref:"graficoProducto"},z={class:"col-12 col-md-6"},Z={class:"text-left"},H={class:"text-right"},J={key:0},X={class:"text-right"};function tt(e,s,d,g,m,f){return n(),x(A,{class:"q-pa-md bg-grey-2"},{default:a(()=>[t("div",K,[t("div",V,[o(u,{flat:"",bordered:""},{default:a(()=>[o(l,null,{default:a(()=>s[1]||(s[1]=[t("div",{class:"text-h6 text-primary"}," Resumen de Acopios ",-1),t("div",{class:"text-caption text-grey-7"},[i(" Datos desde la tabla "),t("b",null,"acopio_cosechas")],-1)])),_:1}),o(b),o(l,null,{default:a(()=>[o(k,{modelValue:e.gestion,"onUpdate:modelValue":s[0]||(s[0]=h=>e.gestion=h),type:"number",label:"Gestión",dense:"",outlined:"",class:"q-mb-sm"},null,8,["modelValue"]),o(M,{color:"primary",icon:"refresh",label:"Actualizar",dense:"","no-caps":"",loading:e.loading,class:"full-width q-mb-md",onClick:e.fetchResumen},null,8,["loading","onClick"]),t("div",q," Total acopiado "+r(e.gestion),1),t("div",B,r(e.totalKgAno)+" kg ",1),o(b,{class:"q-my-md"}),t("div",T,[s[2]||(s[2]=i(" Productos en gráfico: ")),t("b",null,r(e.resumenProducto.labels.length),1)])]),_:1})]),_:1})]),t("div",S,[o(u,{flat:"",bordered:""},{default:a(()=>[o(l,null,{default:a(()=>[t("div",D,[t("div",I,[t("div",N," Acopio mensual (kg) - Gestión "+r(e.gestion),1),s[3]||(s[3]=t("div",{class:"text-caption text-grey-7"},[i(" Suma de "),t("b",null,"cantidad_kg"),i(" por mes ")],-1))]),t("div",Y,[o(w,{color:"primary",outline:""},{default:a(()=>[i(" Total: "+r(e.totalKgAno)+" kg ",1)]),_:1})])])]),_:1}),o(l,null,{default:a(()=>[t("div",E,[t("canvas",G,null,512)])]),_:1})]),_:1})]),t("div",L,[o(u,{flat:"",bordered:""},{default:a(()=>[o(l,null,{default:a(()=>[s[7]||(s[7]=t("div",{class:"text-subtitle1 text-weight-bold"}," Distribución por producto (kg) ",-1)),t("div",O,[s[4]||(s[4]=i(" Suma de ")),s[5]||(s[5]=t("b",null,"cantidad_kg",-1)),s[6]||(s[6]=i(" por producto ")),e.gestion?(n(),c("span",U," en "+r(e.gestion),1)):y("",!0)])]),_:1}),o(l,null,{default:a(()=>[t("div",W,[t("canvas",j,null,512)])]),_:1})]),_:1})]),t("div",z,[o(u,{flat:"",bordered:""},{default:a(()=>[o(l,null,{default:a(()=>s[8]||(s[8]=[t("div",{class:"text-subtitle1 text-weight-bold"}," Detalle por producto ",-1)])),_:1}),o(l,null,{default:a(()=>[o(Q,{dense:"",flat:"",bordered:""},{default:a(()=>[s[10]||(s[10]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Producto"),t("th",{class:"text-right"},"Kg acopiados")])],-1)),t("tbody",null,[(n(!0),c(C,null,$(e.resumenProducto.labels,(h,p)=>(n(),c("tr",{key:p},[t("td",Z,r(h),1),t("td",H,r((e.resumenProducto.data[p]??0).toFixed(2)),1)]))),128)),e.resumenProducto.labels.length?(n(),c("tr",J,[s[9]||(s[9]=t("td",{class:"text-right"},[t("strong",null,"TOTAL")],-1)),t("td",X,[t("strong",null,r(e.totalKgProductos)+" kg",1)])])):y("",!0)])]),_:1})]),_:1})]),_:1})])])]),_:1})}const dt=P(F,[["render",tt],["__scopeId","data-v-383c55fe"]]);export{dt as default};
