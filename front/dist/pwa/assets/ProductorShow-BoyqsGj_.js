import{_ as S,c as m,o as n,w as a,b as r,a as e,f as u,a7 as v,a6 as I,a8 as A,a9 as R,t as i,J as p,d as E,a5 as x,aa as k,h as D,Q as q,e as f,I as w,ad as c,a4 as h}from"./index-4XRnpLzQ.js";import{Q as P}from"./QSpace-B31R1fGl.js";import{Q as H,a as g,b as J,c as _}from"./QTabPanels-DFkhSbJG.js";import{Q as K}from"./QPage-GQ58fr7j.js";import{P as W}from"./ProductorForm-C6CCL4VR.js";import{P as X,a as Y,b as Z}from"./ProductorMapa-Bnrb9Bx_.js";import{Q as U,b,d as O}from"./format-PTEoBpqY.js";import{Q as T}from"./QList-BEz4ZwlF.js";import{Q as G}from"./QBtnDropdown-BPWbn-1c.js";import{Q as z}from"./QMarkupTable-B1uuRUOi.js";import{Q as B}from"./QSelect-C0NVWp7I.js";import{Q as j}from"./QForm-nJslZedo.js";import{C as y}from"./ClosePopup-CiiCx1Fd.js";import"./moment-C5S46NFB.js";import"./QResizeObserver-iuBcbhQ5.js";import"./use-panel-U8chl6rM.js";import"./touch-BjYP5sR0.js";import"./selection-COZTZ3DS.js";import"./QBanner-DhefAlKt.js";import"./marker-shadow-pDHLJ3-B.js";import"./QBadge-cwbxOQFE.js";const oo={name:"ProductorRunsas",props:{productor:{type:Object,required:!0}},emits:["updated"],data(){return{loading:!1,saving:!1,list:[],dlg:{open:!1},form:this.emptyForm()}},mounted(){this.hydrateFromProductor()},watch:{productor(){this.hydrateFromProductor()}},methods:{hydrateFromProductor(){this.productor?.runsas?this.list=this.productor.runsas:this.fetchRunsas()},async fetchRunsas(){console.log(this.productor),this.loading=!0;try{const{data:o}=await this.$axios.get("runsas",{params:{productor_id:this.productor.id,paginate:!1}});console.log(o),this.list=Array.isArray(o)?o:o?.data||[]}catch(o){console.log(o),this.list=[],this.$alert?.error?.(o.response?.data?.message||"No se pudo cargar runsas")}finally{this.loading=!1}},emptyForm(){return{id:null,productor_id:this.productor?.id||null,codigo:null,subcodigo:"",fecha_registro:null,fecha_vencimiento:null,estado:"VIGENTE"}},chip(o){return o==="VIGENTE"?"green":o==="VENCIDO"?"red":o==="SUSPENDIDO"?"orange":"grey"},startCreate(){this.form=this.emptyForm(),this.form.productor_id=this.productor?.id||null,this.dlg.open=!0},startEdit(o){this.form={id:o.id,productor_id:this.productor?.id||o.productor_id,codigo:o.codigo||null,subcodigo:o.subcodigo||"",fecha_registro:o.fecha_registro||null,fecha_vencimiento:o.fecha_vencimiento||null,estado:o.estado||"VIGENTE"},this.dlg.open=!0},async submit(){if(this.productor?.id){this.saving=!0;try{const o={...this.form,productor_id:this.productor.id};o.id?await this.$axios.put(`runsas/${o.id}`,o):await this.$axios.post("runsas",o),this.$alert?.success?.(o.id?"Runsa actualizada":"Runsa creada"),this.dlg.open=!1,this.$emit("updated")}catch(o){this.$alert?.error?.(o.response?.data?.message||"No se pudo guardar")}finally{this.saving=!1}}},remove(o){this.$alert?.dialog?.("¿Eliminar runsa?")?.onOk(async()=>{try{await this.$axios.delete(`runsas/${o.id}`),this.$alert?.success?.("Eliminado"),this.$emit("updated")}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo eliminar")}})}}},eo={class:"row items-center q-gutter-sm q-mb-sm"},to={key:0},ro={class:"text-h6"},so={class:"col-12 col-sm-4"},lo={class:"col-12 col-sm-8"},ao={class:"col-6 col-sm-3"},io={class:"col-6 col-sm-3"},no={class:"col-12 col-sm-3"},uo={class:"col-12 text-right q-gutter-sm q-mt-sm"};function co(o,t,N,F,s,d){return n(),m(f,null,{default:a(()=>[r("div",eo,[t[6]||(t[6]=r("div",{class:"text-subtitle1"},"Certificaciones Runsa",-1)),e(P),e(u,{dense:"",color:"primary",icon:"add_circle",label:"Nueva",onClick:d.startCreate,disable:s.saving,"no-caps":""},null,8,["onClick","disable"])]),e(z,{dense:""},{default:a(()=>[t[10]||(t[10]=r("thead",null,[r("tr",{class:"bg-grey-3"},[r("th",{class:"text-left"},"#"),r("th",{class:"text-left",style:{width:"120px"}},"Opciones"),r("th",{class:"text-left"},"Codigo"),r("th",{class:"text-left"},"Subcodigo"),r("th",{class:"text-left"},"Registro"),r("th",{class:"text-left"},"Vencimiento"),r("th",{class:"text-left"},"Estado")])],-1)),r("tbody",null,[(n(!0),v(A,null,R(s.list||[],(l,C)=>(n(),v("tr",{key:l.id||C},[r("td",null,i(C+1),1),r("td",null,[e(G,{dense:"",label:"Opciones",color:"primary","no-caps":"",size:"10px"},{default:a(()=>[e(T,null,{default:a(()=>[p((n(),m(U,{clickable:"",onClick:Q=>d.startEdit(l)},{default:a(()=>[e(b,{avatar:""},{default:a(()=>[e(E,{name:"edit"})]),_:1}),e(b,null,{default:a(()=>t[7]||(t[7]=[x("Editar")])),_:1})]),_:2},1032,["onClick"])),[[k],[y]]),p((n(),m(U,{clickable:"",onClick:Q=>d.remove(l)},{default:a(()=>[e(b,{avatar:""},{default:a(()=>[e(E,{name:"delete",class:"text-negative"})]),_:1}),e(b,{class:"text-negative"},{default:a(()=>t[8]||(t[8]=[x("Eliminar")])),_:1})]),_:2},1032,["onClick"])),[[k],[y]])]),_:2},1024)]),_:2},1024)]),r("td",null,i(l.codigo||"-"),1),r("td",null,i(l.subcodigo||"-"),1),r("td",null,i(l.fecha_registro||"-"),1),r("td",null,i(l.fecha_vencimiento||"-"),1),r("td",null,[e(O,{color:d.chip(l.estado),"text-color":"white",size:"xs",class:"text-bold"},{default:a(()=>[x(i(l.estado),1)]),_:2},1032,["color"])])]))),128)),!s.loading&&(N.productor?.runsas?.length||0)===0?(n(),v("tr",to,t[9]||(t[9]=[r("td",{colspan:"8",class:"text-center text-grey"},"Sin registros",-1)]))):I("",!0)])]),_:1}),e(D,{modelValue:s.dlg.open,"onUpdate:modelValue":t[5]||(t[5]=l=>s.dlg.open=l),persistent:""},{default:a(()=>[e(q,{style:{"min-width":"720px","max-width":"95vw"}},{default:a(()=>[e(f,{class:"row items-center q-gutter-sm"},{default:a(()=>[r("div",ro,i(s.form.id?"Editar runsa":"Nueva runsa"),1),e(P),p(e(u,{flat:"",round:"",dense:"",icon:"close"},null,512),[[y]])]),_:1}),e(w),e(f,null,{default:a(()=>[e(j,{onSubmit:d.submit,class:"row q-col-gutter-sm"},{default:a(()=>[r("div",so,[e(c,{modelValue:s.form.codigo,"onUpdate:modelValue":t[0]||(t[0]=l=>s.form.codigo=l),dense:"",outlined:"",label:"Codigo",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"])]),r("div",lo,[e(c,{modelValue:s.form.subcodigo,"onUpdate:modelValue":t[1]||(t[1]=l=>s.form.subcodigo=l),dense:"",outlined:"",label:"Subcodigo"},null,8,["modelValue"])]),r("div",ao,[e(c,{modelValue:s.form.fecha_registro,"onUpdate:modelValue":t[2]||(t[2]=l=>s.form.fecha_registro=l),type:"date",dense:"",outlined:"",label:"Fec Registro"},null,8,["modelValue"])]),r("div",io,[e(c,{modelValue:s.form.fecha_vencimiento,"onUpdate:modelValue":t[3]||(t[3]=l=>s.form.fecha_vencimiento=l),type:"date",dense:"",outlined:"",label:"Fec Vencimiento"},null,8,["modelValue"])]),r("div",no,[e(B,{modelValue:s.form.estado,"onUpdate:modelValue":t[4]||(t[4]=l=>s.form.estado=l),options:["VIGENTE","VENCIDO","SUSPENDIDO"],dense:"",outlined:"",label:"Estado"},null,8,["modelValue"])]),r("div",uo,[p(e(u,{flat:"",color:"grey",label:"Cancelar",disable:s.saving},null,8,["disable"]),[[y]]),e(u,{color:"primary",label:s.form.id?"Guardar cambios":"Crear",type:"submit",loading:s.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const mo=S(oo,[["render",co]]),po={name:"ProductorAcopios",props:{productor:{type:Object,required:!0}},emits:["updated"],data(){return{loading:!1,saving:!1,list:[],dlg:{open:!1},form:this.emptyForm(),acopioCosechas:[]}},mounted(){this.hydrateFromProductor()},watch:{productor(){this.hydrateFromProductor()}},methods:{async fetchAcopio(){this.loading=!0,console.log(this.productor),await this.$axios.post("/productorAcopios",{productor_id:this.productor.id}).then(o=>{console.log(o),this.acopioCosechas=o.data}).catch(o=>{console.log(o),this.$alert?.error?.(o.response?.data?.message||"No se pudo cargar las cosechas")}).finally(()=>{this.loading=!1})},hydrateFromProductor(){this.fetchAcopio()},async fetchRunsas(){console.log(this.productor),this.loading=!0;try{const{data:o}=await this.$axios.get("runsas",{params:{productor_id:this.productor.id,paginate:!1}});console.log(o),this.list=Array.isArray(o)?o:o?.data||[]}catch(o){console.log(o),this.list=[],this.$alert?.error?.(o.response?.data?.message||"No se pudo cargar runsas")}finally{this.loading=!1}},emptyForm(){return{id:null,productor_id:this.productor?.id||null,codigo:null,subcodigo:"",fecha_registro:null,fecha_vencimiento:null,estado:"VIGENTE"}},chip(o){return o==="VIGENTE"?"green":o==="VENCIDO"?"red":o==="SUSPENDIDO"?"orange":"grey"},startCreate(){this.form=this.emptyForm(),this.form.productor_id=this.productor?.id||null,this.dlg.open=!0},startEdit(o){this.form={id:o.id,productor_id:this.productor?.id||o.productor_id,codigo:o.codigo||null,subcodigo:o.subcodigo||"",fecha_registro:o.fecha_registro||null,fecha_vencimiento:o.fecha_vencimiento||null,estado:o.estado||"VIGENTE"},this.dlg.open=!0},async submit(){if(this.productor?.id){this.saving=!0;try{const o={...this.form,productor_id:this.productor.id};o.id?await this.$axios.put(`runsas/${o.id}`,o):await this.$axios.post("runsas",o),this.$alert?.success?.(o.id?"Runsa actualizada":"Runsa creada"),this.dlg.open=!1,this.$emit("updated")}catch(o){this.$alert?.error?.(o.response?.data?.message||"No se pudo guardar")}finally{this.saving=!1}}},remove(o){this.$alert?.dialog?.("¿Eliminar runsa?")?.onOk(async()=>{try{await this.$axios.delete(`runsas/${o.id}`),this.$alert?.success?.("Eliminado"),this.$emit("updated")}catch(t){this.$alert?.error?.(t.response?.data?.message||"No se pudo eliminar")}})}}},fo={class:"row items-center q-gutter-sm q-mb-sm"},ho={key:1,class:"text-center q-pa-md"},go={class:"text-h6"},_o={class:"col-12 col-sm-4"},bo={class:"col-12 col-sm-8"},yo={class:"col-6 col-sm-3"},vo={class:"col-6 col-sm-3"},Vo={class:"col-12 col-sm-3"},xo={class:"col-12 text-right q-gutter-sm q-mt-sm"};function Po(o,t,N,F,s,d){return n(),m(f,null,{default:a(()=>[r("div",fo,[t[6]||(t[6]=r("div",{class:"text-subtitle1"},"Acopios Proveedor",-1)),e(P)]),s.acopioCosechas.length>0?(n(),m(z,{key:0,dense:"","wrap-cells":"",flat:"",bordered:""},{default:a(()=>[t[8]||(t[8]=r("thead",null,[r("tr",{class:"bg-primary text-white"},[r("th",null,"Opciones"),r("th",null,"Fecha Cosecha"),r("th",null,"Productor"),r("th",null,"Cantidad (kg)"),r("th",null,"Humedad (%)"),r("th",null,"Temperatura Almacenaje (°C)"),r("th",null,"Número Acta"),r("th",null,"Condiciones Almacenaje"),r("th",null,"Estado")])],-1)),r("tbody",null,[(n(!0),v(A,null,R(s.acopioCosechas,l=>(n(),v("tr",{key:l.id},[r("td",null,[e(G,{dense:"",label:"Opciones",color:"primary","no-caps":"",size:"10px"},{default:a(()=>[e(T,null,{default:a(()=>[p((n(),m(U,{clickable:"",to:`/acopio/cosechas/${l.id}`},{default:a(()=>[e(b,{avatar:""},{default:a(()=>[e(E,{name:"visibility"})]),_:1}),e(b,null,{default:a(()=>t[7]||(t[7]=[x("Ver Detalles")])),_:1})]),_:2},1032,["to"])),[[k]])]),_:2},1024)]),_:2},1024)]),r("td",null,i(l.fecha_cosecha),1),r("td",null,i(l.apiario?.productor.nombre)+" "+i(l.apiario?.productor.apellidos),1),r("td",null,i(l.cantidad_kg),1),r("td",null,i(l.humedad),1),r("td",null,i(l.temperatura_almacenaje),1),r("td",null,i(l.num_acta),1),r("td",null,i(l.condiciones_almacenaje),1),r("td",null,[e(O,{color:l.estado==="BUENO"?"green":"red","text-color":"white",dense:"",size:"10px"},{default:a(()=>[x(i(l.estado.replace("_"," ")),1)]),_:2},1032,["color"])])]))),128))])]),_:1})):(n(),v("div",ho,[e(E,{name:"info",size:"48px",color:"grey-5"}),t[9]||(t[9]=r("div",{class:"text-subtitle2 text-grey-5"},"No se encontraron cosechas.",-1))])),e(D,{modelValue:s.dlg.open,"onUpdate:modelValue":t[5]||(t[5]=l=>s.dlg.open=l),persistent:""},{default:a(()=>[e(q,{style:{"min-width":"720px","max-width":"95vw"}},{default:a(()=>[e(f,{class:"row items-center q-gutter-sm"},{default:a(()=>[r("div",go,i(s.form.id?"Editar runsa":"Nueva runsa"),1),e(P),p(e(u,{flat:"",round:"",dense:"",icon:"close"},null,512),[[y]])]),_:1}),e(w),e(f,null,{default:a(()=>[e(j,{onSubmit:d.submit,class:"row q-col-gutter-sm"},{default:a(()=>[r("div",_o,[e(c,{modelValue:s.form.codigo,"onUpdate:modelValue":t[0]||(t[0]=l=>s.form.codigo=l),dense:"",outlined:"",label:"Codigo",rules:[l=>!!l||"Requerido"]},null,8,["modelValue","rules"])]),r("div",bo,[e(c,{modelValue:s.form.subcodigo,"onUpdate:modelValue":t[1]||(t[1]=l=>s.form.subcodigo=l),dense:"",outlined:"",label:"Subcodigo"},null,8,["modelValue"])]),r("div",yo,[e(c,{modelValue:s.form.fecha_registro,"onUpdate:modelValue":t[2]||(t[2]=l=>s.form.fecha_registro=l),type:"date",dense:"",outlined:"",label:"Fec Registro"},null,8,["modelValue"])]),r("div",vo,[e(c,{modelValue:s.form.fecha_vencimiento,"onUpdate:modelValue":t[3]||(t[3]=l=>s.form.fecha_vencimiento=l),type:"date",dense:"",outlined:"",label:"Fec Vencimiento"},null,8,["modelValue"])]),r("div",Vo,[e(B,{modelValue:s.form.estado,"onUpdate:modelValue":t[4]||(t[4]=l=>s.form.estado=l),options:["VIGENTE","VENCIDO","SUSPENDIDO"],dense:"",outlined:"",label:"Estado"},null,8,["modelValue"])]),r("div",xo,[p(e(u,{flat:"",color:"grey",label:"Cancelar",disable:s.saving},null,8,["disable"]),[[y]]),e(u,{color:"primary",label:s.form.id?"Guardar cambios":"Crear",type:"submit",loading:s.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Co=S(po,[["render",Po]]),Eo={name:"ProductorShow",components:{ProductorMapa:Z,ProductorApiarios:Y,ProductorCertificaciones:X,ProductorForm:W,ProductorRunsa:mo,ProductorAcopios:Co},data(){return{tab:"general",loading:!1,productor:null}},mounted(){this.fetchProductor()},methods:{async fetchProductor(){this.loading=!0;try{const o=this.$route.params.id,{data:t}=await this.$axios.get(`productores/${o}`);this.productor=t}catch(o){this.productor=null,this.$alert?.error?.(o.response?.data?.message||"No se pudo cargar el productor")}finally{this.loading=!1}},onSaved(o){this.productor=o,this.$alert?.success?.("Cambios guardados")}}},No={class:"row items-center q-gutter-sm q-mb-md"};function Qo(o,t,N,F,s,d){const l=h("ProductorForm"),C=h("ProductorCertificaciones"),Q=h("ProductorRunsa"),M=h("ProductorApiarios"),$=h("ProductorMapa"),L=h("ProductorAcopios");return n(),m(K,{class:"q-pa-md"},{default:a(()=>[r("div",No,[e(u,{flat:"",round:"",icon:"arrow_back",onClick:t[0]||(t[0]=V=>o.$router.push("/productores"))}),t[4]||(t[4]=r("div",{class:"text-h6"},"Editar Productor",-1)),e(P),e(u,{flat:"",round:"",icon:"refresh",loading:s.loading,onClick:d.fetchProductor},null,8,["loading","onClick"])]),e(q,{flat:"",bordered:""},{default:a(()=>[e(H,{modelValue:s.tab,"onUpdate:modelValue":t[1]||(t[1]=V=>s.tab=V),class:"text-primary",align:"left",dense:""},{default:a(()=>[e(g,{name:"general",icon:"badge",label:"1) Información general","no-caps":""}),e(g,{name:"runsa",icon:"assured_workload",label:"2) Runsa","no-caps":""}),e(g,{name:"certs",icon:"verified",label:"3) Certificaciones","no-caps":""}),e(g,{name:"apiarios",icon:"hive",label:"4) Apiarios","no-caps":""}),e(g,{name:"mapa",icon:"map",label:"5) Mapa","no-caps":""}),e(g,{name:"acopio",icon:"send",label:"6) Acopio","no-caps":""})]),_:1},8,["modelValue"]),e(w),e(J,{modelValue:s.tab,"onUpdate:modelValue":t[3]||(t[3]=V=>s.tab=V),animated:""},{default:a(()=>[e(_,{name:"general",class:"q-pa-none"},{default:a(()=>[!s.loading&&s.productor?(n(),m(f,{key:0},{default:a(()=>[e(l,{productor:s.productor,"banner-msg":"Actualiza los datos y guarda los cambios",onSaved:d.onSaved,onCancel:t[2]||(t[2]=V=>o.$router.back())},null,8,["productor","onSaved"])]),_:1})):I("",!0)]),_:1}),e(_,{name:"certs",class:"q-pa-none"},{default:a(()=>[e(C,{productor:s.productor,onUpdated:d.fetchProductor},null,8,["productor","onUpdated"])]),_:1}),e(_,{name:"runsa",class:"q-pa-none"},{default:a(()=>[e(Q,{productor:s.productor,onUpdated:d.fetchProductor},null,8,["productor","onUpdated"])]),_:1}),e(_,{name:"apiarios",class:"q-pa-none"},{default:a(()=>[e(M,{productor:s.productor,onUpdated:d.fetchProductor},null,8,["productor","onUpdated"])]),_:1}),e(_,{name:"mapa",class:"q-pa-none"},{default:a(()=>[e($,{productor:s.productor,onUpdated:d.fetchProductor},null,8,["productor","onUpdated"])]),_:1}),e(_,{name:"acopio",class:"q-pa-none"},{default:a(()=>[e(L,{productor:s.productor,onUpdated:d.fetchProductor},null,8,["productor","onUpdated"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const Ko=S(Eo,[["render",Qo]]);export{Ko as default};
