import{Q as B,a as S,b as O,c as N}from"./QTabPanels-C0WRYe14.js";import{_ as Z,c,o as i,w as o,a as s,O as A,b as d,a9 as b,a8 as q,aa as _,ab as x,a7 as p,t as h,ad as j,d as g,P as U,f as u,ag as v,h as T,Q as V,e as y,ah as P,ai as M,aj as H}from"./index-BlKDBvQ5.js";import{Q as C,b as f,a as Q}from"./position-engine-C6RYylQK.js";import{Q as L}from"./QList-CtW7EQxk.js";import{Q as J}from"./QBtnDropdown-XEBgpxW1.js";import{Q as w}from"./QTd-CZruX_-d.js";import{Q as D}from"./QChip-CsUcH7aQ.js";import{Q as K}from"./QImg-CxrOCvsa.js";import{Q as W}from"./QTooltip-CQgyPbEx.js";import{Q as G}from"./QBadge-DjxiqQnk.js";import{Q as z}from"./QTable-Cev_6FcY.js";import{Q as R}from"./QSpace-CWkkK__K.js";import{Q as X}from"./QSelect-CrufDZ1L.js";import{Q as E}from"./QForm-CPNmOC2s.js";import{Q as Y}from"./QPage-9F4PkkBC.js";import{C as F}from"./ClosePopup-jQ9viJ4_.js";import"./QResizeObserver-DYiNlxGD.js";import"./use-panel-COilReTJ.js";import"./touch-BjYP5sR0.js";import"./selection-D8rj6CQm.js";import"./use-render-cache-DLxPkVnQ.js";import"./QBtnGroup-CTHu9_Bx.js";import"./format-Zk9it-h-.js";import"./QMarkupTable-Dr0zNr-8.js";import"./QLinearProgress-Bu1X8STu.js";import"./use-fullscreen-D3o4GhfS.js";const $={name:"UsuariosPage",data(){return{tab:"internos",users:[],user:{},userDialog:!1,loading:!1,actionUser:"",filter:"",rolesSelect:[],rolesList:[],rolesLoading:!1,columns:[{name:"actions",label:"Acciones",align:"center"},{name:"name",label:"Nombre",align:"left",field:"name"},{name:"username",label:"Usuario",align:"left",field:"username"},{name:"avatar",label:"Avatar",align:"left",field:r=>r.avatar},{name:"role",label:"Rol",align:"left",field:"role"},{name:"permissions",label:"Permisos",align:"left",field:r=>(r.permissions||[]).map(e=>e.name).join(", ")}],cambioAvatarDialogo:!1,bpUsers:[],loadingInternos:!1,filterInterno:"",bpColumns:[{name:"actions",label:"Acciones",align:"center"},{name:"usr_id",label:"ID",field:"usr_id",align:"left"},{name:"usr_usuario",label:"Usuario",field:"usr_usuario",align:"left"},{name:"traza",label:"TRAZA",field:"traza_activado",align:"center"},{name:"sistemas",label:"Sistemas",field:"usr_access_sistem",align:"left"}],dialogUserRoles:!1,rolesTargetType:null,rolesTargetId:null,rolesUserList:[],rolesUserFilter:"",rolesAdminDialog:!1,allPermissions:[],roleForm:{id:null,name:""},selectedRole:null,rolePermissions:[],permFilterRole:"",rolesColumns:[{name:"name",label:"Nombre",field:"name",align:"left"},{name:"permissions_count",label:"N° permisos",field:r=>(r.permissions||[]).length,align:"center"},{name:"actions",label:"",align:"center"}]}},async mounted(){this.usersGet(),this.bpUsersGet(),this.loadRoles()},methods:{onFileChange(r){const e=r.target.files[0],m=new FormData;m.append("avatar",e),this.loading=!0,this.$axios.post(this.user.id+"/avatar",m,{headers:{"Content-Type":"multipart/form-data"}}).then(()=>{this.cambioAvatarDialogo=!1,this.$alert.success("Avatar actualizado"),this.usersGet()}).catch(k=>{this.$alert.error(k.response.data.message)}).finally(()=>{this.loading=!1})},cambiarAvatar(r){this.cambioAvatarDialogo=!0,this.user={...r}},userNew(){this.user={name:"",email:"",password:"",username:"",role_id:null},this.actionUser="Nuevo",this.userDialog=!0},usersGet(){this.loading=!0,this.$axios.get("users").then(r=>{this.users=r.data}).catch(r=>{this.$alert.error(r.response.data.message)}).finally(()=>{this.loading=!1})},userPost(){this.loading=!0,this.$axios.post("users",this.user).then(()=>{this.userDialog=!1,this.$alert.success("User creado"),this.usersGet()}).catch(r=>{this.$alert.error(r.response.data.message)}).finally(()=>{this.loading=!1})},userPut(){this.loading=!0,this.$axios.put("users/"+this.user.id,this.user).then(()=>{this.usersGet(),this.userDialog=!1,this.$alert.success("User actualizado")}).catch(r=>{this.$alert.error(r.response.data.message)}).finally(()=>{this.loading=!1})},userEditPassword(r){this.user={...r},this.$alert.dialogPrompt("Nueva contraseña","Ingrese la nueva contraseña","password").onOk(e=>{this.$axios.put("updatePassword/"+r.id,{password:e}).then(()=>{this.usersGet(),this.$alert.success("Contraseña actualizada de "+r.username)}).catch(m=>{this.$alert.error(m.response.data.message)})})},userEdit(r){this.user={...r},r.roles&&r.roles.length&&(this.user.role_id=r.roles[0].id),this.actionUser="Editar",this.userDialog=!0},userDelete(r){this.$alert.dialog("¿Desea eliminar el user?").onOk(()=>{this.loading=!0,this.$axios.delete("users/"+r).then(()=>{this.usersGet(),this.$alert.success("User eliminado")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})})},bpUsersGet(){this.loadingInternos=!0,this.$axios.get("bp-usuarios").then(r=>{this.bpUsers=r.data}).catch(r=>{this.$alert.error(r.response?.data?.message||"Error cargando usuarios internos")}).finally(()=>{this.loadingInternos=!1})},toggleTraza(r,e){this.$axios.put(`bp-usuarios/${r.usr_id}/traza`,{activado:e}).then(()=>{this.$alert.success(`TRAZA ${e?"activado":"desactivado"} para ${r.usr_usuario}`)}).catch(m=>{this.$alert.error(m.response?.data?.message||"No se pudo actualizar TRAZA"),r.traza_activado=!e})},async loadRoles(){this.rolesLoading=!0;try{const[r,e]=await Promise.all([this.$axios.get("roles"),this.$axios.get("permissions")]);this.rolesSelect=r.data,this.rolesList=r.data,this.allPermissions=e.data}catch(r){this.$alert.error(r.response?.data?.message||"Error cargando roles/permisos")}finally{this.rolesLoading=!1}},async userRolesShow(r){this.dialogUserRoles=!0,this.loading=!0,r.id?(this.rolesTargetType="external",this.rolesTargetId=r.id,this.user={...r}):(this.rolesTargetType="internal",this.rolesTargetId=r.usr_id,this.user={username:r.usr_usuario});try{this.rolesSelect.length||await this.loadRoles();const e=this.rolesTargetType==="external"?`users/${this.rolesTargetId}/roles`:`bp-usuarios/${this.rolesTargetId}/roles`,m=await this.$axios.get(e).then(k=>k.data);this.rolesUserList=this.rolesSelect.map(k=>({...k,checked:m.includes(k.id)}))}catch(e){this.$alert.error(e.response?.data?.message||"Error cargando roles del usuario")}finally{this.loading=!1}},async userRolesSave(){this.loading=!0;try{const r=this.rolesUserList.filter(m=>m.checked).map(m=>m.id),e=this.rolesTargetType==="external"?`users/${this.rolesTargetId}/roles`:`bp-usuarios/${this.rolesTargetId}/roles`;await this.$axios.put(e,{roles:r}),this.dialogUserRoles=!1,this.$alert.success("Roles actualizados"),this.rolesTargetType==="external"?this.usersGet():this.bpUsersGet()}catch(r){this.$alert.error(r.response?.data?.message||"No se pudo guardar roles")}finally{this.loading=!1}},openRolesAdmin(){this.rolesAdminDialog=!0,this.loadRoles(),this.resetRoleForm(),this.selectedRole=null,this.rolePermissions=[],this.permFilterRole=""},resetRoleForm(){this.roleForm={id:null,name:""}},async saveRole(){if(!this.roleForm.name){this.$alert.error("El nombre del rol es obligatorio");return}this.rolesLoading=!0;try{this.roleForm.id?(await this.$axios.put(`roles/${this.roleForm.id}`,{name:this.roleForm.name}),this.$alert.success("Rol actualizado")):(await this.$axios.post("roles",{name:this.roleForm.name}),this.$alert.success("Rol creado")),await this.loadRoles(),this.roleForm.id||(this.roleForm.name="")}catch(r){this.$alert.error(r.response?.data?.message||"No se pudo guardar el rol")}finally{this.rolesLoading=!1}},async deleteRole(r){this.$alert.dialog(`¿Eliminar el rol "${r.name}"?`).onOk(async()=>{this.rolesLoading=!0;try{await this.$axios.delete(`roles/${r.id}`),this.$alert.success("Rol eliminado"),await this.loadRoles(),this.selectedRole&&this.selectedRole.id===r.id&&(this.selectedRole=null,this.rolePermissions=[])}catch(e){this.$alert.error(e.response?.data?.message||"No se pudo eliminar el rol")}finally{this.rolesLoading=!1}})},async selectRole(r){this.selectedRole=r,this.roleForm={id:r.id,name:r.name},this.rolesLoading=!0;try{const e=await this.$axios.get(`roles/${r.id}/permissions`).then(m=>m.data);this.rolePermissions=this.allPermissions.map(m=>({...m,checked:e.includes(m.id)}))}catch(e){this.$alert.error(e.response?.data?.message||"Error cargando permisos del rol")}finally{this.rolesLoading=!1}},async saveRolePermissions(){if(this.selectedRole){this.rolesLoading=!0;try{const r=this.rolePermissions.filter(e=>e.checked).map(e=>e.id);await this.$axios.put(`roles/${this.selectedRole.id}/permissions`,{permissions:r}),this.$alert.success("Permisos del rol actualizados"),await this.loadRoles()}catch(r){this.$alert.error(r.response?.data?.message||"No se pudo guardar los permisos del rol")}finally{this.rolesLoading=!1}}}},computed:{bpUsersFiltered(){if(!this.filterInterno)return this.bpUsers;const r=this.filterInterno.toLowerCase();return this.bpUsers.filter(e=>String(e.usr_usuario||"").toLowerCase().includes(r)||String(e.usr_id||"").includes(r))},filteredRolesUser(){if(!this.rolesUserFilter)return this.rolesUserList;const r=this.rolesUserFilter.toLowerCase();return this.rolesUserList.filter(e=>e.name.toLowerCase().includes(r))},filteredRolePermissions(){if(!this.permFilterRole)return this.rolePermissions;const r=this.permFilterRole.toLowerCase();return this.rolePermissions.filter(e=>e.name.toLowerCase().includes(r))}}},ee={class:"row items-center q-col-gutter-xs"},se={class:"text-left"},le={class:"text-right q-mt-md"},oe={style:{position:"relative",top:"0",left:"0"}},re=["src"],ae={class:"text-right q-mt-md"},te={class:"row q-col-gutter-sm q-mb-sm"},ie={class:"col"},ne={class:"col-auto"},de={class:"row q-col-gutter-md"},ue={class:"col-12 col-md-5"},me={class:"col-12 col-md-7"},ce={key:0},pe={class:"row items-center q-mb-sm"},fe={class:"text-subtitle2"},ge={class:"text-right q-mt-sm"},he={key:1,class:"text-grey text-italic"};function be(r,e,m,k,a,n){return i(),c(Y,{class:"q-pa-md"},{default:o(()=>[s(B,{modelValue:a.tab,"onUpdate:modelValue":e[0]||(e[0]=l=>a.tab=l),dense:"",class:"text-primary q-mb-md",align:"left","active-color":"primary","indicator-color":"primary"},{default:o(()=>[s(S,{name:"internos",label:"Usuarios internos",icon:"badge","no-caps":""}),s(S,{name:"externos",label:"Usuarios externos",icon:"person","no-caps":""})]),_:1},8,["modelValue"]),s(A,{class:"q-mb-md"}),s(O,{modelValue:a.tab,"onUpdate:modelValue":e[18]||(e[18]=l=>a.tab=l),animated:""},{default:o(()=>[s(N,{name:"externos"},{default:o(()=>[s(z,{rows:a.users,columns:a.columns,dense:"","wrap-cells":"",flat:"",bordered:"","rows-per-page-options":[0],title:"Usuarios externos",filter:a.filter},{"top-right":o(()=>[s(u,{color:"secondary",label:"Roles & permisos","no-caps":"",icon:"admin_panel_settings",class:"q-mr-sm",loading:a.rolesLoading,onClick:n.openRolesAdmin},null,8,["loading","onClick"]),s(u,{color:"positive",label:"Nuevo",onClick:n.userNew,"no-caps":"",icon:"add_circle_outline",loading:a.loading,class:"q-mr-sm"},null,8,["onClick","loading"]),s(u,{color:"primary",label:"Actualizar",onClick:n.usersGet,"no-caps":"",icon:"refresh",loading:a.loading,class:"q-mr-sm"},null,8,["onClick","loading"]),s(v,{modelValue:a.filter,"onUpdate:modelValue":e[1]||(e[1]=l=>a.filter=l),label:"Buscar",dense:"",outlined:""},{append:o(()=>[s(g,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":o(l=>[s(w,{props:l},{default:o(()=>[s(J,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:o(()=>[s(L,null,{default:o(()=>[U((i(),c(C,{clickable:"",onClick:t=>n.userEdit(l.row)},{default:o(()=>[s(f,{avatar:""},{default:o(()=>[s(g,{name:"edit"})]),_:1}),s(f,null,{default:o(()=>[s(Q,null,{default:o(()=>e[28]||(e[28]=[p("Editar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[F]]),U((i(),c(C,{clickable:"",onClick:t=>n.userDelete(l.row.id)},{default:o(()=>[s(f,{avatar:""},{default:o(()=>[s(g,{name:"delete"})]),_:1}),s(f,null,{default:o(()=>[s(Q,null,{default:o(()=>e[29]||(e[29]=[p("Eliminar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[F]]),U((i(),c(C,{clickable:"",onClick:t=>n.userEditPassword(l.row)},{default:o(()=>[s(f,{avatar:""},{default:o(()=>[s(g,{name:"lock_reset"})]),_:1}),s(f,null,{default:o(()=>[s(Q,null,{default:o(()=>e[30]||(e[30]=[p("Cambiar contraseña")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[F]]),U((i(),c(C,{clickable:"",onClick:t=>n.cambiarAvatar(l.row)},{default:o(()=>[s(f,{avatar:""},{default:o(()=>[s(g,{name:"image"})]),_:1}),s(f,null,{default:o(()=>[s(Q,null,{default:o(()=>e[31]||(e[31]=[p("Cambiar avatar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[F]]),U((i(),c(C,{clickable:"",onClick:t=>n.userRolesShow(l.row)},{default:o(()=>[s(f,{avatar:""},{default:o(()=>[s(g,{name:"admin_panel_settings"})]),_:1}),s(f,null,{default:o(()=>[s(Q,null,{default:o(()=>e[32]||(e[32]=[p("Roles del usuario")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[F]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-role":o(l=>[s(w,{props:l},{default:o(()=>[s(D,{label:l.row.role,color:r.$filters.color(l.row.role),"text-color":"white",dense:"",size:"14px"},null,8,["label","color"])]),_:2},1032,["props"])]),"body-cell-avatar":o(l=>[s(w,{props:l},{default:o(()=>[s(j,{rounded:""},{default:o(()=>[l.row.avatar?(i(),c(K,{key:0,src:`${r.$url}/../images/${l.row.avatar}`,width:"40px",height:"40px"},null,8,["src"])):(i(),c(g,{key:1,name:"person",size:"40px"}))]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-permissions":o(l=>[s(w,{props:l},{default:o(()=>[d("div",ee,[(i(!0),b(_,null,x((l.row.permissions||[]).slice(0,3),(t,I)=>(i(),c(D,{key:t.id,dense:"",color:"grey-3","text-color":"black",size:"12px",class:"q-mr-xs q-mb-xs"},{default:o(()=>[p(h(t.name),1)]),_:2},1024))),128)),(l.row.permissions||[]).length>3?(i(),c(G,{key:0,outline:"",color:"primary",class:"q-ml-xs"},{default:o(()=>[p(" +"+h((l.row.permissions||[]).length-3)+" ",1),s(W,{anchor:"top middle",self:"bottom middle",offset:[0,8]},{default:o(()=>[d("div",se,[(i(!0),b(_,null,x(l.row.permissions,t=>(i(),b("div",{key:t.id},"• "+h(t.name),1))),128))])]),_:2},1024)]),_:2},1024)):q("",!0),(l.row.permissions||[]).length?q("",!0):(i(),c(G,{key:1,color:"grey-5","text-color":"white",outline:""},{default:o(()=>e[33]||(e[33]=[p(" Sin permisos ")])),_:1}))])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),s(T,{modelValue:a.userDialog,"onUpdate:modelValue":e[10]||(e[10]=l=>a.userDialog=l),persistent:""},{default:o(()=>[s(V,{style:{width:"400px"}},{default:o(()=>[s(y,{class:"q-pb-none row items-center"},{default:o(()=>[d("div",null,h(a.actionUser)+" user",1),s(R),s(u,{icon:"close",flat:"",round:"",dense:"",onClick:e[2]||(e[2]=l=>a.userDialog=!1)})]),_:1}),s(y,{class:"q-pt-none"},{default:o(()=>[s(E,{onSubmit:e[9]||(e[9]=l=>a.user.id?n.userPut():n.userPost())},{default:o(()=>[s(v,{modelValue:a.user.name,"onUpdate:modelValue":e[3]||(e[3]=l=>a.user.name=l),label:"Nombre",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"]),s(v,{modelValue:a.user.username,"onUpdate:modelValue":e[4]||(e[4]=l=>a.user.username=l),label:"Usuario",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"]),s(v,{modelValue:a.user.email,"onUpdate:modelValue":e[5]||(e[5]=l=>a.user.email=l),label:"Email",dense:"",outlined:""},null,8,["modelValue"]),a.user.id?q("",!0):(i(),c(v,{key:0,modelValue:a.user.password,"onUpdate:modelValue":e[6]||(e[6]=l=>a.user.password=l),label:"Contraseña",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"],type:"password"},null,8,["modelValue","rules"])),s(X,{modelValue:a.user.role_id,"onUpdate:modelValue":e[7]||(e[7]=l=>a.user.role_id=l),label:"Rol",dense:"",outlined:"",options:a.rolesSelect,"option-label":"name","option-value":"id","emit-value":"","map-options":"",loading:a.rolesLoading,rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","options","loading","rules"]),d("div",le,[s(u,{color:"negative",label:"Cancelar",onClick:e[8]||(e[8]=l=>a.userDialog=!1),"no-caps":"",loading:a.loading},null,8,["loading"]),s(u,{color:"primary",label:"Guardar",type:"submit","no-caps":"",loading:a.loading,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(T,{modelValue:a.cambioAvatarDialogo,"onUpdate:modelValue":e[16]||(e[16]=l=>a.cambioAvatarDialogo=l),persistent:""},{default:o(()=>[s(V,null,{default:o(()=>[s(y,{class:"q-pb-none row items-center text-bold"},{default:o(()=>[e[34]||(e[34]=p(" Cambiar avatar ")),s(R),s(u,{icon:"close",flat:"",round:"",dense:"",onClick:e[11]||(e[11]=l=>a.cambioAvatarDialogo=!1)})]),_:1}),s(y,{class:"q-pt-none"},{default:o(()=>[s(E,{onSubmit:e[15]||(e[15]=l=>n.userPut())},{default:o(()=>[d("div",null,[d("div",oe,[s(u,{icon:"edit",size:"10px",class:"absolute q-mt-sm q-ml-sm",onClick:e[12]||(e[12]=l=>r.$refs.fileInput.click()),dense:"",outline:"",label:"Cambiar foto","no-caps":""})]),a.user.avatar?(i(),b("img",{key:0,src:`${r.$url}/../images/${a.user.avatar}`,width:"300px",height:"300px"},null,8,re)):(i(),c(g,{key:1,name:"person",size:"100px"})),d("input",{ref:"fileInput",type:"file",style:{display:"none"},onChange:e[13]||(e[13]=(...l)=>n.onFileChange&&n.onFileChange(...l)),accept:"image/*"},null,544)]),d("div",ae,[s(u,{color:"negative",label:"Cancelar",onClick:e[14]||(e[14]=l=>a.cambioAvatarDialogo=!1),"no-caps":"",loading:a.loading},null,8,["loading"]),s(u,{color:"primary",label:"Guardar",type:"submit","no-caps":"",loading:a.loading,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(N,{name:"internos"},{default:o(()=>[s(V,{flat:"",bordered:""},{default:o(()=>[s(y,{class:"row items-center q-col-gutter-sm"},{default:o(()=>[e[35]||(e[35]=d("div",{class:"text-h6"}," Usuarios internos ",-1)),s(R),s(u,{color:"primary",label:"Actualizar",icon:"refresh","no-caps":"",loading:a.loadingInternos,onClick:n.bpUsersGet},null,8,["loading","onClick"]),s(v,{modelValue:a.filterInterno,"onUpdate:modelValue":e[17]||(e[17]=l=>a.filterInterno=l),dense:"",outlined:"",placeholder:"Buscar usuario interno...",class:"q-ml-sm"},{append:o(()=>[s(g,{name:"search"})]),_:1},8,["modelValue"])]),_:1}),s(A),s(z,{rows:n.bpUsersFiltered,columns:a.bpColumns,"row-key":"usr_id",dense:"",flat:"","rows-per-page-options":[0]},{"body-cell-actions":o(l=>[s(w,{props:l},{default:o(()=>[s(u,{color:"primary",label:"Roles","no-caps":"",size:"10px",onClick:t=>n.userRolesShow(l.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-traza":o(l=>[s(w,{props:l},{default:o(()=>[s(P,{modelValue:l.row.traza_activado,"onUpdate:modelValue":[t=>l.row.traza_activado=t,t=>n.toggleTraza(l.row,t)],color:"primary",label:"TRAZA"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),"body-cell-sistemas":o(l=>[s(w,{props:l},{default:o(()=>[(i(!0),b(_,null,x(l.row.usr_access_sistem||[],(t,I)=>(i(),c(D,{key:I,dense:"",outline:"",color:t.sistema==="TRAZA"?t.activado?"green-5":"red-5":"grey-4","text-color":"black",class:"q-mr-xs q-mb-xs",size:"11px"},{default:o(()=>[p(h(t.sistema)+" ("+h(t.activado?"ON":"OFF")+") ",1)]),_:2},1032,["color"]))),128))]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(T,{modelValue:a.dialogUserRoles,"onUpdate:modelValue":e[22]||(e[22]=l=>a.dialogUserRoles=l),persistent:""},{default:o(()=>[s(V,{style:{"min-width":"420px"}},{default:o(()=>[s(y,{class:"q-pb-none row items-center text-bold"},{default:o(()=>[p(" Roles de "+h(a.user.username)+" ",1),s(R),s(u,{icon:"close",flat:"",round:"",dense:"",onClick:e[19]||(e[19]=l=>a.dialogUserRoles=!1)})]),_:1}),s(y,{class:"q-pt-none"},{default:o(()=>[s(v,{modelValue:a.rolesUserFilter,"onUpdate:modelValue":e[20]||(e[20]=l=>a.rolesUserFilter=l),dense:"",outlined:"",placeholder:"Filtrar roles...",class:"q-mb-sm"},{append:o(()=>[s(g,{name:"search"})]),_:1},8,["modelValue"]),s(L,{dense:"",bordered:""},{default:o(()=>[(i(!0),b(_,null,x(n.filteredRolesUser,l=>(i(),c(C,{key:l.id},{default:o(()=>[s(f,null,{default:o(()=>[p(h(l.name),1)]),_:2},1024),s(f,{side:""},{default:o(()=>[s(P,{modelValue:l.checked,"onUpdate:modelValue":t=>l.checked=t},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),s(M,{align:"right"},{default:o(()=>[s(u,{color:"negative",label:"Cancelar",onClick:e[21]||(e[21]=l=>a.dialogUserRoles=!1),"no-caps":"",loading:a.loading},null,8,["loading"]),s(u,{color:"primary",label:"Guardar",onClick:n.userRolesSave,"no-caps":"",loading:a.loading},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(T,{modelValue:a.rolesAdminDialog,"onUpdate:modelValue":e[27]||(e[27]=l=>a.rolesAdminDialog=l),persistent:""},{default:o(()=>[s(V,{style:{"min-width":"700px","max-width":"900px"}},{default:o(()=>[s(y,{class:"row items-center q-pb-none"},{default:o(()=>[e[36]||(e[36]=d("div",{class:"text-h6"},"Roles & permisos",-1)),s(R),s(u,{icon:"close",flat:"",round:"",dense:"",onClick:e[23]||(e[23]=l=>a.rolesAdminDialog=!1)})]),_:1}),s(A),s(y,{class:"q-pt-sm"},{default:o(()=>[d("div",te,[d("div",ie,[s(v,{modelValue:a.roleForm.name,"onUpdate:modelValue":e[24]||(e[24]=l=>a.roleForm.name=l),label:"Nombre del rol",dense:"",outlined:""},null,8,["modelValue"])]),d("div",ne,[s(u,{label:a.roleForm.id?"Actualizar rol":"Crear rol",color:"primary","no-caps":"",icon:"save",loading:a.rolesLoading,onClick:n.saveRole,class:"q-mr-sm"},null,8,["label","loading","onClick"]),a.roleForm.id?(i(),c(u,{key:0,label:"Nuevo",color:"grey-7","no-caps":"",flat:"",onClick:n.resetRoleForm},null,8,["onClick"])):q("",!0)])]),d("div",de,[d("div",ue,[s(z,{title:"Roles",rows:a.rolesList,columns:a.rolesColumns,"row-key":"id",dense:"",flat:"",bordered:"","rows-per-page-options":[0],onRowClick:e[25]||(e[25]=(l,t)=>n.selectRole(t))},{"body-cell-actions":o(l=>[s(w,{props:l},{default:o(()=>[s(u,{icon:"delete",size:"sm",color:"negative",flat:"",round:"",onClick:H(t=>n.deleteRole(l.row),["stop"])},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),d("div",me,[a.selectedRole?(i(),b("div",ce,[d("div",pe,[d("div",fe,[e[37]||(e[37]=p(" Permisos de: ")),d("strong",null,h(a.selectedRole.name),1)]),s(R),s(v,{modelValue:a.permFilterRole,"onUpdate:modelValue":e[26]||(e[26]=l=>a.permFilterRole=l),dense:"",outlined:"",placeholder:"Filtrar permisos...",style:{"max-width":"220px"}},{append:o(()=>[s(g,{name:"search"})]),_:1},8,["modelValue"])]),s(L,{dense:"",bordered:"",style:{"max-height":"350px","overflow-y":"auto"}},{default:o(()=>[(i(!0),b(_,null,x(n.filteredRolePermissions,l=>(i(),c(C,{key:l.id},{default:o(()=>[s(f,null,{default:o(()=>[p(h(l.name),1)]),_:2},1024),s(f,{side:""},{default:o(()=>[s(P,{modelValue:l.checked,"onUpdate:modelValue":t=>l.checked=t},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),d("div",ge,[s(u,{color:"primary",label:"Guardar permisos del rol","no-caps":"",loading:a.rolesLoading,onClick:n.saveRolePermissions},null,8,["loading","onClick"])])])):(i(),b("div",he," Selecciona un rol de la tabla para editar sus permisos. "))])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Ze=Z($,[["render",be]]);export{Ze as default};
