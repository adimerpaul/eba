import{_ as w,c as m,o as c,w as s,a as e,J as f,d as u,a5 as h,aa as b,b as r,ad as n,f as d,h as C,Q as V,e as y,t as x,I as _,ax as k,af as S}from"./index-CR9yd891.js";import{Q as v,b as p}from"./format-DRJHZA7l.js";import{Q as E}from"./QList-BkjS96H9.js";import{Q as q}from"./QBtnDropdown-nXaEaUA6.js";import{Q as T}from"./QTd-DiavY6mL.js";import{Q as D}from"./QTable-C7Jsy1Ok.js";import{Q as N}from"./QForm-BKpgTyZl.js";import{Q as B}from"./QPage-HTQfxZep.js";import{C as g}from"./ClosePopup-PXHaWxlU.js";import"./selection-BAQa1WJt.js";import"./QMarkupTable-DeVHDAOX.js";import"./QSelect-C-THZuVK.js";import"./use-fullscreen-UUHdOR6D.js";const I={name:"TransportesPage",data(){return{loading:!1,rows:[],columns:[{name:"actions",label:"Acciones",align:"right"},{name:"empresa",label:"Empresa",align:"left",field:"empresa"},{name:"placa",label:"Placa",align:"left",field:"placa"},{name:"responsable",label:"Responsable",align:"left",field:"responsable"}],filter:"",dlg:{open:!1,mode:"create",row:null},form:{empresa:"",placa:"",responsable:""},saving:!1}},computed:{canSubmit(){const a=this.form;return!!(a.empresa||a.responsable)}},mounted(){this.fetch()},methods:{async fetch(){this.loading=!0;try{const a={};this.filter&&(a.q=this.filter);const{data:l}=await this.$axios.get("/transportes",{params:a});this.rows=Array.isArray(l)?l:l.data||[]}catch(a){this.$q.notify({type:"negative",message:a.response?.data?.message||"Error al listar transportes"})}finally{this.loading=!1}},fetchDebounced:(()=>{let a;return function(){clearTimeout(a),a=setTimeout(()=>this.fetch(),350)}})(),openCreate(){this.dlg={open:!0,mode:"create",row:null},this.form={empresa:"",placa:"",responsable:""}},openEdit(a){this.dlg={open:!0,mode:"edit",row:a},this.form={empresa:a.empresa||"",placa:a.placa||"",responsable:a.responsable||""}},async onSubmit(){if(this.canSubmit){this.saving=!0;try{this.dlg.mode==="create"?await this.$axios.post("/transportes",this.form):await this.$axios.put(`/transportes/${this.dlg.row.id}`,this.form),this.$q.notify({type:"positive",message:"Guardado"}),this.dlg.open=!1,await this.fetch()}catch(a){this.$q.notify({type:"negative",message:a.response?.data?.message||"No se pudo guardar"})}finally{this.saving=!1}}},async onDelete(a){this.$q.dialog({title:"Eliminar",message:`¿Eliminar el transporte ${a.empresa||a.placa||a.responsable}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{await this.$axios.delete(`/transportes/${a.id}`),this.$q.notify({type:"positive",message:"Eliminado"}),await this.fetch()}catch(l){this.$q.notify({type:"negative",message:l.response?.data?.message||"No se pudo eliminar"})}})}}},U={class:"row items-center q-gutter-sm"},A={class:"row q-col-gutter-md"},P={class:"col-12 col-md-6"},R={class:"col-12 col-md-6"},z={class:"col-12"};function G(a,l,O,F,t,i){return c(),m(B,{class:"q-pa-md"},{default:s(()=>[e(D,{rows:t.rows,columns:t.columns,"row-key":"id",flat:"",bordered:"",dense:"","wrap-cells":"","rows-per-page-options":[0],title:"Transportes",loading:t.loading,filter:t.filter},{"top-right":s(()=>[r("div",U,[e(n,{modelValue:t.filter,"onUpdate:modelValue":[l[0]||(l[0]=o=>t.filter=o),i.fetchDebounced],dense:"",outlined:"",placeholder:"Buscar por empresa, placa o responsable"},{append:s(()=>[e(u,{name:"search"})]),_:1},8,["modelValue","onUpdate:modelValue"]),e(d,{color:"positive",icon:"add_circle_outline",label:"Nuevo","no-caps":"",loading:t.loading,onClick:i.openCreate},null,8,["loading","onClick"]),e(d,{color:"primary",icon:"refresh",label:"Actualizar","no-caps":"",loading:t.loading,onClick:i.fetch},null,8,["loading","onClick"])])]),"body-cell-actions":s(o=>[e(T,{props:o,class:"text-right"},{default:s(()=>[e(q,{label:"Opciones",dense:"",color:"primary","no-caps":"",size:"10px"},{default:s(()=>[e(E,null,{default:s(()=>[f((c(),m(v,{clickable:"",onClick:Q=>i.openEdit(o.row)},{default:s(()=>[e(p,{avatar:""},{default:s(()=>[e(u,{name:"edit"})]),_:1}),e(p,null,{default:s(()=>l[5]||(l[5]=[h("Editar")])),_:1})]),_:2},1032,["onClick"])),[[b],[g]]),f((c(),m(v,{clickable:"",onClick:Q=>i.onDelete(o.row)},{default:s(()=>[e(p,{avatar:""},{default:s(()=>[e(u,{name:"delete",color:"negative"})]),_:1}),e(p,null,{default:s(()=>l[6]||(l[6]=[r("span",{class:"text-negative"},"Eliminar",-1)])),_:1})]),_:2},1032,["onClick"])),[[b],[g]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading","filter"]),e(C,{modelValue:t.dlg.open,"onUpdate:modelValue":l[4]||(l[4]=o=>t.dlg.open=o),persistent:""},{default:s(()=>[e(V,{style:{"min-width":"520px","max-width":"760px"}},{default:s(()=>[e(y,{class:"text-h6"},{default:s(()=>[h(x(t.dlg.mode==="create"?"Nuevo Transporte":"Editar Transporte"),1)]),_:1}),e(_),e(y,null,{default:s(()=>[e(N,{onSubmit:k(i.onSubmit,["prevent"]),ref:"formRef"},{default:s(()=>[r("div",A,[r("div",P,[e(n,{modelValue:t.form.empresa,"onUpdate:modelValue":l[1]||(l[1]=o=>t.form.empresa=o),dense:"",filled:"",label:"Empresa / Razón social"},null,8,["modelValue"])]),r("div",R,[e(n,{modelValue:t.form.placa,"onUpdate:modelValue":l[2]||(l[2]=o=>t.form.placa=o),dense:"",filled:"",label:"Placa"},null,8,["modelValue"])]),r("div",z,[e(n,{modelValue:t.form.responsable,"onUpdate:modelValue":l[3]||(l[3]=o=>t.form.responsable=o),dense:"",filled:"",label:"Responsable / Conductor"},null,8,["modelValue"])])])]),_:1},8,["onSubmit"])]),_:1}),e(_),e(S,{align:"right"},{default:s(()=>[f(e(d,{flat:"",label:"Cancelar"},null,512),[[g]]),e(d,{color:"primary",loading:t.saving,disable:!i.canSubmit,label:"Guardar",onClick:i.onSubmit},null,8,["loading","disable","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const le=w(I,[["render",G],["__scopeId","data-v-5f4af132"]]);export{le as default};
