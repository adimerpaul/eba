import{Q as _}from"./QBanner-DfDBHCxQ.js";import{_ as h,c as p,o as f,w as d,a6 as V,b as n,a5 as a,t as u,a as s,ad as r,f as g}from"./index-DFIAzMKF.js";import{Q as m}from"./QSelect-Dr3256I9.js";import{Q as v,b as x}from"./format-DigbM5Gz.js";import{Q as y}from"./QForm-BNkdETkt.js";const U={name:"ProductorForm",props:{productor:{type:Object,default:null},tree:{type:Array,default:()=>[]},autoLoadTree:{type:Boolean,default:!0},bannerMsg:{type:String,default:""}},emits:["saved","cancel","error"],data(){return{tipos:["Pequeño Productor","Productor Individual","Organizacion de Productores","Asociacion"],localTree:[],saving:!1,banner:this.bannerMsg,orgOptions:[],orgLoading:!1,form:this.emptyForm(),sexoOptions:[{label:"Masculino",value:1},{label:"Femenino",value:2}]}},computed:{treeToUse(){return this.tree&&this.tree.length?this.tree:this.localTree},depOptions(){return(this.treeToUse||[]).map(l=>({label:l.nombre_departamento,value:l.id}))},provOptions(){const l=this.form.departamento_id;return l?((this.treeToUse||[]).find(t=>t.id===l)?.provincias||[]).map(t=>({label:t.nombre_provincia,value:t.id})):[]},munOptions(){const l=this.form.departamento_id,o=this.form.provincia_id;return!l||!o?[]:(((this.treeToUse||[]).find(e=>e.id===l)?.provincias||[]).find(e=>e.id===o)?.municipios||[]).map(e=>({label:e.nombre_municipio,value:e.id}))}},watch:{productor:{handler(){this.initFromProp()},immediate:!0}},mounted(){!this.tree?.length&&this.autoLoadTree&&this.loadTree()},methods:{emptyForm(){return{id:null,municipio_id:null,runsa:"0",sub_codigo:"",nombre:"",apellidos:"",numcarnet:"",expedido:"",fec_nacimiento:null,sexo:null,direccion:"",comunidad:"",proveedor:"",cip_acopio:"",num_celular:"",ocupacion:"",otros:"",seleccion:0,organizacion_id:null,fecha_registro:new Date().toISOString().slice(0,10),fecha_expiracion:null,estado:"VIGENTE",departamento_id:null,provincia_id:null}},async loadTree(){try{const{data:l}=await this.$axios.get("geo/tree");this.localTree=l}catch(l){this.$alert?.error?.(l.response?.data?.message||"No se pudo cargar el árbol geográfico")}},initFromProp(){const l=this.productor;if(!l){this.form=this.emptyForm();return}this.form={id:l.id??null,runsa:l.runsa??"0",sub_codigo:l.sub_codigo??"",nombre:l.nombre??"",apellidos:l.apellidos??"",numcarnet:l.numcarnet??"",expedido:l.expedido??"",fec_nacimiento:l.fec_nacimiento??null,sexo:l.sexo??null,direccion:l.direccion??"",comunidad:l.comunidad??"",proveedor:l.proveedor??"",cip_acopio:l.cip_acopio??"",num_celular:l.num_celular??"",ocupacion:l.ocupacion??"",otros:l.otros??"",seleccion:l.seleccion??0,organizacion_id:l.organizacion?.id||l.organizacion_id||null,fecha_registro:l.fecha_registro??new Date().toISOString().slice(0,10),fecha_expiracion:l.fecha_expiracion??null,estado:l.estado??"VIGENTE",provincia_id:l.municipio?.provincia_id||null}},onDepChange(){this.form.provincia_id=null,this.form.municipio_id=null},onProvChange(){this.form.municipio_id=null},async filterOrganizaciones(l,o){o(async()=>{this.orgLoading=!0;try{const{data:t}=await this.$axios.get("organizaciones",{params:{search:l||void 0,paginate:!1}});console.log(t),this.orgOptions=Array.isArray(t)?t:t?.data||[]}catch{this.orgOptions=[]}finally{this.orgLoading=!1}})},async submit(){this.saving=!0;try{const l={runsa:this.form.runsa,sub_codigo:this.form.sub_codigo,nombre:this.form.nombre,apellidos:this.form.apellidos,numcarnet:this.form.numcarnet,expedido:this.form.expedido,fec_nacimiento:this.form.fec_nacimiento,sexo:this.form.sexo,direccion:this.form.direccion,comunidad:this.form.comunidad,proveedor:this.form.proveedor,cip_acopio:this.form.cip_acopio,num_celular:this.form.num_celular,ocupacion:this.form.ocupacion,otros:this.form.otros,seleccion:this.form.seleccion,organizacion_id:this.form.organizacion.id,fecha_registro:this.form.fecha_registro,fecha_expiracion:this.form.fecha_expiracion,estado:this.form.estado};let o;this.form.id?o=await this.$axios.put(`productores/${this.form.id}`,l):o=await this.$axios.post("productores",l);const t=o.data;this.form.id||this.$router.push("/productores/editar/"+t.id),this.$alert?.success?.(this.form.id?"Productor actualizado":"Productor creado")}catch(l){const o=l.response?.data?.message||"No se pudo guardar";this.$alert?.error?.(o),this.$emit("error",l)}finally{this.saving=!1}}}},O={class:"row q-col-gutter-sm"},z={class:"col-6 col-sm-2"},I={class:"col-6 col-sm-2"},T={class:"col-12 col-sm-4"},C={class:"col-12 col-sm-4"},P={class:"col-6 col-sm-3"},S={class:"col-6 col-sm-2"},N={class:"col-12 col-sm-3"},w={class:"col-12 col-sm-4"},F={class:"col-12"},E={class:"col-12 col-sm-4"},Q={class:"col-12 col-sm-4"},A={class:"col-12 col-sm-4"},q={class:"col-12 col-sm-4"},B={class:"col-12 col-sm-4"},D={class:"col-12 col-sm-4"},L={class:"col-12 col-sm-6"},M={class:"col-12 col-sm-4"},R={class:"col-12 col-sm-4"},k={class:"col-12 col-sm-4"},G={class:"col-12 col-sm-4"},j={class:"col-12 col-sm-4"},H={class:"col-12 col-sm-4"},J={class:"col-12"},K={class:"text-right q-gutter-sm"};function W(l,o,t,b,e,c){return f(),p(y,{onSubmit:c.submit,class:"q-gutter-md"},{default:d(()=>[e.banner?(f(),p(_,{key:0,class:"bg-yellow-1 text-yellow-10"},{default:d(()=>[a(u(e.banner),1)]),_:1})):V("",!0),n("div",O,[n("div",z,[s(r,{modelValue:e.form.runsa,"onUpdate:modelValue":o[0]||(o[0]=i=>e.form.runsa=i),label:"RUNSA",dense:"",outlined:""},null,8,["modelValue"])]),n("div",I,[s(r,{modelValue:e.form.sub_codigo,"onUpdate:modelValue":o[1]||(o[1]=i=>e.form.sub_codigo=i),label:"Sub Código",dense:"",outlined:""},null,8,["modelValue"])]),n("div",T,[s(r,{modelValue:e.form.nombre,"onUpdate:modelValue":o[2]||(o[2]=i=>e.form.nombre=i),label:"Nombre",dense:"",outlined:"",rules:[i=>!!i||"Requerido"]},null,8,["modelValue","rules"])]),n("div",C,[s(r,{modelValue:e.form.apellidos,"onUpdate:modelValue":o[3]||(o[3]=i=>e.form.apellidos=i),label:"Apellidos",dense:"",outlined:"",rules:[i=>!!i||"Requerido"]},null,8,["modelValue","rules"])]),n("div",P,[s(r,{modelValue:e.form.numcarnet,"onUpdate:modelValue":o[4]||(o[4]=i=>e.form.numcarnet=i),label:"N° Carnet",dense:"",outlined:"",rules:[i=>!!i||"Requerido"]},null,8,["modelValue","rules"])]),n("div",S,[s(r,{modelValue:e.form.expedido,"onUpdate:modelValue":o[5]||(o[5]=i=>e.form.expedido=i),label:"Expedido",dense:"",outlined:"",hint:"LP, CB, SC..."},null,8,["modelValue"])]),n("div",N,[s(r,{modelValue:e.form.fec_nacimiento,"onUpdate:modelValue":o[6]||(o[6]=i=>e.form.fec_nacimiento=i),type:"date",label:"Nacimiento",dense:"",outlined:""},null,8,["modelValue"])]),n("div",w,[s(m,{modelValue:e.form.sexo,"onUpdate:modelValue":o[7]||(o[7]=i=>e.form.sexo=i),options:e.sexoOptions,label:"Sexo",dense:"",outlined:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),n("div",F,[s(r,{modelValue:e.form.direccion,"onUpdate:modelValue":o[8]||(o[8]=i=>e.form.direccion=i),type:"textarea",label:"Dirección",dense:"",outlined:"",autogrow:""},null,8,["modelValue"])]),n("div",E,[s(r,{modelValue:e.form.comunidad,"onUpdate:modelValue":o[9]||(o[9]=i=>e.form.comunidad=i),label:"Comunidad",dense:"",outlined:""},null,8,["modelValue"])]),n("div",Q,[s(m,{modelValue:e.form.proveedor,"onUpdate:modelValue":o[10]||(o[10]=i=>e.form.proveedor=i),label:"Proveedor",options:e.tipos,dense:"",outlined:""},null,8,["modelValue","options"])]),n("div",A,[s(r,{modelValue:e.form.cip_acopio,"onUpdate:modelValue":o[11]||(o[11]=i=>e.form.cip_acopio=i),label:"CIP Acopio",dense:"",outlined:""},null,8,["modelValue"])]),n("div",q,[s(r,{modelValue:e.form.num_celular,"onUpdate:modelValue":o[12]||(o[12]=i=>e.form.num_celular=i),label:"Celular",dense:"",outlined:""},null,8,["modelValue"])]),n("div",B,[s(r,{modelValue:e.form.ocupacion,"onUpdate:modelValue":o[13]||(o[13]=i=>e.form.ocupacion=i),label:"Ocupación",dense:"",outlined:""},null,8,["modelValue"])]),n("div",D,[s(r,{modelValue:e.form.seleccion,"onUpdate:modelValue":o[14]||(o[14]=i=>e.form.seleccion=i),modelModifiers:{number:!0},type:"number",label:"Selección",dense:"",outlined:""},null,8,["modelValue"])]),n("div",L,[s(m,{modelValue:e.form.organizacion,"onUpdate:modelValue":o[15]||(o[15]=i=>e.form.organizacion=i),label:"Organización",dense:"",outlined:"","use-input":"","fill-input":"","input-debounce":"300",options:e.orgOptions,"option-label":"nombre_organiza","emit-value":"","map-options":"",clearable:"",onFilter:c.filterOrganizaciones,loading:e.orgLoading,hint:"Escribe para buscar"},{"no-option":d(()=>[s(v,null,{default:d(()=>[s(x,{class:"text-grey"},{default:d(()=>o[21]||(o[21]=[a("Sin resultados")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","loading"])]),n("div",M,[o[22]||(o[22]=n("b",null,"DEPT:",-1)),a(" "+u(e.form.organizacion?.departamento.nombre_departamento),1)]),n("div",R,[o[23]||(o[23]=n("b",null,"Mun:",-1)),a(" "+u(e.form.organizacion?.municipio.nombre_municipio),1)]),n("div",k,[o[24]||(o[24]=n("b",null,"Prov:",-1)),a(" "+u(e.form.organizacion?.provincia.nombre_provincia),1)]),n("div",G,[s(r,{modelValue:e.form.fecha_registro,"onUpdate:modelValue":o[16]||(o[16]=i=>e.form.fecha_registro=i),type:"date",label:"Fecha Registro",dense:"",outlined:""},null,8,["modelValue"])]),n("div",j,[s(r,{modelValue:e.form.fecha_expiracion,"onUpdate:modelValue":o[17]||(o[17]=i=>e.form.fecha_expiracion=i),type:"date",label:"Fecha Expiración",dense:"",outlined:""},null,8,["modelValue"])]),n("div",H,[s(m,{modelValue:e.form.estado,"onUpdate:modelValue":o[18]||(o[18]=i=>e.form.estado=i),options:["VIGENTE","VENCIDO","ACTIVO","INACTIVO"],label:"Estado",dense:"",outlined:""},null,8,["modelValue"])]),n("div",J,[s(r,{modelValue:e.form.otros,"onUpdate:modelValue":o[19]||(o[19]=i=>e.form.otros=i),type:"textarea",label:"Otros",dense:"",outlined:"",autogrow:""},null,8,["modelValue"])])]),n("div",K,[s(g,{flat:"",color:"negative",label:"Cancelar",disable:e.saving,onClick:o[20]||(o[20]=i=>l.$emit("cancel"))},null,8,["disable"]),s(g,{color:"primary",label:e.form.id?"Guardar cambios":"Crear productor",type:"submit",loading:e.saving},null,8,["label","loading"])])]),_:1},8,["onSubmit"])}const eo=h(U,[["render",W],["__scopeId","data-v-ffd5aa44"]]);export{eo as P};
